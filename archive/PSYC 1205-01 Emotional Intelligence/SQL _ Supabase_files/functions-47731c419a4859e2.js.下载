(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8447],{90975:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/functions",function(){return s(56498)}])},55527:function(e,t,s){"use strict";s.d(t,{p:function(){return l}});var n=s(97458),a=s(43633),i=s(27477);let l=e=>{let{title:t,description:s,docsUrl:l,actions:r,className:c}=e;return(0,n.jsxs)("div",{className:(0,a.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(c)),children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),s&&(0,n.jsx)("div",{className:"prose text-sm max-w-full",children:s})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==l&&(0,n.jsx)(i.G,{href:l}),r]})]})}},37315:function(e,t,s){"use strict";var n=s(97458),a=s(19369);t.Z=e=>{let{resourceText:t,isFullPage:s=!1}=e,i=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(a.Z,{size:20})}),(0,n.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)("div",{className:"w-[550px]",children:(0,n.jsx)(i,{})})}):(0,n.jsx)(i,{})}},56498:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return q}});var n=s(97458),a=s(40540),i=s(52983),l=s(63640),r=s(21823),c=s(71607),o=s.n(c),d=s(50663),u=s.n(d),x=s(16696),h=s(32691),m=s(73512),f=s(32672),p=s(47594),j=s(2052),g=s(84261),b=s(2861),v=s(58427),N=s(61115),w=s(77546),y=s(1447),Z=s(94281),k=s(50998),S=s(61958),_=s(41212),C=s(60661),L=s(8294),R=s(73692),F=s(42876),A=s.n(F),z=s(71635),E=s.n(z),V=s(84053),T=s(28346),P=s(35323),I=s(48631),U=s(26597),X=s(53486),D=s(15011),Q=e=>{let{schema:t,filterString:s,isLocked:i,editFunction:l=o(),deleteFunction:r=o()}=e,c=(0,h.useRouter)(),{project:d}=(0,f.d2)(),{setAiAssistantPanel:u}=(0,_.WZ)(),{data:x}=(0,w.R)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),m=(null!=x?x:[]).filter(e=>A()(e.name.toLowerCase(),s.toLowerCase())),p=E()(m.filter(e=>e.schema==t),e=>e.name.toLocaleLowerCase()),g=null==d?void 0:d.ref,v=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"functions");return 0===p.length&&0===s.length?(0,n.jsx)(j.Z.tr,{children:(0,n.jsxs)(j.Z.td,{colSpan:5,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No functions created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no functions found in the schema "',t,'"']})]})},t):0===p.length&&s.length>0?(0,n.jsx)(j.Z.tr,{children:(0,n.jsxs)(j.Z.td,{colSpan:5,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',s,'" did not return any results']})]})},t):(0,n.jsx)(n.Fragment,{children:p.map(e=>{let s="public"==t&&"trigger"!==e.return_type;return(0,n.jsxs)(j.Z.tr,{children:[(0,n.jsx)(j.Z.td,{className:"truncate",children:(0,n.jsx)(X.z,{type:"text",className:"text-foreground p-0 hover:bg-transparent",onClick:()=>l(e),children:e.name})}),(0,n.jsx)(j.Z.td,{className:"table-cell overflow-auto",children:(0,n.jsx)("p",{title:e.argument_types,className:"truncate",children:e.argument_types||"-"})}),(0,n.jsx)(j.Z.td,{className:"table-cell",children:(0,n.jsx)("p",{title:e.return_type,children:e.return_type})}),(0,n.jsx)(j.Z.td,{className:"table-cell",children:e.security_definer?"Definer":"Invoker"}),(0,n.jsx)(j.Z.td,{className:"text-right",children:!i&&(0,n.jsx)("div",{className:"flex items-center justify-end",children:v?(0,n.jsxs)(D.h_,{children:[(0,n.jsx)(D.$F,{asChild:!0,children:(0,n.jsx)(X.z,{type:"default",className:"px-1",icon:(0,n.jsx)(V.Z,{})})}),(0,n.jsxs)(D.AW,{side:"left",className:"w-52",children:[s&&(0,n.jsxs)(D.Xi,{className:"space-x-2",onClick:()=>c.push("/project/".concat(g,"/api?rpc=").concat(e.name)),children:[(0,n.jsx)(T.Z,{size:14}),(0,n.jsx)("p",{children:"Client API docs"})]}),(0,n.jsxs)(D.Xi,{className:"space-x-2",onClick:()=>l(e),children:[(0,n.jsx)(P.Z,{size:14}),(0,n.jsx)("p",{children:"Edit function"})]}),(0,n.jsxs)(D.Xi,{className:"space-x-2",onClick:()=>{u({open:!0,initialInput:"Update this function to do...",suggestions:{title:"I can help you make a change to this function, here are a few example prompts to get you started:",prompts:["Rename this function to ...","Modify this function so that it ...","Add a trigger for this function that calls it when ..."]},sqlSnippets:[e.complete_statement]})},children:[(0,n.jsx)(I.Z,{size:14}),(0,n.jsx)("p",{children:"Edit function with Assistant"})]}),(0,n.jsx)(D.VD,{}),(0,n.jsxs)(D.Xi,{className:"space-x-2",onClick:()=>r(e),children:[(0,n.jsx)(U.Z,{size:14,className:"text-destructive"}),(0,n.jsx)("p",{children:"Delete function"})]})]})]}):(0,n.jsx)(b.u,{disabled:!0,type:"default",icon:(0,n.jsx)(V.Z,{}),className:"px-1",tooltip:{content:{side:"left",text:"You need additional permissions to update functions"}}})})})]},e.id)})})},W=e=>{let{createFunction:t=o(),editFunction:s=o(),deleteFunction:i=o()}=e,l=(0,h.useRouter)(),{search:r}=(0,m.UO)(),{project:c}=(0,f.d2)(),{setAiAssistantPanel:d}=(0,_.WZ)(),{selectedSchema:F,setSelectedSchema:A}=(0,k.B)(),z=null!=r?r:"",E=e=>{let t=new URL(document.URL);""===e?t.searchParams.delete("search"):t.searchParams.set("search",e),l.push(t)},V=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"functions"),{data:T}=(0,y.Q1)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),[P]=u()(null!=T?T:[],e=>{var t;return S.s.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),I=null==T?void 0:T.find(e=>e.name===F),U=P.some(e=>e.id===(null==I?void 0:I.id)),{data:X,error:D,isLoading:W,isError:B}=(0,w.R)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString});return W?(0,n.jsx)(N.A,{}):B?(0,n.jsx)(g.Z,{error:D,subject:"Failed to retrieve database functions"}):(0,n.jsx)(n.Fragment,{children:0==(null!=X?X:[]).length?(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,n.jsxs)(p.Z,{title:"Functions",ctaButtonLabel:"Create a new function",onClickCta:()=>t(),disabled:!V,disabledMessage:"You need additional permissions to create functions",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"PostgreSQL functions, also known as stored procedures, is a set of SQL and procedural commands such as declarations, assignments, loops, flow-of-control, etc."}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"It's stored on the database server and can be invoked using the SQL interface."})]})}):(0,n.jsxs)("div",{className:"w-full space-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[(0,n.jsx)(v.Z,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:F,onSelectSchema:e=>{let t=new URL(document.URL);t.searchParams.delete("search"),l.push(t),A(e)}}),(0,n.jsx)(C.Z,{placeholder:"Search for a function",size:"tiny",icon:(0,n.jsx)(x.Z,{size:14}),value:z,className:"w-full lg:w-52",onChange:e=>E(e.target.value)})]}),(0,n.jsx)("div",{className:"flex items-center gap-x-2",children:!U&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b.u,{disabled:!V,onClick:()=>t(),className:"flex-grow",tooltip:{content:{side:"bottom",text:V?void 0:"You need additional permissions to create functions"}},children:"Create a new function"}),(0,n.jsx)(b.u,{type:"default",disabled:!V,className:"px-1 pointer-events-auto",icon:(0,n.jsx)(L.c,{size:16}),onClick:()=>d({open:!0,initialInput:"Create a new function for the schema ".concat(F," that does ...")}),tooltip:{content:{side:"bottom",text:V?"Create with Supabase Assistant":"You need additional permissions to create functions"}}})]})})]}),U&&(0,n.jsx)(R.Z,{schema:F,entity:"functions"}),(0,n.jsx)(j.Z,{className:"table-fixed overflow-x-auto",head:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.Z.th,{children:"Name"},"name"),(0,n.jsx)(j.Z.th,{className:"table-cell",children:"Arguments"},"arguments"),(0,n.jsx)(j.Z.th,{className:"table-cell",children:"Return type"},"return_type"),(0,n.jsx)(j.Z.th,{className:"table-cell w-[100px]",children:"Security"},"security"),(0,n.jsx)(j.Z.th,{className:"w-1/6"},"buttons")]}),body:(0,n.jsx)(Q,{schema:F,filterString:z,isLocked:U,editFunction:s,deleteFunction:i})})]})})},B=s(405),M=s(38057),O=s(33838),Y=s(55527),$=s(37315);let K=()=>{let[e,t]=(0,i.useState)(),[s,c]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),{setEditorPanel:u}=(0,_.WZ)(),x=(0,l.uL)(),h=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_READ,"functions");return(0,Z.N4)()&&!h?(0,n.jsx)($.Z,{isFullPage:!0,resourceText:"view database functions"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O._S,{children:(0,n.jsx)(O.jX,{children:(0,n.jsxs)("div",{className:"col-span-12",children:[(0,n.jsx)(Y.p,{title:"Database Functions",docsUrl:"https://supabase.com/docs/guides/database/functions"}),(0,n.jsx)(W,{createFunction:()=>{x?u({open:!0,initialValue:"create function function_name()\nreturns void\nlanguage plpgsql\nas $$\nbegin\n  -- Write your function logic here\nend;\n$$;",label:"Create new database function",saveLabel:"Create function",initialPrompt:"Create a new database function that..."}):(t(void 0),c(!0))},editFunction:e=>{x?u({open:!0,initialValue:e.complete_statement,label:'Edit function "'.concat(e.name,'"'),saveLabel:"Update function",initialPrompt:'Update the database function "'.concat(e.name,'" to...')}):(t(e),c(!0))},deleteFunction:e=>{t(e),d(!0)}})]})})}),(0,n.jsx)(r.B8,{func:e,visible:s,setVisible:c}),(0,n.jsx)(r.ZR,{func:e,visible:o,setVisible:d})]})};K.getLayout=e=>(0,n.jsx)(M.Z,{children:(0,n.jsx)(B.Z,{title:"Database",children:e})});var q=K},35323:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(74234).Z)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},28289:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var n=s(97458),a=s(52983),i=s(17199),l=s(75675);function r(e,t){if(!t.error)return delete e[t.key],e;if(t)return{...e,[t.key]:t.error};throw Error()}function c(e){let{validate:t,...s}=e,[c,o]=(0,a.useReducer)(r,null),d=(0,i.TA)({validateOnBlur:!0,...s,validationSchema:s.validationSchema,initialValues:s.initialValues,onSubmit:s.onSubmit,validate:t||function(){return c}});return(0,n.jsx)("form",{id:s.id,name:s.name,onSubmit:d.handleSubmit,className:s.className,style:s.style,method:"POST",children:(0,n.jsx)(l.o,{values:d.values,errors:d.errors,formContextOnChange:d.handleChange,handleBlur:d.handleBlur,touched:d.touched,fieldLevelValidation:function(e,t){o({key:e,error:t})},children:s.children({errors:d.errors,touched:d.touched,isSubmitting:d.isSubmitting,isValidating:d.isValidating,submitCount:d.submitCount,initialValues:d.initialValues,values:d.values,handleReset:d.handleReset,resetForm:d.resetForm,setFieldValue:d.setFieldValue})})})}},104:function(e,t,s){"use strict";s.d(t,{r:function(){return d}});var n=s(97458),a=s(56384),i=s(31706),l=s(52983),r=s(43633);let c=(0,i.j)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),o=(0,i.j)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),d=l.forwardRef((e,t)=>{let{className:s,size:i,...l}=e;return(0,n.jsx)(a.fC,{className:(0,r.cn)(c({size:i}),s),...l,ref:t,children:(0,n.jsx)(a.bU,{className:(0,r.cn)(o({size:i}))})})});d.displayName=a.fC.displayName}},function(e){e.O(0,[6665,3659,7186,7623,588,7037,8e3,6402,4418,8703,2303,6823,6499,4837,3297,441,1577,5605,1503,7702,5834,7198,3535,8232,3048,7199,5538,3767,2347,8777,8005,2578,1446,9198,4554,5631,8803,8482,5618,3881,9774,2888,179],function(){return e(e.s=90975)}),_N_E=e.O()}]);