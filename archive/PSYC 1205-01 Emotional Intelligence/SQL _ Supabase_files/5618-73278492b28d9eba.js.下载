"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5618],{11181:function(e,n,t){t.d(n,{z:function(){return W},v:function(){return Y}});var r=t(97458),a=t(52983),l=t(29442),i=t(63969),o=t(63730),s=t(73512),c=t(32672),d=t(15834),u=t(81541),m=t(29125),f=t(25135),p=t(5688),h=t(11152),g=t(8427),x=t(92063),v=t(77655),b=t(66266);function y(e){let{gridRef:n,rows:t}=e,r=(0,h.uM)(),{gridColumns:l}=(0,x.Qq)(),i=(0,a.useMemo)(()=>{var e,n;return"windows"==((null===(e=navigator)||void 0===e?void 0:e.appVersion.indexOf("Win"))!==-1?"windows":(null===(n=navigator)||void 0===n?void 0:n.appVersion.indexOf("Mac"))!==-1?"macos":"unknown")?"Control":"Command"},[]);return(0,b.a)({["".concat(i,"+ArrowUp")]:e=>{if(e.stopPropagation(),r.selectedCellPosition){var t,a;let e={idx:null!==(a=null===(t=r.selectedCellPosition)||void 0===t?void 0:t.idx)&&void 0!==a?a:0,rowIdx:0};n.current.selectCell(e)}else n.current.scrollToCell({rowIdx:Number(0)})},["".concat(i,"+ArrowDown")]:e=>{if(e.stopPropagation(),r.selectedCellPosition){var a,l;let e={idx:null!==(l=null===(a=r.selectedCellPosition)||void 0===a?void 0:a.idx)&&void 0!==l?l:0,rowIdx:t.length>1?t.length-1:0};n.current.selectCell(e)}else n.current.scrollToCell({rowIdx:Number(t.length)})},["".concat(i,"+ArrowLeft")]:e=>{var t,a;e.stopPropagation();let i={idx:l.filter(e=>e.frozen).length,rowIdx:null!==(a=null===(t=r.selectedCellPosition)||void 0===t?void 0:t.rowIdx)&&void 0!==a?a:0};n.current.selectCell(i)},["".concat(i,"+ArrowRight")]:e=>{var t,a,i;e.stopPropagation(),null===(a=n.current)||void 0===a||a.selectCell({idx:l.length-2,rowIdx:null!==(i=null===(t=r.selectedCellPosition)||void 0===t?void 0:t.rowIdx)&&void 0!==i?i:0})},["".concat(i,"+c")]:e=>{if(e.stopPropagation(),r.selectedCellPosition){let{idx:e,rowIdx:i}=r.selectedCellPosition;if(e>0){var n,a;let r=l[e].key,o=null!==(a=null===(n=t[i])||void 0===n?void 0:n[r])&&void 0!==a?a:"",s=(0,v.Lw)(o);(0,v.vQ)(s)}}}},["INPUT","TEXTAREA","SELECT"]),null}var j=t(85743),_=t(12832),N=t(44914),w=t(87595),C=t(42010),k=t(37990),E=t(84261),S=t(89548),R=t(59884),q=t(9881),A=t(6433),I=t(43633),O=t(53486),L=t(70717),T=t(33482);function z(e,n){let{show:t}=(0,L.av)();return(0,r.jsx)(N.X2,{...n,onContextMenu:function(e){t(e,{id:T.ep,props:{rowIdx:n.rowIdx}})}},e)}let D=e=>{var n;return null!==(n=null==e?void 0:e.idx)&&void 0!==n?n:-1},P=(0,_.Z)((e,n,t)=>{t({type:"UPDATE_COLUMN_SIZE",payload:{index:e,width:Math.round(n)}})},500),Z=(0,w.X$)((0,a.forwardRef)((e,n)=>{var t;let{width:l,height:i,containerClass:o,gridClass:s,rowClass:d,rows:u,error:m,isLoading:f,isSuccess:p,isError:g,filters:y,setParams:j,updateRow:_,onAddRow:w,onImportData:L,onEditForeignKeyColumnValue:T}=e,Z=(0,x.I0)(),F=(0,h.uM)(),U=(0,x.Qq)();async function M(e,n){let t=e[n.indexes[0]],r=u.find(e=>e.idx==t.idx),a=Object.keys(t).find(e=>t[e]!==r[e]);a&&_(r,{[a]:t[a]})}let Y=(0,a.useRef)(null);function K(){var e,n,t,r;let a=null===(r=Y.current)||void 0===r?void 0:null===(t=r.row)||void 0===t?void 0:t[null===(n=Y.current)||void 0===n?void 0:null===(e=n.column)||void 0===e?void 0:e.key],l=(0,v.Lw)(a);l&&(0,A.vQ)(l)}(0,b.a)({"Command+c":e=>{e.stopPropagation(),K()},"Control+c":e=>{e.stopPropagation(),K()}},["INPUT","TEXTAREA"]);let W=U.table,{mutate:$}=(0,R.a)(),H=(0,q.l)(),{project:J}=(0,c.d2)(),{data:V}=(0,S.XJ)({projectRef:null==J?void 0:J.ref,connectionString:null==J?void 0:J.connectionString,schema:null!==(t=null==W?void 0:W.schema)&&void 0!==t?t:void 0}),B=()=>{j(e=>({...e,filter:[]}))};return(0,r.jsx)("div",{className:(0,I.cn)("flex flex-col",o),style:{width:l||"100%",height:i||"50vh"},children:(0,r.jsx)(N.ZP,{ref:n,className:"".concat(s," flex-grow"),rowClass:d,columns:U.gridColumns,rows:null!=u?u:[],renderers:{renderRow:z,noRowsFallback:(0,r.jsxs)("div",{style:{width:"calc(100vw - 255px - 55px)"},children:[f&&(0,r.jsx)(C.U,{}),g&&(0,r.jsx)("div",{className:"p-2 col-span-full",children:(0,r.jsx)(E.Z,{error:m,subject:"Failed to retrieve rows from table"})}),p&&(0,r.jsx)(r.Fragment,{children:0===(null!=y?y:[]).length?(0,r.jsxs)("div",{style:{height:"calc(100% - 35px)"},className:"flex flex-col items-center justify-center col-span-full",children:[(0,r.jsx)("p",{className:"text-sm text-light",children:"This table is empty"}),void 0!==w&&void 0!==L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-sm text-light mt-1",children:"Add rows to your table to get started."}),(0,r.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:void 0!==w&&void 0!==L&&(0,r.jsx)(O.z,{type:"default",onClick:()=>{var e,n;L(),$({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:null!==(e=null==J?void 0:J.ref)&&void 0!==e?e:"Unknown",organization:null!==(n=null==H?void 0:H.slug)&&void 0!==n?n:"Unknown"}})},children:"Import data from CSV"})})]})]}):(0,r.jsxs)("div",{style:{height:"calc(100% - 35px)"},className:"flex flex-col items-center justify-center col-span-full",children:[(0,r.jsx)("p",{className:"text-sm text-light",children:"The filters applied have returned no results from this table"}),(0,r.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,r.jsx)(O.z,{type:"default",onClick:()=>B(),children:"Remove all filters"})})]})})]})},rowKeyGetter:D,selectedRows:F.selectedRows,onColumnResize:function(e,n){P(e,n,Z)},onRowsChange:M,onSelectedCellChange:function(e){Y.current=e,F.setSelectedCellPosition({idx:e.column.idx,rowIdx:e.rowIdx})},onSelectedRowsChange:function(e){F.setSelectedRows(e)},onCellDoubleClick:e=>(function(e,n){let t=function(e){var n,t;let{targetTableSchema:r,targetTableName:a,targetColumnName:l}=null!==(t=null==W?void 0:null===(n=W.columns.find(n=>n.name==e))||void 0===n?void 0:n.foreignKey)&&void 0!==t?t:{},i=null==V?void 0:V.find(n=>n.source_schema===(null==W?void 0:W.schema)&&n.source_table===(null==W?void 0:W.name)&&n.source_columns.includes(e)&&n.target_schema===r&&n.target_table===a&&n.target_columns.includes(l));return void 0!==i?(0,k.S)([i])[0]:void 0}(n.name);t&&T({foreignKey:t,row:e,column:n})})(e.row,e.column)})})}));var F=t(65378),U=t(69824),M=t(80368);function Y(e,n,t){let r=(0,g.x4)(U.E_,e),a=localStorage.getItem(r);if(a)return JSON.parse(a)[t&&"public"!=t?"".concat(t,".").concat(n):n]}async function K(e,n,t,r,a){var l,i;let o=e.projectRef?Y(e.projectRef,e.table.name,e.table.schema):void 0;if(!n.isInitialComplete&&void 0===r&&void 0===a&&((null==o?void 0:o.sorts)||(null==o?void 0:o.filters)))return{savedState:{sorts:o.sorts,filters:o.filters}};let s=(0,M.cv)(e.table,{projectRef:e.projectRef,tableId:e.tableId,editable:e.editable,defaultWidth:null===(l=e.gridProps)||void 0===l?void 0:l.defaultColumnWidth,onAddColumn:e.editable?e.onAddColumn:void 0,onExpandJSONEditor:e.onExpandJSONEditor,onExpandTextEditor:e.onExpandTextEditor});return t({type:"INIT_TABLE",payload:{table:e.table,gridProps:e.gridProps,gridColumns:s,savedState:o,editable:e.editable,onError:null!==(i=e.onError)&&void 0!==i?i:e=>{console.error("Supabase grid error: ",e)}}}),{savedState:{}}}let W=e=>{let n=(0,g.cc)(e);return(0,r.jsx)(x.g3,{children:(0,r.jsx)(l.W,{backend:i.PD,context:window,children:(0,r.jsx)($,{...n})})})},$=e=>{var n,t,l,i;let{editable:v,projectRef:b,gridProps:_,headerActions:N,showCustomChildren:w,customHeader:C,children:k,onAddRow:E,onAddColumn:S,updateTableRow:R,onEditForeignKeyColumnValue:q,onImportData:A}=e,{id:I}=(0,s.UO)(),O=(0,x.I0)(),L=(0,x.Qq)(),z=(0,p._2)(),D=(0,h.uM)(),P=(0,a.useRef)(null),[U,M]=(0,a.useState)(!1),[{sort:Y,filter:W},$]=(0,u.x)({arrayKeys:["sort","filter"]}),H=(0,g.rg)(e.table.name,Y),J=(0,g.Yb)(W),V=(0,f.fN)(),{project:B}=(0,c.d2)(),{data:Q,error:G,isSuccess:X,isError:ee,isLoading:en,isRefetching:et}=(0,d.KK)({projectRef:null==B?void 0:B.ref,connectionString:null==B?void 0:B.connectionString,tableId:e.table.id,sorts:H,filters:J,page:D.page,limit:z.rowsPerPage,impersonatedRole:V.role},{keepPreviousData:!0,retryDelay:(e,n)=>{var t;return(n&&(null===(t=n.message)||void 0===t?void 0:t.includes("does not exist"))&&$(e=>({...e,sort:void 0})),e>3)?1/0:5e3}});return(0,a.useEffect)(()=>{U||M(!0)},[]),(0,a.useEffect)(()=>{L.isInitialComplete&&b&&L.table&&(0,g.Tf)(L,b,Y,W)},[L.table,L.isInitialComplete,L.gridColumns,JSON.stringify(H),JSON.stringify(J),b]),(0,a.useEffect)(()=>{O({type:"INIT_CALLBACK",payload:{...e}})},[]),(0,a.useEffect)(()=>{let n=async()=>{let{savedState:n}=await K({...e,tableId:I},L,O,Y,W);(n.sorts||n.filters)&&$(e=>({...e,...n.sorts&&{sort:n.sorts},...n.filters&&{filter:n.filters}}))},t=JSON.stringify(e.table)!==JSON.stringify(L.table);(!L.table||t)&&n()},[L.table,e.table,e.schema]),(0,r.jsxs)("div",{className:"sb-grid h-full flex flex-col",children:[(0,r.jsx)(F.ZP,{table:e.table,sorts:H,filters:J,onAddRow:v&&(null!==(n=e.table.columns)&&void 0!==n?n:[]).length>0?E:void 0,onAddColumn:v?S:void 0,onImportData:v?A:void 0,headerActions:N,customHeader:C}),w&&void 0!==k?(0,r.jsx)(r.Fragment,{children:k}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Z,{ref:P,..._,rows:null!==(t=null==Q?void 0:Q.rows)&&void 0!==t?t:m.Z6,error:G,isLoading:en,isSuccess:X,isError:ee,filters:J,setParams:$,updateRow:R,onAddRow:E,onImportData:A,onEditForeignKeyColumnValue:q}),(0,r.jsx)(j.Z,{isRefetching:et}),(0,r.jsx)(y,{gridRef:P,rows:null!==(l=null==Q?void 0:Q.rows)&&void 0!==l?l:m.Z6})]}),U&&(0,o.createPortal)((0,r.jsx)(T.q4,{rows:null!==(i=null==Q?void 0:Q.rows)&&void 0!==i?i:m.Z6}),document.body)]})}},8427:function(e,n,t){t.d(n,{NK:function(){return m},Tf:function(){return f},Yb:function(){return u},cc:function(){return c},rg:function(){return d},x4:function(){return p}});var r=t(12832),a=t(6494),l=t.n(a),i=t(67305),o=t(89831),s=t(69824);function c(e){let{editable:n}=e;return n?e:{...e,onAddColumn:void 0,onAddRow:void 0,onEditColumn:void 0,onDeleteColumn:void 0,onEditRow:void 0}}function d(e,n){return Array.isArray(n)?l()(n.map(n=>{let[t,r]=n.split(":");if(t&&r)return{table:e,column:t,ascending:"asc"===r}})):[]}function u(e){return Array.isArray(e)?e.map(e=>{let[n,t,...r]=e.split(":"),a=r.join(":"),l=o.o.find(e=>e.abbrev===t);if(n&&t&&l)return{column:n,operator:l.value,value:a||""}}).filter(e=>void 0!==e):[]}function m(e){let n=e.columns,t=(0,i.N3)(e)?e.primary_keys:[],r=(0,i.N3)(e)?e.relationships:[],a=n.map(e=>{let n={position:e.ordinal_position,name:e.name,defaultValue:e.default_value,dataType:e.data_type,format:e.format,isPrimaryKey:!1,isIdentity:e.is_identity,isGeneratable:"BY DEFAULT"==e.identity_generation,isNullable:e.is_nullable,isUpdatable:e.is_updatable,enum:e.enums,comment:e.comment,foreignKey:{targetTableSchema:null,targetTableName:null,targetColumnName:null,deletionAction:void 0,updateAction:void 0}},a=t.find(n=>n.name==e.name);n.isPrimaryKey=!!a;let l=r.find(n=>n.source_schema===e.schema&&n.source_table_name===e.table&&n.source_column_name===e.name);return l&&(n.foreignKey.targetTableSchema=l.target_table_schema,n.foreignKey.targetTableName=l.target_table_name,n.foreignKey.targetColumnName=l.target_column_name,n.foreignKey.deletionAction=l.deletion_action,n.foreignKey.updateAction=l.update_action),n});return{id:e.id,name:e.name,comment:e.comment,schema:e.schema,columns:a,estimateRowCount:(0,i.N3)(e)?e.live_rows_estimate:0}}let f=(0,r.Z)(function(e,n,t,r){let a;if(!e.table)return;let l={gridColumns:e.gridColumns,...void 0!==t&&{sorts:t},...void 0!==r&&{filters:r}},i=p(s.E_,n),o=localStorage.getItem(i),{name:c,schema:d}=e.table,u=d&&"public"!=d?"".concat(d,".").concat(c):c;a=o?{...a=JSON.parse(o),[u]:l}:{[u]:l},localStorage.setItem(i,JSON.stringify(a))},500);function p(e,n){return"".concat(e,"_").concat(n)}},36180:function(e,n,t){t.d(n,{F:function(){return l}});var r=t(97458),a=t(15011);let l=e=>{let{children:n,side:t,align:l,options:i,onSelect:o}=e;return(0,r.jsxs)(a.h_,{children:[(0,r.jsx)(a.$F,{children:n}),(0,r.jsx)(a.AW,{side:t,align:l,children:(0,r.jsxs)("div",{className:"dropdown-control",style:{maxHeight:"30vh"},children:[0===i.length&&(0,r.jsx)("p",{className:"dropdown-control__empty-text",children:"No more items"}),i.map(e=>(0,r.jsx)(a.Xi,{onClick:()=>o(e.value),children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[e.preLabel&&(0,r.jsx)("span",{className:"grow text-foreground-lighter",children:e.preLabel}),(0,r.jsx)("span",{children:e.label}),e.postLabel&&(0,r.jsx)("span",{className:"text-foreground-lighter",children:e.postLabel})]})},e.value))]})})]})}},66266:function(e,n,t){t.d(n,{a:function(){return l}});var r=t(52983);function a(e,n){return e.indexOf(n)>=0}function l(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],[l,i]=r.useState(),o=r=>{if(!e||a(n,r.target.nodeName)||a(t,r.target.className))return;let l=r.metaKey&&r.shiftKey?"Command+Shift+".concat(r.key):r.metaKey?"Command+".concat(r.key):r.shiftKey&&"Enter"===r.key?"Shift+".concat(r.key):r.ctrlKey&&r.key?"Control+".concat(r.key):r.key;e[l]&&(l.includes("+")?(r.preventDefault(),e[l](r),i(null)):(i(r.key),r.preventDefault()))},s=n=>{e&&e[n.key]&&l===n.key&&(n.preventDefault(),e[n.key](n),i(null))};r.useEffect(()=>(window.addEventListener("keydown",o),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",o),window.removeEventListener("keyup",s)}))}},43835:function(e,n,t){t.d(n,{r:function(){return l}});var r=t(97458),a=t(85229);let l=e=>{let{width:n,height:t,value:l,language:i,readOnly:o=!1,onChange:s,onMount:c}=e;return(0,r.jsx)(a.default,{width:n,height:t||"200px",theme:"supabase",wrapperProps:{className:"grid-monaco-editor-container"},className:"grid-monaco-editor",defaultLanguage:i||"plaintext",defaultValue:l,onChange:s,onMount:function(e){e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})});let n=e.getModel().getPositionAt(null==l?void 0:l.length);e.setPosition(n),setTimeout(()=>{null==e||e.focus()},0),c&&c(e)},options:{readOnly:o,tabSize:2,fontSize:13,minimap:{enabled:!1},glyphMargin:!1,folding:!1,lineNumbers:"off",lineNumbersMinChars:0,scrollBeyondLastLine:!1,wordWrap:"on"}})}},35977:function(e,n,t){t.d(n,{q:function(){return a}});var r=t(97458);let a=()=>(0,r.jsx)("span",{className:"null-value opacity-50",children:"NULL"})},85743:function(e,n,t){t.d(n,{Z:function(){return R}});var r=t(97458),a=t(73512),l=t(32672),i=t(67688),o=t(26369),s=t(6570),c=t(67305),d=t(81541),u=t(33937),m=t(72439),f=t(22002),p=t(29274),h=t(52983),g=t(8427),x=t(58793),v=t(25135),b=t(5688),y=t(11152),j=t(53486),_=t(50322),N=t(60586),w=t(15518),C=t(36180);let k=e=>{if(0===e)return"0";let n=Math.floor(Math.log(e)/Math.log(1e3)),t=n>4?"T":["","K","M","B","T"][n];return"".concat((e/Math.pow(1e3,n>4?4:n)).toFixed(1)).concat(t)},E=[{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1000 rows"}];var S=()=>{var e,n;let{id:t}=(0,a.UO)(),i=t?Number(t):void 0,{project:o}=(0,l.d2)(),u=(0,b._2)(),S=(0,y.uM)(),{data:R}=(0,s.iB)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,id:i}),q=(0,c.N3)(R)?R.live_rows_estimate:null,[{filter:A}]=(0,d.x)({arrayKeys:["filter"]}),I=(0,g.Yb)(A),O=S.page,L=(0,v.fN)(),[T,z]=(0,h.useState)(!1),[D,P]=(0,h.useState)(!1),[Z,F]=(0,h.useState)(!1),[U,M]=(0,h.useState)(O.toString());(0,h.useEffect)(()=>{M(String(O))},[O]);let{data:Y,isLoading:K,isSuccess:W,isError:$,isFetching:H}=(0,x.HS)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,tableId:i,filters:I,enforceExactCount:S.enforceExactCount,impersonatedRole:L.role},{keepPreviousData:!0}),J=(null==Y?void 0:Y.is_estimate)?k(Y.count):null==Y?void 0:Y.count.toLocaleString(),V=Math.ceil((null!==(e=null==Y?void 0:Y.count)&&void 0!==e?e:0)/u.rowsPerPage),B=(null!==(n=null==Y?void 0:Y.count)&&void 0!==n?n:0)>0?V:1,Q=()=>{X()},G=()=>{ee()},X=()=>{let e=O-1;S.setPage(e)},ee=()=>{let e=O+1;S.setPage(e)},en=e=>{let n=e>V?V:e;S.setPage(n||1)};return(0,h.useEffect)(()=>{O&&O>B&&S.setPage(B)},[O,B]),(0,h.useEffect)(()=>{void 0!==i&&S.setEnforceExactCount(null!==q&&q<=x.Fi)},[i]),(0,r.jsxs)("div",{className:"flex items-center gap-x-4",children:[K&&(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading records count..."}),W&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,r.jsx)(j.z,{icon:(0,r.jsx)(m.Z,{}),type:"outline",className:"px-1.5",disabled:O<=1||K,onClick:()=>{O>1&&(S.selectedRows.size>=1?P(!0):X())}}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,r.jsx)(N.I,{className:"w-12",size:"tiny",min:1,max:V,value:U,onChange:e=>M(e.target.value),onKeyDown:e=>{let n=Number(U);"Enter"===e.code&&!Number.isNaN(n)&&n>=1&&n<=V&&en(n)}}),(0,r.jsxs)("p",{className:"text-xs text-foreground-light",children:["of ",B.toLocaleString()]}),(0,r.jsx)(j.z,{icon:(0,r.jsx)(f.Z,{}),type:"outline",className:"px-1.5",disabled:O>=V||K,onClick:()=>{O<V&&(S.selectedRows.size>=1?z(!0):ee())}}),(0,r.jsx)(C.F,{options:E,onSelect:e=>{let n=Number(e);u.setRowsPerPage(isNaN(n)?100:n)},side:"top",align:"start",children:(0,r.jsx)(j.z,{asChild:!0,type:"outline",style:{padding:"3px 10px"},children:(0,r.jsx)("span",{children:"".concat(u.rowsPerPage," rows")})})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,r.jsxs)("p",{className:"text-xs text-foreground-light",children:["".concat(J," ").concat(0===Y.count||Y.count>1?"records":"record")," ",Y.is_estimate?"(estimated)":""]}),Y.is_estimate&&(0,r.jsxs)(_.u,{children:[(0,r.jsx)(_.aJ,{asChild:!0,children:(0,r.jsx)(j.z,{size:"tiny",type:"text",className:"px-1.5",loading:H,icon:(0,r.jsx)(p.Z,{}),onClick:()=>{null===q||Y.count>x.Fi?F(!0):S.setEnforceExactCount(!0)}})}),(0,r.jsxs)(_._v,{side:"top",className:"w-72",children:["This is an estimated value as your table has more than"," ",x.Fi.toLocaleString()," rows. ",(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"text-brand",children:"Click to retrieve the exact count of the table."})]})]})]})]}),$&&(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"Error fetching records count. Please refresh the page."}),(0,r.jsx)(w.Z,{visible:D,title:"Confirm moving to previous page",confirmLabel:"Confirm",onCancel:()=>P(!1),onConfirm:()=>{Q()},children:(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,r.jsx)(w.Z,{visible:T,title:"Confirm moving to next page",confirmLabel:"Confirm",onCancel:()=>z(!1),onConfirm:()=>{G()},children:(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,r.jsx)(w.Z,{variant:"warning",visible:Z,title:"Confirm to fetch exact count for table",confirmLabel:"Retrieve exact count",onCancel:()=>F(!1),onConfirm:()=>{S.setEnforceExactCount(!0),F(!1)},children:(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:null===q?"If your table has a row count of greater than ".concat(x.Fi.toLocaleString()," rows,\n          retrieving the exact count of the table may cause performance issues on your database."):"Your table has a row count of greater than ".concat(x.Fi.toLocaleString()," rows, and\n          retrieving the exact count of the table may cause performance issues on your database.")})})]})},R=e=>{let{isRefetching:n}=e,{project:t}=(0,l.d2)(),{id:m}=(0,a.UO)(),f=m?Number(m):void 0,{data:p}=(0,s.iB)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:f}),[{view:h="data"},g]=(0,d.x)(),x=(0,c.D1)(p),v=(0,c.N3)(p);return(0,r.jsxs)(i.x,{children:["data"===h&&(0,r.jsx)(S,{}),(0,r.jsxs)("div",{className:"ml-auto flex items-center gap-x-2",children:[p&&"data"===h&&(0,r.jsx)(u.Z,{table:p,isRefetching:n}),(x||v)&&(0,r.jsx)(o.Z,{width:75,options:["definition","data"],activeOption:h,borderOverride:"border",onClickOption:e=>{"data"===e?g({view:void 0}):g({view:e})}})]})]})}},65378:function(e,n,t){t.d(n,{kI:function(){return D},m0:function(){return P}});var r=t(97458),a=t(40540),l=t(12887),i=t.n(l),o=t(15647),s=t(28346),c=t(15676),d=t(26597),u=t(83145),m=t.n(u),f=t(49571),p=t.n(f),h=t(52983),g=t(34549),x=t(73512),v=t(92063),b=t(13537),y=t(32672),j=t(2861),_=t(58793),N=t(15834),w=t(59884),C=t(94281),k=t(9881),E=t(81541),S=t(25135),R=t(5688),q=t(11152),A=t(15011),I=t(53486),O=t(43633),L=t(47889),T=t(89798),z=t(15482);let D=5e5,P=(0,r.jsxs)(r.Fragment,{children:["Sorry! We're unable to support exporting row counts larger than $",D.toLocaleString()," at the moment. Alternatively, you may consider using",(0,r.jsx)(m(),{href:"https://supabase.com/docs/reference/cli/supabase-db-dump",target:"_blank",children:"pg_dump"})," ","via our CLI instead."]});n.ZP=e=>{let{table:n,sorts:t,filters:a,onAddColumn:l,onAddRow:i,onImportData:o,headerActions:s,customHeader:c}=e,d=(0,q.uM)();return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"flex h-10 items-center justify-between bg-dash-sidebar px-1.5 py-1.5 gap-2 overflow-x-auto",children:[c?(0,r.jsx)(r.Fragment,{children:c}):(0,r.jsx)(r.Fragment,{children:d.selectedRows.size>0?(0,r.jsx)(F,{table:n,sorts:t,filters:a}):(0,r.jsx)(Z,{table:n,onAddColumn:l,onAddRow:i,onImportData:o})}),(0,r.jsx)("div",{className:"sb-grid-header__inner",children:s})]})})};let Z=e=>{let{table:n,onAddColumn:t,onAddRow:l,onImportData:i}=e,{ref:d}=(0,x.UO)(),u=(0,k.l)(),m=(0,C.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"columns"),[{filter:f,sort:p},h]=(0,E.x)({arrayKeys:["sort","filter"]}),{mutate:g}=(0,w.a)();return(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(T.Z,{table:n,filters:f,setParams:h}),(0,r.jsx)(z.f,{table:n,sorts:p,setParams:h})]}),(void 0!==l||void 0!==t)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:m&&(0,r.jsxs)(A.h_,{children:[(0,r.jsx)(A.$F,{asChild:!0,children:(0,r.jsx)(I.z,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,r.jsx)(o.Z,{strokeWidth:1.5}),children:"Insert"})}),(0,r.jsx)(A.AW,{side:"bottom",align:"start",children:[...void 0!==l?[(0,r.jsxs)(A.Xi,{className:"group space-x-2",onClick:l,children:[(0,r.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,r.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,r.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,r.jsx)("div",{className:(0,O.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:"Insert row"}),(0,r.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",n.name]})]})]},"add-row")]:[],...void 0!==t?[(0,r.jsxs)(A.Xi,{className:"group space-x-2",onClick:t,children:[(0,r.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,r.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,r.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,r.jsx)("div",{className:(0,O.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:"Insert column"}),(0,r.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",n.name]})]})]},"add-column")]:[],...void 0!==i?[(0,r.jsxs)(A.Xi,{className:"group space-x-2",onClick:()=>{var e;i(),g({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:null!=d?d:"Unknown",organization:null!==(e=null==u?void 0:u.slug)&&void 0!==e?e:"Unknown"}})},children:[(0,r.jsxs)("div",{className:"relative -mt-2",children:[(0,r.jsx)(s.Z,{size:18,strokeWidth:1.5,className:"-translate-x-[2px]"}),(0,r.jsx)(c.Z,{className:(0,O.cn)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:"Import data from CSV"}),(0,r.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]})})]})]})},F=e=>{var n,t;let{table:a,sorts:l,filters:s}=e,c=(0,v.Qq)(),{project:u}=(0,y.d2)(),m=(0,R._2)(),f=(0,q.uM)(),x=(0,S.fN)(),w=void 0!==x.role,[C,k]=(0,h.useState)(!1),{data:E}=(0,N.KK)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,tableId:a.id,sorts:l,filters:s,page:f.page,limit:m.rowsPerPage,impersonatedRole:x.role}),{data:O}=(0,_.HS)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,tableId:a.id,filters:s,enforceExactCount:f.enforceExactCount,impersonatedRole:x.role},{keepPreviousData:!0}),T=()=>{f.setSelectedRows(new Set(F.map(e=>e.idx)),!0)};async function z(){if(k(!0),f.allRowsSelected&&U>D)return g.Am.error((0,r.jsx)("div",{className:"prose text-sm text-foreground",children:P})),k(!1);if(!u)return g.Am.error("Project is required"),k(!1);let e=(f.allRowsSelected?await (0,N.wF)({projectRef:u.ref,connectionString:u.connectionString,table:a,filters:s,sorts:l,impersonatedRole:x.role}):F.filter(e=>f.selectedRows.has(e.idx))).map(e=>(Object.keys(e).map(n=>{"object"==typeof e[n]&&null!==e[n]&&(e[n]=JSON.stringify(e[n]))}),e)),n=new Blob([p().unparse(e,{columns:c.table.columns.map(e=>e.name)})],{type:"text/csv;charset=utf-8;"});i()(n,"".concat(c.table.name,"_rows.csv")),k(!1)}async function Z(){if(k(!0),f.allRowsSelected&&U>D)return g.Am.error((0,r.jsx)("div",{className:"prose text-sm text-foreground",children:P})),k(!1);if(!u)return g.Am.error("Project is required"),k(!1);let e=f.allRowsSelected?await (0,N.wF)({projectRef:u.ref,connectionString:u.connectionString,table:a,filters:s,sorts:l,impersonatedRole:x.role}):F.filter(e=>f.selectedRows.has(e.idx)),n=new Blob([(0,b.k)(a,e)],{type:"text/sql;charset=utf-8;"});i()(n,"".concat(c.table.name,"_rows.sql")),k(!1)}let F=null!==(n=null==E?void 0:E.rows)&&void 0!==n?n:[],U=null!==(t=null==O?void 0:O.count)&&void 0!==t?t:0,{editable:M}=c;return(0,S.gv)(()=>{(f.allRowsSelected||f.selectedRows.size>0)&&f.setSelectedRows(new Set)}),(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[M&&(0,r.jsx)(j.u,{type:"default",size:"tiny",icon:(0,r.jsx)(d.Z,{}),onClick:()=>{let e=f.allRowsSelected?U:f.selectedRows.size,n=Array.from(f.selectedRows),t=F.filter(e=>n.includes(e.idx));m.onDeleteRows(t,{allRowsSelected:f.allRowsSelected,numRows:e,callback:()=>{f.setSelectedRows(new Set)}})},disabled:f.allRowsSelected&&w,tooltip:{content:{side:"bottom",text:f.allRowsSelected&&w?"Table truncation is not supported when impersonating a role":void 0}},children:f.allRowsSelected?"Delete all rows in table":f.selectedRows.size>1?"Delete ".concat(f.selectedRows.size," rows"):"Delete ".concat(f.selectedRows.size," row")}),(0,r.jsxs)(A.h_,{children:[(0,r.jsx)(A.$F,{asChild:!0,children:(0,r.jsx)(I.z,{type:"default",size:"tiny",iconRight:(0,r.jsx)(o.Z,{}),loading:C,disabled:C,children:"Export"})}),(0,r.jsxs)(A.AW,{className:"w-40",children:[(0,r.jsx)(A.Xi,{onClick:z,children:(0,r.jsx)("span",{className:"text-foreground-light",children:"Export to CSV"})}),(0,r.jsx)(A.Xi,{onClick:Z,children:"Export to SQL"})]})]}),!f.allRowsSelected&&U>F.length&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-6 ml-0.5",children:(0,r.jsx)(L.Z,{orientation:"vertical"})}),(0,r.jsx)(I.z,{type:"text",onClick:()=>T(),children:"Select all rows in table"})]})]})}},33937:function(e,n,t){var r=t(97458),a=t(36457),l=t(929),i=t(73512),o=t(51214),s=t(53486);n.Z=e=>{let{table:n,isRefetching:t}=e,{ref:c}=(0,i.UO)(),d=(0,a.NL)(),u=o.s.tableRowsAndCount(c,n.id);async function m(){await d.invalidateQueries(u)}return(0,r.jsx)(s.z,{type:"text",loading:t,icon:(0,r.jsx)(l.Z,{className:"text-foreground-muted",strokeWidth:1.5}),onClick:()=>m(),children:"Refresh"})}},89831:function(e,n,t){t.d(n,{o:function(){return r}});let r=[{value:"=",label:"equals",preLabel:"[ = ]",abbrev:"eq"},{value:"<>",label:"not equal",preLabel:"[ <> ]",abbrev:"neq"},{value:">",label:"greater than",preLabel:"[ > ]",abbrev:"gt"},{value:"<",label:"less than",preLabel:"[ < ]",abbrev:"lt"},{value:">=",label:"greater than or equal",preLabel:"[ >= ]",abbrev:"gte"},{value:"<=",label:"less than or equal",preLabel:"[ <= ]",abbrev:"lte"},{value:"~~",label:"like operator",preLabel:"[ ~~ ]",abbrev:"like"},{value:"~~*",label:"ilike operator",preLabel:"[ ~~* ]",abbrev:"ilike"},{value:"in",label:"one of a list of values",preLabel:"[ in ]",abbrev:"in"},{value:"is",label:"checking for (null,not null,true,false)",preLabel:"[ is ]",abbrev:"is"}]},89798:function(e,n,t){t.d(n,{Z:function(){return j}});var r=t(97458),a=t(58724),l=t.n(a),i=t(85466),o=t.n(i),s=t(41639),c=t(4534),d=t(52983),u=t(8427),m=t(11152),f=t(12753),p=t(53486),h=t(89831),g=t(60661),x=t(36180),v=t(15647),b=t(11321),y=(0,d.memo)(e=>{var n,t;let{table:a,filter:l,filterIdx:i,onChange:o,onDelete:s,onKeyDown:c}=e,d=a.columns.find(e=>e.name===l.column),u=(null===(n=a.columns)||void 0===n?void 0:n.map(e=>({value:e.name,label:e.name,postLabel:e.dataType})))||[],m=(null==d?void 0:d.format)==="timestamptz"?"yyyy-mm-dd hh:mm:ss+zz":(null==d?void 0:d.format)==="timestamp"?"yyyy-mm-dd hh:mm:ss":"Enter a value";return(0,r.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-1 px-3",children:[(0,r.jsx)(x.F,{align:"start",options:u,onSelect:e=>o(i,{...l,column:e}),children:(0,r.jsx)(p.z,{asChild:!0,type:"outline",icon:(0,r.jsx)("div",{className:"text-foreground-lighter",children:(0,r.jsx)(v.Z,{strokeWidth:1.5})}),className:"w-32 justify-start",children:(0,r.jsx)("span",{children:null!==(t=null==d?void 0:d.name)&&void 0!==t?t:""})})}),(0,r.jsx)(x.F,{align:"start",options:h.o,onSelect:e=>o(i,{...l,operator:e}),children:(0,r.jsx)(p.z,{asChild:!0,type:"outline",icon:(0,r.jsx)("div",{className:"text-foreground-lighter",children:(0,r.jsx)(v.Z,{strokeWidth:1.5})}),children:(0,r.jsx)("span",{children:l.operator})})}),(0,r.jsx)(g.Z,{size:"tiny",className:"w-full",placeholder:m,value:l.value,onChange:e=>o(i,{...l,value:e.target.value}),onKeyDown:c}),(0,r.jsx)(p.z,{type:"text",className:"px-1",icon:(0,r.jsx)(b.Z,{strokeWidth:1.5}),onClick:()=>s(i)})]})}),j=e=>{let{table:n,filters:t,setParams:a}=e,[l,i]=(0,d.useState)(!1),o=(0,m.uM)(),c=(t||[]).length>0?"Filtered by ".concat(t.length," rule").concat(t.length>1?"s":""):"Filter";return(0,r.jsxs)(f.J2,{open:l,onOpenChange:i,modal:!1,children:[(0,r.jsx)(f.xo,{asChild:!0,children:(0,r.jsx)(p.z,{type:(t||[]).length>0?"link":"text",icon:(0,r.jsx)(s.Z,{}),children:c})}),(0,r.jsx)(f.yk,{className:"p-0 w-96",side:"bottom",align:"start",children:(0,r.jsx)(_,{table:n,filters:t,onApplyFilters:e=>{o.setEnforceExactCount(!1),a(n=>({...n,filter:e.map(e=>{let n=h.o.find(n=>n.value===e.operator);return"".concat(e.column,":").concat(null==n?void 0:n.abbrev,":").concat(e.value)})}))}})})]})};let _=e=>{let{table:n,filters:t,onApplyFilters:a}=e,i=(0,d.useMemo)(()=>(0,u.Yb)(null!=t?t:[]),[t]),[s,m]=(0,d.useState)(i),h=(0,d.useCallback)((e,n)=>{m(t=>l()(t,{[e]:{$set:n}}))},[]),g=(0,d.useCallback)(e=>{m(n=>l()(n,{$splice:[[e,1]]}))},[]),x=()=>{let e=s.map(e=>{let t=n.columns.find(n=>n.name===e.column);return(null==t?void 0:t.format)==="uuid"?{...e,value:e.value.trim()}:e});m(e),a(e)};function v(e){"Enter"===e.key&&x()}return(0,r.jsxs)("div",{className:"space-y-2 py-2",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[s.map((e,t)=>(0,r.jsx)(y,{table:n,filter:e,filterIdx:t,onChange:h,onDelete:g,onKeyDown:v},"filter-".concat(e.column,"-").concat([t]))),0==s.length&&(0,r.jsxs)("div",{className:"space-y-1 px-3",children:[(0,r.jsx)("h5",{className:"text-sm text-foreground-light",children:"No filters applied to this view"}),(0,r.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to filter the view"})]})]}),(0,r.jsx)(f.Fm,{}),(0,r.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[(0,r.jsx)(p.z,{icon:(0,r.jsx)(c.Z,{}),type:"text",onClick:function(){var e;let t=null===(e=n.columns[0])||void 0===e?void 0:e.name;t&&m([...s,{column:t,operator:"=",value:""}])},children:"Add filter"}),(0,r.jsx)(p.z,{disabled:o()(s,i),type:"default",onClick:()=>x(),children:"Apply filter"})]})]})}},15482:function(e,n,t){t.d(n,{f:function(){return j}});var r=t(97458),a=t(58724),l=t.n(a),i=t(85466),o=t.n(i),s=t(76524),c=t(15647),d=t(52983),u=t(8427),m=t(36180),f=t(12753),p=t(53486),h=t(65206),g=t(11321),x=t(17751),v=t(37555),b=t(77127),y=(0,d.memo)(e=>{let{table:n,index:t,columnName:a,sort:l,onDelete:i,onToggle:o,onDrag:s}=e,c=n.columns.find(e=>e.name===a),u=(0,d.useRef)(null),[{isDragging:m},f]=(0,x.c)({type:"sort-row",item:()=>({key:a,index:t}),collect:e=>({isDragging:e.isDragging()})}),[{handlerId:y},j]=(0,v.L)({accept:"sort-row",collect:e=>({handlerId:e.getHandlerId()}),hover(e,n){var r;if(!u.current)return;let a=e.index;if(a===t)return;let l=null===(r=u.current)||void 0===r?void 0:r.getBoundingClientRect(),i=(l.bottom-l.top)/2,o=n.getClientOffset().y-l.top;a<t&&o<i||a>t&&o>i||(_(a,t),e.index=t)}}),_=(e,n)=>{e!=n&&s(e,n)};return(f(j(u)),c)?(0,r.jsxs)("div",{className:"flex items-center gap-3 px-3",ref:u,style:{opacity:m?0:1},"data-handler-id":y,children:[(0,r.jsx)("span",{className:"transition-color text-foreground-lighter hover:text-foreground-light",children:(0,r.jsx)(h.Z,{strokeWidth:2,size:16})}),(0,r.jsx)("div",{className:"grow",children:(0,r.jsxs)("span",{className:"flex grow items-center gap-1 truncate text-sm text-foreground",children:[(0,r.jsx)("span",{className:"text-xs text-foreground-lighter",children:t>0?"then by":"sort by"}),c.name]})}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-foreground-lighter",children:"ascending:"}),(0,r.jsx)(b.Z,{size:"tiny",layout:"flex",defaultChecked:l.ascending,onChange:e=>o(a,e)})]}),(0,r.jsx)(p.z,{icon:(0,r.jsx)(g.Z,{strokeWidth:1.5}),size:"tiny",type:"text",onClick:()=>i(a)})]}):null}),j=e=>{let{table:n,sorts:t,setParams:a}=e,[l,i]=(0,d.useState)(!1),o=(t||[]).length>0?"Sorted by ".concat(t.length," rule").concat(t.length>1?"s":""):"Sort";return(0,r.jsxs)(f.J2,{modal:!1,open:l,onOpenChange:i,children:[(0,r.jsx)(f.xo,{asChild:!0,children:(0,r.jsx)(p.z,{type:(t||[]).length>0?"link":"text",icon:(0,r.jsx)(s.Z,{}),children:o})}),(0,r.jsx)(f.yk,{className:"p-0 w-96",side:"bottom",align:"start",children:(0,r.jsx)(_,{table:n,sorts:t,onApplySorts:e=>{a(n=>({...n,sort:e.map(e=>"".concat(e.column,":").concat(e.ascending?"asc":"desc"))}))}})})]})};let _=e=>{let{table:n,sorts:t,onApplySorts:a}=e,i=(0,d.useMemo)(()=>(0,u.rg)(n.name,null!=t?t:[]),[n.name,t]),[s,h]=(0,d.useState)(i),g=n.columns.filter(e=>"json"!==e.dataType&&"jsonb"!==e.dataType&&!s.find(n=>n.column==e.name)),x=(null==g?void 0:g.map(e=>({value:e.name,label:e.name})))||[],v=(0,d.useCallback)(e=>{h(n=>n.filter(n=>n.column!==e))},[]),b=(0,d.useCallback)((e,n)=>{h(t=>{let r=t.findIndex(n=>n.column===e);return l()(t,{[r]:{$merge:{ascending:n}}})})},[]),j=(0,d.useCallback)((e,n)=>{h(t=>l()(t,{$splice:[[e,1],[n,0,t[e]]]}))},[]);return(0,r.jsxs)("div",{className:"space-y-2 py-2",children:[s.map((e,t)=>(0,r.jsx)(y,{table:n,index:t,columnName:e.column,sort:e,onDelete:v,onToggle:b,onDrag:j},e.column)),0===s.length&&(0,r.jsxs)("div",{className:"space-y-1 px-3",children:[(0,r.jsx)("h5",{className:"text-sm text-foreground-light",children:"No sorts applied to this view"}),(0,r.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to sort the view"})]}),(0,r.jsx)(f.Fm,{}),(0,r.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[g&&g.length>0?(0,r.jsx)(m.F,{options:x,onSelect:function(e){h([...s,{table:n.name,column:e,ascending:!0}])},side:"bottom",align:"start",children:(0,r.jsx)(p.z,{asChild:!0,type:"text",iconRight:(0,r.jsx)(c.Z,{size:"14",className:"text-foreground-light"}),className:"sb-grid-dropdown__item-trigger","data-testid":"table-editor-pick-column-to-sort-button",children:(0,r.jsxs)("span",{children:["Pick ",s.length>1?"another":"a"," column to sort by"]})})}):(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"All columns have been added"}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)(p.z,{disabled:o()(s,i),type:"default",onClick:()=>a(s),children:"Apply sorting"})})]})]})}},33482:function(e,n,t){t.d(n,{ov:function(){return p},ep:function(){return _},q4:function(){return j}});var r=t(97458),a=t(48631),l=t(9887),i=t(74286),o=t(26597),s=t(15647),c=t(50322),d=t(15011),u=t(47889),m=t(53486),f=t(92063),p=e=>{let{column:n,isEncrypted:t}=e,p=(0,f.Qq)(),h=(0,f.I0)(),{onEditColumn:g,onDeleteColumn:x}=p,v=n.key;function b(){g&&g(v)}function y(){x&&x(v)}return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(d.h_,{children:[(0,r.jsx)(d.$F,{asChild:!0,children:(0,r.jsx)(m.z,{className:"opacity-50 flex",type:"text",style:{padding:"3px"},onClick:e=>{e.stopPropagation()},icon:(0,r.jsx)(s.Z,{})})}),(0,r.jsx)(d.AW,{align:"end",side:"bottom",children:(0,r.jsxs)(r.Fragment,{children:[p.editable&&void 0!==b&&(0,r.jsxs)(c.u,{children:[(0,r.jsx)(c.aJ,{asChild:!0,className:"".concat(t?"opacity-50":""),children:(0,r.jsxs)(d.Xi,{className:"space-x-2",onClick:b,disabled:t,children:[(0,r.jsx)(a.Z,{size:14}),(0,r.jsx)("p",{children:"Edit column"})]})}),t&&(0,r.jsx)(c._v,{side:"bottom",children:"Encrypted columns cannot be edited"})]}),(0,r.jsx)(d.Xi,{className:"space-x-2",onClick:n.frozen?function(){h({type:"UNFREEZE_COLUMN",payload:{columnKey:v}})}:function(){h({type:"FREEZE_COLUMN",payload:{columnKey:v}})},children:n.frozen?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{size:14}),(0,r.jsx)("p",{children:"Unfreeze column"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{size:14}),(0,r.jsx)("p",{children:"Freeze column"})]})}),p.editable&&void 0!==y&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{}),(0,r.jsxs)(d.Xi,{className:"space-x-2",onClick:y,children:[(0,r.jsx)(o.Z,{size:14,stroke:"red"}),(0,r.jsx)("p",{children:"Delete column"})]})]})]})})]})})},h=t(32024),g=t(52983),x=t(70717),v=t(5688),b=t(11152),y=t(77655),j=e=>{let{rows:n}=e,t=(0,f.Qq)(),l=(0,v._2)(),i=(0,b.uM)();function s(e){let{data:n}=e;return"edit"===n?void 0==t.onEditRow:"delete"===n&&!t.editable}let c=(0,g.useCallback)(e=>{let{props:r}=e;if(!i.selectedCellPosition||!r)return;let{rowIdx:a}=r,l=n[a][t.gridColumns[i.selectedCellPosition.idx].key],o=(0,y.Lw)(l);(0,y.vQ)(o)},[n,t.gridColumns,i.selectedCellPosition]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(x.v2,{id:_,animation:!1,children:[(0,r.jsxs)(x.ck,{onClick:c,children:[(0,r.jsx)(h.Z,{size:14}),(0,r.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell content"})]}),(0,r.jsxs)(x.ck,{onClick:function(e){let{props:r}=e,{rowIdx:a}=r,l=n[a];t.onEditRow&&t.onEditRow(l)},hidden:s,data:"edit",children:[(0,r.jsx)(a.Z,{size:14}),(0,r.jsx)("span",{className:"ml-2 text-xs",children:"Edit row"})]}),t.editable&&(0,r.jsx)(x.Z0,{}),(0,r.jsxs)(x.ck,{onClick:function(e){let{props:t}=e,{rowIdx:r}=t,a=n[r];a&&l.onDeleteRows([a])},hidden:s,data:"delete",children:[(0,r.jsx)(o.Z,{size:14,stroke:"red"}),(0,r.jsx)("span",{className:"ml-2 text-xs",children:"Delete row"})]})]})})};let _="row-context-menu-id"},69824:function(e,n,t){t.d(n,{E_:function(){return a},W:function(){return l},mr:function(){return r},uZ:function(){return i}});let r=100,a="supabase_grid",l="supabase-grid-select-row",i="supabase-grid-add-column"},77724:function(e,n,t){t.d(n,{A:function(){return u}});var r=t(98219),a=t(93547);function l(e,n){return 0===n.length?e:e+=" where ".concat(n.map(e=>{switch(e.operator){case"in":let n;return n=Array.isArray(e.value)?e.value.map(e=>i(e)):String(e.value).split(",").map(e=>i(e)),"".concat((0,a.yR)(e.column)," ").concat(e.operator," (").concat(n.join(","),")");case"is":return function(e){let n=String(e.value);switch(n){case"null":case"false":case"true":case"not null":return"".concat((0,a.yR)(e.column)," ").concat(e.operator," ").concat(n);default:return"".concat((0,a.yR)(e.column)," ").concat(e.operator," ").concat(i(e.value))}}(e);default:return"".concat((0,a.yR)(e.column)," ").concat(e.operator," ").concat(i(e.value))}}).join(" and "))}function i(e){return"string"!=typeof e||(null==e?void 0:e.startsWith("ARRAY["))&&(null==e?void 0:e.endsWith("]"))?e:(0,a.i0)(e)}function o(e){return"".concat((0,a.yR)(e.schema),".").concat((0,a.yR)(e.name))}class s{range(e,n){return this.pagination={offset:e,limit:n-e+1},this}toSql(){try{var e;let{actionValue:n,actionOptions:t,filters:r,sorts:i}=null!==(e=this.options)&&void 0!==e?e:{};switch(this.action){case"count":return function(e,n){let t="select count(*) from ".concat(o(e)),{filters:r}=null!=n?n:{};return r&&(t=l(t,r)),t+";"}(this.table,{filters:r});case"delete":return function(e,n,t){if(!n||0===n.length)throw{message:"no filters for this delete query"};let r="delete from ".concat(o(e)),{returning:a,enumArrayColumns:i}=null!=t?t:{};return n&&(r=l(r,n)),a&&(r+=void 0===i||0===i.length?" returning *":" returning *, ".concat(i.map(e=>'"'.concat(e,'"::text[]')).join(","))),r+";"}(this.table,r,{returning:null==t?void 0:t.returning,enumArrayColumns:null==t?void 0:t.enumArrayColumns});case"insert":return function(e,n,t){if(!n||0===n.length)throw{message:"no value to insert"};let{returning:r,enumArrayColumns:l}=null!=t?t:{},i=Object.keys(n[0]).map(e=>(0,a.yR)(e)).join(","),s="";return s=0==i.length?(0,a.WU)("insert into %1$s select from jsonb_populate_recordset(null::%1$s, %2$s)",o(e),(0,a.i0)(JSON.stringify(n))):(0,a.WU)("insert into %1$s (%2$s) select %2$s from jsonb_populate_recordset(null::%1$s, %3$s)",o(e),i,(0,a.i0)(JSON.stringify(n))),r&&(s+=void 0===l||0===l.length?" returning *":" returning *, ".concat(l.map(e=>'"'.concat(e,'"::text[]')).join(","))),s+";"}(this.table,n,{returning:null==t?void 0:t.returning,enumArrayColumns:null==t?void 0:t.enumArrayColumns});case"select":return function(e,n,t){var r;let i="";i+="select ".concat(null!=n?n:"*"," from ").concat(o(e));let{filters:s,pagination:c,sorts:d}=null!=t?t:{};if(s&&(i=l(i,s)),d&&(r=i,i=0===d.length?r:r+=" order by ".concat(d.map(e=>{if(!e.column)return null;let n=e.ascending?"asc":"desc",t=e.nullsFirst?"nulls first":"nulls last";return"".concat((0,a.yR)(e.table),".").concat((0,a.yR)(e.column)," ").concat(n," ").concat(t)}).join(", "))),c){let{limit:e,offset:n}=null!=c?c:{};i+=" limit ".concat((0,a.i0)(e)," offset ").concat((0,a.i0)(n))}return i+";"}(this.table,n,{filters:r,pagination:this.pagination,sorts:i});case"update":return function(e,n,t){let{filters:r,returning:i,enumArrayColumns:s}=null!=t?t:{};if(!r||0===r.length)throw{message:"no filters for this update query"};let c=Object.keys(n).map(e=>(0,a.yR)(e)).join(","),d=(0,a.WU)("update %1$s set (%2$s) = (select %2$s from json_populate_record(null::%1$s, %3$s))",o(e),c,(0,a.i0)(JSON.stringify(n)));return r&&(d=l(d,r)),i&&(d+=void 0===s||0===s.length?" returning *":" returning *, ".concat(s.map(e=>'"'.concat(e,'"::text[]')).join(","))),d+";"}(this.table,n,{filters:r,returning:null==t?void 0:t.returning,enumArrayColumns:null==t?void 0:t.enumArrayColumns});case"truncate":return function(e,n){let t="truncate ".concat(o(e)),{cascade:r}=null!=n?n:{};return r&&(t+=" cascade"),t+";"}(this.table,{cascade:null==t?void 0:t.cascade});default:return""}}catch(e){throw e}}constructor(e,n,t){(0,r._)(this,"table",void 0),(0,r._)(this,"action",void 0),(0,r._)(this,"options",void 0),(0,r._)(this,"pagination",void 0),this.table=e,this.action=n,this.options=t}}class c{filter(e,n,t){return this.filters.push({column:e,operator:n,value:t}),this}match(e){return Object.entries(e).map(e=>{let[n,t]=e;this.filters.push({column:n,operator:"=",value:t})}),this}order(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.sorts.push({table:e,column:n,ascending:t,nullsFirst:r}),this}range(e,n){return this._getQueryModifier().range(e,n)}toSql(){return this._getQueryModifier().toSql()}_getQueryModifier(){return new s(this.table,this.action,{actionValue:this.actionValue,actionOptions:this.actionOptions,filters:this.filters,sorts:this.sorts})}constructor(e,n,t,a){(0,r._)(this,"table",void 0),(0,r._)(this,"action",void 0),(0,r._)(this,"actionValue",void 0),(0,r._)(this,"actionOptions",void 0),(0,r._)(this,"filters",void 0),(0,r._)(this,"sorts",void 0),this.table=e,this.action=n,this.actionValue=t,this.actionOptions=a,this.filters=[],this.sorts=[]}}class d{count(){return new c(this.table,"count")}delete(e){return new c(this.table,"delete",void 0,e)}insert(e,n){return new c(this.table,"insert",e,n)}select(e){return new c(this.table,"select",e)}update(e,n){return new c(this.table,"update",e,n)}truncate(e){return new c(this.table,"truncate",void 0,e)}constructor(e){(0,r._)(this,"table",void 0),this.table=e}}class u{from(e,n){return new d({name:e,schema:null!=n?n:"public"})}}},92063:function(e,n,t){t.d(n,{g3:function(){return m},I0:function(){return p},Qq:function(){return f}});var r=t(52983),a=t(87595),l=t(58724),i=t.n(l),o=t(69824),s=t(77655);function c(e){let n=(0,s.I8)(e);return n.renderEditCell=e.renderEditCell,n.renderHeaderCell=e.renderHeaderCell,n.renderCell=e.renderCell,n.renderGroupCell=e.renderGroupCell,n}let d={table:null,isInitialComplete:!1,editable:!1,onAddColumn:null,onAddRow:null,onError:null,onEditRow:null,onEditColumn:null,onDeleteColumn:null,gridColumns:[]},u=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;for(let r=0;r<n.length;r++)e=n[r](e,t);return e}}((e,n)=>"INIT_TABLE"===n.type?{...e,table:n.payload.table,isInitialComplete:!0,editable:n.payload.editable||!1}:e,(e,n)=>"INIT_CALLBACK"===n.type?{...e,onAddColumn:n.payload.onAddColumn,onAddRow:n.payload.onAddRow,onError:n.payload.onError,onEditRow:n.payload.onEditRow,onEditColumn:n.payload.onEditColumn,onDeleteColumn:n.payload.onDeleteColumn}:e,(e,n)=>{switch(n.type){case"INIT_TABLE":return{...e,gridColumns:function(e,n){let t=e;if(null==n?void 0:n.gridColumns){t=[];let r=n.gridColumns.filter(e=>(null==e?void 0:e.name)!=="");for(let n=0;n<r.length;n++){let a=r[n],l=e.find(e=>e.key===a.key);l&&t.push({...l,width:a.width,frozen:a.frozen})}let a=e.filter(e=>!r.find(n=>n.key===e.key)&&""!==e.name);t=t.concat(a);let l=e.find(e=>e.key===o.W);l&&(t=[l,...t]);let i=e.find(e=>e.key===o.uZ);i&&t.push(i)}return t}(n.payload.gridColumns,n.payload.savedState)};case"MOVE_COLUMN":{let t=e.gridColumns.findIndex(e=>e.key===n.payload.fromKey),r=e.gridColumns.findIndex(e=>e.key===n.payload.toKey),a=e.gridColumns[t];return{...e,gridColumns:i()(e.gridColumns,{$splice:[[t,1],[r,0,a]]})}}case"UPDATE_COLUMN_SIZE":{let t=c(e.gridColumns[n.payload.index]);return t.width=n.payload.width,{...e,gridColumns:i()(e.gridColumns,{[n.payload.index]:{$set:t}})}}case"FREEZE_COLUMN":{let t=e.gridColumns.findIndex(e=>e.key===n.payload.columnKey),r=c(e.gridColumns[t]);return r.frozen=!0,{...e,gridColumns:i()(e.gridColumns,{[t]:{$set:r}})}}case"UNFREEZE_COLUMN":{let t=e.gridColumns.findIndex(e=>e.key===n.payload.columnKey),r=c(e.gridColumns[t]);return r.frozen=!1,{...e,gridColumns:i()(e.gridColumns,{[t]:{$set:r}})}}case"UPDATE_COLUMN_IDX":{let t=e.gridColumns.findIndex(e=>e.key===n.payload.columnKey),r=c(e.gridColumns[t]);return r.idx=n.payload.columnIdx,{...e,gridColumns:i()(e.gridColumns,{[t]:{$set:r}}).sort((e,n)=>e.idx-n.idx)}}default:return e}}),{Provider:m,useTrackedState:f,useUpdate:p}=(0,a.fH)(()=>(0,r.useReducer)(u,d))},77655:function(e,n,t){function r(e){try{return JSON.parse(JSON.stringify(e))}catch(e){throw e}}function a(e){return e?"object"==typeof e||Array.isArray(e)?JSON.stringify(e):e:""}t.d(n,{I8:function(){return r},Lw:function(){return a},vQ:function(){return l}});let l=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};if(window.document.hasFocus()){var t,r;null===(r=window.navigator)||void 0===r||null===(t=r.clipboard)||void 0===t||t.writeText(e).then(n)}else console.warn("Unable to copy to clipboard")}},80368:function(e,n,t){t.d(n,{i1:function(){return eI},ve:function(){return eL},cv:function(){return eO}});var r=t(97458),a=t(69824),l=t(92063),i=t(35071);let o=e=>{let{row:n,column:t,isNullable:a,onRowChange:o,onClose:s}=e,c=(0,l.Qq)().gridColumns.find(e=>e.name==t.key),d=n[t.key];return(0,r.jsxs)(i.ZP,{autoFocus:!0,id:"boolean-editor",name:"boolean-editor",size:"small",onBlur:()=>s(!1),onChange:e=>{let r=e.target.value;"null"===r?o({...n,[t.key]:null},!0):o({...n,[t.key]:"true"===r},!0)},defaultValue:null===d?"null":d.toString(),style:{width:"".concat((null==c?void 0:c.width)||t.width,"px")},children:[(0,r.jsx)(i.ZP.Option,{value:"true",children:"TRUE"}),(0,r.jsx)(i.ZP.Option,{value:"false",children:"FALSE"}),a&&(0,r.jsx)(i.ZP.Option,{value:"null",children:"NULL"})]})};var s=t(28977),c=t.n(s),d=t(15647),u=t(52983),m=t(12753),f=t(43633),p=t(53486),h=t(15011),g=t(18858),x=t(60586);let v=e=>{let[n,t]=(0,u.useState)(!1);return(0,u.useEffect)(()=>{let n=n=>{e.current&&!e.current.contains(n.target)?t(!0):t(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[e]),n},b=e=>{let{value:n,children:t,onEscape:a,onEnter:l,ignoreOutsideClicks:i=!1}=e,o=(0,u.useRef)(null),s=v(o),c=(0,u.useCallback)(e=>{switch(e.key){case"Escape":e.stopPropagation(),a&&a(n);break;case"Enter":e.stopPropagation(),!e.shiftKey&&l&&(e.preventDefault(),l(n))}},[n]);return(0,u.useEffect)(()=>{!i&&s&&void 0!==l&&l(n)},[s]),(0,r.jsx)("div",{ref:o,onKeyDown:c,children:t})},y={date:"YYYY-MM-DD",datetime:"YYYY-MM-DD HH:mm:ss",datetimetz:"YYYY-MM-DD HH:mm:ss+ZZ"};function j(e){let{row:n,column:t,type:a,isNullable:l,onRowChange:i,onClose:o}=e,s=(0,u.useRef)(null),v=y[a],j=n[t.key],[_,N]=(0,u.useState)(j),w=_?Number(c()(_,v)):_,C=e=>{("string"!=typeof e||0!==e.length)&&"Invalid Date"!==w&&i({...n,[t.key]:e},!0)},k=()=>{C(c()().format("date"===a?"YYYY-MM-DD":"datetimetz"===a?"YYYY-MM-DDTHH:mm:ssZ":"YYYY-MM-DDTHH:mm:ss"))};return(0,u.useEffect)(()=>{var e,n;try{null===(e=s.current)||void 0===e||e.focus({preventScroll:!0})}catch(e){null===(n=s.current)||void 0===n||n.focus()}},[]),(0,r.jsxs)(m.J2,{open:!0,children:[(0,r.jsx)(m.xo,{children:(0,r.jsx)("div",{className:(0,f.cn)("px-[8px]",null===j?"text-foreground-lighter":""),children:null===j?"NULL":j})}),(0,r.jsxs)(m.yk,{align:"start",className:"p-0 rounded-none w-64",children:[(0,r.jsx)(b,{ignoreOutsideClicks:!0,value:_,onEscape:()=>o(!1),onEnter:C,children:(0,r.jsx)(x.I,{ref:s,value:null!=_?_:"",placeholder:v,onChange:e=>N(e.target.value),className:"border-0 rounded-none bg-dash-sidebar outline-none !ring-0 !ring-offset-0"})}),(0,r.jsxs)("div",{className:"px-3 py-1 flex flex-col gap-y-0.5",children:[(0,r.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Formatted value:"}),0===(null!=_?_:"").length?(0,r.jsx)("p",{className:"text-sm font-mono text-foreground-light",children:"Enter a valid date format"}):"Invalid Date"===w?(0,r.jsx)("p",{className:"text-sm font-mono text-foreground-light",children:"Invalid date format"}):"datetimetz"===a?(0,r.jsx)(g.c,{displayAs:"utc",utcTimestamp:w,labelFormat:"DD MMM YYYY HH:mm:ss (ZZ)",className:"text-left !text-sm font-mono tracking-tight"}):(0,r.jsx)("p",{className:"text-sm font-mono tracking-tight",children:(0,g.w)({utcTimestamp:w,format:"date"===a?"DD MMM YYYY":"datetime"===a?"DD MMM YYYY HH:mm:ss":void 0})})]}),(0,r.jsxs)("div",{className:"px-3 pt-1 pb-2 flex justify-between gap-x-1",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1.5 h-[22px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1 h-[22px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,r.jsx)("div",{className:"flex",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.z,{type:"default",className:"rounded-r-none",onClick:()=>C(null),children:"Set NULL"}),(0,r.jsxs)(h.h_,{children:[(0,r.jsx)(h.$F,{asChild:!0,children:(0,r.jsx)(p.z,{type:"default",icon:(0,r.jsx)(d.Z,{}),className:"px-1 rounded-l-none border-l-0"})}),(0,r.jsx)(h.AW,{className:"w-20",align:"end",children:(0,r.jsx)(h.Xi,{onClick:k,children:"Set to NOW"})})]})]}):(0,r.jsx)(p.z,{type:"default",onClick:k,children:"Set to NOW"})})]})]})]})}function _(e,n){return t=>(0,r.jsx)(j,{...t,type:e,isNullable:n})}var N=t(35511),w=t(34549),C=t(73512),k=t(6570),E=t(67305),S=t(30519),R=t(15834),q=t(289),A=t(6433),I=t(44336),O=t(50322),L=t(43835),T=t(35977);let z=e=>{let{isLoading:n,loadFullValue:t}=e;return(0,r.jsxs)("div",{className:(0,f.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-xs w-full h-full px-3 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsxs)("p",{children:["Value is larger than ",R.no.toLocaleString()," characters"]}),(0,r.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire value, but your browser may run into performance issues"})]}),(0,r.jsx)(p.z,{type:"default",loading:n,onClick:t,children:"Load full value"})]})},D=e=>{try{return JSON.parse(e),!0}catch(e){return!1}},P=e=>{try{let n=JSON.parse(e);return JSON.stringify(n)}catch(n){if("string"==typeof e)return e.replaceAll('"','"');return JSON.stringify(e)}},Z=e=>{let{row:n,column:t,isEditable:a=!0,onRowChange:i,onExpandEditor:o}=e,s=(0,l.Qq)(),{id:c}=(0,C.UO)(),d=c?Number(c):void 0,m=(0,q.Vm)(),{data:f}=(0,k.iB)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,id:d}),p=s.gridColumns.find(e=>e.name==t.key),h=n[t.key],g=null==h||"string"==typeof h?h:JSON.stringify(h),x=(0,A.ZO)(g?P(g):""),v="string"==typeof g&&g.endsWith("...")&&g.length>R.no,[y,j]=(0,u.useState)(!0),[_,Z]=(0,u.useState)(x),{mutate:F,isLoading:U,isSuccess:M}=(0,S.rp)(),Y=(0,u.useCallback)(()=>{a&&i(n,!0),j(!1)},[]),K=(0,u.useCallback)(e=>{(null!==e?(0,A.tT)(e):e)!==_?$(e):j(!1)},[M]),W=()=>{Y(),o(t.key,{...n,[t.key]:(0,A.dW)(_)||n[t.key]})},$=e=>{if(a){if(e){if(D(e)){let r=JSON.parse(e);i({...n,[t.key]:r},!0),j(!1)}else{let{onError:e}=s;e&&e(Error("Please enter a valid JSON"))}}else i({...n,[t.key]:null},!0),j(!1)}};return(0,r.jsx)(I.Z,{open:y,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:v&&!M?(0,r.jsxs)("div",{style:{width:"".concat((null==p?void 0:p.width)||t.width,"px")},className:"flex items-center justify-center flex-col relative",children:[(0,r.jsx)(L.r,{readOnly:!0,onChange:()=>{},width:"".concat((null==p?void 0:p.width)||t.width,"px"),value:null!=_?_:"",language:"markdown"}),(0,r.jsx)(z,{isLoading:U,loadFullValue:()=>{if(void 0===f||void 0===m||!(0,E.N3)(f))return;if(0===f.primary_keys.length)return(0,w.Am)("Unable to load value as table has no primary keys");let e=f.primary_keys.reduce((e,t)=>({...e,[t.name]:n[t.name]}),{});F({table:{schema:f.schema,name:f.name},column:t.name,pkMatch:e,projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString},{onSuccess:e=>{Z(JSON.stringify(e))}})}})]}):(0,r.jsxs)(b,{value:_,onEscape:Y,onEnter:K,children:[(0,r.jsx)(L.r,{width:"".concat((null==p?void 0:p.width)||t.width,"px"),value:null!=_?_:"",language:"json",readOnly:!a,onChange:e=>{a&&(e&&""!=e?Z(e):Z(null))}}),(0,r.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 gap-x-2",children:[a&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,r.jsxs)(O.u,{children:[(0,r.jsx)(O.aJ,{asChild:!0,children:(0,r.jsx)("div",{className:"border border-strong rounded p-1 flex items-center justify-center transition cursor-pointer bg-selection hover:bg-border-strong",onClick:()=>W(),children:(0,r.jsx)(N.Z,{size:12,strokeWidth:2})})}),(0,r.jsx)(O._v,{side:"bottom",align:"center",children:(0,r.jsx)("span",{children:"Expand editor"})})]})]})]}),children:(0,r.jsx)("div",{className:"".concat(_&&0==x.trim().length?"sb-grid-fill-container":""," sb-grid-json-editor__trigger"),onClick:()=>j(!y),children:null===_||""===_?(0,r.jsx)(T.q,{}):x})})};function F(e){null==e||e.focus(),null==e||e.select()}function U(e){let{row:n,column:t,onRowChange:a,onClose:l}=e,i=n[t.key];return(0,r.jsx)("input",{className:"sb-grid-number-editor",ref:F,value:null!=i?i:"",onChange:function(e){let r=e.target.value;""===r?a({...n,[t.key]:null}):a({...n,[t.key]:r})},onBlur:function(){l(!0)},type:"number"})}function M(e){let{row:n,column:t,onRowChange:a,onClose:o,options:s,isNullable:c}=e,d=(0,l.Qq)().gridColumns.find(e=>e.name==t.key),u=n[t.key];return(0,r.jsxs)(i.ZP,{autoFocus:!0,id:"select-editor",name:"select-editor",size:"small",defaultValue:null!=u?u:"",className:"sb-grid-select-editor !gap-2",style:{width:"".concat((null==d?void 0:d.width)||t.width,"px")},onChange:function(e){e.target.value&&""!=e.target.value?a({...n,[t.key]:e.target.value},!0):a({...n,[t.key]:null},!0)},onBlur:function(){o(!1)},children:[c&&(0,r.jsx)(i.ZP.Option,{value:"",children:"NULL"}),s.map(e=>{let{label:n,_value:t}=e;return(0,r.jsx)(i.ZP.Option,{value:t,selected:t===u,children:n},t)})]})}var Y=t(15518);let K=()=>(0,r.jsx)("span",{className:"sb-grid-empty-value opacity-50",children:"EMPTY"}),W=e=>{let{row:n,column:t,isNullable:a,isEditable:i,onRowChange:o,onExpandEditor:s}=e,c=(0,l.Qq)(),{id:d}=(0,C.UO)(),m=d?Number(d):void 0,h=(0,q.Vm)(),{data:g}=(0,k.iB)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,id:m}),x=c.gridColumns.find(e=>e.name==t.key),v=n[t.key],y=v||""===v?String(v):null,[j,_]=(0,u.useState)(!0),[A,D]=(0,u.useState)(y),[P,Z]=(0,u.useState)(!1),{mutate:F,isLoading:U,isSuccess:M}=(0,S.rp)(),W="string"==typeof y&&y.endsWith("...")&&y.length>R.no,$=(0,u.useCallback)(()=>{i&&o(n,!0),_(!1)},[]),H=(0,u.useCallback)(e=>{i&&e!==A&&o({...n,[t.key]:e},!0),_(!1)},[M]),J=()=>{$(),s(t.key,{...n,[t.key]:A||n[t.key]})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I.Z,{open:j,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:W&&!M?(0,r.jsxs)("div",{style:{width:"".concat((null==x?void 0:x.width)||t.width,"px")},className:"flex items-center justify-center flex-col relative",children:[(0,r.jsx)(L.r,{readOnly:!0,onChange:()=>{},width:"".concat((null==x?void 0:x.width)||t.width,"px"),value:null!=A?A:"",language:"markdown"}),(0,r.jsx)(z,{isLoading:U,loadFullValue:()=>{if(void 0===g||void 0===h||!(0,E.N3)(g))return;if(0===g.primary_keys.length)return(0,w.Am)("Unable to load value as table has no primary keys");let e=g.primary_keys.reduce((e,t)=>({...e,[t.name]:n[t.name]}),{});F({table:{schema:g.schema,name:g.name},column:t.name,pkMatch:e,projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString},{onSuccess:e=>D(e)})}})]}):(0,r.jsxs)(b,{value:A,onEscape:$,onEnter:H,ignoreOutsideClicks:P,children:[(0,r.jsx)(L.r,{width:"".concat((null==x?void 0:x.width)||t.width,"px"),value:null!=A?A:"",readOnly:!i,onChange:e=>{i&&(e?D(e):D(""))}}),i&&(0,r.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 space-x-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-y-1",children:[(0,r.jsxs)(O.u,{children:[(0,r.jsx)(O.aJ,{asChild:!0,children:(0,r.jsx)(p.z,{type:"default",className:"px-1",onClick:()=>J(),icon:(0,r.jsx)(N.Z,{size:12,strokeWidth:2})})}),(0,r.jsx)(O._v,{side:"bottom",children:"Expand editor"})]}),a&&(0,r.jsx)(p.z,{size:"tiny",type:"default",htmlType:"button",onClick:()=>Z(!0),children:"Set to NULL"})]})]})]}),children:(0,r.jsx)("div",{className:(0,f.cn)(!!A&&0===A.toString().trim().length&&"sb-grid-fill-container","sb-grid-text-editor__trigger"),onClick:()=>_(!j),children:null===A?(0,r.jsx)(T.q,{}):""===A?(0,r.jsx)(K,{}):A})}),(0,r.jsx)(Y.Z,{visible:P,title:"Confirm setting value to NULL",confirmLabel:"Confirm",onCancel:()=>Z(!1),onConfirm:()=>{H(null)},children:(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you wish to set this value to NULL? This action cannot be undone."})})]})};var $=t(97214),H=t.n($);function J(e){null==e||e.focus(),null==e||e.select()}c().extend(H());let V="HH:mm:ss";function B(e){let{row:n,column:t,format:a,onRowChange:l,onClose:i}=e,o=n[t.key],s=o?c()(o,a).format(V):o;return(0,r.jsx)("input",{className:"sb-grid-time-editor",ref:J,value:null!=s?s:"",onChange:function(e){let r=e.target.value;if(""==r)l({...n,[t.key]:null});else{let e=c()(r,V).format(a);l({...n,[t.key]:e})}},onBlur:()=>i(!0),type:"time",step:"1"})}function Q(e){return(0,r.jsx)(B,{...e,format:"HH:mm:ss"})}function G(e){return(0,r.jsx)(B,{...e,format:"HH:mm:ssZZ"})}var X=t(57718);let ee=e=>{let n=e.row[e.column.key];if(!n)return(0,r.jsx)(T.q,{});let t=(0,X.D4)(n);return(0,r.jsx)(r.Fragment,{children:t})},en=e=>{let n=e.row[e.column.key];return null===n?(0,r.jsx)(T.q,{}):(0,r.jsx)(r.Fragment,{children:n?"TRUE":"FALSE"})},et=e=>{let n=e.row[e.column.key];return null===n?(0,r.jsx)(T.q,{}):""===n?(0,r.jsx)(K,{}):(("object"==typeof n||Array.isArray(n))&&(n=JSON.stringify(n)),(0,r.jsx)(r.Fragment,{children:n}))};var er=t(22002),ea=t(32672),el=t(2861),ei=t(21925),eo=t(58312),es=t(44914),ec=t(12724),ed=t(28179);let eu=e=>{var n,t;let{table:l,column:i,value:o}=e,{ref:s}=(0,C.UO)(),c=(0,q.Vm)(),{data:d,error:u,isSuccess:m,isError:h,isLoading:g}=(0,R.KK)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,tableId:l.id,filters:[{column:i,operator:"=",value:o}],page:1,limit:10},{keepPreviousData:!0}),x=l.primary_keys.map(e=>e.name),v=(null!==(n=null==l?void 0:l.columns)&&void 0!==n?n:[]).map(e=>{let n=eL({dataType:e.data_type,format:e.format}),t=(e.name.length+e.format.length)*eI,l=x.includes(e.name);return{key:e.name,name:e.name,resizable:!1,draggable:!1,sortable:!1,width:n<t?t:n,minWidth:a.mr,headerCellClass:"outline-none !shadow-none",renderHeaderCell:()=>(0,r.jsxs)("div",{className:"flex h-full items-center justify-center gap-x-2",children:[l&&(0,r.jsxs)(O.u,{children:[(0,r.jsx)(O.aJ,{children:(0,r.jsx)(eo.Z,{size:14,strokeWidth:2,className:"text-brand rotate-45"})}),(0,r.jsx)(O._v,{side:"bottom",children:"Primary key"})]}),(0,r.jsx)("span",{className:"text-xs truncate",children:e.name}),(0,r.jsx)("span",{className:"text-xs text-foreground-light font-normal",children:e.format})]}),renderCell:n=>{let{column:t,row:a}=n,l=a[t.name],i="bytea"===e.format?(0,X.D4)(l):l;return(0,r.jsx)("div",{className:(0,f.cn)("flex items-center h-full w-full whitespace-pre",null===i&&"text-foreground-lighter"),children:null===i?"NULL":i})}}});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"px-2 py-2 text-xs text-foreground-light border-b",children:["Referencing record from"," ",(0,r.jsxs)("span",{className:"text-foreground",children:[l.schema,".",l.name]}),":"]}),(0,r.jsx)(es.ZP,{className:"h-32 rounded-b border-0",columns:v,rows:null!==(t=null==d?void 0:d.rows)&&void 0!==t?t:[],onCellDoubleClick:(e,n)=>{n.preventDefault(),n.stopPropagation()},renderers:{noRowsFallback:(0,r.jsxs)("div",{className:"w-96 px-2",children:[g&&(0,r.jsx)("div",{className:"py-2",children:(0,r.jsx)(ed.Z,{})}),h&&(0,r.jsxs)("p",{className:"text-foreground-light",children:["Failed to find referencing row: ",u.message]}),m&&(0,r.jsx)("p",{className:"text-foreground-light",children:"No results were returned"})]})}}),(0,r.jsx)("div",{className:"flex items-center justify-end px-2 py-1",children:(0,r.jsx)(ec.Sf,{href:"/project/".concat(s,"/editor/").concat(l.id,"?schema=").concat(l.schema,"&filter=").concat(i,"%3Aeq%3A").concat(o),projectRef:s,id:String(l.id),filters:[{column:i,operator:"=",value:String(o)}],children:(0,r.jsx)(p.z,{type:"default",children:"Open table"})})})]})},em=e=>{var n;let{project:t}=(0,ea.d2)(),{tableId:a,row:l,column:i}=e,o=a?Number(a):void 0,{data:s}=(0,k.iB)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:o}),c=null==s?void 0:s.columns.find(e=>e.name===i.key),d=(0,E.N3)(s)?s:void 0,u=(null!==(n=null==d?void 0:d.relationships)&&void 0!==n?n:[]).find(e=>e.source_schema===(null==d?void 0:d.schema)&&e.source_table_name===(null==d?void 0:d.name)&&e.source_column_name===i.name),{data:f}=(0,ei.Bj)({projectRef:null==t?void 0:t.ref,includeColumns:!0,connectionString:null==t?void 0:t.connectionString,schema:null==u?void 0:u.target_table_schema}),p=null==f?void 0:f.find(e=>e.schema===(null==u?void 0:u.target_table_schema)&&e.name===u.target_table_name),h=l[i.key],g=(null==c?void 0:c.format)==="bytea"&&h?(0,X.D4)(h):h;return(0,r.jsxs)("div",{className:"sb-grid-foreign-key-formatter flex justify-between",children:[(0,r.jsx)("span",{className:"sb-grid-foreign-key-formatter__text",children:null===g?(0,r.jsx)(T.q,{}):g}),void 0!==u&&void 0!==p&&null!==g&&(0,r.jsxs)(m.J2,{children:[(0,r.jsx)(m.xo,{asChild:!0,children:(0,r.jsx)(el.u,{type:"default",className:"w-6 h-6",icon:(0,r.jsx)(er.Z,{}),onClick:e=>e.stopPropagation(),tooltip:{content:{side:"bottom",text:"View referencing record"}}})}),(0,r.jsx)(m.yk,{portal:!0,align:"end",className:"p-0 w-96",children:(0,r.jsx)(eu,{table:p,column:u.target_column_name,value:g})})]})]})},ef=e=>{let n=e.row[e.column.key];if(null===n)return(0,r.jsx)(T.q,{});if(""===n)return(0,r.jsx)(K,{});if("string"==typeof n&&n.endsWith("..."))return(0,r.jsx)(r.Fragment,{children:n});try{let e=JSON.parse(n);return(0,r.jsx)(r.Fragment,{children:JSON.stringify(e)})}catch(e){return(0,r.jsx)(r.Fragment,{children:JSON.stringify(n)})}};var ep=t(4534);let eh={key:a.uZ,name:"",idx:999,width:100,maxWidth:100,resizable:!1,sortable:!1,frozen:!1,isLastFrozenColumn:!1,renderHeaderCell:()=>(0,r.jsx)(eg,{"aria-label":"Add New Row"}),renderCell:et,parent:void 0,level:0,minWidth:0,draggable:!1},eg=e=>{let{}=e,{onAddColumn:n}=(0,l.Qq)();return(0,r.jsx)("div",{className:"sb-grid-add-column",children:(0,r.jsx)(p.z,{block:!0,type:"text",onClick:n,icon:(0,r.jsx)(ep.Z,{})})})};var ex=t(74286),ev=t(49473),eb=t(17751),ey=t(37555),ej=t(29303),e_=t(55614),eN=t(33482);function ew(e){let{column:n,columnType:t,isPrimaryKey:a,isEncrypted:i,format:o,foreignKey:s}=e,c=(0,u.useRef)(null),d=(0,l.I0)(),m=n.idx,f=n.key,p="array"==t?"".concat(o.replace("_",""),"[]"):o,h=(0,l.Qq)(),g=n.name;(0,u.useEffect)(()=>{h.gridColumns[m].key!=f&&d({type:"UPDATE_COLUMN_IDX",payload:{columnKey:f,columnIdx:m}})},[f,m,h.gridColumns]);let[{isDragging:x},v]=(0,eb.c)({type:"column-header",item:()=>({key:f,index:m}),canDrag:()=>!n.frozen,collect:e=>({isDragging:e.isDragging()})}),[{handlerId:b},y]=(0,ey.L)({accept:"column-header",collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){var r;if(!c.current||n.frozen)return;let a=e.index,l=e.key;if(a===m)return;let i=null===(r=c.current)||void 0===r?void 0:r.getBoundingClientRect(),o=(i.right-i.left)/2,s=t.getClientOffset().x-i.left;a<m&&s<o||a>m&&s>o||(j(l,f),e.index=m)}}),j=(e,n)=>{e!=n&&d({type:"MOVE_COLUMN",payload:{fromKey:e,toKey:n}})},_=n.frozen?"sb-grid-column-header--cursor":"";return v(y(c)),(0,r.jsx)("div",{ref:c,"data-handler-id":b,style:{opacity:x?0:1},className:"w-full",children:(0,r.jsxs)("div",{className:"sb-grid-column-header ".concat(_),children:[(0,r.jsxs)("div",{className:"sb-grid-column-header__inner",children:[function(e,n){let{name:t,foreignKey:a}=n;return"foreign_key"===e?(0,r.jsxs)(O.u,{children:[(0,r.jsx)(O.aJ,{children:(0,r.jsx)(ev.Z,{size:14,strokeWidth:2})}),(0,r.jsx)(O._v,{side:"bottom",children:(0,r.jsxs)("div",{className:"font-normal",children:[(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Foreign key relation:"}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("p",{className:"text-xs !text-foreground",children:t}),(0,r.jsx)(er.Z,{size:14,strokeWidth:1.5,className:"!text-foreground-light"}),(0,r.jsxs)("p",{className:"text-xs !text-foreground",children:[null==a?void 0:a.targetTableSchema,".",null==a?void 0:a.targetTableName,".",null==a?void 0:a.targetColumnName]})]}),(null==a?void 0:a.updateAction)!==e_.N.NO_ACTION&&(0,r.jsxs)("p",{className:"text-xs !text-foreground mt-1",children:["On update: ",(0,ej.s8)(null==a?void 0:a.updateAction)]}),(null==a?void 0:a.deletionAction)!==e_.N.NO_ACTION&&(0,r.jsxs)("p",{className:"text-xs !text-foreground mt-1",children:["On delete: ",(0,ej.s8)(null==a?void 0:a.deletionAction)]})]})})]}):null}(t,{name:n.name,foreignKey:s}),a&&(0,r.jsxs)(O.u,{children:[(0,r.jsx)(O.aJ,{children:(0,r.jsx)("div",{className:"sb-grid-column-header__inner__primary-key",children:(0,r.jsx)(eo.Z,{size:14,strokeWidth:2})})}),(0,r.jsx)(O._v,{side:"bottom",className:"font-normal",children:"Primary key"})]}),(0,r.jsx)("span",{className:"sb-grid-column-header__inner__name",title:g,children:n.name}),(0,r.jsxs)("span",{className:"sb-grid-column-header__inner__format",children:[p,"bytea"===p?" (hex)":""]}),i&&(0,r.jsxs)(O.u,{children:[(0,r.jsx)(O.aJ,{children:(0,r.jsx)(ex.Z,{size:14,strokeWidth:2})}),(0,r.jsx)(O._v,{side:"bottom",className:"font-normal",children:"Encrypted column"})]})]}),(0,r.jsx)(eN.ov,{column:n,isEncrypted:i})]})})}var eC=t(95962),ek=t(11152);let eE={key:a.W,name:"",idx:0,width:65,maxWidth:65,resizable:!1,sortable:!1,frozen:!0,isLastFrozenColumn:!1,renderHeaderCell:e=>{let[n,t]=(0,es.Gt)();return(0,r.jsx)(eq,{"aria-label":"Select All",tabIndex:e.tabIndex,value:n,onChange:e=>t({type:"HEADER",checked:e})})},renderCell:e=>{let[n,t]=(0,es.Gt)();return(0,r.jsx)(eR,{"aria-label":"Select",tabIndex:e.tabIndex,value:n,row:e.row,onChange:(n,r)=>{t({type:"ROW",row:e.row,checked:n,isShiftClick:r})},onClick:eS})},renderGroupCell:e=>{let[n,t]=(0,es.Gt)();return(0,r.jsx)(eR,{"aria-label":"Select Group",tabIndex:e.tabIndex,value:n,onChange:n=>{t({type:"ROW",row:e.row,checked:n,isShiftClick:!1})},onClick:eS})},parent:void 0,level:0,minWidth:0,draggable:!1};function eS(e){e.stopPropagation()}function eR(e){let{row:n,value:t,tabIndex:a,disabled:i,onClick:o,onChange:s,"aria-label":c,"aria-labelledby":d}=e,{onEditRow:u}=(0,l.Qq)();return(0,r.jsxs)("div",{className:"sb-grid-select-cell__formatter",children:[(0,r.jsx)("input",{"aria-label":c,"aria-labelledby":d,tabIndex:a,type:"checkbox",className:"rdg-row__select-column__select-action",disabled:i,checked:t,onChange:function(e){s(e.target.checked,e.nativeEvent.shiftKey)},onClick:o}),u&&n&&(0,r.jsx)(el.u,{type:"text",size:"tiny",className:"px-1 rdg-row__select-column__edit-action",icon:(0,r.jsx)(eC.Z,{}),onClick:function(e){e.stopPropagation(),u&&n&&u(n)},tooltip:{content:{side:"bottom",text:"Expand row"}}})]})}function eq(e){let{disabled:n,tabIndex:t,value:a,onChange:l,onClick:i,"aria-label":o,"aria-labelledby":s}=e,c=(0,ek.uM)(),d=(0,u.useRef)(null),m=c.selectedRows.size>0&&!c.allRowsSelected;return(0,u.useEffect)(()=>{d.current&&(d.current.indeterminate=m)},[m]),(0,r.jsx)("div",{className:"sb-grid-select-cell__header",children:(0,r.jsx)("input",{ref:d,"aria-label":o,"aria-labelledby":s,tabIndex:t,type:"checkbox",className:"sb-grid-select-cell__header__input",disabled:n,checked:a,onChange:function(e){l(e.target.checked,e.nativeEvent.shiftKey)},onClick:i})})}var eA=t(24372);let eI=9;function eO(e,n){let t=[eE,...e.columns.map((e,t)=>{var l;let i=function(e){if((0,eA.Pm)(e))return"foreign_key";if((0,eA.v3)(e.dataType))return"number";if((0,eA.nr)(e.dataType))return"array";if((0,eA.om)(e.dataType))return"json";if((0,eA.II)(e.dataType))return"text";if((0,eA.kO)(e.format))return"citext";if((0,eA.VO)(e.format))return"date";else if((0,eA.LT)(e.format))return"time";else if((0,eA.Kp)(e.format))return"datetime";else if((0,eA.nL)(e.dataType))return"boolean";else if((0,eA.N8)(e.dataType))return"enum";else if((0,eA.yM)(e.dataType))return"binary";else return"unknown"}(e),s=eL(e),c=(e.name.length+e.format.length)*eI,d=(null==n?void 0:n.defaultWidth)?n.defaultWidth:s<c?c:s;return{key:e.name,name:e.name,idx:t+1,resizable:!0,sortable:!0,width:d,minWidth:a.mr,frozen:e.isPrimaryKey||!1,isLastFrozenColumn:!1,renderHeaderCell:n=>(0,r.jsx)(ew,{...n,columnType:i,isPrimaryKey:e.isPrimaryKey,isEncrypted:e.isEncrypted,format:e.format,foreignKey:e.foreignKey}),renderEditCell:n?function(e,n,t,a,l){if(!t)return["array","json"].includes(n)?e=>(0,r.jsx)(Z,{...e,isEditable:t,onExpandEditor:a}):["number","boolean"].includes(n)?void 0:e=>(0,r.jsx)(W,{...e,isEditable:t,onExpandEditor:l});if(!e.isPrimaryKey&&e.isUpdatable)switch(n){case"boolean":return n=>(0,r.jsx)(o,{...n,isNullable:e.isNullable});case"date":return _("date",e.isNullable||!1);case"datetime":return e.format.endsWith("z")?_("datetimetz",e.isNullable||!1):_("datetime",e.isNullable||!1);case"time":return e.format.endsWith("z")?G:Q;case"enum":{let n=e.enum.map(e=>({label:e,value:e}));return t=>(0,r.jsx)(M,{...t,options:n,isNullable:e.isNullable})}case"array":case"json":return e=>(0,r.jsx)(Z,{...e,onExpandEditor:a});case"number":return U;case"citext":case"text":return n=>(0,r.jsx)(W,{...n,isEditable:t,isNullable:e.isNullable,onExpandEditor:l});default:return}}(e,i,null!==(l=null==n?void 0:n.editable)&&void 0!==l&&l,n.onExpandJSONEditor,n.onExpandTextEditor):void 0,renderCell:function(e,n,t){switch(n){case"boolean":return en;case"foreign_key":if(!e.isUpdatable)return et;return e=>(0,r.jsx)(em,{...e,projectRef:t.projectRef,tableId:t.tableId});case"binary":return ee;case"json":return ef;default:return et}}(e,i,{projectRef:null==n?void 0:n.projectRef,tableId:null==n?void 0:n.tableId}),parent:void 0,level:0,maxWidth:void 0,draggable:!1}})];return(null==n?void 0:n.onAddColumn)&&t.push(eh),t}function eL(e){return(0,eA.v3)(e.dataType)?120:(0,eA.Kp)(e.format)||(0,eA.VO)(e.format)||(0,eA.LT)(e.format)?150:(0,eA.nL)(e.dataType)?120:(0,eA.N8)(e.dataType)?150:250}},24372:function(e,n,t){t.d(n,{II:function(){return d},Kp:function(){return p},LT:function(){return v},N8:function(){return _},Pm:function(){return C},VO:function(){return g},kO:function(){return m},nL:function(){return y},nr:function(){return s},om:function(){return i},v3:function(){return a},yM:function(){return w}});let r=["smallint","integer","bigint","decimal","numeric","real","double precision","serial","bigserial","int2","int4","int8","float4","float8","smallserial","serial2","serial4","serial8"];function a(e){return r.indexOf(e.toLowerCase())>-1}let l=["json","jsonb","array"];function i(e){return l.indexOf(e.toLowerCase())>-1}let o=["array"];function s(e){return o.indexOf(e.toLowerCase())>-1}let c=["uuid","text","character varying"];function d(e){return c.indexOf(e.toLowerCase())>-1}let u=["citext"];function m(e){return u.indexOf(e.toLowerCase())>-1}let f=["timestamp","timestamptz"];function p(e){return f.indexOf(e.toLowerCase())>-1}let h=["date"];function g(e){return h.indexOf(e.toLowerCase())>-1}let x=["time","timetz"];function v(e){return x.indexOf(e.toLowerCase())>-1}let b=["boolean","bool"];function y(e){return b.indexOf(e.toLowerCase())>-1}let j=["user-defined"];function _(e){return j.indexOf(e.toLowerCase())>-1}let N=["bytea"];function w(e){return N.indexOf(e.toLowerCase())>-1}function C(e){var n;let{targetTableSchema:t,targetTableName:r,targetColumnName:a}=null!==(n=null==e?void 0:e.foreignKey)&&void 0!==n?n:{};return!!t&&!!r&&!!a}},73692:function(e,n,t){t.d(n,{b:function(){return d}});var r=t(97458),a=t(52983),l=t(37914),i=t(53486),o=t(19405),s=t(61958),c=t(19369);let d=e=>{let{visible:n,onClose:t}=e;return(0,r.jsx)(l.Z,{size:"medium",visible:n,header:"Schemas managed by Supabase",customFooter:(0,r.jsx)("div",{className:"flex items-center justify-end space-x-2",children:(0,r.jsx)(i.z,{type:"default",onClick:()=>t(),children:"Understood"})}),onCancel:()=>t(),children:(0,r.jsxs)(l.Z.Content,{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-sm",children:"The following schemas are managed by Supabase and are currently protected from write access through the dashboard."}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:s.s.map(e=>(0,r.jsx)("code",{className:"text-xs",children:e},e))}),(0,r.jsx)("p",{className:"text-sm !mt-4",children:"These schemas are critical to the functionality of your Supabase project and hence we highly recommend not altering them."}),(0,r.jsx)("p",{className:"text-sm",children:"You can, however, still interact with those schemas through the SQL Editor although we advise you only do so if you know what you are doing."})]})})};n.Z=e=>{let{schema:n,entity:t}=e,[l,s]=(0,a.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.bZ,{children:[(0,r.jsx)(c.Z,{strokeWidth:2}),(0,r.jsxs)(o.Cd,{children:["Currently viewing ",t," from a protected schema"]}),(0,r.jsxs)(o.X,{children:[(0,r.jsxs)("p",{className:"mb-2",children:["The ",(0,r.jsx)("code",{className:"text-xs",children:n})," schema is managed by Supabase and is read-only through the dashboard."]}),(0,r.jsx)(i.z,{type:"default",size:"tiny",onClick:()=>s(!0),children:"Learn more"})]})]}),(0,r.jsx)(d,{visible:l,onClose:()=>s(!1)})]})}},42010:function(e,n,t){t.d(n,{U:function(){return l},h:function(){return i}});var r=t(97458),a=t(61115);let l=()=>(0,r.jsx)("div",{className:"p-2 col-span-full",children:(0,r.jsx)(a.A,{})}),i=()=>(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("div",{className:"h-10 bg-dash-sidebar"}),(0,r.jsx)("div",{className:"h-9 border-y"}),(0,r.jsx)(l,{})]})},29303:function(e,n,t){t.d(n,{Of:function(){return p},QZ:function(){return d},Sb:function(){return v},oo:function(){return m},s8:function(){return x},uE:function(){return u},xY:function(){return f}});var r=t(85466),a=t.n(r),l=t(7534),i=t.n(l),o=t(55614),s=t(6433);let c=e=>{if(["CURRENT_DATE"].includes(e)||"("===e[0]&&")"===e[e.length-1])return!0;let n=e.indexOf("("),t=e.indexOf(")");return!(e.indexOf(" ")>=0)&&n>=0&&t>n},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{name:n,table:t,schema:r,format:a}=e;return{id:(0,s.k$)(),name:n||"",table:t||"",schema:r||"",comment:"",format:a||"",defaultValue:null,foreignKey:void 0,check:null,isNullable:!0,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}},u=(e,n,t)=>{var r,a;let{primary_keys:l}=n,i=l.map(e=>e.name),o=h(e,n,t),c=(null==e?void 0:e.data_type)==="ARRAY";return{foreignKey:o,id:null!==(r=null==e?void 0:e.id)&&void 0!==r?r:(0,s.k$)(),table:e.table,schema:e.schema,name:e.name,comment:null!==(a=null==e?void 0:e.comment)&&void 0!==a?a:"",format:c?e.format.slice(1):e.format,defaultValue:null==e?void 0:e.default_value,check:e.check,isArray:c,isNullable:e.is_nullable,isIdentity:e.is_identity,isUnique:e.is_unique,isNewColumn:!1,isEncrypted:!1,isPrimaryKey:i.includes(e.name)}},m=(e,n)=>{var t,r;let a=!!n.format.includes("int")&&n.isIdentity,l=n.defaultValue;return{tableId:e,isIdentity:a,name:n.name.trim(),comment:null===(t=n.comment)||void 0===t?void 0:t.trim(),type:n.isArray?"".concat(n.format,"[]"):n.format,check:(null===(r=n.check)||void 0===r?void 0:r.trim())||void 0,isUnique:n.isUnique,isPrimaryKey:n.isPrimaryKey,...!n.isPrimaryKey&&!a&&{isNullable:n.isNullable},...!a&&{defaultValue:n.isArray&&l?g(l):l},...!a&&l&&{defaultValueFormat:i()(l)||c(l)?"expression":"literal"}}},f=(e,n,t)=>{var r,l,o,s,d,u;let m=n.primary_keys.map(e=>e.name).includes(e.name),f=t.name.trim(),p=t.isArray?"".concat(t.format,"[]"):t.format,h=null===(r=(null!==(u=null===(l=t.comment)||void 0===l?void 0:l.length)&&void 0!==u?u:"")===0?null:t.comment)||void 0===r?void 0:r.trim(),g=null===(o=t.check)||void 0===o?void 0:o.trim(),x={};if(a()(e.name.trim(),f)||(x.name=f),a()(null===(s=e.comment)||void 0===s?void 0:s.trim(),h)||(x.comment=h),a()(null===(d=e.check)||void 0===d?void 0:d.trim(),g)||(x.check=g),a()(e.format,p)||(x.type=p),!a()(e.default_value,t.defaultValue)){let e=t.defaultValue;x.defaultValue=e,x.defaultValueFormat=i()(e)||c(e)?"expression":"literal"}return a()(e.is_identity,t.isIdentity)||(x.isIdentity=t.isIdentity),a()(e.is_nullable,t.isNullable)||(x.isNullable=t.isNullable),a()(e.is_unique,t.isUnique)||(x.isUnique=t.isUnique),a()(m,t.isPrimaryKey)||(x.isPrimaryKey=t.isPrimaryKey),x},p=e=>{let n={};return 0===e.name.length&&(n.name="Please assign a name for your column"),0===e.format.length&&(n.format="Please select a type for your column"),n},h=(e,n,t)=>{let{relationships:r}=n,a=r.find(n=>n.source_schema===e.schema&&n.source_table_name===e.table&&n.source_column_name===e.name);if(void 0===a)return a;{var l,i;let e=t.find(e=>e.id===a.id);return{...a,deletion_action:null!==(l=null==e?void 0:e.deletion_action)&&void 0!==l?l:o.N.NO_ACTION,update_action:null!==(i=null==e?void 0:e.update_action)&&void 0!==i?i:o.N.NO_ACTION}}},g=e=>e?e.replaceAll("[","{").replaceAll("]","}"):null,x=e=>{switch(e){case o.N.CASCADE:return"Cascade";case o.N.RESTRICT:return"Restrict";case o.N.SET_DEFAULT:return"Set default";case o.N.SET_NULL:return"Set NULL";default:return}},v=(e,n)=>{let t=n||"column_name";switch(e){case"int2":case"int4":case"int8":case"numeric":return'"'.concat(t,'" > 0');case"float4":case"float8":return'"'.concat(t,'" > 0.0');case"text":case"varchar":return'length("'.concat(t,'") <= 50');case"json":case"jsonb":return'jsonb_typeof("'.concat(t,"\"->'active') = 'boolean'");case"bool":return'"'.concat(t,'" in (true, false)');case"date":return'"'.concat(t,"\" > '2024-01-01'");case"time":return'"'.concat(t,"\" between '09:00:00' and '12:00:00'");case"timetz":return'"'.concat(t,"\" at time zone 'UTC' between '09:00:00+00' and '17:00:00+00'");case"uuid":return'"'.concat(t,"\" '00000000-0000-0000-0000-000000000000'");case"timestamp":return'"'.concat(t,"\" > '2023-01-01 00:00' and \"").concat(t,"\" < '2025-01-01 00:00'");case"timestamptz":return'"'.concat(t,"\" > '2023-01-01 00:00:00+00' and \"").concat(t,"\" < '2025-01-01 00:00:00+00'");default:return'length("'.concat(t,'") < 500')}}},37990:function(e,n,t){t.d(n,{S:function(){return s},x:function(){return c}});var r=t(97458),a=t(55614),l=t(29274),i=t(50322),o=t(29303);let s=e=>e.map(e=>({id:e.id,name:e.constraint_name,tableId:e.target_id,schema:e.target_schema,table:e.target_table,columns:e.source_columns.map((n,t)=>({source:n,target:e.target_columns[t]})),deletionAction:e.deletion_action,updateAction:e.update_action})),c=(e,n,t)=>{var s;let c="update"===e?"Updating":"Deleting",d=null!==(s=(0,o.s8)(n))&&void 0!==s?s:"No action";switch(n){case a.N.NO_ACTION:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,r.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will"," ",(0,r.jsx)("span",{className:"text-amber-900 opacity-75",children:"raise an error"})," if there are records existing in this table that reference it"]});case a.N.CASCADE:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,r.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will"," ",(0,r.jsxs)("span",{className:"text-amber-900 opacity-75",children:["also ",e]})," any records that reference it in this table"]});case a.N.RESTRICT:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-foreground-light",children:d}),(0,r.jsxs)(i.u,{children:[(0,r.jsx)(i.aJ,{className:"translate-y-[3px] mx-1",children:(0,r.jsx)(l.Z,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,r.jsx)(i._v,{side:"bottom",className:"w-80",children:"This is similar to no action, but the restrict check cannot be deferred till later in the transaction"})]}),": ",c," a record from"," ",(0,r.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will"," ",(0,r.jsxs)("span",{className:"text-amber-900 opacity-75",children:["prevent ",c.toLowerCase()]})," ","existing referencing rows from this table."]});case a.N.SET_DEFAULT:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,r.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will set the value of any existing records in this table referencing it to their"," ",(0,r.jsx)("span",{className:"text-amber-900 opacity-75",children:"default value"})]});case a.N.SET_NULL:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,r.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will set the value of any existing records in this table referencing it"," ",(0,r.jsx)("span",{className:"text-amber-900 opacity-75",children:"to NULL"})]})}}},57718:function(e,n,t){t.d(n,{D4:function(){return R},Gq:function(){return y},Of:function(){return j},X3:function(){return E},YY:function(){return k},kh:function(){return S}});var r=t(28977),a=t.n(r),l=t(6494),i=t.n(l),o=t(85466),s=t.n(o),c=t(7534),d=t.n(c),u=t(76705),m=t.n(u),f=t(55371),p=t.n(f),h=t(15834),g=t(6433),x=t(35508),v=t(15313).Buffer;let b=e=>{let{column:n,row:t}=e;return void 0===t?x.BB.includes(n.format)?null:"bool"!==n.format?"":n.default_value?n.default_value:n.is_nullable?"null":null:"bool"===n.format&&null===t[n.name]?"null":x.nA.includes(n.format)?w(n.format,t[n.name]):_(t[n.name],n.format)},y=(e,n,t)=>{var r;let{primary_keys:a}=n,l=a.map(e=>e.name);return(null!==(r=n.columns)&&void 0!==r?r:[]).map(n=>{var r,a;let i=b({column:n,row:e}),o=t.find(e=>e.columns.map(e=>e.source).includes(n.name));return{value:i,foreignKey:void 0!==o?{id:o.id,constraint_name:o.name,source_schema:n.schema,source_table_name:n.table,source_column_name:n.name,target_table_schema:o.schema,target_table_name:o.table,target_column_name:null!==(a=null===(r=o.columns.find(e=>e.source===n.name))||void 0===r?void 0:r.target)&&void 0!==a?a:""}:void 0,id:n.id,name:n.name,comment:N(n.comment),format:n.format,enums:n.enums,defaultValue:null==n?void 0:n.default_value,isNullable:n.is_nullable,isIdentity:n.is_identity,isPrimaryKey:l.includes(n.name)}})},j=e=>{let n={};return e.forEach(e=>{var t,r,a;if(e.format.startsWith("_")&&e.value)try{JSON.parse(e.value)}catch(t){n[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(null!==(r=null===(t=e.value)||void 0===t?void 0:t.length)&&void 0!==r?r:0)>0){if(S(e.value))return;try{(0,g.jn)(null!==(a=e.value)&&void 0!==a?a:"")}catch(t){n[e.name]="Value is invalid JSON"}}if(e.isIdentity||e.defaultValue)return}),n},_=(e,n)=>{try{if(null===e||"string"==typeof e&&0===e.length||"number"==typeof e||!n)return e;if("bytea"===n)return R(e);if("object"==typeof e)return JSON.stringify(e);else if("boolean"==typeof e)return e.toString();else return e}catch(n){return e}},N=e=>{var n,t;if(!e)return"";let r=i()(e.split("\n"));return 1==r.length?e:2==r.length?"".concat(r[0]," ").concat(null===(n=r[1])||void 0===n?void 0:n.split(".<")[0]):r.length>2?"".concat(r[0]," (").concat(r[1]," ").concat(null===(t=r[2])||void 0===t?void 0:t.split(".<")[0],")"):""},w=(e,n)=>{if(!n||0==n.length)return"";if(x.Ks.includes(e))return a()(n).format("YYYY-MM-DDTHH:mm:ss");if(!x.XO.includes(e))return n;{let e=n&&n.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return a()(n,e).format("HH:mm:ss")}},C=(e,n)=>{if(!n||0==n.length)return null;switch(e){case"timestamptz":return a()(n,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return a()(n,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return a()(n,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return a()(n,"HH:mm:ss").format("HH:mm:ss");default:return n}},k=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t={};return e.forEach(e=>{var n;let r=e.format.startsWith("_"),a=x.BB.includes(e.format)?e.value:0===(null!==(n=null==e?void 0:e.value)&&void 0!==n?n:"").length?null:e.value;if(r&&null!==a)t[e.name]=(0,g.dW)(a);else if(e.format.includes("json"))"object"==typeof e.value?t[e.name]=a:m()(a)&&(t[e.name]=(0,g.dW)(a));else if("bool"===e.format&&a)"null"===a?t[e.name]=null:t[e.name]="true"===a;else if(x.nA.includes(e.format)){let n=2===(a||"").split(":").length?"".concat(a,":00"):a;t[e.name]=C(e.format,n)}else t[e.name]=a}),n?t:p()(t,d())},E=(e,n)=>{let t=k(n,!0),r={};return Object.keys(t).forEach(a=>{let l=n.find(e=>e.name===a),i=null==l?void 0:l.format;if(void 0!==i&&x.nA.includes(i)){let n=w(i,e[a]);C(i,n)!==t[a]&&(r[a]=t[a])}else void 0!==i&&x.YF.includes(i)?S(null==l?void 0:l.value)||(r[a]=t[a]):s()(e[a],t[a])||(r[a]=t[a])}),r},S=e=>(null==e?void 0:e.endsWith("..."))&&(null!=e?e:"").length>h.no,R=e=>{try{return"\\x".concat(v.from(e.data).toString("hex"))}catch(n){return e}}},35508:function(e,n,t){t.d(n,{BB:function(){return c},DL:function(){return h},Ks:function(){return d},N0:function(){return x},VP:function(){return g},XO:function(){return m},YF:function(){return s},ji:function(){return o},lb:function(){return u},nA:function(){return f},vH:function(){return p}});var r=t(11466),a=t.n(r),l=t(71635),i=t.n(l);let o=["int2","int4","int8","float4","float8","numeric","double precision"],s=["json","jsonb"],c=["text","varchar"],d=["timestamp","timestamptz"],u=["date"],m=["time","timetz"],f=a()(d,u,m),p=["uuid","bool","vector","bytea"],h=i()(a()(o,s,c,f,p)),g={varchar:{alternative:"text",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_varchar.28n.29_by_default"},json:{alternative:"jsonb",reference:"https://www.postgresql.org/docs/current/datatype-json.html"},timetz:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timetz"},timestamp:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timestamp_.28without_time_zone.29"}},x=[{name:"int2",description:"Signed two-byte integer",type:"number"},{name:"int4",description:"Signed four-byte integer",type:"number"},{name:"int8",description:"Signed eight-byte integer",type:"number"},{name:"float4",description:"Single precision floating-point number (4 bytes)",type:"number"},{name:"float8",description:"Double precision floating-point number (8 bytes)",type:"number"},{name:"numeric",description:"Exact numeric of selectable precision",type:"number"},{name:"json",description:"Textual JSON data",type:"json"},{name:"jsonb",description:"Binary JSON data, decomposed",type:"json"},{name:"text",description:"Variable-length character string",type:"text"},{name:"varchar",description:"Variable-length character string",type:"text"},{name:"uuid",description:"Universally unique identifier",type:"text"},{name:"date",description:"Calendar date (year, month, day)",type:"time"},{name:"time",description:"Time of day (no time zone)",type:"time"},{name:"timetz",description:"Time of day, including time zone",type:"time"},{name:"timestamp",description:"Date and time (no time zone)",type:"time"},{name:"timestamptz",description:"Date and time, including time zone",type:"time"},{name:"bool",description:"Logical boolean (true/false)",type:"bool"},{name:"bytea",description:"Variable-length binary string",type:"others"}]},13537:function(e,n,t){t.d(n,{R:function(){return r},k:function(){return a}});let r=(e,n,t,r,a)=>{let l=(null==r?void 0:r.find(r=>{var l,i;return(null==r?void 0:null===(l=r.metadata)||void 0===l?void 0:l.name)===e&&(null==r?void 0:null===(i=r.metadata)||void 0===i?void 0:i.schema)===a&&(null==r?void 0:r.name)===n&&t.includes(null==r?void 0:r.level)}))||null;return{hasLint:null!==l,count:l?1:0,matchingLint:l}},a=(e,n)=>{if(0===n.length)return"";let t=e.columns.map(e=>'"'.concat(e.name,'"')).join(", "),r=n.map(n=>{let t={...n};"idx"in t&&delete t.idx;let r=Object.entries(t).map(n=>{var t;let[r,a]=n,{dataType:l,format:i}=null!==(t=e.columns.find(e=>e.name===r))&&void 0!==t?t:{};return null===a?"null":"ARRAY"===l?"'".concat(JSON.stringify(a).replace("[","{").replace(/.$/,"}"),"'"):(null==i?void 0:i.includes("json"))?"".concat(JSON.stringify(a).replace(/\\"/g,'"').replace('"',"'").replace(/.$/,"'")):"'".concat(a,"'")});return"(".concat(r.join(", "),")")}).join(", ");return'INSERT INTO "'.concat(e.schema,'"."').concat(e.name,'" (').concat(t,") VALUES ").concat(r,";")}},47594:function(e,n,t){var r=t(97458),a=t(99033),l=t(2861),i=t(83145),o=t.n(i),s=t(53486);n.Z=e=>{let{title:n="",size:t="medium",children:i,ctaButtonLabel:c="",infoButtonLabel:d="",infoButtonUrl:u="",onClickCta:m=()=>{},loading:f=!1,disabled:p=!1,disabledMessage:h="",ctaUrl:g}=e,x=c&&m||u&&d;return(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,r.jsx)("div",{className:"flex space-x-4 rounded border bg-surface-100 p-6 shadow-md",children:(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsxs)("div",{className:"".concat("medium"===t?"w-80":"w-[400px]"," space-y-4"),children:[(0,r.jsx)("h5",{className:"text-foreground",children:n}),(0,r.jsx)("div",{className:"flex flex-col space-y-2 text-foreground-light",children:i}),x&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[c&&g?(0,r.jsx)(s.z,{asChild:!0,type:"primary",children:(0,r.jsx)(o(),{href:g,children:c})}):c&&m?(0,r.jsx)(l.u,{type:"primary",onClick:m,loading:f,disabled:f||p,tooltip:{content:{side:"bottom",text:p&&h.length>0?h:void 0}},children:c}):null,u&&d?(0,r.jsx)(s.z,{type:"default",icon:(0,r.jsx)(a.Z,{strokeWidth:1.5}),children:(0,r.jsx)("a",{target:"_blank",rel:"noreferrer",href:u,children:d})}):null]})]})})})})}},62445:function(e,n,t){var r=t(97458),a=t(56757),l=t(95962),i=t(99033),o=t(83145),s=t.n(o),c=t(52983),d=t(53486);let u=(0,c.forwardRef)((e,n)=>{let{icon:t,title:o,description:u,url:m,urlLabel:f="Read more",defaultVisibility:p=!1,hideCollapse:h=!1,button:g,className:x="",block:v=!1}=e,[b,y]=(0,c.useState)(p);return(0,r.jsx)("div",{ref:n,role:"alert",className:"".concat(v?"block w-full":"","\n      block w-full rounded-md border bg-surface-300/25 py-3 ").concat(x),children:(0,r.jsxs)("div",{className:"flex flex-col px-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex w-full space-x-3 items-center",children:[t&&(0,r.jsx)("span",{className:"text-foreground-lighter",children:t}),(0,r.jsx)("div",{className:"flex-grow",children:(0,r.jsx)("h5",{className:"text-sm text-foreground",children:o})})]}),u&&!h?(0,r.jsx)("div",{className:"cursor-pointer text-foreground-lighter",onClick:()=>y(!b),children:b?(0,r.jsx)(a.Z,{size:14,strokeWidth:1.5}):(0,r.jsx)(l.Z,{size:14,strokeWidth:1.5})}):null]}),(u||m||g)&&(0,r.jsxs)("div",{className:"flex flex-col space-y-3 overflow-hidden transition-all ".concat(b?"mt-3":""),style:{maxHeight:b?500:0},children:[(0,r.jsx)("div",{className:"text-foreground-light text-sm",children:u}),m&&(0,r.jsx)("div",{children:(0,r.jsx)(d.z,{asChild:!0,type:"default",icon:(0,r.jsx)(i.Z,{}),children:(0,r.jsx)(s(),{href:m,target:"_blank",rel:"noreferrer",children:f})})}),g&&(0,r.jsx)("div",{children:g})]})]})})});u.displayName="InformationBox",n.Z=u},67133:function(e,n,t){t.d(n,{LW:function(){return u},bn:function(){return h}});var r=t(36457),a=t(64618),l=t(34549),i=t(15538),o=t.n(i),s=t(70864),c=t(32161),d=t(63609);let u="pgmq_public",m=o()("\ncreate schema if not exists ".concat(u,";\ngrant usage on schema ").concat(u," to postgres, anon, authenticated, service_role;\n\ncreate or replace function ").concat(u,".pop(\n    queue_name text\n)\n  returns setof pgmq.message_record\n  language plpgsql\n  set search_path = ''\nas $$\nbegin\n    return query\n    select *\n    from pgmq.pop(\n        queue_name := queue_name\n    );\nend;\n$$;\n\ncomment on function ").concat(u,".pop(queue_name text) is 'Retrieves and locks the next message from the specified queue.';\n\n\ncreate or replace function ").concat(u,".send(\n    queue_name text,\n    message jsonb,\n    sleep_seconds integer default 0  -- renamed from 'delay'\n)\n  returns setof bigint\n  language plpgsql\n  set search_path = ''\nas $$\nbegin\n    return query\n    select *\n    from pgmq.send(\n        queue_name := queue_name,\n        msg := message,\n        delay := sleep_seconds\n    );\nend;\n$$;\n\ncomment on function ").concat(u,".send(queue_name text, message jsonb, sleep_seconds integer) is 'Sends a message to the specified queue, optionally delaying its availability by a number of seconds.';\n\n\ncreate or replace function ").concat(u,".send_batch(\n    queue_name text,\n    messages jsonb[],\n    sleep_seconds integer default 0  -- renamed from 'delay'\n)\n  returns setof bigint\n  language plpgsql\n  set search_path = ''\nas $$\nbegin\n    return query\n    select *\n    from pgmq.send_batch(\n        queue_name := queue_name,\n        msgs := messages,\n        delay := sleep_seconds\n    );\nend;\n$$;\n\ncomment on function ").concat(u,".send_batch(queue_name text, messages jsonb[], sleep_seconds integer) is 'Sends a batch of messages to the specified queue, optionally delaying their availability by a number of seconds.';\n\n\ncreate or replace function ").concat(u,".archive(\n    queue_name text,\n    message_id bigint\n)\n  returns boolean\n  language plpgsql\n  set search_path = ''\nas $$\nbegin\n    return\n    pgmq.archive(\n        queue_name := queue_name,\n        msg_id := message_id\n    );\nend;\n$$;\n\ncomment on function ").concat(u,".archive(queue_name text, message_id bigint) is 'Archives a message by moving it from the queue to a permanent archive.';\n\n\ncreate or replace function ").concat(u,".delete(\n    queue_name text,\n    message_id bigint\n)\n  returns boolean\n  language plpgsql\n  set search_path = ''\nas $$\nbegin\n    return\n    pgmq.delete(\n        queue_name := queue_name,\n        msg_id := message_id\n    );\nend;\n$$;\n\ncomment on function ").concat(u,".delete(queue_name text, message_id bigint) is 'Permanently deletes a message from the specified queue.';\n\ncreate or replace function ").concat(u,".read(\n    queue_name text,\n    sleep_seconds integer,\n    n integer\n)\n  returns setof pgmq.message_record\n  language plpgsql\n  set search_path = ''\nas $$\nbegin\n    return query\n    select *\n    from pgmq.read(\n        queue_name := queue_name,\n        vt := sleep_seconds,\n        qty := n\n    );\nend;\n$$;\n\ncomment on function ").concat(u,'.read(queue_name text, sleep_seconds integer, n integer) is \'Reads up to "n" messages from the specified queue with an optional "sleep_seconds" (visibility timeout).\';\n\n-- Grant execute permissions on wrapper functions to roles\ngrant execute on function ').concat(u,".pop(text) to postgres, service_role, anon, authenticated;\ngrant execute on function pgmq.pop(text) to postgres, service_role, anon, authenticated;\n\ngrant execute on function ").concat(u,".send(text, jsonb, integer) to postgres, service_role, anon, authenticated;\ngrant execute on function pgmq.send(text, jsonb, integer) to postgres, service_role, anon, authenticated;\n\ngrant execute on function ").concat(u,".send_batch(text, jsonb[], integer) to postgres, service_role, anon, authenticated;\ngrant execute on function pgmq.send_batch(text, jsonb[], integer) to postgres, service_role, anon, authenticated;\n\ngrant execute on function ").concat(u,".archive(text, bigint) to postgres, service_role, anon, authenticated;\ngrant execute on function pgmq.archive(text, bigint) to postgres, service_role, anon, authenticated;\n\ngrant execute on function ").concat(u,".delete(text, bigint) to postgres, service_role, anon, authenticated;\ngrant execute on function pgmq.delete(text, bigint) to postgres, service_role, anon, authenticated;\n\ngrant execute on function ").concat(u,".read(text, integer, integer) to postgres, service_role, anon, authenticated;\ngrant execute on function pgmq.read(text, integer, integer) to postgres, service_role, anon, authenticated;\n\n-- For the service role, we want full access\n-- Grant permissions on existing tables\ngrant all privileges on all tables in schema pgmq to postgres, service_role;\n\n-- Ensure service_role has permissions on future tables\nalter default privileges in schema pgmq grant all privileges on tables to postgres, service_role;\n\ngrant usage on schema pgmq to postgres, anon, authenticated, service_role;\n\n\n/*\n  Grant access to sequences to API roles by default. Existing table permissions\n  continue to enforce insert restrictions. This is necessary to accommodate the\n  on-backup hook that rebuild queue table primary keys to avoid a pg_dump segfault.\n  This can be removed once logical backups are completely retired.\n*/\ngrant usage, select, update\non all sequences in schema pgmq\nto anon, authenticated, service_role;\n\nalter default privileges in schema pgmq\ngrant usage, select, update\non sequences\nto anon, authenticated, service_role;\n")),f=o()("\n  drop function if exists \n    ".concat(u,".pop(queue_name text),\n    ").concat(u,".send(queue_name text, message jsonb, sleep_seconds integer),\n    ").concat(u,".send_batch(queue_name text, message jsonb[], sleep_seconds integer),\n    ").concat(u,".archive(queue_name text, message_id bigint),\n    ").concat(u,".delete(queue_name text, message_id bigint),\n    ").concat(u,".read(queue_name text, sleep integer, n integer)\n  ;\n\n  -- Revoke execute permissions on inner pgmq functions to roles (inverse of enabling)\n  do $$\n  begin\n      if exists (select 1 from pg_namespace where nspname = 'pgmq') then\n          -- Revoke privileges on the schema itself\n          revoke all on schema pgmq from anon, authenticated, service_role;\n          \n          -- Revoke default privileges for future objects\n          alter default privileges in schema pgmq revoke all on tables from anon, authenticated, service_role;\n          alter default privileges in schema pgmq revoke all on sequences from anon, authenticated, service_role;\n          alter default privileges in schema pgmq revoke all on functions from anon, authenticated, service_role;\n      end if;\n  end $$;\n\n  drop schema if exists ").concat(u,";\n"));async function p(e){let{projectRef:n,connectionString:t,enable:r}=e,{result:a}=await (0,s.R)({projectRef:n,connectionString:t,sql:r?m:f,queryKey:["toggle-queues-exposure"]});return a}let h=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,r.NL)();return(0,a.D)(e=>p(e),{async onSuccess(n,t,r){let{projectRef:a}=t;await i.invalidateQueries(c.a.exposePostgrestStatus(a)),i.invalidateQueries(d.A.schemas(a)),await (null==e?void 0:e(n,t,r))},async onError(e,t,r){void 0===n?l.Am.error("Failed to toggle queue exposure via PostgREST: ".concat(e.message)):n(e,t,r)},...t})}},32161:function(e,n,t){t.d(n,{a:function(){return r}});let r={create:()=>["queues","create"],delete:e=>["queues",e,"delete"],purge:e=>["queues",e,"purge"],getMessagesInfinite:(e,n,t)=>["projects",e,"queue-messages",n,t].filter(Boolean),list:e=>["projects",e,"queues"],metrics:(e,n)=>["projects",e,"queue-metrics",n],exposePostgrestStatus:e=>["projects",e,"queue-expose-status"]}},89548:function(e,n,t){t.d(n,{XJ:function(){return s}});var r=t(28894),a=t(70864),l=t(63609);let i=e=>{let{schema:n}=e;if(!n)throw Error("schema is required");return"\nSELECT \n  con.oid as id, \n  con.conname as constraint_name, \n  con.confdeltype as deletion_action,\n  con.confupdtype as update_action,\n  rel.oid as source_id,\n  nsp.nspname as source_schema, \n  rel.relname as source_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.conkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = rel.oid\n  ) source_columns, \n  frel.oid as target_id,\n  fnsp.nspname as target_schema, \n  frel.relname as target_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.confkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = frel.oid\n  ) target_columns \nFROM \n  pg_constraint con \n  INNER JOIN pg_class rel ON rel.oid = con.conrelid \n  INNER JOIN pg_namespace nsp ON nsp.oid = rel.relnamespace \n  INNER JOIN pg_class frel ON frel.oid = con.confrelid \n  INNER JOIN pg_namespace fnsp ON fnsp.oid = frel.relnamespace \nWHERE \n  con.contype = 'f'\n  AND nsp.nspname = '".concat(n,"'\n").trim()};async function o(e,n){let{projectRef:t,connectionString:r,schema:l}=e,o=i({schema:l}),{result:s}=await (0,a.R)({projectRef:t,connectionString:r,sql:o,queryKey:["foreign-key-constraints",l]},n);return(null!=s?s:[]).map(e=>({...e,source_columns:e.source_columns.replace("{","").replace("}","").split(","),target_columns:e.target_columns.replace("{","").replace("}","").split(",")}))}let s=function(e){let{projectRef:n,connectionString:t,schema:a}=e,{enabled:i=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.a)(l.A.foreignKeyConstraints(n,a),e=>{let{signal:r}=e;return o({projectRef:n,connectionString:t,schema:a},r)},{enabled:i&&void 0!==n&&void 0!==a,...s})}},12724:function(e,n,t){t.d(n,{Sf:function(){return x},xg:function(){return h},yF:function(){return g}});var r=t(97458),a=t(36457),l=t(32691),i=t(52983),o=t(11181),s=t(8427),c=t(32672),d=t(6570),u=t(15834),m=t(25135),f=t(5688),p=t(30565);function h(e){let{queryClient:n,projectRef:t,connectionString:r,id:a,sorts:l,filters:i,impersonatedRole:c}=e;return(0,d.nq)(n,{projectRef:t,connectionString:r,id:a}).then(e=>{if(e){var d;let m=(0,s.NK)(e),{sorts:p=[],filters:h=[]}=null!==(d=(0,o.v)(t,e.name,e.schema))&&void 0!==d?d:{};(0,u.Ue)(n,{projectRef:t,connectionString:r,tableId:a,sorts:null!=l?l:(0,s.rg)(m.name,p),filters:null!=i?i:(0,s.Yb)(h),page:1,limit:f.Re,impersonatedRole:c})}})}function g(){let e=(0,l.useRouter)(),n=(0,a.NL)(),{project:t}=(0,c.d2)(),r=(0,m.fN)();return(0,i.useCallback)(a=>{let{id:l,filters:i,sorts:o}=a,s=l?Number(l):void 0;!t||!s||isNaN(s)||(e.prefetch("/project/".concat(t.ref,"/editor/").concat(s)),h({queryClient:n,projectRef:t.ref,connectionString:t.connectionString,id:s,sorts:o,filters:i,impersonatedRole:r.role}).catch(()=>{}))},[t,n,r.role,e])}function x(e){let{projectRef:n,id:t,sorts:a,filters:l,href:i,children:o,...s}=e,c=g();return(0,r.jsx)(p.Z,{href:i||"/project/".concat(n,"/editor/").concat(t),prefetcher:()=>c({id:t,sorts:a,filters:l}),...s,children:o})}},91843:function(e,n,t){t.d(n,{Q:function(){return r}});let r={tableEditor:(e,n)=>["projects",e,"table-editor",n]}},6570:function(e,n,t){t.d(n,{IV:function(){return s},nq:function(){return d},iB:function(){return c}});var r=t(28894),a=t(70864),l=t(91843),i=t(15538),o=t.n(i);async function s(e,n){var t,r;let{projectRef:l,connectionString:i,id:s}=e;if(!s)throw Error("id is required");let c=s?o()("\n    with base_table_info as (\n        select \n            c.oid::int8 as id,\n            nc.nspname as schema,\n            c.relname as name,\n            c.relkind,\n            c.relrowsecurity as rls_enabled,\n            c.relforcerowsecurity as rls_forced,\n            c.relreplident,\n            c.relowner,\n            obj_description(c.oid) as comment\n        from pg_class c\n        join pg_namespace nc on nc.oid = c.relnamespace\n        where c.oid = ".concat(s,"\n            and not pg_is_other_temp_schema(nc.oid)\n            and (\n                pg_has_role(c.relowner, 'USAGE')\n                or has_table_privilege(\n                    c.oid,\n                    'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n                )\n                or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n            )\n    ),\n    table_stats as (\n        select \n            b.id,\n            case\n                when b.relreplident = 'd' then 'DEFAULT'\n                when b.relreplident = 'i' then 'INDEX'\n                when b.relreplident = 'f' then 'FULL'\n                else 'NOTHING'\n            end as replica_identity,\n            pg_total_relation_size(format('%I.%I', b.schema, b.name))::int8 as bytes,\n            pg_size_pretty(pg_total_relation_size(format('%I.%I', b.schema, b.name))) as size,\n            pg_stat_get_live_tuples(b.id) as live_rows_estimate,\n            pg_stat_get_dead_tuples(b.id) as dead_rows_estimate\n        from base_table_info b\n        where b.relkind in ('r', 'p')\n    ),\n    primary_keys as (\n        select \n            i.indrelid as table_id,\n            jsonb_agg(jsonb_build_object(\n                'schema', n.nspname,\n                'table_name', c.relname,\n                'table_id', i.indrelid::int8,\n                'name', a.attname\n            )) as primary_keys\n        from pg_index i\n        join pg_class c on i.indrelid = c.oid\n        join pg_attribute a on (a.attrelid = c.oid and a.attnum = any(i.indkey))\n        join pg_namespace n on c.relnamespace = n.oid\n        where i.indisprimary\n        group by i.indrelid\n    ),\n    relationships as (\n        select \n            c.conrelid as source_id,\n            c.confrelid as target_id,\n            jsonb_build_object(\n                'id', c.oid::int8,\n                'constraint_name', c.conname,\n                'deletion_action', c.confdeltype,\n                'update_action', c.confupdtype,\n                'source_schema', nsa.nspname,\n                'source_table_name', csa.relname,\n                'source_column_name', sa.attname,\n                'target_table_schema', nta.nspname,\n                'target_table_name', cta.relname,\n                'target_column_name', ta.attname\n            ) as rel_info\n        from pg_constraint c\n        join pg_class csa on c.conrelid = csa.oid\n        join pg_namespace nsa on csa.relnamespace = nsa.oid\n        join pg_attribute sa on (sa.attrelid = c.conrelid and sa.attnum = any(c.conkey))\n        join pg_class cta on c.confrelid = cta.oid\n        join pg_namespace nta on cta.relnamespace = nta.oid\n        join pg_attribute ta on (ta.attrelid = c.confrelid and ta.attnum = any(c.confkey))\n        where c.contype = 'f'\n    ),\n    columns as (\n        select \n            a.attrelid as table_id,\n            jsonb_agg(jsonb_build_object(\n                'id', (a.attrelid || '.' || a.attnum),\n                'table_id', c.oid::int8,\n                'schema', nc.nspname,\n                'table', c.relname,\n                'ordinal_position', a.attnum,\n                'name', a.attname,\n                'default_value', case \n                    when a.atthasdef then pg_get_expr(ad.adbin, ad.adrelid)\n                    else null\n                end,\n                'data_type', case \n                    when t.typtype = 'd' then \n                        case \n                            when bt.typelem <> 0::oid and bt.typlen = -1 then 'ARRAY'\n                            when nbt.nspname = 'pg_catalog' then format_type(t.typbasetype, null)\n                            else 'USER-DEFINED'\n                        end\n                    else \n                        case \n                            when t.typelem <> 0::oid and t.typlen = -1 then 'ARRAY'\n                            when nt.nspname = 'pg_catalog' then format_type(a.atttypid, null)\n                            else 'USER-DEFINED'\n                        end\n                end,\n                'format', case\n                    when t.typtype = 'e' then\n                        case\n                            when nt.nspname <> 'public' then concat(nt.nspname, '.', coalesce(bt.typname, t.typname))\n                            else coalesce(bt.typname, t.typname)\n                        end\n                    else\n                        coalesce(bt.typname, t.typname)\n                end,\n                'is_identity', a.attidentity in ('a', 'd'),\n                'identity_generation', case a.attidentity\n                    when 'a' then 'ALWAYS'\n                    when 'd' then 'BY DEFAULT'\n                    else null\n                end,\n                'is_generated', a.attgenerated in ('s'),\n                'is_nullable', not (a.attnotnull or t.typtype = 'd' and t.typnotnull),\n                'is_updatable', (\n                    b.relkind in ('r', 'p') or \n                    (b.relkind in ('v', 'f') and pg_column_is_updatable(b.id, a.attnum, false))\n                ),\n                'is_unique', uniques.table_id is not null,\n                'check', check_constraints.definition,\n                'comment', col_description(c.oid, a.attnum),\n                'enums', coalesce(\n                    (\n                        select jsonb_agg(e.enumlabel order by e.enumsortorder)\n                        from pg_catalog.pg_enum e\n                        where e.enumtypid = coalesce(bt.oid, t.oid)\n                            or e.enumtypid = coalesce(bt.typelem, t.typelem)\n                    ),\n                    '[]'::jsonb\n                )\n            ) order by a.attnum) as columns\n        from pg_attribute a\n        join base_table_info b on a.attrelid = b.id\n        join pg_class c on a.attrelid = c.oid\n        join pg_namespace nc on c.relnamespace = nc.oid\n        left join pg_attrdef ad on (a.attrelid = ad.adrelid and a.attnum = ad.adnum)\n        join pg_type t on a.atttypid = t.oid\n        join pg_namespace nt on t.typnamespace = nt.oid\n        left join pg_type bt on (t.typtype = 'd' and t.typbasetype = bt.oid)\n        left join pg_namespace nbt on bt.typnamespace = nbt.oid\n        left join (\n            select \n                conrelid as table_id,\n                conkey[1] as ordinal_position\n            from pg_catalog.pg_constraint\n            where contype = 'u' and cardinality(conkey) = 1\n        ) as uniques on uniques.table_id = a.attrelid and uniques.ordinal_position = a.attnum\n        left join (\n            select distinct on (conrelid, conkey[1])\n                conrelid as table_id,\n                conkey[1] as ordinal_position,\n                substring(\n                    pg_get_constraintdef(oid, true),\n                    8,\n                    length(pg_get_constraintdef(oid, true)) - 8\n                ) as definition\n            from pg_constraint\n            where contype = 'c' and cardinality(conkey) = 1\n            order by conrelid, conkey[1], oid asc\n        ) as check_constraints on check_constraints.table_id = a.attrelid \n                            and check_constraints.ordinal_position = a.attnum\n        where a.attnum > 0 \n        and not a.attisdropped\n        group by a.attrelid\n    )\n    select \n        case b.relkind\n            when 'r' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'rls_enabled', b.rls_enabled,\n                'rls_forced', b.rls_forced,\n                'replica_identity', ts.replica_identity,\n                'bytes', ts.bytes,\n                'size', ts.size,\n                'live_rows_estimate', ts.live_rows_estimate,\n                'dead_rows_estimate', ts.dead_rows_estimate,\n                'comment', b.comment,\n                'primary_keys', coalesce(pk.primary_keys, '[]'::jsonb),\n                'relationships', coalesce(\n                    (select jsonb_agg(r.rel_info)\n                    from relationships r\n                    where r.source_id = b.id or r.target_id = b.id), \n                    '[]'::jsonb\n                ),\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n            when 'p' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'rls_enabled', b.rls_enabled,\n                'rls_forced', b.rls_forced,\n                'replica_identity', ts.replica_identity,\n                'bytes', ts.bytes,\n                'size', ts.size,\n                'live_rows_estimate', ts.live_rows_estimate,\n                'dead_rows_estimate', ts.dead_rows_estimate,\n                'comment', b.comment,\n                'primary_keys', coalesce(pk.primary_keys, '[]'::jsonb),\n                'relationships', coalesce(\n                    (select jsonb_agg(r.rel_info)\n                    from relationships r\n                    where r.source_id = b.id or r.target_id = b.id), \n                    '[]'::jsonb\n                ),\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n            when 'v' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'is_updatable', (pg_relation_is_updatable(b.id, false) & 20) = 20,\n                'comment', b.comment,\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n            when 'm' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'is_populated', true,\n                'comment', b.comment,\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n            when 'f' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'comment', b.comment,\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n        end as entity\n    from base_table_info b\n    left join table_stats ts on b.id = ts.id\n    left join primary_keys pk on b.id = pk.table_id\n    left join columns c on b.id = c.table_id;\n  ")):"",{result:d}=await (0,a.R)({projectRef:l,connectionString:i,sql:c,queryKey:["table-editor",s]},n);return null!==(r=null===(t=d[0])||void 0===t?void 0:t.entity)&&void 0!==r?r:void 0}let c=function(e){let{projectRef:n,connectionString:t,id:a}=e,{enabled:i=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.a)(l.Q.tableEditor(n,a),e=>{let{signal:r}=e;return s({projectRef:n,connectionString:t,id:a},r)},{enabled:i&&void 0!==n&&void 0!==a&&!isNaN(a),staleTime:3e5,...o})};function d(e,n){let{projectRef:t,connectionString:r,id:a}=n;return e.fetchQuery(l.Q.tableEditor(t,a),e=>{let{signal:n}=e;return s({projectRef:t,connectionString:r,id:a},n)})}},67305:function(e,n,t){t.d(n,{D1:function(){return s},Du:function(){return i},GV:function(){return l},N3:function(){return a},z_:function(){return o}});var r=t(7272);function a(e){return(null==e?void 0:e.entity_type)===r.l.TABLE||(null==e?void 0:e.entity_type)===r.l.PARTITIONED_TABLE}function l(e){return(null==e?void 0:e.entity_type)===r.l.FOREIGN_TABLE}function i(e){return(null==e?void 0:e.entity_type)===r.l.VIEW}function o(e){return(null==e?void 0:e.entity_type)===r.l.MATERIALIZED_VIEW}function s(e){return i(e)||o(e)}},30519:function(e,n,t){t.d(n,{rp:function(){return s}});var r=t(64618),a=t(34549),l=t(77724),i=t(70864);async function o(e){let{projectRef:n,connectionString:t,table:r,column:a,pkMatch:o}=e,s=function(e){var n;let{table:t,column:r,pkMatch:a}=e;return new l.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).select('"'.concat(r,'"')).match(a).toSql()}({table:r,column:a,pkMatch:o}),{result:c}=await (0,i.R)({projectRef:n,connectionString:t,sql:s});return null==c?void 0:c[0][a]}let s=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.D)(e=>o(e),{async onSuccess(n,t,r){await (null==e?void 0:e(n,t,r))},async onError(e,t,r){void 0===n?a.Am.error(e.message):n(e,t,r)},...t})}},51214:function(e,n,t){t.d(n,{s:function(){return r}});let r={tableRows:function(e){let{table:n,...t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return["projects",e,"table-rows",null==n?void 0:n.id,"rows",t]},tableRowsCount:function(e){let{table:n,...t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return["projects",e,"table-rows",null==n?void 0:n.id,"count",t]},tableRowsAndCount:(e,n)=>["projects",e,"table-rows",n]}},58793:function(e,n,t){t.d(n,{Fi:function(){return f},HS:function(){return x}});var r=t(36457),a=t(28894),l=t(77724),i=t(8427),o=t(6570),s=t(16333),c=t(25135),d=t(70864),u=t(51214),m=t(4701);let f=5e4,p="\nCREATE OR REPLACE FUNCTION pg_temp.count_estimate(\n    query text\n) RETURNS integer LANGUAGE plpgsql AS $$\nDECLARE\n    plan jsonb;\nBEGIN\n    EXECUTE 'EXPLAIN (FORMAT JSON)' || query INTO plan;\n    RETURN plan->0->'Plan'->'Plan Rows';\nEND;\n$$;\n".trim(),h=e=>{var n,t,r;let{table:a,filters:i=[],enforceExactCount:o=!1}=e;if(!a)return"";if(o){let e=new l.A().from(a.name,null!==(n=a.schema)&&void 0!==n?n:void 0).count();return i.filter(e=>e.value&&""!==e.value).forEach(n=>{let t=(0,m.q)(a,n);e=e.filter(n.column,n.operator,t)}),"select (".concat(e.toSql().slice(0,-1),"), false as is_estimate;")}{let e=new l.A().from(a.name,null!==(t=a.schema)&&void 0!==t?t:void 0).select("*");i.filter(e=>e.value&&""!=e.value).forEach(n=>{let t=(0,m.q)(a,n);e=e.filter(n.column,n.operator,t)});let n=e.toSql(),o=new l.A().from(a.name,null!==(r=a.schema)&&void 0!==r?r:void 0).count();i.filter(e=>e.value&&""!=e.value).forEach(e=>{let n=(0,m.q)(a,e);o=o.filter(e.column,e.operator,n)});let s=o.toSql().slice(0,-1);return"\n".concat(p,"\n\nwith approximation as (\n    select reltuples as estimate\n    from pg_class\n    where oid = ").concat(a.id,"\n)\nselect \n  case \n    when estimate = -1 then (select pg_temp.count_estimate('").concat(n.replaceAll("'","''"),"'))\n    when estimate > ").concat(f," then ").concat(i.length>0?"pg_temp.count_estimate('".concat(n.replaceAll("'","''"),"')"):"estimate","\n    else (").concat(s,")\n  end as count,\n  estimate = -1 or estimate > ").concat(f," as is_estimate\nfrom approximation;\n").trim()}};async function g(e,n){var t;let{queryClient:r,projectRef:a,connectionString:l,tableId:u,filters:m,impersonatedRole:f,enforceExactCount:p}=e,g=await (0,o.nq)(r,{projectRef:a,connectionString:l,id:u});if(!g)throw Error("Table not found");let x=(0,i.NK)(g),v=(0,s.Jh)(h({table:x,filters:m,enforceExactCount:p}),{projectRef:null!=a?a:"ref",role:f}),{result:b}=await (0,d.R)({projectRef:a,connectionString:l,sql:v,queryKey:["table-rows-count",x.id],isRoleImpersonationEnabled:(0,c.Gm)(f)},n);return{count:b[0].count,is_estimate:null!==(t=b[0].is_estimate)&&void 0!==t&&t}}let x=function(e){let{projectRef:n,connectionString:t,tableId:l,...i}=e,{enabled:o=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=(0,r.NL)();return(0,a.a)(u.s.tableRowsCount(n,{table:{id:l},...i}),e=>{let{signal:r}=e;return g({queryClient:c,projectRef:n,connectionString:t,tableId:l,...i},r)},{enabled:o&&void 0!==n&&void 0!==l,...s})}},15834:function(e,n,t){t.d(n,{no:function(){return x},wF:function(){return b},Ue:function(){return N},KK:function(){return _}});var r=t(36457),a=t(28894),l=t(73512),i=t(77724),o=t(8427),s=t(35508),c=t(6570),d=t(56535),u=t(16333),m=t(25135),f=t(70864),p=t(51214),h=t(58793),g=t(4701);let x=10*d.KB,v=e=>{var n;let t=e.columns.filter(e=>null==e?void 0:e.isPrimaryKey).map(e=>e.name);return 0!==t.length?t:[null===(n=e.columns[0])||void 0===n?void 0:n.name]},b=async e=>{var n;let{projectRef:t,connectionString:r,table:a,filters:o=[],sorts:s=[],impersonatedRole:c}=e;if(l.Qy&&!r)return console.error("Connection string is required"),[];let d=[],m=new i.A,p=a.columns.filter(e=>{var n;return(null!==(n=null==e?void 0:e.enum)&&void 0!==n?n:[]).length>0&&"array"===e.dataType.toLowerCase()}).map(e=>'"'.concat(e.name,'"::text[]')),x=m.from(a.name,null!==(n=a.schema)&&void 0!==n?n:void 0).select(p.length>0?"*,".concat(p.join(",")):"*");if(o.filter(e=>e.value&&""!==e.value).forEach(e=>{let n=(0,g.q)(a,e);x=x.filter(e.column,e.operator,n)}),0===s.length&&a.estimateRowCount<=h.Fi){let e=v(a);e.length>0&&e.forEach(e=>{x=x.order(a.name,e,!0,!0)})}else s.forEach(e=>{x=x.order(e.table,e.column,e.ascending,e.nullsFirst)});let b=-1,y=0,j=0,_=[];return await (async()=>{do{b+=1,y=500*b,j=(b+1)*500-1;let e=(0,u.Jh)(x.range(y,j).toSql(),{projectRef:t,role:c});try{let{result:n}=await (0,f.R)({projectRef:t,connectionString:r,sql:e});d.push(...n),_=n}catch(e){return{data:{rows:[]}}}}while(500===_.length)})(),d.filter(e=>1!==e[u.$y])},y=e=>{var n;let{table:t,filters:r=[],sorts:a=[],page:l,limit:o}=e,c=new i.A;if(!t)return"";let d=t.columns.filter(e=>{var n;return(null!==(n=null==e?void 0:e.enum)&&void 0!==n?n:[]).length>0&&"array"===e.dataType.toLowerCase()}).map(e=>'"'.concat(e.name,'"::text[]')),u=c.from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).select(d.length>0?"*,".concat(d.join(",")):"*");if(r.filter(e=>e.value&&""!=e.value).forEach(e=>{let n=(0,g.q)(t,e);u=u.filter(e.column,e.operator,n)}),0===a.length&&t.estimateRowCount<=h.Fi&&t.columns.length>0){let e=v(t);e.length>0&&e.forEach(e=>{u=u.order(t.name,e,!0,!0)})}else a.forEach(e=>{u=u.order(e.table,e.column,e.ascending,e.nullsFirst)});let{from:m,to:f}=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,t=e?e*n:0;return{from:t,to:e?t+n-1:n-1}}((null!=l?l:1)-1,o),p=u.range(m,f).toSql(),b=t.columns.filter(e=>s.BB.includes(e.format)||s.YF.includes(e.format)).map(e=>'case when length("'.concat(e.name,'"::text) > ').concat(x,' then concat(left("').concat(e.name,'"::text, ').concat(x,"), '...') else \"").concat(e.name,'"::text end "').concat(e.name,'"'));return b.length>0?"with _temp as (".concat(p.slice(0,-1),") select *, ").concat(b.join(",")," from _temp"):p};async function j(e,n){let{queryClient:t,projectRef:r,connectionString:a,tableId:l,impersonatedRole:i,filters:s,sorts:d,limit:p,page:h}=e,g=await (0,c.nq)(t,{projectRef:r,connectionString:a,id:l});if(!g)throw Error("Table not found");let x=(0,o.NK)(g),v=(0,u.Jh)(y({table:x,filters:s,sorts:d,limit:p,page:h,impersonatedRole:i}),{projectRef:null!=r?r:"ref",role:i}),{result:b}=await (0,f.R)({projectRef:r,connectionString:a,sql:v,queryKey:["table-rows",null==x?void 0:x.id],isRoleImpersonationEnabled:(0,m.Gm)(i)},n);return{rows:b.map((e,n)=>({idx:n,...e}))}}let _=function(e){let{projectRef:n,connectionString:t,tableId:l,...i}=e,{enabled:o=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=(0,r.NL)();return(0,a.a)(p.s.tableRows(n,{table:{id:l},...i}),e=>{let{signal:r}=e;return j({queryClient:c,projectRef:n,connectionString:t,tableId:l,...i},r)},{enabled:o&&void 0!==n&&void 0!==l,...s})};function N(e,n){let{projectRef:t,connectionString:r,tableId:a,impersonatedRole:l,...i}=n;return e.fetchQuery(p.s.tableRows(t,{table:{id:a},...i}),n=>{let{signal:l}=n;return j({queryClient:e,projectRef:t,connectionString:r,tableId:a,...i},l)})}},4701:function(e,n,t){t.d(n,{h:function(){return i},q:function(){return l}});var r=t(24372),a=t(67305);function l(e,n){let t=e.columns.find(e=>e.name==n.column);if(t&&(0,r.v3)(t.format)){let e=Number(n.value);if(!Number.isNaN(e)&&!(e>Number.MAX_SAFE_INTEGER))return Number(n.value)}return n.value}function i(e){let{table:n}=e;if(!(0,a.N3)(n))return{error:{message:"Only table rows can be updated or deleted"}};let t=n.primary_keys;return t&&0!=t.length?{primaryKeys:t.map(e=>e.name)}:{error:{message:"Please add a primary key column to your table to update or delete rows"}}}},61958:function(e,n,t){t.d(n,{T:function(){return a},s:function(){return r}});let r=["auth","cron","extensions","information_schema","net","pgsodium","pgsodium_masks","pgbouncer","pgtle","realtime","storage","supabase_functions","supabase_migrations","vault","graphql","graphql_public",t(67133).LW],a=r.filter(e=>"extensions"!==e)},11152:function(e,n,t){t.d(n,{t:function(){return d},uM:function(){return u}});var r=t(97458),a=t(52983),l=t(28622),i=t(34653),o=t(17338);let s=()=>{let e=(0,l.sj)({enforceExactCount:!1,setEnforceExactCount:n=>{e.enforceExactCount=n},page:1,setPage:n=>{e.page=n,e.setSelectedRows(new Set)},selectedRows:(0,o.C6)(),allRowsSelected:!1,setSelectedRows:(n,t)=>{e.allRowsSelected=null!=t&&t,e.selectedRows=(0,o.C6)(n)},selectedCellPosition:null,setSelectedCellPosition:n=>{e.selectedCellPosition=n}});return e},c=(0,a.createContext)(s()),d=e=>{let{children:n}=e,t=(0,a.useRef)(s()).current;return(0,r.jsx)(c.Provider,{value:t,children:n})},u=e=>{let n=(0,a.useContext)(c);return(0,i.R)(n,e)}},35071:function(e,n,t){var r=t(97458),a=t(52983),l=t(40392),i=t(5625),o=t(47196),s=t(92334),c=t(75675);function d(e){let{autoComplete:n,autofocus:t,children:d,className:u,descriptionText:m,disabled:f,error:p,icon:h,id:g="",inputRef:x,label:v,afterLabel:b,beforeLabel:y,labelOptional:j,layout:_,name:N="",onChange:w,onBlur:C,placeholder:k,required:E,value:S,defaultValue:R,style:q,size:A="medium",borderless:I=!1,validation:O,...L}=e,{formContextOnChange:T,values:z,errors:D,handleBlur:P,touched:Z,fieldLevelValidation:F}=(0,c.G)();z&&!S&&(S=z[g]),p||(D&&!p&&(p=D[g||N]),p=Z&&Z[g||N]?p:void 0),(0,a.useEffect)(()=>{O&&F(g,O(S))},[]);let U=(0,s.Z)("select"),M=[U.container];u&&M.push(u);let Y=[U.base];return p&&Y.push(U.variants.error),p||Y.push(U.variants.standard),h&&Y.push(U.with_icon),A&&Y.push(U.size[A]),f&&Y.push(U.disabled),(0,r.jsx)(l.l,{label:v,afterLabel:b,beforeLabel:y,labelOptional:j,layout:_,id:g,error:p,descriptionText:m,className:u,style:q,size:A,children:(0,r.jsxs)("div",{className:U.container,children:[(0,r.jsx)("select",{id:g,name:N,"data-size":A,defaultValue:R,autoComplete:n,autoFocus:t,className:Y.join(" "),onChange:function(e){w&&w(e),T&&T(e),O&&F(g,O(e.target.value))},onBlur:function(e){P&&P(e),C&&C(e)},ref:x,value:S,disabled:f,required:E,placeholder:k,...L,children:d}),h&&(0,r.jsx)(o.Z,{size:A,icon:h}),p&&(0,r.jsx)("div",{className:U.actions_container,children:p&&(0,r.jsx)(i.Z,{size:A})}),(0,r.jsx)("span",{className:U.chevron_container,children:(0,r.jsx)("svg",{className:U.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})}d.Option=function(e){let{value:n,children:t,selected:a}=e;return(0,r.jsx)("option",{value:n,selected:a,children:t})},d.OptGroup=function(e){let{label:n,children:t}=e;return(0,r.jsx)("optgroup",{label:n,children:t})},n.ZP=d}}]);