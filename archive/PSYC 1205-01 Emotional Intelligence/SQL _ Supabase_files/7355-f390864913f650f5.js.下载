"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7355],{1650:function(e,n,t){t.d(n,{Z:function(){return q}});var i=t(97458),o=t(99033),a=t(83145),l=t.n(a),r=t(34549),s=t(8427),c=t(32672),d=t(61124),u=t(36457),m=t(64618),h=t(77724),f=t(70864),p=t(16333),g=t(25135),v=t(51214),x=t(4701);async function b(e){let{projectRef:n,connectionString:t,table:i,filters:o,impersonatedRole:a}=e,l=(0,p.Jh)(function(e){var n;let{table:t,filters:i}=e,o=new h.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).delete();return i.filter(e=>e.value&&""!==e.value).forEach(e=>{let n=(0,x.q)(t,e);o=o.filter(e.column,e.operator,n)}),o.toSql()}({table:i,filters:o}),{projectRef:n,role:a}),{result:r}=await (0,f.R)({projectRef:n,connectionString:t,sql:l,isRoleImpersonationEnabled:(0,g.Gm)(a)});return r}let j=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,u.NL)();return(0,m.D)(e=>b(e),{async onSuccess(n,t,o){let{projectRef:a,table:l}=t;await i.invalidateQueries(v.s.tableRowsAndCount(a,l.id)),await (null==e?void 0:e(n,t,o))},async onError(e,t,i){void 0===n?r.Am.error("Failed to delete all table rows: ".concat(e.message)):n(e,t,i)},...t})};var y=t(79663),w=t(27477);async function S(e){let{projectRef:n,connectionString:t,table:i,rows:o,impersonatedRole:a}=e,l=(0,p.Jh)(function(e){var n;let{table:t,rows:i}=e,{primaryKeys:o,error:a}=(0,x.h)({table:t});if(a)throw a;let l=new h.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).delete();return null==o||o.forEach(e=>{let n=i.map(n=>n[e]);l=l.filter(e,"in",n)}),l.toSql()}({table:i,rows:o}),{projectRef:n,role:a}),{result:r}=await (0,f.R)({projectRef:n,connectionString:t,sql:l,isRoleImpersonationEnabled:(0,g.Gm)(a)});return r}let N=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,u.NL)();return(0,m.D)(e=>S(e),{async onSuccess(n,t,i){let{projectRef:a,table:l}=t;await o.invalidateQueries(v.s.tableRowsAndCount(a,l.id)),await (null==e?void 0:e(n,t,i))},async onError(e,t,o){if(void 0===n){let{table:n,rows:o}=t,a=e.message.includes("Please add a primary key column"),l=e.message.includes("violates foreign key constraint"),s=o.length>1;if(l){let t=n.name,o=e.message.split("on table ")[2].replaceAll('"',""),a=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),l=s?"Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table `".concat(o,"`."):"Unable to delete row as it is currently referenced by a foreign key constraint from the table `".concat(o,"`."),c="Set an on delete behavior on the foreign key relation `".concat(a,"` in the `").concat(o,"` table to automatically respond when row(s) are being deleted in the `").concat(t,"` table.");(0,r.Am)(l,{description:(0,i.jsx)(y.U,{content:c,className:"[&>p]:m-0"}),action:(0,i.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,i.jsx)(w.G,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"})})})}else a?(0,r.Am)("Unable to delete row(s) as table has no primary keys",{description:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(w.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})}):r.Am.error("Failed to delete table row: ".concat(e.message))}else n(e,t,o)},...t})};async function D(e){let{projectRef:n,connectionString:t,table:i}=e,o=function(e){var n;let{table:t}=e;return new h.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).truncate().toSql()}({table:i}),{result:a}=await (0,f.R)({projectRef:n,connectionString:t,sql:o});return a}let R=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,u.NL)();return(0,m.D)(e=>D(e),{async onSuccess(n,t,o){let{projectRef:a,table:l}=t;await i.invalidateQueries(v.s.tableRowsAndCount(a,l.id)),await (null==e?void 0:e(n,t,o))},async onError(e,t,i){void 0===n?r.Am.error("Failed to truncate table row: ".concat(e.message)):n(e,t,i)},...t})};var C=t(54406),A=t(21925),E=t(50998),_=t(81541),k=t(29125),L=t(5688),z=t(24958),Z=t(19405),T=t(53486),I=t(15518),q=e=>{var n,t,a,u,m,h,f,p,v;let{selectedTable:x,onAfterDeleteTable:b=k.ZT}=e,{project:y}=(0,c.d2)(),w=(0,L._2)(),{selectedSchema:S}=(0,E.B)(),[{filter:D},q]=(0,_.x)({arrayKeys:["filter","sort"]}),F=(0,s.Yb)(D),W=(0,A.AF)({projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString}),O=e=>{q(n=>{var t,i;let o=null!==(t=null==n?void 0:n.filter)&&void 0!==t?t:[],a=null!==(i=null==n?void 0:n.sort)&&void 0!==i?i:[];return{...n,filter:o.filter(n=>{let[t]=n.split(":");if(t!==e)return n}),sort:a.filter(n=>{let[t]=n.split(":");if(t!==e)return n})}})},{mutate:U}=(0,d.v)({onSuccess:()=>{var e;if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="column")return;let n=w.confirmationDialog.column;O(n.name),r.Am.success('Successfully deleted column "'.concat(n.name,'"'))},onError:e=>{var n;if((null===(n=w.confirmationDialog)||void 0===n?void 0:n.type)!=="column")return;let t=w.confirmationDialog.column;r.Am.error("Failed to delete ".concat(t.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:V}=(0,C.H)({onSuccess:async()=>{b(await W(S)),r.Am.success('Successfully deleted table "'.concat(null==x?void 0:x.name,'"'))},onError:e=>{r.Am.error("Failed to delete ".concat(null==x?void 0:x.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:Q}=N({onSuccess:()=>{var e,n,t;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=w.confirmationDialog).callback)||void 0===n||n.call(t)),r.Am.success("Successfully deleted selected row(s)")},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:J}=j({onSuccess:()=>{var e,n,t;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=w.confirmationDialog).callback)||void 0===n||n.call(t)),r.Am.success("Successfully deleted selected rows")},onError:e=>{r.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:M}=R({onSuccess:()=>{var e,n,t;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=w.confirmationDialog).callback)||void 0===n||n.call(t)),r.Am.success("Successfully deleted all rows from table")},onError:e=>{r.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),P=(null===(n=w.confirmationDialog)||void 0===n?void 0:n.type)==="row"&&w.confirmationDialog.allRowsSelected,K=(null===(t=w.confirmationDialog)||void 0===t?void 0:t.type)==="row"?w.confirmationDialog.allRowsSelected?null!==(v=w.confirmationDialog.numRows)&&void 0!==v?v:0:w.confirmationDialog.rows.length:0,G=((null===(a=w.confirmationDialog)||void 0===a?void 0:a.type)==="column"||(null===(u=w.confirmationDialog)||void 0===u?void 0:u.type)==="table")&&w.confirmationDialog.isDeleteWithCascade,H=async()=>{var e;if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="column"||void 0===y)return;let n=w.confirmationDialog.column;void 0!==n&&U({id:n.id,cascade:G,projectRef:y.ref,connectionString:null==y?void 0:y.connectionString,table:x})},X=async()=>{var e;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="table"&&void 0!==x&&V({projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString,schema:x.schema,id:x.id,cascade:G})},Y=(0,g.z6)(),B=async()=>{var e;if(!y)return console.error("Project ref is required");if(!x)return console.error("Selected table required");if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="row")return;let n=w.confirmationDialog.rows;if(w.confirmationDialog.allRowsSelected){if(0===F.length){if(void 0!==Y())return w.closeConfirmationDialog(),r.Am.error("Table truncation is not supported when impersonating a role");M({projectRef:y.ref,connectionString:y.connectionString,table:x})}else J({projectRef:y.ref,connectionString:y.connectionString,table:x,filters:F,impersonatedRole:Y()})}else Q({projectRef:y.ref,connectionString:y.connectionString,table:x,rows:n,impersonatedRole:Y()})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(m=w.confirmationDialog)||void 0===m?void 0:m.type)==="column",title:'Confirm deletion of column "'.concat((null===(h=w.confirmationDialog)||void 0===h?void 0:h.type)==="column"&&w.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:H,children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,i.jsx)(z.Z,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:G,onChange:()=>w.toggleConfirmationIsWithCascade()}),G&&(0,i.jsxs)(Z.bZ,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,i.jsx)(Z.Cd,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,i.jsx)(Z.X,{children:(0,i.jsx)(T.z,{asChild:!0,size:"tiny",type:"default",icon:(0,i.jsx)(o.Z,{}),children:(0,i.jsx)(l(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(f=w.confirmationDialog)||void 0===f?void 0:f.type)==="table",title:(0,i.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==x?void 0:x.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:X,children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,i.jsx)(z.Z,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:G,onChange:()=>w.toggleConfirmationIsWithCascade(!G)}),G&&(0,i.jsxs)(Z.bZ,{variant:"warning",children:[(0,i.jsx)(Z.Cd,{children:"Warning: Dropping with cascade may result in unintended consequences"}),(0,i.jsx)(Z.X,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,i.jsx)(Z.X,{className:"mt-4",children:(0,i.jsx)(T.z,{asChild:!0,size:"tiny",type:"default",icon:(0,i.jsx)(o.Z,{}),children:(0,i.jsx)(l(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(p=w.confirmationDialog)||void 0===p?void 0:p.type)==="row",title:(0,i.jsxs)("p",{className:"break-words",children:[(0,i.jsx)("span",{children:"Confirm to delete the selected row"}),(0,i.jsx)("span",{children:K>1&&"s"})]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>w.closeConfirmationDialog(),onConfirm:()=>B(),children:(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,i.jsx)("span",{children:"Are you sure you want to delete "}),(0,i.jsxs)("span",{children:[P?"all":"the selected"," "]}),(0,i.jsx)("span",{children:K>1&&"".concat(K," ")}),(0,i.jsx)("span",{children:"row"}),(0,i.jsx)("span",{children:K>1&&"s"}),(0,i.jsx)("span",{children:"? This action cannot be undone."})]})})})]})}},64612:function(e,n,t){t.d(n,{l5:function(){return ev.Z},mM:function(){return eE}});var i=t(97458),o=t(40540),a=t(36457),l=t(26969),r=t.n(l),s=t(86474),c=t.n(s),d=t(32691),u=t(34549),m=t(73512),h=t(11181),f=t(8427),p=t(32672),g=t(27477),v=t(67305),x=t(51214),b=t(39231),j=t(94281),y=t(26058),w=t(81541),S=t(61958),N=t(29125),D=t(25135),R=t(5688),C=t(77225),A=t(74286),E=t(9887),_=t(25631),k=t(83145),L=t.n(k),z=t(52983),Z=t(13537),T=t(62347),I=t(2861),q=t(54309),F=t(72356),W=t(58901),O=t(53431),U=t(37174),V=t(59884),Q=t(20424),J=t(9881),M=t(11152),P=t(50322),K=t(53486),G=t(43633),H=t(12753),X=t(7341),Y=t(15518),B=t(26487),$=t(28894),ee=t(70864),en=t(63609);let et=e=>{let{id:n}=e;if(!n)throw Error("id is required");return"\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name,\n        to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ".concat(n,"\n    )\n    select pg_get_viewdef(t.regclass, true) as definition\n    from table_info t\n  ").trim()};async function ei(e,n){let{projectRef:t,connectionString:i,id:o}=e,a=et({id:o}),{result:l}=await (0,ee.R)({projectRef:t,connectionString:i,sql:a,queryKey:["view-definition",o]},n);return l[0].definition.trim()}let eo=function(e){let{projectRef:n,connectionString:t,id:i}=e,{enabled:o=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,$.a)(en.A.viewDefinition(n,i),e=>{let{signal:o}=e;return ei({projectRef:n,connectionString:t,id:i},o)},{enabled:o&&void 0!==n&&void 0!==i&&!isNaN(i),...a})};var ea=t(69658),el=t(49736),er=t(12361),es=t(44151),ec=t(28179);function ed(e){let{table:n,isAutofixViewSecurityModalOpen:t,setIsAutofixViewSecurityModalOpen:o}=e,{project:l}=(0,p.d2)(),r=(0,a.NL)(),{isSuccess:s,isLoading:c,data:d}=eo({id:null==n?void 0:n.id,projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString},{enabled:t&&(0,v.D1)(n)}),{mutate:m}=(0,el.r)({onSuccess:async()=>{u.Am.success("View security changed successfully"),o(!1),await r.invalidateQueries(ea.X.lint(null==l?void 0:l.ref))},onError:e=>{u.Am.error("Failed to autofix view security: ".concat(e.message))}});return(0,v.D1)(n)?(0,i.jsxs)(Y.Z,{visible:t,size:"xlarge",title:"Confirm autofixing view security",confirmLabel:"Confirm",onCancel:()=>o(!1),onConfirm:()=>(function(){let e='\n	ALTER VIEW "'.concat(n.schema,'"."').concat(n.name,'" SET (security_invoker = on);\n	');m({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,sql:e})})(),children:[(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:["Setting ",(0,i.jsx)("code",{children:"security_invoker=on"})," ensures the View runs with the permissions of the querying user, reducing the risk of unintended data exposure."]}),(0,i.jsxs)("div",{className:"flex items-center gap-8 mt-8",children:[(0,i.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,i.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Existing query"}),(0,i.jsxs)(er.xr,{className:"h-[225px] px-4 py-2",children:[c&&(0,i.jsx)(ec.A,{}),s&&(0,i.jsx)(es.c,{children:"create view ".concat(n.schema,".").concat(n.name," as\n ").concat(d)})]})]}),(0,i.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,i.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Updated query"}),(0,i.jsxs)(er.xr,{className:"h-[225px] px-4 py-2",children:[c&&(0,i.jsx)(ec.A,{}),s&&(0,i.jsx)(es.c,{children:"create view ".concat(n.schema,".").concat(n.name," with (security_invoker = on) as\n ").concat(d)})]})]})]})]}):null}var eu=e=>{var n;let{table:t}=e,{ref:a}=(0,m.UO)(),{project:l}=(0,p.d2)(),r=(0,J.l)(),{data:s=[]}=(0,O.U)({projectRef:null==l?void 0:l.ref}),c=(0,v.N3)(t),d=(0,v.GV)(t),h=(0,v.Du)(t),f=(0,v.z_)(t),g=(0,Q.N)("realtime:all"),x=S.s.includes(t.schema),{mutate:b}=(0,U.V)({onError:e=>{u.Am.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{eb()}}),[y,w]=(0,z.useState)(!1),[N,D]=(0,z.useState)(!1),[R,k]=(0,z.useState)(!1),$=0===(0,M.uM)().selectedRows.size,ee=null==l?void 0:l.ref,{data:en}=(0,q.r)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),et=(null!=en?en:[]).filter(e=>e.schema===t.schema&&e.table===t.name),{data:ei}=(0,F.z)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),eo=(null!=ei?ei:[]).find(e=>"supabase_realtime"===e.name),ea=null!==(n=null==eo?void 0:eo.tables)&&void 0!==n?n:[],el=ea.some(e=>e.id===(null==t?void 0:t.id)),{mutate:er,isLoading:es}=(0,W.u)({onSuccess:()=>{w(!1)},onError:e=>{u.Am.error("Failed to toggle realtime for ".concat(t.name,": ").concat(e.message))}}),ec=(0,j.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"tables"),eu=(0,j.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"columns"),em="public"===t.schema,{hasLint:eh,matchingLint:ef}=(0,Z.R)(t.name,"security_definer_view",["ERROR","WARN"],s,t.schema),{hasLint:ep,matchingLint:eg}=(0,Z.R)(t.name,"materialized_view_in_api",["ERROR","WARN"],s,t.schema),{mutate:ev}=(0,V.a)(),ex=async()=>{var e,n;if(!l)return console.error("Project is required");if(!eo)return console.error("Unable to find realtime publication");let i=ea.some(e=>e.id==t.id),o=i?ea.filter(e=>e.id!=t.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(t.schema,".").concat(t.name)].concat(ea.map(e=>"".concat(e.schema,".").concat(e.name)));ev({action:"realtime_toggle_table_clicked",properties:{newState:i?"disabled":"enabled",origin:"tableGridHeader"},groups:{project:null!==(e=null==l?void 0:l.ref)&&void 0!==e?e:"Unknown",organization:null!==(n=null==r?void 0:r.slug)&&void 0!==n?n:"Unknown"}}),er({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:eo.id,tables:o})},eb=()=>{D(!1)},ej=async()=>{let e={id:t.id,rls_enabled:!(c&&t.rls_enabled)};b({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:e.id,schema:t.schema,payload:e})};return(0,i.jsxs)(i.Fragment,{children:[$&&(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[!ec&&!eu&&(0,i.jsxs)(P.u,{children:[(0,i.jsx)(P.aJ,{asChild:!0,children:(0,i.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,i.jsx)(P._v,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),c&&!x?t.rls_enabled?(0,i.jsx)(i.Fragment,{children:et.length<1&&!x?(0,i.jsx)(I.u,{asChild:!0,type:"default",className:"group",icon:(0,i.jsx)(C.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,i.jsx)(L(),{passHref:!0,href:"/project/".concat(ee,"/auth/policies?search=").concat(t.id,"&schema=").concat(t.schema),children:"Add RLS policy"})}):(0,i.jsx)(K.z,{asChild:!0,type:et.length<1&&!x?"warning":"default",className:"group",icon:x||et.length>0?(0,i.jsx)("div",{className:(0,G.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",et.length>9?" px-1":"w-[16px]",""),children:(0,i.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:et.length})}):(0,i.jsx)(C.Z,{strokeWidth:1.5}),children:(0,i.jsxs)(L(),{passHref:!0,href:"/project/".concat(ee,"/auth/policies?search=").concat(t.id,"&schema=").concat(t.schema),children:["Auth ",et.length>1?"policies":"policy"]})})}):(0,i.jsxs)(H.J2,{modal:!1,children:[(0,i.jsx)(H.xo,{asChild:!0,children:(0,i.jsx)(K.z,{type:"warning",icon:(0,i.jsx)(A.Z,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,i.jsxs)(H.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(A.Z,{size:16})," Row Level Security (RLS)"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,i.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!x&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(K.z,{type:"default",onClick:()=>D(!N),children:"Enable RLS for this table"})})]})]})]}):null,h&&eh&&(0,i.jsxs)(H.J2,{modal:!1,children:[(0,i.jsx)(H.xo,{asChild:!0,children:(0,i.jsx)(K.z,{type:"warning",icon:(0,i.jsx)(E.Z,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,i.jsxs)(H.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(E.Z,{size:16})," Secure your View"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,i.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,i.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,i.jsx)(K.z,{type:"secondary",onClick:()=>{k(!0)},children:"Autofix"}),(0,i.jsx)(K.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"/project/".concat(a,"/advisors/security?preset=").concat(null==ef?void 0:ef.level,"&id=").concat(null==ef?void 0:ef.cache_key),children:"Learn more"})})]})]})]})]}),f&&ep&&(0,i.jsxs)(H.J2,{modal:!1,children:[(0,i.jsx)(H.xo,{asChild:!0,children:(0,i.jsx)(K.z,{type:"warning",icon:(0,i.jsx)(E.Z,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,i.jsxs)(H.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(E.Z,{size:16})," Secure your View"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,i.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(K.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"/project/".concat(a,"/advisors/security?preset=").concat(null==eg?void 0:eg.level,"&id=").concat(null==eg?void 0:eg.cache_key),children:"Learn more"})})})]})]})]}),d&&"public"===t.schema&&(0,i.jsxs)(H.J2,{modal:!1,children:[(0,i.jsx)(H.xo,{asChild:!0,children:(0,i.jsx)(K.z,{type:"warning",icon:(0,i.jsx)(E.Z,{strokeWidth:1.5}),children:"Foreign table is accessible via your project's APIs"})}),(0,i.jsxs)(H.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(E.Z,{size:16})," Secure Foreign table"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"Foreign tables do not enforce RLS. Move them to a private schema not exposed to Postgrest or disable Postgrest."}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(K.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview#security",children:"Learn more"})})})]})]})]}),(0,i.jsx)(B.Q,{serviceRoleLabel:"postgres"}),c&&g&&(0,i.jsxs)(K.z,{type:"default",icon:(0,i.jsx)(_.Z,{strokeWidth:1.5,className:el?"text-brand":"text-foreground-muted"}),onClick:()=>w(!0),children:["Realtime ",el?"on":"off"]}),em&&(0,i.jsx)(T.Z,{section:["entities",t.name]})]}),(0,i.jsx)(Y.Z,{visible:y,loading:es,title:"".concat(el?"Disable":"Enable"," realtime for ").concat(t.name),confirmLabel:"".concat(el?"Disable":"Enable"," realtime"),confirmLabelLoading:"".concat(el?"Disabling":"Enabling"," realtime"),onCancel:()=>w(!1),onConfirm:()=>ex(),children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",el?"disabled":"enabled",", the table will"," ",el?"no longer ":"","broadcast any changes to authorized subscribers."]}),!el&&(0,i.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,i.jsx)(L(),{href:"/project/".concat(a,"/database/publications"),className:"text-brand",children:"database publications"})," ","settings."]})]})}),(0,i.jsx)(ed,{table:t,isAutofixViewSecurityModalOpen:R,setIsAutofixViewSecurityModalOpen:k}),c&&(0,i.jsx)(X.Z,{danger:t.rls_enabled,visible:N,title:"Confirm to enable Row Level Security",description:"Are you sure you want to enable Row Level Security for this table?",buttonLabel:"Enable RLS",buttonLoadingLabel:"Updating",onSelectCancel:eb,onSelectConfirm:ej})]})},em=t(42010),eh=t(62445),ef=t(19369),ep=e=>{let{id:n}=e;return(0,i.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,i.jsx)("div",{className:"w-[400px]",children:(0,i.jsx)(eh.Z,{icon:(0,i.jsx)(ef.Z,{strokeWidth:2}),title:"Unable to find your table with ID ".concat(n)})})})},eg=t(57718),ev=t(89359),ex=t(85229),eb=t(98809),ej=t(85743),ey=t(61115),ew=t(55614);let eS=e=>{let{id:n}=e;return"\n    ".concat(ew.k,"\n\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ").concat(n,"\n    )\n    select pg_temp.pg_get_tabledef (\n      t.schema,\n      t.name,\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n    from table_info t;\n  ").trim()};async function eN(e,n){let{projectRef:t,connectionString:i,id:o}=e;if(!o)throw Error("id is required");let a=eS({id:o}),{result:l}=await (0,ee.R)({projectRef:t,connectionString:i,sql:a,queryKey:["table-definition",o]},n);return l[0].definition.trim()}let eD=function(e){let{projectRef:n,connectionString:t,id:i}=e,{enabled:o=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,$.a)(en.A.tableDefinition(n,i),e=>{let{signal:o}=e;return eN({projectRef:n,connectionString:t,id:i},o)},{enabled:o&&void 0!==n&&void 0!==i&&!isNaN(i),...a})};var eR=t(34069),eC=t(6433),eA=e=>{let{entity:n}=e,{ref:t}=(0,m.UO)(),o=(0,z.useRef)(null),a=(0,z.useRef)(null),{resolvedTheme:l}=(0,eb.F)(),{project:r}=(0,p.d2)(),s=eo({id:null==n?void 0:n.id,projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{enabled:(0,v.D1)(n)}),c=eD({id:null==n?void 0:n.id,projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{enabled:(0,v.N3)(n)}),{data:d,isLoading:u}=(0,v.D1)(n)?s:c,h=(0,v.Du)(n)?"create view ".concat(n.schema,".").concat(n.name," as\n"):(0,v.z_)(n)?"create materialized view ".concat(n.schema,".").concat(n.name," as\n"):"",f=(0,z.useMemo)(()=>d?(0,eR._)(h+d):void 0,[d]),g=async(e,n)=>{o.current=e,a.current=n,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,eC.Vs)(500),null==e||e.focus()};return u?(0,i.jsxs)("div",{className:"h-full grid",children:[(0,i.jsx)("div",{className:"p-4",children:(0,i.jsx)(ey.A,{})}),(0,i.jsx)("div",{className:"mt-auto",children:(0,i.jsx)(ej.Z,{})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,i.jsx)(K.z,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10",children:(0,i.jsx)(L(),{href:"/project/".concat(t,"/sql/new?content=").concat(encodeURIComponent(null!=f?f:"")),children:"Open in SQL Editor"})}),(0,i.jsx)(ex.default,{className:"monaco-editor",theme:(null==l?void 0:l.includes("dark"))?"vs-dark":"vs",onMount:g,defaultLanguage:"pgsql",value:f,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0}})]}),(0,i.jsx)(ej.Z,{})]})},eE=e=>{var n,t;let{theme:l="dark",isLoadingSelectedTable:s=!1,selectedTable:C}=e,A=(0,d.useRouter)(),{ref:E,id:_}=(0,m.UO)(),{project:k}=(0,p.d2)(),L=(0,R._2)(),z=(0,D.z6)(),[{view:Z="data"}]=(0,w.x)(),T=(0,j.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"tables"),I=(0,j.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"columns"),q=!T&&!I,F=(0,a.NL)(),{mutate:W}=(0,b.Gz)({async onMutate(e){let{projectRef:n,table:t,configuration:i,payload:o}=e,a=new Set(Object.keys(i.identifiers)),l=x.s.tableRows(n,{table:{id:t.id}});await F.cancelQueries(l);let r=F.getQueriesData(l);return F.setQueriesData(l,e=>{var n;return{rows:null!==(n=null==e?void 0:e.rows.map(e=>Object.entries(e).filter(e=>{let[n]=e;return a.has(n)}).every(e=>{let[n,t]=e;return t===i.identifiers[n]})?{...e,...o}:e))&&void 0!==n?n:[]}}),{previousRowsQueries:r}},onError(e,n,t){let{previousRowsQueries:i}=t;i.forEach(e=>{let[n,t]=e;t&&F.setQueriesData(n,t),F.invalidateQueries(n)}),K(e)}}),O=(0,y.Z)(null!==(n=null==C?void 0:C.columns)&&void 0!==n?n:N.Z6);if(s)return(0,i.jsx)(em.h,{});if(c()(C))return(0,i.jsx)(ep,{id:Number(_)});let U=(0,v.Du)(C)||(0,v.z_)(C),V=(0,v.N3)(C),Q=S.s.includes(null!==(t=null==C?void 0:C.schema)&&void 0!==t?t:""),J=V&&!Q,M=(0,f.NK)(C),P="".concat(C.schema,"_").concat(C.name),K=e=>{var n,t;u.Am.error(null!==(t=null!==(n=null==e?void 0:e.details)&&void 0!==n?n:null==e?void 0:e.message)&&void 0!==t?t:e)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.z,{theme:l,gridProps:{height:"100%"},projectRef:E,editable:!q&&J,schema:C.schema,table:M,headerActions:(0,i.jsx)(eu,{table:C,canEditViaTableEditor:J}),onAddColumn:L.onAddColumn,onEditColumn:e=>{let n=r()(O.current,{name:e});n?L.onEditColumn(n):u.Am.error("Unable to find column ".concat(e," in ").concat(null==C?void 0:C.name))},onDeleteColumn:e=>{var n;let t=r()(null!==(n=O.current)&&void 0!==n?n:[],{name:e});t?L.onDeleteColumn(t):u.Am.error("Unable to find column ".concat(e," in ").concat(null==C?void 0:C.name))},onAddRow:L.onAddRow,updateTableRow:(e,n)=>{var t;if(!k)return;let o=null===(t=C.columns)||void 0===t?void 0:t.filter(e=>{var n;return(null!==(n=null==e?void 0:e.enums)&&void 0!==n?n:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),a={};if((0,v.N3)(C)&&C.primary_keys.forEach(n=>{let t=C.columns.find(e=>e.name===n.name);a[n.name]=(null==t?void 0:t.format)==="bytea"?(0,eg.D4)(e[n.name]):e[n.name]}),0===Object.keys(a).length)return(0,u.Am)("Unable to update row as table has no primary keys",{description:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(g.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})});W({projectRef:k.ref,connectionString:k.connectionString,table:C,configuration:{identifiers:a},payload:n,enumArrayColumns:o,impersonatedRole:z()})},onEditRow:L.onEditRow,onImportData:L.onImportData,onError:K,onExpandJSONEditor:(e,n)=>{L.onExpandJSONEditor({column:e,row:n,value:JSON.stringify(n[e])||""})},onExpandTextEditor:(e,n)=>{L.onExpandTextEditor(e,n)},onEditForeignKeyColumnValue:L.onEditForeignKeyColumnValue,showCustomChildren:(U||V)&&"definition"===Z,customHeader:(U||V)&&"definition"===Z?(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsxs)("p",{children:["SQL Definition of ",(0,i.jsx)("code",{className:"text-sm",children:C.name})," "]}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,children:(U||V)&&(0,i.jsx)(eA,{entity:C})},P),(0,i.jsx)(ev.Z,{editable:!q&&J,selectedTable:(0,v.N3)(C)?C:void 0,onTableCreated:e=>{A.push("/project/".concat(E,"/editor/").concat(e.id))}})]})};t(45291)},94398:function(e,n,t){var i=t(97458),o=t(9738),a=t(32024),l=t(52983),r=t(6433),s=t(53486),c=t(43633);n.Z=e=>{var n;let{text:t,asyncText:d,iconOnly:u=!1,children:m,onClick:h,copyLabel:f="Copy",copiedLabel:p="Copied",...g}=e,[v,x]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!v)return;let e=setTimeout(()=>x(!1),2e3);return()=>clearTimeout(e)},[v]),(0,i.jsx)(s.z,{onClick:async e=>{let n=d?await d():t;x(!0),await (0,r.vQ)(n),null==h||h(e)},...g,className:(0,c.cn)({"px-1":u},g.className),icon:v?(0,i.jsx)(o.Z,{strokeWidth:2,className:"text-brand"}):null!==(n=g.icon)&&void 0!==n?n:(0,i.jsx)(a.Z,{}),children:!u&&(0,i.jsx)(i.Fragment,{children:null!=m?m:v?p:f})})}},54309:function(e,n,t){t.d(n,{r:function(){return c}});var i=t(28894),o=t(129),a=t(289),l=t(56535),r=t(9610);async function s(e,n,t){let{projectRef:i,connectionString:a,schema:l}=e;if(!i)throw Error("projectRef is required");let r=new Headers(t);a&&r.set("x-connection-encrypted",a);let{data:s,error:c}=await (0,o.U2)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":a},path:{ref:i},query:{included_schemas:l||"",excluded_schemas:""}},headers:r,signal:n});return c&&(0,o.S3)(c),s}let c=function(e){let{projectRef:n,connectionString:t,schema:o}=e,{enabled:c=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=(0,a.Vm)(),m=(null==u?void 0:u.status)===l.S.ACTIVE_HEALTHY;return(0,i.a)(r.R.list(n,o),e=>{let{signal:i}=e;return s({projectRef:n,connectionString:t,schema:o},i)},{enabled:c&&void 0!==n&&m,...d})}},30740:function(e,n,t){t.d(n,{k:function(){return r}});var i=t(62213);let o={search:"",timestampStart:"",timestampEnd:"",filters:{}},a=e=>(0,i.jo)({parse:n=>null!=n?n:e,serialize:e=>e||""}),l=e=>(0,i.jo)({parse:n=>{if(!n)return e;try{return JSON.parse(n)}catch(n){return e}},serialize:e=>{if(!e)return"";try{return JSON.stringify(e)}catch(e){return""}}});function r(){let[e,n]=(0,i.v1)("s",a(o.search)),[t,r]=(0,i.v1)("its",a(o.timestampStart)),[s,c]=(0,i.v1)("ite",a(o.timestampEnd)),[d,u]=(0,i.v1)("log",a("")),[m,h]=(0,i.v1)("f",l(o.filters)),f=e||o.search,p=t||o.timestampStart,g=s||o.timestampEnd,v=m||o.filters,x=e=>{n(e||o.search)},b=e=>{h(e||o.filters)};return{search:f,timestampStart:p,timestampEnd:g,selectedLogId:d||null,filters:v,setSearch:x,setTimeRange:(e,n)=>{r(e||o.timestampStart),c(n||o.timestampEnd)},setSelectedLogId:e=>{u(e||"")},setFilters:b,updateFilter:(e,n)=>{b({...v,[e]:n})},reset:()=>{x(o.search),r(o.timestampStart),c(o.timestampEnd),u(""),h(o.filters)}}}},7341:function(e,n,t){var i=t(97458),o=t(52983),a=t(37914),l=t(28289),r=t(53486);n.Z=e=>{let{visible:n=!1,danger:t=!1,title:s="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:h=()=>{},onSelectConfirm:f=()=>{}}=e;(0,o.useEffect)(()=>{n&&g(!1)},[n]);let[p,g]=(0,o.useState)(!1),v=()=>{g(!0),f()};return(0,i.jsx)(a.Z,{header:s,visible:n,title:s,description:c,size:d,hideFooter:!0,onCancel:h,children:(0,i.jsx)(l.Z,{initialValues:{},validateOnBlur:!0,onSubmit:()=>v(),validate:()=>[],children:()=>(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(a.Z.Content,{children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(r.z,{block:!0,htmlType:"button",type:"default",onClick:h,disabled:p,children:"Cancel"}),(0,i.jsx)(r.z,{htmlType:"submit",block:!0,type:t?"danger":"primary",disabled:p,loading:p,children:m&&p?m:u||"Confirm"})]})})})})})}}}]);