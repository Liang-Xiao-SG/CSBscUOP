"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2619],{42619:function(e,t,i){i.d(t,{Z:function(){return tg}});var n=i(97458),s=i(28977),r=i.n(s),a=i(929),l=i(85283),o=i(52983),d=i(34549),c=i(84261),u=i(18505),p=i(36457),m=i(64618),h=i(70864),f=i(62865);async function x(e){let{pid:t,projectRef:i,connectionString:n}=e,{result:s}=await (0,h.R)({projectRef:i,connectionString:n,sql:"select pg_terminate_backend(".concat(t,")")});return s}let v=function(){let{onSuccess:e,onError:t,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,p.NL)();return(0,m.D)(e=>x(e),{async onSuccess(t,i,s){let{projectRef:r}=i;await n.invalidateQueries(f.M.ongoingQueries(r)),await (null==e?void 0:e(t,i,s))},async onError(e,i,n){void 0===t?d.Am.error("Failed to abort query: ".concat(e.message)):t(e,i,n)},...i})};var g=i(28894);let j=()=>"\nselect pid, query, query_start from pg_stat_activity where state = 'active' and datname = 'postgres';\n".trim();async function y(e,t){let{projectRef:i,connectionString:n}=e,s=j().trim(),{result:r}=await (0,h.R)({projectRef:i,connectionString:n,sql:s,queryKey:["ongoing-queries"]},t);return(null!=r?r:[]).filter(e=>!e.query.startsWith(s))}let b=function(e){let{projectRef:t,connectionString:i}=e,{enabled:n=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.a)(f.M.ongoingQueries(t),e=>{let{signal:n}=e;return y({projectRef:t,connectionString:i},n)},{enabled:n&&void 0!==t,...s})};var N=i(289),w=i(81541),S=i(56535),q=i(80342),C=i(33968),P=i(53486),Z=i(7879),_=i(43633),L=i(50322),k=i(15518),E=i(41212),z=i(73512);let F=()=>{let[e,t]=(0,w.x)({replace:!0}),{viewOngoingQueries:i}=(0,z.UO)(),s=(0,N.Vm)(),p=(0,q.TF)(),m=(0,E.WZ)(),[h,f]=(0,o.useState)(),{data:x}=(0,u.bN)({projectRef:null==s?void 0:s.ref}),g=(null!=x?x:[]).find(e=>e.identifier===p.selectedDatabaseId),{data:j,error:y,isError:F,isLoading:A,isFetching:D,refetch:O}=b({projectRef:null==s?void 0:s.ref,connectionString:null==g?void 0:g.connectionString},{enabled:!S.Qy||S.Qy&&(null==g?void 0:g.connectionString)!==void 0,staleTime:5e3}),R=null!=j?j:[];(0,o.useEffect)(()=>{i&&(m.setOnGoingQueriesPanelOpen(!0),t({viewOngoingQueries:void 0}))},[i]);let{mutate:I,isLoading:M}=v({onSuccess:()=>{d.Am.success("Successfully aborted query (ID: ".concat(h,")")),f(void 0)}}),Q=()=>{t({viewOngoingQueries:void 0}),m.setOnGoingQueriesPanelOpen(!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.yo,{open:m.ongoingQueriesPanelOpen,onOpenChange:()=>Q(),children:(0,n.jsxs)(C.ue,{size:"lg",children:[(0,n.jsxs)(C.Tu,{children:[(0,n.jsxs)(C.bC,{className:"flex items-center gap-x-2",children:["Running queries on"," ",(null==g?void 0:g.identifier)===(null==s?void 0:s.ref)?"primary database":"read replica",(0,n.jsx)(P.z,{type:"default",className:"px-1.5",loading:A||D,icon:(0,n.jsx)(a.Z,{}),onClick:()=>O()})]}),(0,n.jsxs)(C.Ei,{children:["There ",1===R.length?"is":"are"," ",(0,n.jsx)("span",{className:"text-foreground-light",children:R.length})," quer",1===R.length?"y":"ies"," currently running"," ",(null==g?void 0:g.identifier)!==(null==s?void 0:s.ref)?"on replica ".concat(null==g?void 0:g.identifier):""]})]}),(0,n.jsxs)("div",{className:"max-h-full h-full divide-y overflow-y-auto",children:[F&&(0,n.jsx)("div",{className:"flex items-center justify-center h-full px-16",children:(0,n.jsx)(c.Z,{subject:"Failed to retrieve ongoing queries",error:y})}),0===R.length&&(0,n.jsxs)("div",{className:"flex flex-col gap-y-2 items-center justify-center h-full text-foreground-light text-sm",children:[(0,n.jsxs)("span",{children:["No queries are currently running on the"," ",(null==g?void 0:g.identifier)!==(null==s?void 0:s.ref)?"read replica ".concat(null==g?void 0:g.identifier):(null!=x?x:[]).length>1?"primary database":"database"]}),(0,n.jsx)(P.z,{type:"default",loading:A||D,icon:(0,n.jsx)(a.Z,{}),onClick:()=>O(),children:"Refresh"})]}),R.map(e=>(0,n.jsxs)(C.DN,{className:"flex justify-between gap-x-4",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-2 w-full",children:[(0,n.jsx)(Z.d,{hideLineNumbers:!0,value:e.query,language:"sql",className:(0,_.cn)("max-w-none max-h-52 w-full","!bg-transparent !py-3 !px-3.5 prose dark:prose-dark","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsxs)("p",{className:"text-foreground-light text-xs",children:["PID: ",e.pid]}),(0,n.jsx)("p",{className:"text-foreground-light text-xs",children:"â€¢"}),(0,n.jsxs)("p",{className:"text-foreground-light text-xs",children:["Started since: ",r()(e.query_start).format("DD MMM YYYY HH:mm (ZZ)")]})]})]}),(0,n.jsxs)(L.u,{children:[(0,n.jsx)(L.aJ,{asChild:!0,children:(0,n.jsx)(P.z,{type:"warning",className:"px-1.5",icon:(0,n.jsx)(l.Z,{}),onClick:()=>f(e.pid)})}),(0,n.jsx)(L._v,{side:"bottom",children:"Abort query"})]})]},e.pid))]})]})}),(0,n.jsx)(k.Z,{loading:M,variant:"warning",title:"Confirm to abort this query? (ID: ".concat(h,")"),visible:void 0!==h,onCancel:()=>f(void 0),onConfirm:()=>{void 0!==h&&I({pid:h,projectRef:null==s?void 0:s.ref,connectionString:null==g?void 0:g.connectionString})},children:(0,n.jsx)("p",{className:"text-sm",children:"This will force the query to stop running."})})]})};var A=i(76026),D=i(15631),O=i(40540),R=i(23382),I=i(94281),M=i(35721),Q=i(27610),U=i(11321),T=i(4534),V=i(91001),B=i(95616),K=i(32691),W=i(22332),$=i(15011),G=i(5817);let Y=["templates","quickstarts"];function J(){let{ref:e}=(0,z.UO)(),t=(0,K.useRouter)();return(0,n.jsx)("div",{children:Y.map(i=>{let s=t.asPath==="/project/".concat(e,"/sql/").concat(i);return(0,n.jsx)(G.G,{title:"Templates",isActive:s,isOpened:!1,href:"/project/".concat(e,"/sql/").concat(i),className:"capitalize",children:i},i)})})}var X=i(85847),H=i(83145),ee=i.n(H),et=i(61711),ei=i(129),en=i(97526);async function es(e,t){let{projectRef:i,cumulative:n,type:s,name:r}=e;if(void 0===i)throw Error("projectRef is required");let{data:a,error:l}=await (0,ei.U2)("/platform/projects/{ref}/content/count",{params:{path:{ref:i},query:{...s&&{type:s},...r&&{name:r}}},...n?{}:{headers:{Version:"2"}},signal:t});if(l)throw(0,ei.S3)(l);return a}let er=function(e){let{projectRef:t,cumulative:i,type:n,name:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.a)(en.$.count(t,n,{cumulative:i,name:s}),e=>{let{signal:r}=e;return es({projectRef:t,cumulative:i,type:n,name:s},r)},{enabled:r&&void 0!==t,...a})};var ea=i(90688);async function el(e,t){let{projectRef:i,type:n,name:s,limit:r=10,sort:a,cursor:l}=e;if(void 0===i)throw Error("projectRef is required for getContent");let{data:o,error:d}=await (0,ei.U2)("/platform/projects/{ref}/content",{params:{path:{ref:i},query:{type:n,name:s,sort_by:a,limit:r.toString(),cursor:l}},signal:t});return d&&(0,ei.S3)(d),{cursor:o.cursor,content:o.data}}let eo=function(e){let{projectRef:t,type:i,name:n,limit:s,sort:r}=e,{enabled:a=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ea.N)(en.$.infiniteList(t,{type:i,name:n,limit:s,sort:r}),e=>{let{signal:a,pageParam:l}=e;return el({projectRef:t,type:i,name:n,limit:s,sort:r,cursor:l},a)},{enabled:a&&void 0!==t,getNextPageParam:e=>e.cursor,...l})};var ed=i(99445),ec=i(86665),eu=i(28179);let ep=e=>{var t;let{search:i}=e,{ref:s}=(0,z.UO)(),{data:r,isLoading:a,hasNextPage:l,fetchNextPage:d,isFetchingNextPage:c}=eo({projectRef:s,type:"sql",limit:ed.KJ,name:0===i.length?void 0:i},{keepPreviousData:!0}),{data:u,isLoading:p}=er({projectRef:s,cumulative:!0,type:"sql",name:i},{keepPreviousData:!0}),m=null!==(t=null==u?void 0:u.count)&&void 0!==t?t:0,h=(0,o.useMemo)(()=>null==r?void 0:r.pages.flatMap(e=>e.content),[null==r?void 0:r.pages]);return(0,n.jsxs)("div",{className:"flex flex-col flex-grow",children:[a?(0,n.jsx)("div",{className:"px-4 py-1 pb-2.5",children:(0,n.jsx)(X.Z,{className:"animate-spin",size:14})}):u?(0,n.jsxs)("p",{className:"px-4 pb-2 text-sm text-foreground-lighter",children:[m," result",m>1?"s":""," found"]}):null,a?(0,n.jsxs)("div",{className:"px-4 flex flex-col gap-y-1",children:[(0,n.jsx)(eu.Z,{className:"py-2.5"}),(0,n.jsx)(eu.Z,{className:"py-2.5 w-5/6"}),(0,n.jsx)(eu.Z,{className:"py-2.5 w-3/4"})]}):(0,n.jsx)(et.Z,{items:h,ItemComponent:e=>(0,n.jsx)(em,{snippet:e.item}),itemProps:{},getItemSize:()=>28,hasNextPage:l,isLoadingNextPage:c,onLoadNextPage:()=>d()})]})},em=e=>{let{snippet:t}=e,{ref:i,id:s}=(0,z.UO)(),r=t.id===s;return(0,n.jsxs)(ee(),{className:(0,_.cn)("h-full flex items-center gap-x-3 pl-4 hover:bg-control transition",r&&"!bg-selection [&>svg]:fill-foreground [&>p]:text-foreground"),href:"/project/".concat(i,"/sql/").concat(t.id),children:[(0,n.jsx)(ec.KK,{size:16,strokeWidth:1.5,className:"w-5 h-5 -ml-0.5 transition-colors fill-foreground-muted group-aria-selected:fill-foreground"}),(0,n.jsx)("p",{className:"transition text-sm text-foreground-light truncate",children:t.name})]})};var eh=i(78616),ef=i(5364),ex=i(9887),ev=i(81923),eg=i(97687),ej=i.n(eg),ey=i(99033),eb=i(26369),eN=i(37914),ew=i(54343),eS=i(79663),eq=i(71926),eC=e=>{var t;let{id:i,...s}=e,r=null===(t=(0,W.B0)().snippets[i])||void 0===t?void 0:t.snippet,a=ej()(null==r?void 0:r.name),[l,d]=(0,o.useState)("CLI"),c=[{id:"migration",label:"Migration",title:"Download as migration",description:"Download the snippet in a new migration named `".concat(a,"`"),cli:(0,eq.kL)(i,a),npm:(0,eq.kL)(i,a,!0)},{id:"seed",label:"Seed file",title:"Download as seed file",description:"If your query consists of sample data, append the snippet to the end of `supabase/seed.sql`",cli:(0,eq.YI)(i),npm:(0,eq.YI)(i,!0)},{id:"sql",label:"SQL file",title:"Download as SQL file",description:"Download the snippet directly into a new SQL file named `".concat(a,".sql`"),cli:(0,eq.y4)(i,a),npm:(0,eq.y4)(i,a,!0)}];return(0,n.jsx)(eN.Z,{hideFooter:!0,showCloseButton:!0,size:"xlarge",header:(0,n.jsx)("p",{children:"Download snippet as local migration file via the Supabase CLI."}),...s,children:(0,n.jsxs)("div",{className:"flex flex-col items-start justify-between gap-4 relative pt-2",children:[(0,n.jsx)(ew.Z,{type:"underlined",listClassNames:"pl-5",children:c.map(e=>(0,n.jsx)(ew.Z.Panel,{id:e.id,label:e.label,children:(0,n.jsxs)(eN.Z.Content,{className:"!py-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,n.jsx)("p",{className:"text-base",children:e.title}),(0,n.jsx)(eS.U,{className:"text-sm text-scale-1000 [&>p>code]:!break-normal",content:e.description})]}),(0,n.jsx)(eb.Z,{width:50,options:["CLI","NPM"],activeOption:l,borderOverride:"border-muted",onClickOption:()=>"CLI"===l?d("NPM"):d("CLI")})]}),(0,n.jsx)("pre",{children:(0,n.jsx)(Z.d,{language:"bash",className:"language-bash prose dark:prose-dark max-w-none",children:"CLI"===l?e.cli:e.npm})})]})},e.id))}),(0,n.jsxs)(eN.Z.Content,{className:"w-full flex items-center justify-between pt-0",children:[(0,n.jsx)("p",{className:"text-xs text-lighter",children:"Run this command from your project directory"}),(0,n.jsxs)("div",{className:"flex justify-between items-center gap-x-2",children:[(0,n.jsx)(P.z,{asChild:!0,type:"default",icon:(0,n.jsx)(ey.Z,{strokeWidth:1.5}),children:(0,n.jsx)(ee(),{href:"https://supabase.com/docs/guides/deployment/database-migrations",target:"_blank",rel:"noreferrer",children:"About migrations"})}),(0,n.jsx)(P.z,{asChild:!0,type:"default",icon:(0,n.jsx)(ey.Z,{strokeWidth:1.5}),children:(0,n.jsx)(ee(),{href:"https://supabase.com/docs/guides/cli/local-development",target:"_blank",rel:"noreferrer",children:"About CLI"})})]})]})]})})},eP=i(90330),eZ=i(64714),e_=i(9738),eL=i(86848),ek=i(5394),eE=i(1042),ez=i(42667),eF=i(39871),eA=i(79180),eD=i(76707),eO=i(7257),eR=i(12753),eI=i(22921),eM=i(12361),eQ=i(93840);let eU=e=>{var t;let{visible:i,snippets:s=[],onClose:r}=e,{ref:a}=(0,z.UO)(),l=(0,W.B0)(),[c,u]=(0,o.useState)(!1),[p,m]=(0,o.useState)(),{mutateAsync:h,isLoading:f}=(0,eF.P)(),{mutateAsync:x,isLoading:v}=(0,ez.R)({onError:e=>{d.Am.error("Failed to move query: ".concat(e.message))}}),g="new-folder"===p?ek.Ry({name:ek.Z_().min(1,"Please provide a name for the folder")}).refine(e=>!l.allFolderNames.includes(e.name),{message:"This folder name already exists",path:["name"]}):ek.Ry({}),j=(0,eL.cI)({mode:"onSubmit",reValidateMode:"onSubmit",resolver:(0,eP.F)(g),defaultValues:{name:""}}),y=(0,W.Gd)(a),b="root"===p?"Root of the editor":"new-folder"===p?"Create a new folder":null===(t=y.find(e=>e.id===p))||void 0===t?void 0:t.name,N=1===s.length&&(!s[0].folder_id&&"root"===p||s[0].folder_id===p),w=1===s.length&&(!s[0].folder_id&&"root"===p||s[0].folder_id===p),S=async e=>{if(!a)return console.error("Project ref is required");try{let t=p;if("new-folder"===p&&"name"in e){let{id:i}=await h({projectRef:a,name:e.name});t=i}await Promise.all(s.map(async e=>{let i=null==e?void 0:e.content;if(void 0===i){let{content:t}=await (0,eE.A)({projectRef:a,id:e.id});"sql"in t&&(i=t)}if(void 0===i)return d.Am.error("Failed to save snippet: Unable to retrieve snippet contents");await x({projectRef:a,payload:{id:e.id,type:"sql",name:e.name,description:e.description,visibility:e.visibility,project_id:e.project_id,owner_id:e.owner_id,folder_id:"root"===p?null:t,content:i}})})),d.Am.success("Successfully moved ".concat(1===s.length?'"'.concat(s[0].name,'"'):"".concat(s.length," snippets")," to ").concat("root"===p?"the root of the editor":b)),s.forEach(e=>{l.updateSnippet({id:e.id,snippet:{...e,folder_id:"root"===p?null:t},skipSave:!0})}),r()}catch(e){d.Am.error("Failed to create new folder: ".concat(e.message))}};return(0,o.useEffect)(()=>{if(i&&void 0!==s){if(1===s.length){var e;m(null!==(e=s[0].folder_id)&&void 0!==e?e:"root")}else m("root");j.reset({name:""})}},[i,s]),(0,n.jsx)(eA.Vq,{open:i,onOpenChange:()=>r(),children:(0,n.jsx)(eA.cZ,{children:(0,n.jsx)(eD.l0,{...j,children:(0,n.jsxs)("form",{id:"move-snippet",onSubmit:j.handleSubmit(S),children:[(0,n.jsxs)(eA.fK,{children:[(0,n.jsxs)(eA.$N,{children:["Move ",1===s.length?'"'.concat(s[0].name,'"'):"".concat(s.length)," ","snippet",s.length>1?"s":""," to a folder"]}),(0,n.jsxs)(eA.Be,{children:["Select which folder to move your quer",s.length>1?"ies":"y"," to"]})]}),(0,n.jsx)(eA.P3,{}),(0,n.jsxs)(eA.VO,{className:"py-5 flex flex-col gap-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,n.jsx)(eO._,{className:"text-foreground-light",children:"Select a folder"}),(0,n.jsxs)(eR.J2,{open:c,onOpenChange:u,modal:!1,children:[(0,n.jsx)(eR.xo,{asChild:!0,children:(0,n.jsx)(P.z,{block:!0,size:"small",type:"default",className:"pr-2 justify-between",iconRight:(0,n.jsx)(eZ.Z,{className:"text-foreground-light rotate-90",strokeWidth:2,size:12}),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[b,N&&" (Current)"]})})}),(0,n.jsx)(eR.yk,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,n.jsxs)(eI.mY,{children:[(0,n.jsx)(eI.sZ,{placeholder:"Find folder..."}),(0,n.jsxs)(eI.e8,{children:[(0,n.jsx)(eI.rb,{children:"No folders found"}),(0,n.jsx)(eI.fu,{children:(0,n.jsxs)(eM.xr,{className:(y||[]).length>6?"h-[210px]":"",children:[(0,n.jsxs)(eI.di,{value:"root",className:"cursor-pointer w-full justify-between",onSelect:()=>{u(!1),m("root")},onClick:()=>{u(!1),m("root")},children:[(0,n.jsxs)("span",{children:["Root of the editor",1===s.length&&null===s[0].folder_id&&" (Current)"]}),"root"===p&&(0,n.jsx)(e_.Z,{size:14})]},"root"),null==y?void 0:y.map(e=>(0,n.jsxs)(eI.di,{value:e.id,className:"cursor-pointer w-full justify-between",onSelect:()=>{u(!1),m(e.id)},onClick:()=>{u(!1),m(e.id)},children:[(0,n.jsxs)("span",{children:[e.name,1===s.length&&s[0].folder_id===e.id&&" (Current)"]}),e.id===p&&(0,n.jsx)(e_.Z,{size:14})]},e.id))]})}),(0,n.jsx)(eI.zz,{}),(0,n.jsx)(eI.fu,{children:(0,n.jsxs)(eI.di,{className:"cursor-pointer w-full justify-start gap-x-2",onSelect:e=>{u(!1),m("new-folder")},onClick:()=>{u(!1),m("new-folder")},children:[(0,n.jsx)(T.Z,{size:14,strokeWidth:1.5}),(0,n.jsx)("p",{children:"New folder"})]})})]})]})})]})]}),"new-folder"===p&&(0,n.jsx)("div",{className:"flex flex-col gap-y-2",children:(0,n.jsx)(eD.Wi,{name:"name",control:j.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(eD.xJ,{className:"flex flex-col gap-y-2",children:[(0,n.jsx)(eD.lX,{children:"Provide a name for your new folder"}),(0,n.jsx)(eD.NI,{children:(0,n.jsx)(eQ.I,{autoFocus:!0,...t,autoComplete:"off",disabled:v||f})}),(0,n.jsx)(eD.zG,{})]})}})})]}),(0,n.jsxs)(eA.cN,{children:[(0,n.jsx)(P.z,{type:"default",disabled:v||f,onClick:()=>r(),children:"Cancel"}),(0,n.jsx)(P.z,{type:"primary",htmlType:"submit",disabled:w,loading:v||f,children:"Move file"})]})]})})})})};var eT=i(14723),eV=i(5359),eB=i(9881),eK=i(28289),eW=i(60661),e$=i(8294),eG=i(16303),eY=e=>{let{snippet:t={},visible:i,onCancel:s,onComplete:r}=e,{ref:a}=(0,z.UO)(),l=(0,eB.l)(),c=(0,W.B0)(),{data:u}=(0,eV.Gl)({orgSlug:null==l?void 0:l.slug}),p="sql"===t.type,m=(0,eG.$w)(u),{id:h,name:f,description:x}=t,[v,g]=(0,o.useState)(f),[j,y]=(0,o.useState)(x),{mutate:b,isLoading:N}=(0,eT.g)({onSuccess:e=>{let{title:t,description:i}=e;g(t),j||y(i)},onError:e=>{d.Am.error("Failed to rename query: ".concat(e.message))}}),w=async()=>{if("content"in t&&p)b({sql:t.content.sql});else try{let{content:e}=await (0,eE.A)({projectRef:a,id:t.id});"sql"in e&&b({sql:e.sql})}catch(e){d.Am.error("Unable to generate title based on query contents")}},{mutateAsync:S}=(0,ez.R)(),q=async(e,i)=>{let{setSubmitting:n}=i;if(!a)return console.error("Project ref is required");if(!h)return console.error("Snippet ID is required");n(!0);try{let e=t;"content"in e||(e=await (0,eE.A)({projectRef:a,id:h}),c.addSnippet({projectRef:a,snippet:e})),await S({projectRef:a,payload:{...e,name:v,description:j}}),c.renameSnippet({id:h,name:v,description:j}),d.Am.success("Successfully renamed snippet!"),r&&r()}catch(e){n(!1),d.Am.error("Failed to rename snippet: ".concat(e.message))}};return(0,o.useEffect)(()=>{g(f),y(x)},[t.id]),(0,n.jsx)(eN.Z,{visible:i,onCancel:s,hideFooter:!0,header:"Rename",size:"small",children:(0,n.jsx)(eK.Z,{onReset:s,validateOnBlur:!0,initialValues:{name:null!=f?f:"",description:null!=x?x:""},validate:()=>{let e={};return v||(e.name="Please enter a query name"),e},onSubmit:q,children:e=>{let{isSubmitting:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eN.Z.Content,{className:"space-y-4",children:[(0,n.jsx)(eW.Z,{label:"Name",id:"name",name:"name",value:v,onChange:e=>g(e.target.value)}),(0,n.jsx)("div",{className:"flex w-full justify-end mt-2",children:!m&&(0,n.jsx)(P.z,{type:"default",onClick:()=>w(),size:"tiny",disabled:N,children:(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"scale-75",children:(0,n.jsx)(e$.c,{loading:N})}),(0,n.jsx)("span",{children:"Rename with Supabase AI"})]})})}),(0,n.jsx)(eW.Z.TextArea,{label:"Description",id:"description",placeholder:"Describe query",size:"medium",textAreaClassName:"resize-none",value:j,onChange:e=>y(e.target.value)})]}),(0,n.jsx)(eN.Z.Separator,{}),(0,n.jsxs)(eN.Z.Content,{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)(P.z,{htmlType:"reset",type:"default",onClick:s,disabled:t,children:"Cancel"}),(0,n.jsx)(P.z,{htmlType:"submit",loading:t,disabled:t,children:"Rename query"})]})]})}})})},eJ=i(3075),eX=i(24450);let eH=()=>(0,n.jsx)(G.Cf,{title:"No private queries created yet",description:"Queries will be automatically saved once you start writing in the editor",className:"mx-4",children:(0,n.jsx)("div",{className:"top-0 left-6 flex flex-col opacity-50 cursor-not-allowed bg-dash-sidebar h-content -mb-7 pointer-events-none scale-75",children:(0,n.jsxs)("div",{className:"relative h-content",children:[(0,n.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent from-80% to-100% to-background-surface-100 dark:to-background-surface-75"}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent from-50% to-100% to-background-surface-100 dark:to-background-surface-75"})]}),(0,n.jsx)("div",{className:"absolute left-[128px] bottom-[21px] text-foreground-muted z-10 pointer-events-none",children:(0,n.jsx)(eX.Z,{size:16,className:"text-foreground-light",strokeWidth:1.5})}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsx)("div",{className:"border-l pointer-events-none",children:(0,n.jsx)(ec.A7,{isSelected:2===t,id:"dummy-".concat(t+1),name:"dummy_query_".concat(t+1),level:1,xPadding:16})},"dummy-".concat(t+1)))]})})});var e0=i(13456),e1=i(3297);async function e2(e,t){let{projectRef:i,ids:n}=e,{data:s,error:r}=await (0,ei.IV)("/platform/projects/{ref}/content/folders",{params:{path:{ref:i},query:{ids:n}},signal:t});if(r)throw(0,ei.S3)(r);return s}let e4=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:i=!0,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,p.NL)();return(0,m.D)(e=>e2(e),{async onSuccess(e,n,r){let{projectRef:a}=n;i&&await s.invalidateQueries(en.$.folders(a)),await (null==t?void 0:t(e,n,r))},async onError(t,i,n){void 0===e?d.Am.error("Failed to delete folder: ".concat(t.message)):e(t,i,n)},...n})};var e5=i(35682),e3=i(65496),e6=i(47889),e9=i(95293),e8=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,n.jsx)(e9.O,{className:"h-4 w-5"}),(0,n.jsx)(e9.O,{className:"w-40 h-4"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,n.jsx)(e9.O,{className:"h-4 w-5"}),(0,n.jsx)(e9.O,{className:"w-32 h-4"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-75",children:[(0,n.jsx)(e9.O,{className:"h-4 w-5"}),(0,n.jsx)(e9.O,{className:"w-20 h-4"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-50",children:[(0,n.jsx)(e9.O,{className:"h-4 w-5"}),(0,n.jsx)(e9.O,{className:"w-40 h-4"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-25",children:[(0,n.jsx)(e9.O,{className:"h-4 w-5"}),(0,n.jsx)(e9.O,{className:"w-20 h-4"})]})]});let e7={id:0,name:"",parent:null,children:[]},te=e=>{var t,i;if(void 0===e)return[e7];let{folders:n,contents:s}=e,r=(null==n?void 0:n.map(e=>{var t;let{id:i,name:n}=e;return{id:i,name:n,parent:0,isBranch:!0,children:null!==(t=null==s?void 0:s.filter(e=>e.folder_id===i).map(e=>e.id))&&void 0!==t?t:[],metadata:e}}))||[],a=(null==s?void 0:s.map(e=>{let{id:t,name:i,folder_id:n}=e;return{id:t,name:i,parent:null!=n?n:0,children:[],metadata:e}}))||[];return[{id:0,name:"",parent:null,children:[...null===(t=n||[])||void 0===t?void 0:t.map(e=>e.id),...null===(i=(s||[]).filter(e=>!e.folder_id))||void 0===i?void 0:i.map(e=>e.id)]},...r,...a]};function tt(e){let t=new Set,i=e.filter(e=>0===e.parent);if(i.length>0){let e=i[i.length-1];"string"==typeof e.id&&t.add(e.id),i.forEach(e=>{if(e.children.length>0){let i=e.children[e.children.length-1];"string"==typeof i&&t.add(i)}})}return t}var ti=i(48631),tn=i(26597),ts=i(34337),tr=i(42958),ta=i(74286),tl=i(74459),to=i(11968),td=i(38001);async function tc(e,t){let{projectRef:i,folderId:n,cursor:s,sort:r,name:a}=e;if(void 0===i)throw Error("projectRef is required");if(void 0===n)throw Error("folderId is required");let{data:l,error:o}=await (0,ei.U2)("/platform/projects/{ref}/content/folders/{id}",{params:{path:{ref:i,id:n},query:{cursor:s,limit:ed.KJ.toString(),sort_by:r,sort_order:"name"===r?"asc":"desc",name:a}},signal:t});return o&&(0,ei.S3)(o),{...l.data,cursor:l.cursor}}let tu=function(e){let{projectRef:t,folderId:i,name:n,sort:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ea.N)(en.$.folderContents(t,i,{name:n,sort:s}),e=>{let{signal:r,pageParam:a}=e;return tc({projectRef:t,folderId:i,cursor:a,name:n,sort:s},r)},{enabled:r&&void 0!==t&&void 0!==i,getNextPageParam:e=>e.cursor,...a})};var tp=i(26058),tm=i(97079);let th=e=>{let{element:t,isBranch:i,isExpanded:s,level:r,status:a,isSelected:l,isMultiSelected:d,getNodeProps:c,onSelectCreate:u,onSelectDelete:p,onSelectRename:m,onSelectMove:h,onSelectShare:f,onSelectUnshare:x,onSelectDownload:v,onSelectDuplicate:g,onEditSave:j,onMultiSelect:y,isLastItem:b,hasNextPage:N,fetchNextPage:w,isFetchingNextPage:S,sort:q,name:C,onFolderContentsChange:Z}=e,_=(0,K.useRouter)(),{id:L,ref:k}=(0,td.U)(),{profile:E}=(0,Q.Un)(),{className:F,onClick:A}=c(),D=(0,W.B0)(),R=(null==E?void 0:E.id)===(null==t?void 0:t.metadata.owner_id),M="project"===t.metadata.visibility,U="editing"===a,V=(0,I.Xo)(O.KA.CREATE,"user_content",{resource:{type:"sql",owner_id:null==E?void 0:E.id},subject:{id:null==E?void 0:E.id}}),B=0===t.parent?void 0:t.parent,$=i&&s,{data:G,isSuccess:Y,isLoading:J,isFetchingNextPage:X,hasNextPage:H,fetchNextPage:et,isPreviousData:ei,isFetching:en}=tu({projectRef:k,folderId:null!=B?B:t.id,name:C,sort:q},{enabled:$,keepPreviousData:!0});(0,o.useEffect)(()=>{k&&Y&&G.pages.forEach(e=>{var t;null===(t=e.contents)||void 0===t||t.forEach(e=>{D.addSnippet({projectRef:k,snippet:e})})})},[k,null==G?void 0:G.pages]);let es=(0,tp.Z)(Z);(0,o.useEffect)(()=>{if($){var e;null===(e=es.current)||void 0===e||e.call(es,{isLoading:J||ei&&en,snippets:null==G?void 0:G.pages.flatMap(e=>{var t;return null!==(t=e.contents)&&void 0!==t?t:[]})})}},[null==G?void 0:G.pages,en,J,ei,$]);let er=void 0!==B;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(tm.xV,{modal:!1,children:[(0,n.jsx)(tm.W4,{asChild:!0,children:(0,n.jsx)(ec.A7,{className:F,level:r,isExpanded:s,isBranch:i,isSelected:l,isEditing:U,isLoading:$&&J||"saving"===a,onEditSubmit:e=>{void 0!==j&&j(e)},onClick:e=>{i?U||A(e):e.shiftKey&&"new"!==L?null==y||y(t.id):_.push("/project/".concat(k,"/sql/").concat(t.id))},name:t.name,xPadding:16})}),(0,n.jsx)(tm.h_,{onCloseAutoFocus:e=>e.stopPropagation(),children:i?(0,n.jsxs)(n.Fragment,{children:[void 0!==u&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>u(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(T.Z,{size:14}),"Create new snippet"]}),void 0!==m&&R&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>m(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ti.Z,{size:14}),"Rename folder"]}),void 0!==p&&R&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tm.uP,{}),(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>p(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(tn.Z,{size:14}),"Delete folder"]})]})]}):d?(0,n.jsxs)(n.Fragment,{children:[void 0!==h&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>h(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ts.Z,{size:14}),"Move selected queries"]}),(0,n.jsx)(tm.uP,{}),void 0!==p&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>p(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(tn.Z,{size:14}),"Delete selected queries"]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tm.Zo,{asChild:!0,className:"gap-x-2",onSelect:()=>{},onFocusCapture:e=>e.stopPropagation(),children:(0,n.jsxs)(ee(),{href:"/project/".concat(k,"/sql/").concat(t.id),target:"_blank",rel:"noreferrer",children:[(0,n.jsx)(ey.Z,{size:14}),"Open in new tab"]})}),(0,n.jsx)(tm.uP,{}),void 0!==m&&R&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>m(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ti.Z,{size:14}),"Rename query"]}),void 0!==h&&R&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>h(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ts.Z,{size:14}),"Move query"]}),void 0!==f&&!M&&V&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>f(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(tr.Z,{size:14}),"Share query with team"]}),void 0!==x&&M&&R&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>x(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ta.Z,{size:14}),"Unshare query with team"]}),void 0!==g&&V&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>g(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(tl.Z,{size:14}),"Duplicate query"]}),void 0!==v&&z.Qy&&(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>v(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(to.Z,{size:14}),"Download as migration file"]}),void 0!==p&&R&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tm.uP,{}),(0,n.jsxs)(tm.Zo,{className:"gap-x-2",onSelect:()=>p(),children:[(0,n.jsx)(tn.Z,{size:14}),"Delete query"]})]})]})})]}),(er?H:N)&&"string"==typeof t.id&&b&&(0,n.jsx)("div",{className:"px-4 py-1",style:{paddingLeft:!t.isBranch&&t.level>1?48*(t.level-1):void 0},children:(0,n.jsx)(P.z,{type:"outline",size:"tiny",block:!0,loading:er?X:S,disabled:er?X:S,onClick:function(){er?et():"function"==typeof w&&w()},children:"Load More"})})]})},tf={shared:!1,favorite:!1,private:!0},tx=e=>{var t,i,s,r,a,l,c;let{sort:u="inserted_at"}=e,p=(0,K.useRouter)(),{profile:m}=(0,Q.Un)(),h=(0,N.Vm)(),{ref:f,id:x}=(0,z.UO)(),v=(0,W.B0)(),[g,j]=(0,M._)(S.dA.SQL_EDITOR_SECTION_STATE(null!=f?f:""),tf),{shared:y,favorite:b,private:w}=g,[q,C]=(0,o.useState)(!1),[P,Z]=(0,o.useState)(!1),[_,L]=(0,o.useState)(!1),[E,F]=(0,o.useState)([]),[A,D]=(0,o.useState)([]),[O,R]=(0,o.useState)(),[I,U]=(0,o.useState)(),[T,V]=(0,o.useState)(),[B,$]=(0,o.useState)(),[Y,J]=(0,o.useState)(),X=null===(t=v.snippets[x])||void 0===t?void 0:t.snippet,{data:H,isSuccess:ee,isLoading:et,isPreviousData:ei,isFetching:en,hasNextPage:es,fetchNextPage:ea,isFetchingNextPage:el}=(0,ed.md)({projectRef:f,sort:u},{keepPreviousData:!0}),[eo,eu]=(0,o.useState)({}),ep=(0,o.useMemo)(()=>{var e;let t=null!==(e=null==H?void 0:H.pages.flatMap(e=>{var t;return null!==(t=e.contents)&&void 0!==t?t:[]}))&&void 0!==e?e:[],i=Object.values(eo).reduce((e,t)=>{var i;let n=(null!==(i=t.snippets)&&void 0!==i?i:[]).filter(t=>!e.snippetIds.has(t.id)),s=new Set(n.map(e=>e.id));return{snippets:[...e.snippets,...n],isLoading:e.isLoading||t.isLoading,snippetIds:new Set([...e.snippetIds,...s])}},{snippets:t,isLoading:et||ei&&en,snippetIds:new Set(t.map(e=>e.id))});return X&&"user"===X.visibility&&!i.snippetIds.has(X.id)&&(i.snippetIds.add(X.id),i.snippets=[...i.snippets,X]),i},[null==H?void 0:H.pages,eo,et,ei,en,X]),em=(0,o.useMemo)(()=>{var e,t;return null!==(t=null===(e=ep.snippets)||void 0===e?void 0:e.filter(e=>"user"===e.visibility).sort((e,t)=>"name"===u?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))&&void 0!==t?t:[]},[ep.snippets,u]),eg=(0,W.Gd)(f),{data:ej}=er({projectRef:f,type:"sql"}),ey=null!==(r=null==ej?void 0:ej.private)&&void 0!==r?r:0,eb=(0,o.useMemo)(()=>0===eg.length&&0===em.length?[e7]:te({folders:eg,contents:em}),[eg,em]),eN=(0,o.useMemo)(()=>tt(eb),[eb]),{data:ew,isLoading:eS,hasNextPage:eP,fetchNextPage:eZ,isFetchingNextPage:e_,isSuccess:eL}=(0,e5.v)({projectRef:f,favorite:!0,sort:u},{enabled:b,keepPreviousData:!0}),ek=(0,o.useMemo)(()=>{var e,t;let i=null!==(e=null==ew?void 0:ew.pages.flatMap(e=>{var t;return null!==(t=e.contents)&&void 0!==t?t:[]}))&&void 0!==e?e:[];return X&&X.favorite&&!i.find(e=>e.id===X.id)&&i.push(X),null!==(t=i.map(e=>({...e,folder_id:void 0})).sort((e,t)=>"name"===u?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))&&void 0!==t?t:[]},[null==ew?void 0:ew.pages,X,u]),eF=null!==(a=null==ej?void 0:ej.favorites)&&void 0!==a?a:0,eA=(0,o.useMemo)(()=>0===ek.length?[e7]:te({contents:ek}),[ek]),eD=(0,o.useMemo)(()=>tt(eA),[eA]),{data:eO,isLoading:eR,hasNextPage:eI,fetchNextPage:eM,isFetchingNextPage:eQ,isSuccess:eT}=(0,e5.v)({projectRef:f,visibility:"project",sort:u},{enabled:y,keepPreviousData:!0}),eV=(0,o.useMemo)(()=>{var e,t;let i=null!==(e=null==eO?void 0:eO.pages.flatMap(e=>{var t;return null!==(t=e.contents)&&void 0!==t?t:[]}))&&void 0!==e?e:[];return X&&"project"===X.visibility&&!i.find(e=>e.id===X.id)&&i.push(X),null!==(t=i.sort((e,t)=>"name"===u?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))&&void 0!==t?t:[]},[null==eO?void 0:eO.pages,X,u]),eB=null!==(l=null==ej?void 0:ej.shared)&&void 0!==l?l:0,eK=(0,o.useMemo)(()=>0===eV.length?[e7]:te({contents:eV}),[eV]),eW=(0,o.useMemo)(()=>tt(eK),[eK]),{mutate:e$,isLoading:eG}=(0,ez.R)({onError:e=>{d.Am.error("Failed to update query: ".concat(e.message))}}),{mutate:eX,isLoading:e2}=(0,e1.z)({onError:(e,t)=>{e.message.includes("Contents not found")?tn(t.ids):d.Am.error("Failed to delete query: ".concat(e.message))}}),{mutate:e9,isLoading:ti}=e4({onSuccess:(e,t)=>{d.Am.success("Successfully deleted folder");let{ids:i}=t;v.removeFolder(i[0]),J(void 0)}}),tn=e=>{Z(!1),D([]);let t=Object.keys(v.snippets).filter(t=>!e.includes(t));0===t.length?p.push("/project/".concat(f,"/sql/new")):e.includes(x)&&p.push("/project/".concat(f,"/sql/").concat(t[0])),e.length>0&&e.forEach(e=>v.removeSnippet(e))},ts=async e=>{var t;let i="share"===e?O:I;if(!f)return console.error("Project ref is required");if(!i)return console.error("Snippet ID is required");let n=v.snippets[i.id],s=null==n?void 0:null===(t=n.snippet)||void 0===t?void 0:t.content;if(void 0===s){let{content:e}=await (0,eE.A)({projectRef:f,id:i.id});s=e}if(void 0===s)return d.Am.error("Unable to update snippet visibility: Content is missing");let r="share"===e?"project":"user";e$({projectRef:f,payload:{...i,visibility:r,folder_id:null,content:s}},{onSuccess:()=>{R(void 0),U(void 0),j({...g,shared:!0}),v.updateSnippet({id:i.id,snippet:{visibility:r,folder_id:null},skipSave:!0}),d.Am.success("share"===e?"Snippet is now shared to the project":"Snippet is now unshared from the project")}})},tr=async e=>{if(!m)return console.error("Profile is required");if(!h)return console.error("Project is required");if(!f)return console.error("Project ref is required");if(!x)return console.error("Snippet ID is required");let t="";if(e.content&&e.content.sql)t=e.content.sql;else{let{content:i}=await (0,eE.A)({projectRef:f,id:e.id});"sql"in i&&(t=i.sql)}let i=(0,eq.wI)({id:(0,e3.Z)(),name:"".concat(e.name," (Duplicate)"),sql:t,owner_id:null==m?void 0:m.id,project_id:null==h?void 0:h.id});v.addSnippet({projectRef:f,snippet:i}),v.addNeedsSaving(i.id),p.push("/project/".concat(f,"/sql/").concat(i.id))},ta=async()=>{if(!f)return console.error("Project ref is required");if(void 0===Y)return console.error("No folder is selected");let e=em.filter(e=>e.folder_id===Y.id);if(e.length>0){let t=e.map(e=>e.id);eX({projectRef:f,ids:t},{onSuccess:()=>{t.forEach(e=>v.removeSnippet(e)),tn(t),e9({projectRef:f,ids:[null==Y?void 0:Y.id]})}})}else e9({projectRef:f,ids:[null==Y?void 0:Y.id]})},tl=e=>{let t=em.map(e=>e.id),i=t.indexOf(x),n=t.indexOf(e),s=Math.min(i,n),r=Math.max(i,n),a=[],l=em[s].folder_id===em[r].folder_id;for(let e=s;e<=r;e++)l&&em[e].folder_id===em[s].folder_id&&a.push(em[e]);D(a)};return(0,o.useEffect)(()=>{void 0!==X&&ee&&("project"===X.visibility?j({...g,shared:!0}):"user"===X.visibility&&j({...g,private:!0}),X.folder_id&&!E.includes(X.folder_id)&&F([...E,X.folder_id]))},[X,u,ee]),(0,o.useEffect)(()=>{D([])},[x]),(0,o.useEffect)(()=>{f&&H&&H.pages.forEach(e=>{var t,i;null===(t=e.contents)||void 0===t||t.forEach(e=>{v.addSnippet({projectRef:f,snippet:e})}),null===(i=e.folders)||void 0===i||i.forEach(e=>v.addFolder({projectRef:f,folder:e}))})},[f,null==H?void 0:H.pages]),(0,o.useEffect)(()=>{void 0!==f&&eL&&ew.pages.forEach(e=>{var t;null===(t=e.contents)||void 0===t||t.forEach(e=>{v.addSnippet({projectRef:f,snippet:e})})})},[f,null==H?void 0:H.pages]),(0,o.useEffect)(()=>{void 0!==f&&eT&&eO.pages.forEach(e=>{var t;null===(t=e.contents)||void 0===t||t.forEach(e=>{v.addSnippet({projectRef:f,snippet:e})})})},[f,null==H?void 0:H.pages]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(G.GZ,{className:"px-0",open:y,onOpenChange:e=>{j({...null!=g?g:tf,shared:e})},children:[(0,n.jsx)(G.Qn,{title:"Shared ".concat(eB>0?" (".concat(eB,")"):"")}),(0,n.jsx)(G.rt,{className:"group-data-[state=open]:pt-2",children:0===eB?(0,n.jsx)(G.Cf,{className:"mx-2",title:"No shared queries",description:"Share queries with your team by right-clicking on the query."}):(0,n.jsx)(ec.LQ,{data:eK,"aria-label":"project-level-snippets",nodeRenderer:e=>{var t;let{element:i,...s}=e,r=(null===(t=i.metadata)||void 0===t?void 0:t.id)===x;return(0,n.jsx)(th,{...s,isSelected:r,element:i,onSelectDelete:()=>{Z(!0),D([i.metadata])},onSelectRename:()=>{L(!0),V(i.metadata)},onSelectDownload:()=>{$(i.metadata)},onSelectDuplicate:()=>{tr(i.metadata)},onSelectUnshare:()=>{U(i.metadata)},isLastItem:eW.has(i.id),hasNextPage:eI,fetchNextPage:eM,isFetchingNextPage:eQ})}})})]}),(0,n.jsx)(G.qs,{}),(0,n.jsxs)(G.GZ,{className:"px-0",open:b,onOpenChange:e=>{j({...null!=g?g:tf,favorite:e})},children:[(0,n.jsx)(G.Qn,{title:"Favorites ".concat(eF>0?" (".concat(eF,")"):"")}),(0,n.jsx)(G.rt,{className:"group-data-[state=open]:pt-2",children:eS?(0,n.jsx)(e8,{}):0===eF?(0,n.jsx)(G.Cf,{title:"No favorite queries",className:"mx-2 px-3",description:(0,n.jsxs)(n.Fragment,{children:["Save a query to favorites for easy accessibility by clicking the"," ",(0,n.jsx)(eh.Z,{size:12,className:"inline-block relative align-center -top-[1px]"})," ","icon."]})}):(0,n.jsx)(ec.LQ,{data:eA,"aria-label":"favorite-snippets",nodeRenderer:e=>{var t;let{element:i,...s}=e,r=(null===(t=i.metadata)||void 0===t?void 0:t.id)===x;return(0,n.jsx)(th,{...s,isSelected:r,element:i,onSelectDelete:()=>{Z(!0),D([i.metadata])},onSelectRename:()=>{L(!0),V(i.metadata)},onSelectDownload:()=>{$(i.metadata)},onSelectDuplicate:()=>{tr(i.metadata)},onSelectShare:()=>R(i.metadata),onSelectUnshare:()=>{U(i.metadata)},isLastItem:eD.has(i.id),hasNextPage:eP,fetchNextPage:eZ,isFetchingNextPage:e_})}})})]}),(0,n.jsx)(G.qs,{}),(0,n.jsxs)(G.GZ,{open:w,onOpenChange:e=>{j({...null!=g?g:tf,private:e})},className:"px-0",children:[(0,n.jsx)(G.Qn,{title:"PRIVATE\n            ".concat(ey>0?" (".concat(ey,")"):"")}),(0,n.jsx)(G.rt,{className:"group-data-[state=open]:pt-2",children:et?(0,n.jsx)(e0.Z,{}):0===eg.length&&0===ey?(0,n.jsx)(eH,{}):(0,n.jsx)(ec.LQ,{multiSelect:!0,togglableSelect:!0,clickAction:"EXCLUSIVE_SELECT",data:eb,selectedIds:A.map(e=>e.id),"aria-label":"private-snippets",onExpand:e=>{let t=e.element.id.toString();e.isExpanded&&!E.includes(t)&&F([...E,t]),!e.isExpanded&&E.includes(t)&&F(E.filter(e=>e!==t))},expandedIds:E,nodeRenderer:e=>{var t;let{element:i,...s}=e,r=(null===(t=i.metadata)||void 0===t?void 0:t.id)===x;return(0,n.jsx)(th,{...s,element:i,isSelected:r,isMultiSelected:A.length>1,isLastItem:eN.has(i.id),status:s.isBranch?v.folders[i.id].status:"idle",onMultiSelect:tl,onSelectCreate:()=>{if(m&&h){let e=(0,eq.wI)({id:(0,e3.Z)(),name:eJ.$C,owner_id:null==m?void 0:m.id,project_id:null==h?void 0:h.id,folder_id:i.id,sql:""});v.addSnippet({projectRef:h.ref,snippet:e}),p.push("/project/".concat(f,"/sql/").concat(e.id))}},onSelectDelete:()=>{s.isBranch?J(i.metadata):(Z(!0),0===A.length&&D([i.metadata]))},onSelectRename:()=>{s.isBranch?v.editFolder(i.id):(L(!0),V(i.metadata))},onSelectMove:()=>{C(!0),0===A.length&&D([i.metadata])},onSelectDownload:()=>$(i.metadata),onSelectDuplicate:()=>tr(i.metadata),onSelectShare:()=>R(i.metadata),onEditSave:e=>{0===e.length&&"new-folder"===i.id?v.removeFolder(i.id):e.length>0&&v.saveFolder({id:i.id,name:e})},hasNextPage:es,fetchNextPage:ea,isFetchingNextPage:el,sort:u,onFolderContentsChange:e=>{let{isLoading:t,snippets:n}=e;eu(e=>({...e,[i.id]:{snippets:n,isLoading:t}}))}})}})})]}),(0,n.jsx)(e6.Z,{}),(0,n.jsx)(eY,{snippet:T,visible:_,onCancel:()=>L(!1),onComplete:()=>L(!1)}),(0,n.jsx)(eU,{snippets:A,visible:q,onClose:()=>{C(!1),D([])}}),(0,n.jsx)(eC,{id:null!==(c=null==B?void 0:B.id)&&void 0!==c?c:"",visible:void 0!==B,onCancel:()=>$(void 0)}),(0,n.jsx)(k.Z,{size:"medium",loading:eG,title:"Confirm to share query: ".concat(null==O?void 0:O.name),confirmLabel:"Share query",confirmLabelLoading:"Sharing query",visible:void 0!==O,onCancel:()=>R(void 0),onConfirm:()=>ts("share"),alert:{title:"This SQL query will become public to all team members",description:"Anyone with access to the project can view it"},children:(0,n.jsxs)("ul",{className:"text-sm text-foreground-light space-y-5",children:[(0,n.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,n.jsx)(ef.Z,{size:16}),(0,n.jsx)("span",{children:"Project members will have read-only access to this query."})]}),(0,n.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,n.jsx)(ex.Z,{size:16}),(0,n.jsx)("span",{children:"Anyone will be able to duplicate it to their personal snippets."})]})]})}),(0,n.jsx)(k.Z,{size:"medium",title:"Confirm to unshare query: ".concat(null==I?void 0:I.name),confirmLabel:"Unshare query",confirmLabelLoading:"Unsharing query",visible:void 0!==I,onCancel:()=>U(void 0),onConfirm:()=>ts("unshare"),alert:{title:"This SQL query will no longer be public to all team members",description:"Only you will have access to this query"},children:(0,n.jsx)("ul",{className:"text-sm text-foreground-light space-y-5",children:(0,n.jsxs)("li",{className:"flex gap-3",children:[(0,n.jsx)(ev.Z,{}),(0,n.jsx)("span",{children:"Project members will no longer be able to view this query."})]})})}),(0,n.jsx)(k.Z,{size:"small",title:"Confirm to delete ".concat(1===A.length?"query":"".concat(A.length.toLocaleString()," quer").concat(A.length>1?"ies":"y")),confirmLabel:"Delete ".concat(A.length.toLocaleString()," quer").concat(A.length>1?"ies":"y"),confirmLabelLoading:"Deleting query",loading:e2,visible:P,variant:"destructive",onCancel:()=>{Z(!1),D([])},onConfirm:()=>{if(!f)return console.error("Project ref is required");eX({projectRef:f,ids:A.map(e=>e.id)},{onSuccess:e=>{d.Am.success("Successfully deleted ".concat(A.length.toLocaleString()," quer").concat(A.length>1?"ies":"y")),tn(e)}})},alert:(null===(i=A[0])||void 0===i?void 0:i.visibility)==="project"?{title:"This SQL snippet will be lost forever",description:"Deleting this query will remove it for all members of the project team."}:void 0,children:(0,n.jsxs)("p",{className:"text-sm",children:["This action cannot be undone."," ",1===A.length?"Are you sure you want to delete '".concat(null===(s=A[0])||void 0===s?void 0:s.name,"'?"):"Are you sure you want to delete the selected ".concat(A.length," quer").concat(A.length>1?"ies":"y","?")]})}),(0,n.jsx)(k.Z,{size:"small",title:"Confirm to delete folder",confirmLabel:"Delete folder",confirmLabelLoading:"Deleting folder",loading:ti,visible:void 0!==Y,variant:"destructive",onCancel:()=>J(void 0),onConfirm:ta,alert:{title:"This action cannot be undone",description:"All SQL snippets within the folder will be permanently removed, and cannot be recovered."},children:(0,n.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete the folder '",null==Y?void 0:Y.name,"'?"]})})]})},tv=()=>{let e=(0,K.useRouter)(),{profile:t}=(0,Q.Un)(),i=(0,N.Vm)(),{ref:s}=(0,z.UO)(),r=(0,W.B0)(),[a,l]=(0,o.useState)(""),[c,u]=(0,o.useState)(!1),[p,m]=(0,M._)(S.dA.SQL_EDITOR_SORT(null!=s?s:""),"inserted_at"),h=(0,E.Mb)(),f=(0,R.Nr)(a,500),x=(0,I.Xo)(O.KA.CREATE,"user_content",{resource:{type:"sql",owner_id:null==t?void 0:t.id},subject:{id:null==t?void 0:t.id}}),v=()=>{if(!s)return console.error("Project ref is required");l(""),u(!1),r.addNewFolder({projectRef:s})},g=async()=>{if(!s)return console.error("Project ref is required");if(!i)return console.error("Project is required");if(!t)return console.error("Profile is required");if(!x)return(0,d.Am)("Your queries will not be saved as you do not have sufficient permissions");try{e.push("/project/".concat(s,"/sql/new?skip=true")),l(""),u(!1)}catch(e){d.Am.error("Failed to create new query: ".concat(e.message))}};return(0,o.useEffect)(()=>{u(f.length>0)},[f]),(0,n.jsxs)("div",{className:"h-full flex flex-col justify-between",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-4 flex-grow",children:[(0,n.jsxs)("div",{className:"mt-4 mx-4 flex items-center justify-between gap-x-2",children:[(0,n.jsx)(G.nM,{className:"w-full p-0 gap-0",children:(0,n.jsx)(G.nn,{name:"search-queries",placeholder:"Search queries...","aria-labelledby":"Search queries",value:a,onChange:e=>{let t=e.target.value;l(t),0===t.length&&u(!1)},onKeyDown:e=>{"Escape"===e.code&&(l(""),u(!1))},children:c?(0,n.jsxs)(L.u,{children:[(0,n.jsx)(L.aJ,{className:"absolute right-1 top-[.4rem] md:top-[.3rem] transition-colors text-foreground-light hover:text-foreground",onClick:()=>{l(""),u(!1)},children:(0,n.jsx)(U.Z,{size:18})}),(0,n.jsx)(L._v,{children:"Clear search"})]}):(0,n.jsxs)(G.ZY,{value:p,onValueChange:e=>m(e),children:[(0,n.jsx)(G.IR,{value:"name",children:"Alphabetical"},"name"),(0,n.jsx)(G.IR,{value:"inserted_at",children:"Created At"},"inserted_at")]})})}),(0,n.jsxs)($.h_,{children:[(0,n.jsx)($.$F,{asChild:!0,children:(0,n.jsx)(P.z,{type:"default",icon:(0,n.jsx)(T.Z,{className:"text-foreground"}),className:"w-[26px]"})}),(0,n.jsxs)($.AW,{align:"end",side:"bottom",className:"w-48",children:[(0,n.jsxs)($.Xi,{className:"gap-x-2",onClick:()=>g(),children:[(0,n.jsx)(V.Z,{size:14}),"Create a new snippet"]}),(0,n.jsxs)($.Xi,{className:"gap-x-2",onClick:()=>v(),children:[(0,n.jsx)(B.Z,{size:14}),"Create a new folder"]})]})]})]}),c?(0,n.jsx)(ep,{search:f}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J,{}),(0,n.jsx)(tx,{sort:p})]})]}),(0,n.jsx)("div",{className:"p-4 border-t sticky bottom-0 bg-studio",children:(0,n.jsx)(P.z,{block:!0,type:"default",onClick:()=>h.setOnGoingQueriesPanelOpen(!0),children:"View running queries"})})]})};var tg=(0,A.Q)(e=>{let{title:t,children:i}=e,s=(0,o.useMemo)(()=>(0,n.jsx)(tv,{},"sql-editor-menu"),[]);return(0,n.jsxs)(D.Z,{title:t||"SQL",product:"SQL Editor",productMenu:s,isBlocking:!1,resizableSidebar:!0,children:[i,(0,n.jsx)(F,{})]})})},13456:function(e,t,i){var n=i(97458),s=i(52983),r=i(95293);let a=(0,s.memo)(function(){return(0,n.jsx)("div",{className:"px-4 flex flex-col gap-0",children:[{width:"w-40",opacity:"opacity-100"},{width:"w-32",opacity:"opacity-100"},{width:"w-20",opacity:"opacity-75"},{width:"w-40",opacity:"opacity-50"},{width:"w-20",opacity:"opacity-25"}].map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-row h-6 items-center gap-3 ".concat(e.opacity),children:[(0,n.jsx)(r.O,{className:"h-4 w-5"}),(0,n.jsx)(r.O,{className:"h-4 ".concat(e.width)})]},t))})});t.Z=a},3297:function(e,t,i){i.d(t,{z:function(){return d}});var n=i(36457),s=i(64618),r=i(34549),a=i(129),l=i(97526);async function o(e,t){let{projectRef:i,ids:n}=e,{data:s,error:r}=await (0,a.IV)("/platform/projects/{ref}/content",{headers:{Version:"2"},params:{path:{ref:i},query:{ids:n}},signal:t});return r&&(0,a.S3)(r),s.map(e=>e.id)}let d=function(){let{onSuccess:e,onError:t,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,n.NL)();return(0,s.D)(e=>o(e),{async onSuccess(t,i,n){let{projectRef:s}=i;await a.invalidateQueries(l.$.allContentLists(s)),await (null==e?void 0:e(t,i,n))},async onError(e,i,n){void 0===t?r.Am.error("Failed to delete contents: ".concat(e.message)):t(e,i,n)},...i})}},1042:function(e,t,i){i.d(t,{A:function(){return a},N:function(){return l}});var n=i(28894),s=i(129),r=i(97526);async function a(e,t){let{projectRef:i,id:n}=e;if(void 0===i)throw Error("projectRef is required");if(void 0===n)throw Error("Content ID is required");let{data:r,error:a}=await (0,s.U2)("/platform/projects/{ref}/content/item/{id}",{params:{path:{ref:i,id:n}},signal:t});if(a)throw(0,s.S3)(a);return r}let l=function(e){let{projectRef:t,id:i}=e,{enabled:s=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(r.$.resource(t,i),e=>{let{signal:n}=e;return a({projectRef:t,id:i},n)},{enabled:s&&void 0!==t&&void 0!==i,...l})}},99445:function(e,t,i){i.d(t,{KJ:function(){return a},md:function(){return o}});var n=i(90688),s=i(129),r=i(97526);let a=100;async function l(e,t){let{projectRef:i,cursor:n,sort:r,name:l}=e;if(void 0===i)throw Error("projectRef is required");let{data:o,error:d}=await (0,s.U2)("/platform/projects/{ref}/content/folders",{params:{path:{ref:i},query:{type:"sql",cursor:n,limit:a.toString(),sort_by:r,sort_order:"name"===r?"asc":"desc",name:l,visibility:"user"}},signal:t});return d&&(0,s.S3)(d),{...o.data,cursor:o.cursor}}let o=function(e){let{projectRef:t,name:i,sort:s}=e,{enabled:a=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.N)(r.$.folders(t,{name:i,sort:s}),e=>{let{signal:n,pageParam:r}=e;return l({projectRef:t,cursor:r,name:i,sort:s},n)},{enabled:a&&void 0!==t,getNextPageParam:e=>e.cursor,...o})}},35682:function(e,t,i){i.d(t,{v:function(){return o}});var n=i(90688),s=i(129),r=i(97526),a=i(99445);async function l(e,t){let{projectRef:i,cursor:n,visibility:r,favorite:l,name:o,sort:d}=e;if(void 0===i)throw Error("projectRef is required for getSqlSnippets");let{data:c,error:u}=await (0,s.U2)("/platform/projects/{ref}/content",{params:{path:{ref:i},query:{type:"sql",cursor:n,visibility:r,favorite:l,name:o,limit:a.KJ.toString(),sort_by:d,sort_order:"name"===d?"asc":"desc"}},signal:t});if(u)throw u;return{cursor:c.cursor,contents:c.data}}let o=function(e){let{projectRef:t,sort:i,name:s,visibility:a,favorite:o}=e,{enabled:d=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.N)(r.$.sqlSnippets(t,{sort:i,name:s,visibility:a,favorite:o}),e=>{let{signal:n,pageParam:r}=e;return l({projectRef:t,cursor:r,sort:i,name:s,visibility:a,favorite:o},n)},{enabled:d&&void 0!==t,getNextPageParam:e=>e.cursor,...c})}},54343:function(e,t,i){var n=i(97458),s=i(77317),r=i(52983),a=i(92334);let l=e=>{var t,i,l;let{defaultActiveId:o,activeId:d,type:c="pills",size:u="tiny",block:p,onChange:m,onClick:h,scrollable:f,wrappable:x,addOnBefore:v,addOnAfter:g,listClassNames:j,baseClassNames:y,refs:b,children:N}=e,w=r.Children.toArray(N),[S,q]=(0,r.useState)(null!==(l=null!=d?d:o)&&void 0!==l?l:null==w?void 0:null===(i=w[0])||void 0===i?void 0:null===(t=i.props)||void 0===t?void 0:t.id);(0,r.useMemo)(()=>{d&&d!==S&&q(d)},[d]);let C=(0,a.Z)("tabs");function P(e){null==h||h(e),e!==S&&(null==m||m(e),q(e))}let Z=[C[c].list];return f&&Z.push(C.scrollable),x&&Z.push(C.wrappable),j&&Z.push(j),(0,n.jsxs)(s.fC,{value:S,className:[C.base,y].join(" "),ref:null==b?void 0:b.base,children:[(0,n.jsxs)(s.aV,{className:Z.join(" "),ref:null==b?void 0:b.list,children:[v,w.map(e=>{let t=S===e.props.id,i=[C[c].base,C.size[u]];return t?i.push(C[c].active):i.push(C[c].inactive),p&&i.push(C.block),(0,n.jsxs)(s.xz,{onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),P(e.props.id))},onClick:()=>P(e.props.id),value:e.props.id,className:i.join(" "),children:[e.props.icon,(0,n.jsx)("span",{children:e.props.label}),e.props.iconRight]},"".concat(e.props.id,"-tab-button"))}),g]}),w]})};l.Panel=e=>{let{children:t,id:i,className:r}=e,l=(0,a.Z)("tabs");return(0,n.jsx)(s.VY,{value:i,className:[l.content,r].join(" "),children:t})},t.Z=l}}]);