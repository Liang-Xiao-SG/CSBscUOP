(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9173],{76:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/advisors/query-performance",function(){return n(80487)}])},96567:function(e,t,n){"use strict";n.d(t,{TZ:function(){return u},V$:function(){return i},cr:function(){return d},j5:function(){return l},sU:function(){return o}});var s=n(28977),r=n.n(s),a=n(84407);let i=2,o=[{text:"Last 24 hours",calcFrom:()=>r()().subtract(1,"day").startOf("day").toISOString(),calcTo:()=>"",default:!0},{text:"Last 7 days",calcFrom:()=>r()().subtract(7,"day").startOf("day").toISOString(),calcTo:()=>""},{text:"Last 14 days",calcFrom:()=>r()().subtract(14,"day").startOf("day").toISOString(),calcTo:()=>""},{text:"Last 30 days",calcFrom:()=>r()().subtract(30,"day").startOf("day").toISOString(),calcTo:()=>""}],l={iso_timestamp_start:o[0].calcFrom(),iso_timestamp_end:o[0].calcTo()},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(0===e.length)return"";let n=e.map(e=>{let t=e.key.split("."),n=[t[t.length-2],t[t.length-1]].join("."),s=e.key.includes(".")?n:e.key;return"matches"===e.compare?"REGEXP_CONTAINS(".concat(s,", '").concat(e.value,"')"):"is"===e.compare?"".concat(s," = ").concat(e.value):void 0}).join(" AND ");return t?"WHERE "+n:"AND "+n},d={[a.s.API]:{title:"API",queries:{totalRequests:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          count(t.id) as count\n        FROM edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC")},topRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          count desc\n        limit 10\n        ")},errorCounts:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          count(t.id) as count\n        FROM edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        WHERE\n          response.status_code >= 400\n        ".concat(c(e,!1),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n        ")},topErrorRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        where\n          response.status_code >= 400\n        ".concat(c(e,!1),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          count desc\n        limit 10\n        ")},responseSpeed:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          avg(response.origin_time) as avg\n        FROM\n          edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n      ")},topSlowRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count,\n          avg(response.origin_time) as avg\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        ".concat(c(e),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          avg desc\n        limit 10\n        ")},networkTraffic:{queryType:"logs",sql:e=>'\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          coalesce(\n            safe_divide(\n              sum(\n                cast(coalesce(headers.content_length, "0") as int64)\n              ),\n              1000000\n            ),\n            0\n          ) as ingress_mb,\n          coalesce(\n            safe_divide(\n              sum(\n                cast(coalesce(resp_headers.content_length, "0") as int64)\n              ),\n              1000000\n            ),\n            0\n          ) as egress_mb,\n        FROM\n          edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          cross join unnest(response.headers) as resp_headers\n          '.concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n        ")}}},[a.s.AUTH]:{title:"",queries:{}},[a.s.STORAGE]:{title:"Storage",queries:{cacheHitRate:{queryType:"logs",sql:e=>"\n-- cache-hit-rate\nSELECT\n  timestamp_trunc(timestamp, hour) as timestamp,\n  countif( h.cf_cache_status in ('HIT', 'STALE', 'REVALIDATED', 'UPDATING') ) as hit_count,\n  countif( h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC') ) as miss_count\nfrom edge_logs f\n  cross join unnest(f.metadata) as m\n  cross join unnest(m.request) as r\n  cross join unnest(m.response) as res\n  cross join unnest(res.headers) as h\nwhere starts_with(r.path, '/storage/v1/object') and r.method = 'GET'\ngroup by timestamp\norder by timestamp desc\n"},topCacheMisses:{queryType:"logs",sql:e=>"\n-- top-cache-misses\nSELECT\n  r.path as path,\n  r.search as search,\n  count(id) as count\nfrom edge_logs f\n  cross join unnest(f.metadata) as m\n  cross join unnest(m.request) as r\n  cross join unnest(m.response) as res\n  cross join unnest(res.headers) as h\nwhere starts_with(r.path, '/storage/v1/object') \n  and r.method = 'GET'\n  and h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC')\ngroup by path, search\norder by count desc\nlimit 12\n    "}}},[a.s.QUERY_PERFORMANCE]:{title:"Query performance",queries:{mostFrequentlyInvoked:{queryType:"db",sql:(e,t,n)=>"\n-- Most frequently called queries\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by statements.calls desc","\n  limit 20;")},mostTimeConsuming:{queryType:"db",sql:(e,t,n)=>"\n-- Most time consuming queries\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    to_char(((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) OVER()) * 100, 'FM90D0') || '%'  AS prop_total_time\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by total_time desc","\n  limit 20;")},slowestExecutionTime:{queryType:"db",sql:(e,t,n)=>"\n-- Slowest queries by max execution time\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by max_time desc","\n  limit 20")},queryHitRate:{queryType:"db",sql:e=>"-- Cache and index hit rate\nselect\n    'index hit rate' as name,\n    (sum(idx_blks_hit)) / nullif(sum(idx_blks_hit + idx_blks_read),0) as ratio\n  from pg_statio_user_indexes\n  union all\n  select\n    'table hit rate' as name,\n    sum(heap_blks_hit) / nullif(sum(heap_blks_hit) + sum(heap_blks_read),0) as ratio\n  from pg_statio_user_tables;"}}},[a.s.DATABASE]:{title:"database",queries:{largeObjects:{queryType:"db",sql:e=>"SELECT \n        SCHEMA_NAME,\n        relname,\n        table_size\n      FROM\n        (SELECT \n          pg_catalog.pg_namespace.nspname AS SCHEMA_NAME,\n          relname,\n          pg_total_relation_size(pg_catalog.pg_class.oid) AS table_size\n        FROM pg_catalog.pg_class\n        JOIN pg_catalog.pg_namespace ON relnamespace = pg_catalog.pg_namespace.oid\n        ) t\n      WHERE SCHEMA_NAME NOT LIKE 'pg_%'\n      ORDER BY table_size DESC\n      LIMIT 5;"}}}},u=["total_realtime_ingress","total_rest_options_requests","total_auth_ingress","total_auth_get_requests","total_auth_post_requests","total_auth_patch_requests","total_auth_options_requests","total_storage_options_requests","total_storage_patch_requests","total_options_requests"]},84407:function(e,t,n){"use strict";var s,r;n.d(t,{s:function(){return s}}),(r=s||(s={})).API="api",r.STORAGE="storage",r.AUTH="auth",r.QUERY_PERFORMANCE="query_performance",r.DATABASE="database"},42135:function(e,t,n){"use strict";n.d(t,{H:function(){return i},u:function(){return a}});var s=n(54016),r=n(20196);let a=e=>Object.fromEntries(new URLSearchParams(e)),i=(e,t)=>Object.entries(e).reduce((e,n)=>{let[a,{sql:i,queryType:o}]=n;return"db"===o?{...e,[a]:()=>(0,s.Z)({sql:i})}:{...e,[a]:()=>(0,r.Z)(t)}},{})},50048:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var s=n(97458),r=n(32691),a=n(4879),i=n(289),o=n(76026),l=n(15631);let c=e=>{var t;let n=null!==(t=null==e?void 0:e.ref)&&void 0!==t?t:"default";return[{title:"Advisors",items:[{name:"Security Advisor",key:"security",url:"/project/".concat(n,"/advisors/security"),items:[]},{name:"Performance Advisor",key:"performance",url:"/project/".concat(n,"/advisors/performance"),items:[]},{name:"Query Performance",key:"query-performance",url:"/project/".concat(n,"/advisors/query-performance"),items:[]}]}]};var d=(0,o.Q)(e=>{let{children:t}=e,n=(0,i.Vm)(),o=(0,r.useRouter)().pathname.split("/")[4];return(0,s.jsx)(l.Z,{isLoading:!1,product:"Advisors",productMenu:(0,s.jsx)(a.Q,{page:o,menu:c(n)}),children:t})})},38057:function(e,t,n){"use strict";n.d(t,{Z:function(){return N}});var s=n(97458),r=n(73512),a=n(26328),i=n(78859),o=n(88803),l=n(3666),c=n(7350),d=n(16696),u=n(65206),m=n(83145),p=n.n(m),x=n(32691),h=n(52983),f=n(56535),g=n(43633),v=n(53486),y=n(78978),j=n(95909),_=()=>{let e=(0,x.useRouter)(),[t,n]=(0,h.useState)(!1),{ref:a}=(0,r.UO)();return(0,s.jsxs)("div",{className:"h-14 w-full flex flex-row md:hidden",children:[(0,s.jsxs)("nav",{className:(0,g.cn)("group px-4 z-10 w-full h-14","border-b bg-dash-sidebar border-default shadow-xl","transition-width duration-200","hide-scrollbar flex flex-row items-center justify-between overflow-x-auto"),children:[(0,s.jsx)(p(),{href:f.Qy?"/projects":"/project/".concat(a),className:"flex items-center h-[26px] w-[26px] min-w-[26px]",children:(0,s.jsx)("img",{alt:"Supabase",src:"".concat(e.basePath,"/img/supabase-logo.svg"),className:"absolute h-[26px] w-[26px] cursor-pointer rounded"})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(y.av,{children:(0,s.jsx)("button",{className:(0,g.cn)("group","flex-grow h-[30px] rounded-md","p-2","flex items-center justify-between","bg-transparent border-none text-foreground-lighter","hover:bg-opacity-100 hover:border-strong hover:text-foreground-light","focus-visible:!outline-4 focus-visible:outline-offset-1 focus-visible:outline-brand-600","transition"),children:(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsx)(d.Z,{size:18,strokeWidth:2})})})}),(0,s.jsx)("button",{title:"Menu dropdown button",className:(0,g.cn)((0,v.d)({type:"default"}),"flex lg:hidden border-default bg-surface-100/75 text-foreground-light rounded-md min-w-[30px] w-[30px] h-[30px] data-[state=open]:bg-overlay-hover/30"),onClick:()=>n(!0),children:(0,s.jsx)(u.Z,{size:18,strokeWidth:1})})]})]}),(0,s.jsx)(j.Z,{open:t,onOpenChange:n,"data-state":"expanded",children:(0,s.jsx)(o.TZ,{})})]})},b=n(32672),N=e=>{let{children:t,showProductMenu:n}=e,{ref:d}=(0,r.UO)();return(0,s.jsx)(l.Hn,{defaultOpen:!1,children:(0,s.jsx)(b.Ml,{projectRef:d,children:(0,s.jsx)(i.EA,{children:(0,s.jsxs)("div",{className:"flex flex-col h-screen w-screen",children:[(0,s.jsx)(a.l,{}),(0,s.jsxs)("div",{className:"flex-shrink-0",children:[(0,s.jsx)(_,{}),(0,s.jsx)(c.N,{showProductMenu:n})]}),(0,s.jsxs)("div",{className:"flex flex-1 w-full overflow-y-hidden",children:[(0,s.jsx)(o.YE,{}),(0,s.jsx)("div",{className:"flex-grow h-full overflow-y-auto",children:t})]})]})})})})}},1511:function(e,t,n){"use strict";n.d(t,{z:function(){return x}});var s=n(97458),r=n(15647),a=n(11968),i=n(32024),o=n(81307),l=n(52983),c=n(84012),d=n(34549),u=n(6433),m=n(15011),p=n(53486);let x=e=>{let{type:t="default",align:n="start",results:x,fileName:h,onDownloadAsCSV:f,onCopyAsMarkdown:g,onCopyAsJSON:v}=e,y=(0,l.useRef)(null),j=x.map(e=>{let t={...e};return Object.keys(e).forEach(n=>{"object"==typeof e[n]&&(t[n]=JSON.stringify(e[n]))}),t}),_=(0,l.useMemo)(()=>{if(x){let e=Array.from(x)[0];if(e)return Object.keys(e)}},[x]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(m.h_,{children:[(0,s.jsx)(m.$F,{asChild:!0,children:(0,s.jsx)(p.z,{type:t,iconRight:(0,s.jsx)(r.Z,{}),disabled:0===x.length,children:"Export"})}),(0,s.jsxs)(m.AW,{align:n,className:"w-44",children:[(0,s.jsxs)(m.Xi,{className:"gap-x-2",onClick:()=>{var e;null===(e=y.current)||void 0===e||e.link.click(),d.Am.success("Downloading results as CSV"),null==f||f()},children:[(0,s.jsx)(a.Z,{size:14}),(0,s.jsx)("p",{children:"Download CSV"})]}),(0,s.jsxs)(m.Xi,{onClick:()=>{if(navigator){0==j.length&&(0,d.Am)("Results are empty");let e=Object.keys(j[0]),t=j.map(t=>{let n=[];return e.forEach(e=>n.push(t[e])),n}),n=[e].concat(t),s=(0,o.x)(n);(0,u.vQ)(s,()=>{d.Am.success("Copied results to clipboard"),null==g||g()})}},className:"gap-x-2",children:[(0,s.jsx)(i.Z,{size:14}),(0,s.jsx)("p",{children:"Copy as markdown"})]}),(0,s.jsxs)(m.Xi,{onClick:()=>{if(navigator){if(0===x.length)return(0,d.Am)("Results are empty");(0,u.vQ)(JSON.stringify(x,null,2),()=>{d.Am.success("Copied results to clipboard"),null==v||v()})}},className:"gap-x-2",children:[(0,s.jsx)(i.Z,{size:14}),(0,s.jsx)("p",{children:"Copy as JSON"})]})]})]}),(0,s.jsx)(c.CSVLink,{ref:y,className:"hidden",headers:_,data:j,filename:"".concat(h,".csv")})]})}},17209:function(e,t,n){"use strict";n.d(t,{E:function(){return u}});var s=n(97458),r=n(52983),a=n(12753),i=n(53486),o=n(43633),l=n(12361),c=n(5562),d=n(7257);let u=e=>{let{title:t,options:n=[],activeOptions:u=[],valueKey:m,labelKey:p,iconKey:x="icon",name:h="default",variant:f="rectangular",buttonType:g,disabled:v,labelClass:y,className:j,maxHeightClass:_="h-[205px]",clearButtonText:b="Clear",onSaveFilters:N}=e,[w,q]=(0,r.useState)(!1),[E,S]=(0,r.useState)([]),C=u.map(e=>{let t=n.find(t=>t[m]===e);return t&&t[p]?t[p]:""});return(0,r.useEffect)(()=>{!w&&u.length>0&&S(u)},[w,u]),(0,s.jsxs)(a.J2,{open:w,onOpenChange:q,children:[(0,s.jsx)(a.xo,{asChild:!0,children:(0,s.jsx)(i.z,{asChild:!0,disabled:v,type:null!=g?g:u.length>0?"default":"dashed",onClick:()=>q(!1),className:"rounded"===f?"rounded-full":"",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:h}),u.length>0&&(0,s.jsx)("span",{className:"mr-1",children:":"}),u.length>=3?(0,s.jsxs)("span",{children:[C[0]," and ",u.length-1," others"]}):u.length>0?(0,s.jsx)("span",{children:C.join(", ")}):null]})})}),(0,s.jsxs)(a.yk,{className:(0,o.cn)("p-0 w-44",j),align:"start",children:[(0,s.jsx)("div",{className:"border-b border-overlay bg-surface-200 rounded-t pb-1 px-3",children:(0,s.jsx)("span",{className:"text-xs text-foreground-light",children:null!=t?t:"Select ".concat(h.toLowerCase())})}),(0,s.jsx)(l.xr,{className:n.length>7?_:"",children:(0,s.jsx)("div",{className:"p-3 flex flex-col gap-y-2",children:n.map(e=>{let t=e[m],n=x?e[x]:void 0;return(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(c.X,{id:t,checked:E.includes(t),onCheckedChange:()=>{E.includes(t)?S(E.filter(e=>e!==t)):S(E.concat(t))}}),(0,s.jsxs)(d._,{htmlFor:e[m],className:(0,o.cn)("flex items-center gap-x-2 text-xs",y),children:[n&&(0,s.jsx)("img",{src:n,alt:e[p],className:(0,o.cn)("w-4 h-4",e.iconClass)}),(0,s.jsx)("span",{children:e[p]})]})]},t)})})}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,s.jsx)(i.z,{size:"tiny",type:"default",onClick:()=>{N([]),S([]),q(!1)},children:b}),(0,s.jsx)(i.z,{type:"primary",onClick:()=>{let e=n.map(e=>e[m]);N(E.sort((t,n)=>e.indexOf(t)-e.indexOf(n))),q(!1)},children:"Save"})]})]})]})}},55527:function(e,t,n){"use strict";n.d(t,{p:function(){return i}});var s=n(97458),r=n(43633),a=n(27477);let i=e=>{let{title:t,description:n,docsUrl:i,actions:o,className:l}=e;return(0,s.jsxs)("div",{className:(0,r.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(l)),children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),n&&(0,s.jsx)("div",{className:"prose text-sm max-w-full",children:n})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==i&&(0,s.jsx)(a.G,{href:i}),o]})]})}},74172:function(e,t,n){"use strict";var s=n(97458),r=n(83145),a=n.n(r),i=n(33880),o=n(33971),l=n(53486);t.Z=e=>{let{name:t="",isActive:n,isExternal:r,icon:c,rightIcon:d,url:u="",target:m="_self",onClick:p,textClassName:x="",hoverText:h="",label:f}=e,g=(0,s.jsx)(i.ZP.Item,{icon:c,rounded:!0,active:n,onClick:p,children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,s.jsxs)("div",{title:h||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+x,children:[(0,s.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==f&&(0,s.jsx)(o.C,{variant:"warning",className:"py-0 px-1.5 capitalize",children:f})]}),d&&(0,s.jsx)("div",{children:d})]})});return u?r?(0,s.jsx)(l.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,s.jsx)(a(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,s.jsx)(a(),{href:u,className:"block",target:m,children:g}):g}},4879:function(e,t,n){"use strict";n.d(t,{Q:function(){return o}});var s=n(97458),r=n(33880),a=n(33971),i=n(74172),o=e=>{let{page:t,menu:n}=e;return(0,s.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto",children:(0,s.jsx)(r.ZP,{type:"pills",children:n.map((e,o)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"my-6 space-y-8",children:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(r.ZP.Group,{title:e.title?(0,s.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,s.jsx)("span",{children:e.title}),e.isPreview&&(0,s.jsx)(a.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,s.jsx)("div",{children:e.items.map(e=>{let n=e.pages?e.pages.includes(t):t===e.key;return(0,s.jsx)(i.Z,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:n,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key)})})]})}),o!==n.length-1&&(0,s.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},24605:function(e,t,n){"use strict";n.d(t,{k:function(){return d}});var s=n(36457),r=n(64618),a=n(34549),i=n(129),o=n(70864),l=n(39310);async function c(e){let{projectRef:t,connectionString:n,schema:s,name:r,version:a,cascade:l=!1,createSchema:c=!1}=e,d=new Headers;if(n&&d.set("x-connection-encrypted",n),c)try{await (0,o.R)({projectRef:t,connectionString:n,sql:"create schema if not exists ".concat(s)})}catch(e){throw e}let{data:u,error:m}=await (0,i.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{schema:s,name:r,version:a,cascade:l},headers:d});return m&&(0,i.S3)(m),u}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,s.NL)();return(0,r.D)(e=>c(e),{async onSuccess(t,n,s){let{projectRef:r}=n;await i.invalidateQueries(l.o.list(r)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?a.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,n,s)},...n})}},31723:function(e,t,n){"use strict";n.d(t,{H:function(){return c}});var s=n(28894),r=n(129),a=n(39310),i=n(289),o=n(56535);async function l(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let a=new Headers;s&&a.set("x-connection-encrypted",s);let{data:i,error:o}=await (0,r.U2)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:a,signal:t});return o&&(0,r.S3)(o),i}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:r=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=(0,i.Vm)(),u=(null==d?void 0:d.status)===o.S.ACTIVE_HEALTHY;return(0,s.a)(a.o.list(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:r&&void 0!==t&&u,...c})}},80070:function(e,t,n){"use strict";n.d(t,{fA:function(){return d},x4:function(){return c}});var s=n(4330),r=n(28894),a=n(70864),i=n(99345);let o=s.Z.roles.list();async function l(e,t){let{projectRef:n,connectionString:s}=e,{result:r}=await (0,a.R)({projectRef:n,connectionString:s,sql:o.sql,queryKey:["database-roles"]},t);return r}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.a)(i.E.databaseRoles(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:s&&void 0!==t,...a})};function d(e,t){return e.invalidateQueries(i.E.databaseRoles(t))}},54016:function(e,t,n){"use strict";var s=n(28894),r=n(96567),a=n(32672),i=n(18505),o=n(70864),l=n(80342);t.Z=e=>{var t;let{sql:n,params:c=r.j5,where:d,orderBy:u}=e,{project:m}=(0,a.d2)(),p=(0,l.TF)(),{data:x}=(0,i.bN)({projectRef:null==m?void 0:m.ref}),h=null===(t=(x||[]).find(e=>e.identifier===p.selectedDatabaseId))||void 0===t?void 0:t.connectionString,f=p.selectedDatabaseId,g="function"==typeof n?n([]):n,{data:v,error:y,isLoading:j,isRefetching:_,refetch:b}=(0,s.a)(["projects",null==m?void 0:m.ref,"db",{...c,sql:g,identifier:f},d,u],e=>{let{signal:t}=e;return(0,o.R)({projectRef:null==m?void 0:m.ref,connectionString:h||(null==m?void 0:m.connectionString),sql:g},t).then(e=>e.result)},{enabled:!!g,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return{error:y||("object"==typeof v?null==v?void 0:v.error:""),data:v,isLoading:j,isRefetching:_,params:c,runQuery:b,resolvedSql:g}}},20196:function(e,t,n){"use strict";var s=n(28894),r=n(52983),a=n(73512),i=n(61249),o=n(23664),l=n(129);t.Z=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=!(arguments.length>2)||void 0===arguments[2]||arguments[2],d=(0,i.PJ)(i.up),[u,m]=(0,r.useState)({sql:(null==n?void 0:n.sql)||"",project:e,iso_timestamp_start:n.iso_timestamp_start?n.iso_timestamp_start:d.calcFrom(),iso_timestamp_end:n.iso_timestamp_end?n.iso_timestamp_end:d.calcTo()}),p=c&&void 0!==e&&!!u.sql,x=(0,o.HJ)(u.sql||""),h=(0,o.Ir)(u.sql||""),{data:f,error:g,isLoading:v,isRefetching:y,refetch:j}=(0,s.a)(["projects",e,"logs",u],async t=>{let{signal:n}=t,{data:s,error:r}=await (0,l.U2)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:e},query:u},signal:n});if(r)throw r;return s},{enabled:p,refetchOnWindowFocus:!1}),_=g?g.message:null;return!_&&(null==f?void 0:f.error)&&(_=null==f?void 0:f.error),a.Qy&&(x&&(_={message:"The parser does not yet support WITH and subquery statements.",docs:"https://supabase.com/docs/guides/platform/advanced-log-filtering#the-with-keyword-and-subqueries-are-not-supported"}),h&&(_={message:"BigQuery does not support ILIKE. Use REGEXP_CONTAINS instead.",docs:"https://supabase.com/docs/guides/platform/advanced-log-filtering#the-ilike-and-similar-to-keywords-are-not-supported"})),{params:u,isLoading:p&&v||y,logData:null!==(t=null==f?void 0:f.result)&&void 0!==t?t:[],error:_,changeQuery:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";m(t=>({...t,sql:e}))},runQuery:()=>j(),setParams:m}}},80487:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eS}});var s,r,a=n(97458),i=n(32691),o=n(73512),l=n(37173),c=n(11321),d=n(52983),u=n(34549),m=n(32672),p=n(18505),x=n(94218),h=n(70864),f=n(35721),g=n(56535),v=n(80342),y=n(19337),j=n(43633),_=n(50322),b=n(42317),N=n(53486),w=n(15518),q=n(28179),E=n(79663),S=n(96567),C=n(84407),R=n(54016);let k=e=>{let{preset:t,orderBy:n,searchQuery:s="",roles:r}=e,a=S.cr[C.s.QUERY_PERFORMANCE].queries[t],i=[void 0!==r&&r.length>0?"auth.rolname in (".concat(r.map(e=>"'".concat(e,"'")).join(", "),")"):"",s.length>0?"statements.query ~ '".concat(s,"'"):""].filter(e=>e.length>0).join(" AND "),o=n&&"ORDER BY ".concat(n.column," ").concat(n.order),l=a.sql([],i.length>0?"WHERE ".concat(i):void 0,o);return(0,R.Z)({sql:l,params:void 0,where:i,orderBy:o})};(s=r||(r={})).MOST_TIME_CONSUMING="most_time_consuming",s.MOST_FREQUENT="most_frequent",s.SLOWEST_EXECUTION="slowest_execution";let T={most_time_consuming:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180},{id:"prop_total_time",name:"Time consumed",description:void 0,minWidth:150}],most_frequent:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"avg_rows",name:"Avg. Rows",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"max_time",name:"Max time",description:void 0,minWidth:void 0},{id:"mean_time",name:"Mean time",description:void 0,minWidth:void 0},{id:"min_time",name:"Min time",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180}],slowest_execution:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"avg_rows",name:"Avg. Rows",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"max_time",name:"Max time",description:void 0,minWidth:void 0},{id:"mean_time",name:"Mean time",description:void 0,minWidth:void 0},{id:"min_time",name:"Min time",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180}]};var A=n(29360),O=n(15676),I=n(929),F=n(1511),M=n(17209),z=n(80070),Z=n(15011),L=n(12753),P=n(71046);let W=e=>{let{name:t,value:n="",placeholder:s,rows:r=4,onSaveText:i}=e,[o,l]=(0,d.useState)(!1),[c,u]=(0,d.useState)(n),m=()=>{i(c),l(!1)};return(0,a.jsxs)(L.J2,{open:o,onOpenChange:l,modal:!1,children:[(0,a.jsx)(L.xo,{asChild:!0,children:(0,a.jsx)(N.z,{asChild:!0,type:n.length>0?"default":"dashed",onClick:()=>l(!1),children:(0,a.jsxs)("div",{className:"max-w-[170px]",children:[(0,a.jsx)("span",{children:t}),n.length>0&&(0,a.jsx)("span",{className:"mr-1",children:":"}),(0,a.jsx)("span",{className:"truncate",children:n})]})})}),(0,a.jsxs)(L.yk,{className:"p-0",side:"bottom",align:"start",children:[(0,a.jsx)("div",{className:"space-y-4 p-3 min-w-[170px]",children:(0,a.jsx)(P.K,{value:c,onChange:e=>u(e.target.value),rows:r,className:"text-xs font-mono tracking-tight",placeholder:null!=s?s:"Search for a query",onKeyDown:e=>{e.metaKey&&"Enter"===e.code&&m()}})}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,a.jsx)(N.z,{size:"tiny",type:"default",onClick:()=>{i(""),u(""),l(!1)},children:"Clear"}),(0,a.jsx)(N.z,{type:"primary",onClick:()=>m(),children:"Apply search"})]})]})]})},Q=e=>{var t;let{queryPerformanceQuery:n,onResetReportClick:s}=e,r=(0,i.useRouter)(),{ref:l}=(0,o.UO)(),{project:c}=(0,m.d2)(),[u]=(0,f.l)(g.dA.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),p=r.query.search?String(r.query.search):"",x=r.query.roles?r.query.roles:[],h=r.query.sort?{column:r.query.sort,order:r.query.order}:void 0,[v,y]=(0,d.useState)(p),[j,_]=(0,d.useState)({roles:"string"==typeof x?[x]:x,query:""}),[b,w]=(0,d.useState)(null!=h?h:{column:"prop_total_time",order:"desc"}),{isLoading:q,isRefetching:E}=n,{data:S,isLoading:C}=(0,z.x4)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),R=(null!=S?S:[]).sort((e,t)=>e.name.localeCompare(t.name)),k=e=>{w({column:"prop_total_time",order:e}),r.push({...r,query:{...r.query,sort:"prop_total_time",order:e}})};return(0,a.jsxs)("div",{className:"px-6 py-2 bg-surface-200 border-t -mt-px flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex items-center gap-x-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("p",{className:"text-xs prose",children:"Filter by"}),(0,a.jsx)(M.E,{name:"Roles",options:R,labelKey:"name",valueKey:"name",activeOptions:C?[]:j.roles,onSaveFilters:e=>{_({...j,roles:e}),r.push({...r,query:{...r.query,roles:e}})}}),(0,a.jsx)(W,{name:"Query",value:v,onSaveText:e=>{if(y(e),e&&"string"==typeof e)r.push({...r,query:{...r.query,search:e}});else{let{search:e,...t}=r.query;r.push({...r,query:{...t}})}}}),(0,a.jsx)("div",{className:"border-r border-strong h-6"}),(0,a.jsxs)(Z.h_,{children:[(0,a.jsx)(Z.$F,{asChild:!0,children:(0,a.jsx)(N.z,{icon:(null==b?void 0:b.order)==="desc"?(0,a.jsx)(A.Z,{}):(0,a.jsx)(O.Z,{}),children:(null==b?void 0:b.order)==="desc"?"Sorted by latency - high to low":"Sorted by latency - low to high"})}),(0,a.jsx)(Z.AW,{className:"w-56",children:(0,a.jsxs)(Z._x,{value:null==b?void 0:b.order,onValueChange:e=>k(e),children:[(0,a.jsx)(Z.qB,{value:"desc",defaultChecked:(null==b?void 0:b.order)==="desc",children:"Sort by latency - high to low"}),(0,a.jsx)(Z.qB,{value:"asc",defaultChecked:(null==b?void 0:b.order)==="asc",children:"Sort by latency - low to high"})]})})]})]})}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[!u&&s&&(0,a.jsx)(N.z,{type:"default",onClick:()=>s(),children:"Reset report"}),(0,a.jsx)(N.z,{size:"tiny",type:"default",onClick:()=>n.runQuery(),disabled:q||E,icon:(0,a.jsx)(I.Z,{className:"text-foreground-light ".concat(q||E?"animate-spin":"")}),children:"Refresh"}),(0,a.jsx)(F.z,{results:null!==(t=n.data)&&void 0!==t?t:[],fileName:"Supabase Query Performance (".concat(l,")")})]})]})};var U=n(80582),D=n(44914),H=n(38336),V=(n(56476),n(34069)),Y=n(7879),B=n(19405);let G=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{className:(0,j.cn)("flex flex-col gap-y-6 py-4",n),children:t})},X=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{className:(0,j.cn)("px-5 flex flex-col gap-y-2",n),children:t})},K=e=>{let{className:t,name:n,description:s,before:r,after:i,hideArrowMarkers:o=!1}=e;return(0,a.jsxs)("div",{className:(0,j.cn)("py-4 px-4 flex",t),children:[(0,a.jsxs)("div",{className:"flex gap-x-2 w-48",children:[(0,a.jsx)("span",{className:"text-sm",children:n}),(0,a.jsxs)(_.u,{children:[(0,a.jsx)(_.aJ,{asChild:!0,className:"mt-1",children:(0,a.jsx)(l.Z,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light"})}),(0,a.jsx)(_._v,{side:"top",className:"w-52 text-center",children:s})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsxs)("div",{className:"flex gap-x-2 text-sm",children:[(0,a.jsx)("span",{className:"text-foreground-light w-20",children:"Currently:"}),(0,a.jsx)("span",{className:(0,j.cn)("font-mono",void 0!==r&&void 0!==i&&r!==i?"text-foreground-light":""),children:r})]}),void 0!==r&&void 0!==i&&r!==i&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2 text-sm",children:[(0,a.jsx)("span",{className:"text-foreground-light w-20",children:"With index:"}),(0,a.jsx)("span",{className:"font-mono",children:i}),void 0!==r&&!o&&(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[i>r?(0,a.jsx)(O.Z,{size:14,className:"text-warning"}):(0,a.jsx)(A.Z,{size:14,className:"text-brand"}),0!==r&&(0,a.jsxs)("span",{className:(0,j.cn)("font-mono tracking-tighter",i>r?"text-warning":"text-brand"),children:[((r-i)/r*100).toFixed(2),"%"]})]})]})]})]})},J=e=>{let{reportType:t,selectedRow:n,onClickViewSuggestion:s}=e,r=T[t],[i,o]=(0,d.useState)(null==n?void 0:n.query);return(0,d.useEffect)(()=>{void 0!==n&&o((0,V._)(n.query))},[n]),(0,a.jsxs)(G,{children:[(0,a.jsxs)(X,{children:[(0,a.jsx)("p",{className:"text-sm",children:"Query pattern"}),(0,a.jsx)(Y.d,{hideLineNumbers:!0,value:i,language:"sql",className:(0,j.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),!1]}),(0,a.jsx)("div",{className:"border-t"}),(0,a.jsx)(X,{className:"gap-y-1",children:r.filter(e=>"query"!==e.id).map(e=>{let t=e.name.includes("time")?"".concat(null==n?void 0:n[e.id].toFixed(2),"ms"):String(null==n?void 0:n[e.id]);return(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsx)("p",{className:"text-foreground-lighter text-sm w-32",children:e.name}),(0,a.jsx)("p",{className:"text-sm w-32",children:t})]},e.id)})})]})};var $=n(71534),ee=n(9738),et=n(57782),en=n(84261),es=n(31723),er=n(28894),ea=n(63609);async function ei(e){let{projectRef:t,connectionString:n,query:s}=e;if(!t)throw Error("Project ref is required");let r=s.replace(/'/g,"''"),{result:a}=await (0,h.R)({projectRef:t,connectionString:n,sql:"select * from index_advisor('".concat(r,"');")});return a[0]}let eo=function(e){let{projectRef:t,connectionString:n,query:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,er.a)(ea.A.indexAdvisorFromQuery(t,s),()=>ei({projectRef:t,connectionString:n,query:s}),{retry:!1,enabled:r&&void 0!==t&&void 0!==s&&(s.startsWith("select")||s.startsWith("SELECT"))||s.trim().toLowerCase().startsWith("with pgrst_source"),...a})};async function el(e){let{projectRef:t,connectionString:n,query:s}=e;if(!t)throw Error("Project ref is required");try{let{result:e}=await (0,h.R)({projectRef:t,connectionString:n,queryKey:["involved-indexes-explain-query"],sql:"\n        create or replace function pg_temp.explain_query(query text) returns jsonb\n        language plpgsql\n        as $$\n        declare\n            explain_result jsonb;\n            prepared_statement_name text := 'query_to_explain';\n            explain_plan_statement text;\n            n_args int;\n        begin\n            -- Remove comment lines (its common that they contain semicolons)\n            query := trim(\n                regexp_replace(\n                    regexp_replace(\n                        regexp_replace(query,'\\/\\*.+\\*\\/', '', 'g'),\n                    '--[^\\r\\n]*', ' ', 'g'),\n                '\\s+', ' ', 'g')\n            );\n      \n            -- Remove trailing semicolon\n            query := regexp_replace(query, ';\\s*$', '');\n\n            -- Disallow multiple statements\n            if query ilike '%;%' then\n                raise exception 'Query must not contain a semicolon';\n            end if;\n        \n            -- Hack to support PostgREST because the prepared statement for args incorrectly defaults to text\n            query := replace(query, 'WITH pgrst_payload AS (SELECT $1 AS json_data)', \n                                    'WITH pgrst_payload AS (SELECT $1::json AS json_data)');\n        \n            -- Create a prepared statement for the given query\n            deallocate all;\n            execute format('prepare %I as %s', prepared_statement_name, query);\n        \n            -- Detect how many arguments are present in the prepared statement\n            n_args = (\n                select\n                    coalesce(array_length(parameter_types, 1), 0)\n                from\n                    pg_prepared_statements\n                where\n                    name = prepared_statement_name\n                limit\n                    1\n            );\n        \n            -- Create a SQL statement that can be executed to collect the explain plan\n            explain_plan_statement = format(\n                'set local plan_cache_mode = force_generic_plan; explain (format json) execute %I%s',\n                prepared_statement_name,\n                case\n                    when n_args = 0 then ''\n                    else format(\n                        '(%s)', array_to_string(array_fill('null'::text, array[n_args]), ',')\n                    )\n                end\n            );\n        \n            -- Execute the explain plan statement and get the result\n            execute explain_plan_statement into explain_result;\n        \n            -- Clean up the prepared statement\n            deallocate all;\n        \n            -- Return the explain result\n            return explain_result;\n        end;\n        $$;\n\n        select pg_temp.explain_query('".concat(s,"') as plans;\n      ")}),r=function(e){let t=[];return!function e(n){null!==n&&"object"==typeof n&&("Index Name"in n&&t.push(n["Index Name"]),Object.values(n).forEach(t=>e(t)))}(e),t}(e);if(r.length<=0)return[];let{result:a}=await (0,h.R)({projectRef:t,connectionString:n,queryKey:["involved-indexes-names"],sql:"select schemaname as schema, tablename as table, indexname as name from pg_indexes where indexname in (".concat(r.map(e=>"'".concat(e,"'")).join(", "),");")});return a}catch(e){return[]}}let ec=function(e){let{projectRef:t,connectionString:n,query:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(null!=s?s:"").trim().toLowerCase(),o=i.startsWith("select")||i.startsWith("with pgrst_source")||i.startsWith("with pgrst_payload");return(0,er.a)(ea.A.indexesFromQuery(t,s),()=>el({projectRef:t,connectionString:n,query:s}),{retry:!1,enabled:r&&void 0!==t&&void 0!==s&&o,...a})};var ed=n(49736),eu=n(67976),em=n(83145),ep=n.n(em),ex=n(27477),eh=n(24605);let ef=()=>{let{ref:e}=(0,o.UO)(),{project:t}=(0,m.d2)(),{data:n}=(0,es.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),s=(null!=n?n:[]).find(e=>"hypopg"===e.name),r=(null!=n?n:[]).find(e=>"index_advisor"===e.name),{mutateAsync:i,isLoading:l}=(0,eh.k)(),c=async()=>{if(void 0===t)return console.error("Project is required");try{var e,n;(null==s?void 0:s.installed_version)===null&&await i({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:s.name,schema:null!==(e=null==s?void 0:s.schema)&&void 0!==e?e:"extensions",version:s.default_version}),(null==r?void 0:r.installed_version)===null&&await i({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:r.name,schema:null!==(n=null==r?void 0:r.schema)&&void 0!==n?n:"extensions",version:r.default_version}),u.Am.success("Successfully enabled index advisor!")}catch(e){u.Am.error("Failed to enable index advisor: ".concat(e.message))}};return(0,a.jsxs)(B.bZ,{className:"mb-6",children:[(0,a.jsx)(B.Cd,{children:(0,a.jsx)(E.U,{className:"text-foreground",content:void 0===r?"Newer version of Postgres required":"Postgres extensions `index_advisor` and `hypopg` required"})}),(0,a.jsx)(B.X,{children:(0,a.jsx)(E.U,{content:void 0===r?"Upgrade to the latest version of Postgres to get recommendations on indexes for your queries":"These extensions can help in recommending database indexes to reduce the costs of your query."})}),(0,a.jsx)(B.X,{className:"mt-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0===r?(0,a.jsx)(N.z,{asChild:!0,type:"default",children:(0,a.jsx)(ep(),{href:"/project/".concat(e,"/settings/infrastructure"),children:"Upgrade Postgres version"})}):(0,a.jsx)(N.z,{type:"default",disabled:l,loading:l,onClick:()=>c(),children:"Enable extensions"}),(0,a.jsx)(ex.G,{href:"https://supabase.com/docs/guides/database/extensions/index_advisor"})]})})]})},eg=e=>{let{selectedRow:t}=e,{project:n}=(0,m.d2)(),[s,r]=(0,d.useState)(!1),{data:i,isSuccess:o,isLoading:l,isError:c,error:p}=ec({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,query:null==t?void 0:t.query}),{data:x,isLoading:h}=(0,es.H)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),f=(null!=x?x:[]).find(e=>"hypopg"===e.name),g=(null!=x?x:[]).find(e=>"index_advisor"===e.name),v=void 0!==g&&null!==g.installed_version&&void 0!==f&&null!==f.installed_version,{data:y,error:_,refetch:b,isError:w,isSuccess:E,isLoading:S}=eo({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,query:null==t?void 0:t.query},{enabled:v}),{index_statements:C,startup_cost_after:R,startup_cost_before:k,total_cost_after:T,total_cost_before:A}=null!=y?y:{index_statements:[],total_cost_after:0,total_cost_before:0},O=E&&C.length>0,I=E?(A-T)/A*100:0,{mutate:F,isLoading:M}=(0,ed.r)({onSuccess:async()=>{await b(),u.Am.success("Successfully created index")},onError:e=>{u.Am.error("Failed to create index: ".concat(e.message))}}),z=()=>{0!==C.length&&F({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,sql:C.join(";\n")+";"})};return(0,a.jsxs)(G,{className:"h-full",children:[(0,a.jsxs)(X,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm",children:"Indexes in use"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["This query is using the following index",(null!=i?i:[]).length>1?"s":"",":"]})]}),l&&(0,a.jsx)(q.A,{}),c&&(0,a.jsx)(en.Z,{projectRef:null==n?void 0:n.ref,error:p,subject:"Failed to retrieve indexes in use"}),o&&(0,a.jsxs)("div",{children:[0===i.length&&(0,a.jsxs)("div",{className:"border rounded border-dashed flex flex-col items-center justify-center py-4 px-20 gap-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"No indexes are involved in this query"}),(0,a.jsx)("p",{className:"text-center text-xs text-foreground-lighter",children:"Indexes may not necessarily be used if they incur a higher cost when executing the query"})]}),i.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-x-4 bg-surface-100 border first:rounded-tl first:rounded-tr border-b-0 last:border-b last:rounded-b px-2 py-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)($.Z,{size:14,className:"text-foreground-light"}),(0,a.jsxs)("span",{className:"text-xs font-mono text-foreground-light",children:[e.schema,".",e.table]})]}),(0,a.jsx)("span",{className:"text-xs font-mono",children:e.name})]},e.name))]})]}),(0,a.jsx)("div",{className:"border-t"}),(0,a.jsxs)(X,{className:"flex flex-col gap-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"New index recommendations"}),h?(0,a.jsx)(q.A,{}):v?(0,a.jsxs)(a.Fragment,{children:[S&&(0,a.jsx)(q.A,{}),w&&(0,a.jsx)(en.Z,{projectRef:null==n?void 0:n.ref,error:_,subject:"Failed to retrieve result from index advisor"}),E&&(0,a.jsx)(a.Fragment,{children:0===(null!=C?C:[]).length?(0,a.jsxs)(B.bZ,{className:"[&>svg]:rounded-full",children:[(0,a.jsx)(ee.Z,{}),(0,a.jsx)(B.Cd,{children:"This query is optimized"}),(0,a.jsx)(B.X,{children:"Recommendations for indexes will show here"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Creating the following ",C.length>1?"indexes":"index"," ","on ",(0,a.jsx)("code",{className:"text-xs",children:"public.files"})," can improve this query's performance by"," ",(0,a.jsxs)("span",{className:"text-brand",children:[I.toFixed(2),"%"]}),":"]}),(0,a.jsx)(Y.d,{hideLineNumbers:!0,value:C.join(";\n")+";",language:"sql",className:(0,j.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"This recommendation serves to prevent your queries from slowing down as your application grows, and hence the index may not be used immediately after it's created. (e.g If your table is still small at this time)"})]})})]}):(0,a.jsx)(ef,{})]}),v&&O&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"Query costs"}),(0,a.jsxs)("div",{className:"border rounded-md flex flex-col bg-surface-100",children:[(0,a.jsx)(K,{name:"Total cost of query",description:"An estimate of how long it will take to return all the rows (Includes start up cost)",before:A,after:T}),(0,a.jsxs)(eu.zF,{open:s,onOpenChange:r,children:[(0,a.jsx)(eu.Fw,{asChild:!0,className:"pb-3",children:(0,a.jsx)(K,{hideArrowMarkers:!0,className:"border-t",name:"Start up cost",description:"An estimate of how long it will take to fetch the first row",before:k,after:R})}),(0,a.jsxs)(eu.wy,{className:"text-xs py-1.5 border-t text-foreground-light bg-studio w-full rounded-b-md",children:["View ",s?"less":"more"]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"FAQ"}),(0,a.jsxs)(et.UQ,{collapsible:!0,type:"single",className:"border rounded-md",children:[(0,a.jsxs)(et.Qd,{value:"1",children:[(0,a.jsx)(et.o4,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"What units are cost in?"}),(0,a.jsx)(et.vF,{className:"px-4 text-foreground-light",children:"Costs are in an arbitrary unit, and do not represent a unit of time. The units are anchored (by default) to a single sequential page read costing 1.0 units. They do, however, serve as a predictor of higher execution times."})]}),(0,a.jsxs)(et.Qd,{value:"2",className:"border-b-0",children:[(0,a.jsx)(et.o4,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"How should I prioritize start up and total cost?"}),(0,a.jsxs)(et.vF,{className:"px-4 text-foreground-light [&>div]:space-y-2",children:[(0,a.jsx)("p",{children:"This depends on the expected size of the result set from the query."}),(0,a.jsx)("p",{children:"For queries that return a small number or rows, the startup cost is more critical and minimizing startup cost can lead to faster response times, especially in interactive applications."}),(0,a.jsx)("p",{children:"For queries that return a large number of rows, the total cost becomes more important, and optimizing it will help in efficiently using resources and reducing overall query execution time."})]})]})]})]})]})]}),v&&O&&(0,a.jsxs)("div",{className:"bg-studio sticky bottom-0 border-t py-3 flex items-center justify-between px-5",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("span",{children:"Apply index to database"}),(0,a.jsx)("span",{className:"text-xs text-foreground-light",children:"This will run the SQL that is shown above"})]}),(0,a.jsx)(N.z,{disabled:M,loading:M,type:"primary",onClick:()=>z(),children:"Create index"})]})]})},ev=e=>{var t,n,s,l,u;let{queryPerformanceQuery:m}=e,p=(0,i.useRouter)(),x=(0,d.useRef)(null),{preset:h,sort:f,order:g,roles:v,search:_}=(0,o.UO)(),{isLoading:b}=m,w=p.query.sort?{column:p.query.sort,order:p.query.order}:void 0,[E,S]=(0,d.useState)("details"),[C,R]=(0,d.useState)(w),[k,I]=(0,d.useState)(),F=null!=h?h:r.MOST_TIME_CONSUMING,M=T[F].map(e=>{var t;return{key:e.id,name:e.name,resizable:!0,minWidth:null!==(t=e.minWidth)&&void 0!==t?t:120,headerCellClass:"first:pl-6 cursor-pointer",renderHeaderCell:()=>(0,a.jsxs)("div",{className:"flex items-center justify-between font-mono font-normal text-xs w-full",onClick:()=>P(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("p",{className:"!text-foreground",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-foreground-lighter",children:e.description})]}),(null==C?void 0:C.column)===e.id&&(0,a.jsx)(a.Fragment,{children:"desc"===C.order?(0,a.jsx)(A.Z,{size:14}):(0,a.jsx)(O.Z,{size:14})})]}),renderCell:t=>{var n;let s=null===(n=t.row)||void 0===n?void 0:n[e.id],r=e.name.includes("time"),i=r?"".concat(s.toFixed(0),"ms"):s.toLocaleString();return(0,a.jsxs)("div",{className:(0,j.cn)("w-full flex flex-col justify-center font-mono text-xs","number"==typeof s?"text-right":""),children:[(0,a.jsx)("p",{children:i}),r&&(0,a.jsxs)("p",{className:"text-foreground-lighter",children:[(s/1e3).toFixed(2),"s"]})]})}}}),z=void 0!==k?null===(n=m.data)||void 0===n?void 0:null===(t=n[k])||void 0===t?void 0:t.query:void 0,Z=(null!=z?z:"").trim().toLowerCase(),L=Z.startsWith("select")||Z.startsWith("with pgrst_source")||Z.startsWith("with pgrst_payload"),P=e=>{let t;if(R(t=(null==C?void 0:C.column)===e?"desc"===C.order?{column:e,order:"asc"}:void 0:{column:e,order:"desc"}),void 0===t){let{sort:e,order:t,...n}=p.query;p.push({...p,query:n})}else p.push({...p,query:{...p.query,sort:t.column,order:t.order}})};return(0,d.useEffect)(()=>{I(void 0)},[h,_,v,f,g]),(0,a.jsxs)(H.pO,{direction:"horizontal",className:"relative flex flex-grow bg-alternative min-h-0",autoSaveId:"query-performance-layout-v1",children:[(0,a.jsx)(H.ee,{defaultSize:1,children:(0,a.jsx)(D.ZP,{ref:x,style:{height:"100%"},className:(0,j.cn)("flex-1 flex-grow h-full"),rowHeight:44,headerRowHeight:36,columns:M,rows:null!==(u=null==m?void 0:m.data)&&void 0!==u?u:[],rowClass:(e,t)=>{let n=t===k;return["".concat(n?"bg-surface-300 dark:bg-surface-300":"bg-200"," cursor-pointer"),"".concat(n?"[&>div:first-child]:border-l-4 border-l-secondary [&>div]:border-l-foreground":""),"[&>.rdg-cell]:border-box [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none","[&>.rdg-cell:first-child>div]:ml-4"].join(" ")},renderers:{renderRow:(e,t)=>(0,d.createElement)(D.X2,{...t,key:"qp-row-".concat(t.rowIdx),onClick:()=>{if("number"==typeof e&&e>=0){var t;I(e),null===(t=x.current)||void 0===t||t.scrollToCell({idx:0,rowIdx:e});let n=m.data[e].query;(null!=n?n:"").trim().toLowerCase().startsWith("select")||S("details")}}}),noRowsFallback:b?(0,a.jsx)("div",{className:"absolute top-14 px-6 w-full",children:(0,a.jsx)(q.A,{})}):(0,a.jsxs)("div",{className:"absolute top-20 px-6 flex flex-col items-center justify-center w-full gap-y-2",children:[(0,a.jsx)(U.Z,{className:"text-foreground-muted",strokeWidth:1}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-foreground",children:"No queries detected"}),(0,a.jsx)("p",{className:"text-foreground-light",children:"There are no actively running queries that match the criteria"})]})]})}})}),void 0!==k&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(H.Dp,{withHandle:!0}),(0,a.jsxs)(H.ee,{defaultSize:30,maxSize:45,minSize:30,className:"bg-studio border-t",children:[(0,a.jsx)(N.z,{type:"text",className:"absolute top-3 right-3 px-1",icon:(0,a.jsx)(c.Z,{}),onClick:()=>I(void 0)}),(0,a.jsxs)(y.mQ,{value:E,className:"flex flex-col h-full",onValueChange:e=>S(e),children:[(0,a.jsxs)(y.dr,{className:"px-5 flex gap-x-4 min-h-[46px]",children:[(0,a.jsx)(y.SP,{value:"details",className:"px-0 pb-0 h-full text-xs  data-[state=active]:bg-transparent !shadow-none",children:"Query details"}),L&&(0,a.jsx)(y.SP,{value:"suggestion",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none",children:"Indexes"})]}),(0,a.jsx)(y.nU,{value:"details",className:"mt-0 flex-grow min-h-0 overflow-y-auto",children:(0,a.jsx)(J,{reportType:F,selectedRow:null===(s=m.data)||void 0===s?void 0:s[k],onClickViewSuggestion:()=>S("suggestion")})}),(0,a.jsx)(y.nU,{value:"suggestion",className:"mt-0 flex-grow min-h-0 overflow-y-auto",children:(0,a.jsx)(eg,{selectedRow:null===(l=m.data)||void 0===l?void 0:l[k]})})]})]})]})]})},ey=e=>{var t;let{queryHitRate:n,queryPerformanceQuery:s}=e,S=(0,i.useRouter)(),{ref:C,preset:R}=(0,o.UO)(),{project:T}=(0,m.d2)(),A=(0,v.TF)(),{isLoading:O,isRefetching:I}=s,F=A.selectedDatabaseId===C,M=(0,x.U)(null!==(t=A.selectedDatabaseId)&&void 0!==t?t:""),[z,Z]=(0,d.useState)(null!=R?R:r.MOST_TIME_CONSUMING),[L,P]=(0,d.useState)(!1),[W,U]=(0,f.l)(g.dA.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),D=()=>{s.runQuery(),n.runQuery()},{data:H}=(0,p.bN)({projectRef:C}),{data:V,isLoading:Y}=k({preset:"mostTimeConsuming"}),{data:B,isLoading:G}=k({preset:"mostFrequentlyInvoked"}),{data:X,isLoading:K}=k({preset:"slowestExecutionTime"}),J=(0,d.useMemo)(()=>[{id:r.MOST_TIME_CONSUMING,label:"Most time consuming",description:"Lists queries ordered by their cumulative total execution time.",isLoading:Y,max:(null!=V?V:[]).length>0?Math.max(...(null!=V?V:[]).map(e=>e.total_time)).toFixed(2):void 0},{id:r.MOST_FREQUENT,label:"Most frequent",description:"Lists queries in order of their execution count",isLoading:G,max:(null!=B?B:[]).length>0?Math.max(...(null!=B?B:[]).map(e=>e.calls)).toFixed(2):void 0},{id:r.SLOWEST_EXECUTION,label:"Slowest execution",description:"Lists queries ordered by their maximum execution time",isLoading:K,max:(null!=X?X:[]).length>0?Math.max(...(null!=X?X:[]).map(e=>e.max_time)).toFixed(2):void 0}],[G,K,Y,B,V,X]);return(0,d.useEffect)(()=>{A.setSelectedDatabaseId(C)},[C]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.mQ,{defaultValue:z,onValueChange:e=>{Z(e);let{sort:t,search:n,...s}=S.query;S.push({...S,query:{...s,preset:e}})},children:(0,a.jsx)(y.dr,{className:(0,j.cn)("flex gap-0 border-0 items-end z-10"),children:J.map(e=>{let t=Number(e.max),n=e.id!==r.MOST_FREQUENT?t>1e3?(t/1e3).toFixed(2):t.toFixed(0):t.toLocaleString();return(0,a.jsxs)(y.SP,{value:e.id,className:(0,j.cn)("group relative","px-6 py-3 border-b-0 flex flex-col items-start !shadow-none border-default border-t","even:border-x last:border-r even:!border-x-strong last:!border-r-strong",e.id===z?"!bg-surface-200":"!bg-surface-200/[33%]","hover:!bg-surface-100","data-[state=active]:!bg-surface-200","hover:text-foreground-light","transition"),children:[e.id===z&&(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-foreground"}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("span",{className:"",children:e.label}),(0,a.jsxs)(_.u,{children:[(0,a.jsx)(_.aJ,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light"})}),(0,a.jsx)(_._v,{side:"top",children:e.description})]})]}),e.isLoading?(0,a.jsx)(q.Z,{className:"w-32 pt-1"}):void 0===e.max?(0,a.jsx)("span",{className:"text-xs text-foreground-muted group-hover:text-foreground-lighter group-data-[state=active]:text-foreground-lighter transition",children:"No data yet"}):(0,a.jsxs)("span",{className:"text-xs text-foreground-muted group-hover:text-foreground-lighter group-data-[state=active]:text-foreground-lighter transition",children:[n,e.id!==r.MOST_FREQUENT?t>1e3?"s":"ms":" calls"]}),e.id===z&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-[1px] bg-surface-200"})]},e.id)})})}),(0,a.jsx)(Q,{queryPerformanceQuery:s,onResetReportClick:()=>P(!0)}),(0,a.jsx)(b.O,{loading:O||I}),(0,a.jsx)(ev,{queryPerformanceQuery:s}),(0,a.jsxs)("div",{className:(0,j.cn)("px-6 py-6 flex gap-x-4 border-t relative",{hidden:!1===W}),children:[(0,a.jsx)(N.z,{className:"absolute top-1.5 right-3 px-1.5",type:"text",size:"tiny",onClick:()=>U(!1),children:(0,a.jsx)(c.Z,{size:"14"})}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"Reset report"}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Consider resetting the analysis after optimizing any queries"}),(0,a.jsx)(N.z,{type:"default",className:"!mt-3 w-min",onClick:()=>P(!0),children:"Reset report"})]}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"How is this report generated?"}),(0,a.jsx)(E.U,{className:"text-xs",content:"This report uses the pg_stat_statements table, and pg_stat_statements extension. [Learn more here](https://supabase.com/docs/guides/platform/performance#examining-query-performance)."})]}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"Inspect your database for potential issues"}),(0,a.jsx)(E.U,{className:"text-xs",content:"The Supabase CLI comes with a range of tools to help inspect your Postgres instances for potential issues. [Learn more here](https://supabase.com/docs/guides/database/inspect)."})]})]}),(0,a.jsx)(w.Z,{visible:L,size:"medium",variant:"destructive",title:"Reset query performance analysis",confirmLabel:"Reset report",confirmLabelLoading:"Resetting report",onCancel:()=>P(!1),onConfirm:async()=>{var e;let t=null==H?void 0:null===(e=H.find(e=>e.identifier===A.selectedDatabaseId))||void 0===e?void 0:e.connectionString;if(g.Qy&&!t)return u.Am.error("Unable to run query: Connection string is missing");try{await (0,h.R)({projectRef:null==T?void 0:T.ref,connectionString:t,sql:"SELECT pg_stat_statements_reset();"}),D(),P(!1)}catch(e){u.Am.error("Failed to reset analysis: ".concat(e.message))}},children:(0,a.jsxs)("p",{className:"text-foreground-light text-sm",children:["This will reset the pg_stat_statements table in the extensions schema on your"," ",(0,a.jsx)("span",{className:"text-foreground",children:F?"primary database":"read replica (ID: ".concat(M,")")}),", which is used to calculate query performance. This data will repopulate immediately after."]})})]})};var ej=n(42135),e_=n(50048),eb=n(64269),eN=n(55527),ew=n(38057);let eq={[r.MOST_TIME_CONSUMING]:"mostTimeConsuming",[r.MOST_FREQUENT]:"mostFrequentlyInvoked",[r.SLOWEST_EXECUTION]:"slowestExecutionTime"},eE=()=>{var e,t;let n=(0,i.useRouter)(),{ref:s,search:r,sort:l,order:c,preset:d}=(0,o.UO)(),u=S.cr[C.s.QUERY_PERFORMANCE],m=(0,ej.H)(u.queries,null!=s?s:"default").queryHitRate(),p=null!==(t=null==n?void 0:null===(e=n.query)||void 0===e?void 0:e.roles)&&void 0!==t?t:[],x=k({searchQuery:null!=r?r:"",orderBy:void 0!==l?{column:l,order:c}:void 0,preset:void 0!==d?eq[d]:"mostTimeConsuming",roles:"string"==typeof p?[p]:p});return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)(eN.p,{className:"py-4 px-6 !mb-0",title:"Query Performance",docsUrl:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",actions:(0,a.jsx)(eb.Z,{})}),(0,a.jsx)(ey,{queryHitRate:m,queryPerformanceQuery:x})]})};eE.getLayout=e=>(0,a.jsx)(ew.Z,{children:(0,a.jsx)(e_.Z,{title:"Query performance",children:e})});var eS=eE},15676:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(74234).Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},78978:function(e,t,n){"use strict";n.d(t,{B_:function(){return v},_f:function(){return b},aG:function(){return g},av:function(){return _}});var s=n(97458),r=n(72439),a=n(28570),i=n(52983),o=n(9060),l=n(73512),c=n(39957),d=n(43633),u=n(22921),m=n(53486),p=n(79180),x=n(92654),h=n(69133),f=n(82040);function g(e){let{className:t}=e,n=(0,x.Wo)(),a=(0,x.yg)();if(n)return(0,s.jsxs)("button",{className:(0,d.cn)("p-2 bg-overlay flex items-center gap-2 text-xs text-foreground-muted",t),onClick:a,children:[(0,s.jsx)(r.Z,{width:12,height:12}),n.name]})}let v=(0,i.forwardRef)((e,t)=>{let{children:n,className:r,...a}=e;return(0,s.jsx)(u.mY,{ref:t,className:(0,d.cn)("h-full w-full flex flex-col overflow-hidden","[&_[cmdk-group]]:px-2 [&_[cmdk-group]]:!bg-transparent [&_[cmdk-group-heading]]:!bg-transparent [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-border-stronger [&_[cmdk-input]]:h-12","[&_[cmdk-item]_svg]:h-5","[&_[cmdk-item]_svg]:w-5","[&_[cmdk-item]_svg]:stroke-1","[&_[cmdk-input-wrapper]_svg]:h-5","[&_[cmdk-input-wrapper]_svg]:w-5","[&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0",r),...a,children:n})});function y(e){let{resetErrorBoundary:t}=e;return(0,s.jsx)("div",{className:(0,d.cn)("min-h-64","flex items-center justify-center"),children:(0,s.jsxs)("div",{className:"p-10 flex flex-col items-center gap-6 mt-4",children:[(0,s.jsx)(a.Z,{strokeWidth:1.5,size:40}),(0,s.jsx)("p",{className:"text-lg text-center",children:"Sorry, looks like we're having some issues with the command menu!"}),(0,s.jsx)("p",{className:"text-sm text-center",children:"Please try again in a bit."}),(0,s.jsx)(m.z,{size:"tiny",type:"secondary",onClick:t,children:"Try again?"})]})})}function j(e){let{children:t}=e,n=(0,x.EB)();return n?(0,s.jsx)(n,{}):(0,s.jsx)(v,{children:t})}function _(e){let{children:t}=e,n=(0,f.Cc)(),s=(0,f.FX)(),r=i.Children.only(t);return r&&(0,i.isValidElement)(r)?(0,i.cloneElement)(r,{onClick:()=>{var e,t;s(!n),null===(e=(t=r.props).onOpen)||void 0===e||e.call(t,!n)},"aria-haspopup":"dialog","aria-expanded":n,"aria-controls":"command-menu-dialog-content",className:(0,d.cn)("h-10 px-4 py-2","inline-flex items-center justify-center","whitespace-nowrap","rounded-md border border-input bg-background","text-sm font-medium","hover:bg-accent hover:text-accent-foreground","ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","transition-colors",r.props.className)}):null}function b(e){let{children:t,trigger:n}=e,r=(0,f.Cc)(),a=(0,f.FX)(),u=(0,l.Gc)("sm"),m=(0,f.Qd)(),g=(0,x.Wo)(),v=(0,x.yg)(),_=(0,h.a)(),b=(0,h.A)(),{ref:N}=function(e){let{toggleOpen:t}=e,{ref:n,handleTouchStart:s,handleTouchMove:r,handleTouchEnd:a}=(0,c.Z)({onClose:t}),o=(0,f.Gk)(),l=(0,i.useMemo)(()=>({handleTouchStart:s,handleTouchMove:r,handleTouchEnd:a}),[s,r,a]);return(0,i.useEffect)(()=>{o(l)},[l]),{ref:n}}({toggleOpen:()=>a(!r)});return(0,s.jsxs)(p.Vq,{open:r,onOpenChange:a,children:[n,(0,s.jsx)(p.cZ,{id:"command-menu-dialog-content",hideClose:!0,forceMount:!0,ref:N,onOpenAutoFocus:e=>u&&e.preventDefault(),onInteractOutside:()=>a(!1),onEscapeKeyDown:e=>(e.preventDefault(),_?b(""):g?v():a(!1)),size:m,className:(0,d.cn)("relative flex flex-col my-0 mx-auto rounded-t-lg overflow-hidden","h-[85dvh] mt-[15vh] md:max-h-[500px] md:mt-0 left-0 bottom-0 md:bottom-auto","!animate-in !slide-in-from-bottom-[85%] !duration-300","data-[state=closed]:!animate-out data-[state=closed]:!slide-out-to-bottom","!slide-in-from-left-[0%] :!slide-in-from-top-[0%]","!slide-out-to-left-[0%] !slide-out-to-top-[0%]","md:data-[state=open]:!slide-in-from-bottom-[0%] md:data-[state=closed]:!slide-out-to-bottom-[0%]","md:data-[state=open]:!zoom-in-95 md:data-[state=closed]:!zoom-out-95"),dialogOverlayProps:{className:(0,d.cn)("overflow-hidden flex data-closed:delay-100")},children:(0,s.jsx)(o.SV,{FallbackComponent:y,children:(0,s.jsx)(j,{children:t})})})]})}v.displayName=u.mY.displayName},92654:function(e,t,n){"use strict";n.d(t,{EB:function(){return u},Qy:function(){return h},SL:function(){return m},Wo:function(){return d},yg:function(){return p}});var s=n(85466),r=n.n(s),a=n(52983),i=n(34653),o=n(42807),l=n(36478),c=n(69133);let d=()=>{let{pagesState:e}=(0,o.D)(),{commandPages:t,pageStack:n}=(0,i.R)(e),s=n.at(-1);return(0,a.useMemo)(()=>s&&t[s]?{...t[s],name:s}:void 0,[t,s])},u=()=>{let e=d();if(e&&(0,l.sG)(e))return e.component},m=()=>{let{pagesState:e}=(0,o.D)(),t=(0,c.A)();return function(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.appendPageStack(n),s||t("")}},p=()=>{let{pagesState:e}=(0,o.D)(),{popPageStack:t}=(0,i.R)(e);return t},x=[],h=function(e,t){let{deps:n=x,enabled:s=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{pagesState:l}=(0,o.D)(),{registerNewPage:c}=(0,i.R)(l),d=(0,a.useRef)(n),u=(0,a.useRef)(s),m=(0,a.useRef)();(0,a.useMemo)(()=>{if(!r()(d.current,n)||u.current!==s){var a;null===(a=m.current)||void 0===a||a.call(m),m.current=s?c(e,t):void 0,d.current=n,u.current=s}},[c,e,t,n,s]),(0,a.useEffect)(()=>(m.current=s?c(e,t):void 0,()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.call(m)}),[])}},69133:function(e,t,n){"use strict";n.d(t,{A:function(){return i},a:function(){return a}});var s=n(34653),r=n(42807);let a=()=>{let{queryState:e}=(0,r.D)(),{query:t}=(0,s.R)(e);return t},i=()=>{let{queryState:e}=(0,r.D)(),{setQuery:t}=(0,s.R)(e);return t}},42317:function(e,t,n){"use strict";n.d(t,{O:function(){return a}});var s=n(97458),r=n(43633);let a=e=>{let{loading:t}=e;return(0,s.jsx)("div",{className:"relative overflow-hidden w-full h-px bg-border m-auto",children:(0,s.jsx)("span",{className:(0,r.cn)("absolute w-[80px] h-px ml-auto mr-auto left-0 right-0 text-center block top-0","transition-all","line-loading-bg-light dark:line-loading-bg",t&&"animate-line-loading-slower opacity-100",t?"opacity-100":"opacity-0")})})}},33880:function(e,t,n){"use strict";n.d(t,{ZP:function(){return m}});var s=n(97458),r=n(52983),a=n(92334),i=n(43633);function o(e){let{children:t,className:n,tag:r="div",style:a}=e;return(0,s.jsx)("".concat(r),{style:a,children:t})}o.Title=function(e){let{className:t,level:n=1,children:r,style:a}=e;return(0,s.jsx)("h".concat(n),{style:a,children:r})},o.Text=function(e){let{className:t,children:n,style:r,type:a,disabled:i,mark:o,code:l,keyboard:c,underline:d,strikethrough:u,strong:m,small:p}=e;return l?(0,s.jsx)("code",{style:r,children:n}):o?(0,s.jsx)("mark",{style:r,children:n}):c?(0,s.jsx)("kbd",{style:r,children:n}):m?(0,s.jsx)("strong",{style:r,children:n}):(0,s.jsx)("span",{style:r,children:n})},o.Link=function(e){let{children:t,target:n="_blank",href:r,className:a,onClick:i,style:o}=e;return(0,s.jsx)("a",{onClick:i,href:r,target:n,rel:"noopener noreferrer",style:o,children:t})};let l=(0,r.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,s.jsx)(l.Provider,{value:{type:t},children:e.children})},d=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:n,ulClassName:r,style:a,type:i="text"}=e;return(0,s.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:n,style:a,children:(0,s.jsx)(c,{type:i,children:(0,s.jsx)("ul",{className:r,children:t})})})}u.Item=function(e){let{children:t,icon:n,active:r,rounded:o,onClick:l,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:m}=e,p=(0,a.Z)("menu"),{type:x}=d(),h=[p.item.base];h.push(p.item.variants[x].base),r?h.push(p.item.variants[x].active):h.push(p.item.variants[x].normal);let f=[p.item.content.base];r?f.push(p.item.content.active):f.push(p.item.content.normal);let g=[p.item.icon.base];return r?g.push(p.item.icon.active):g.push(p.item.icon.normal),(0,s.jsxs)("li",{role:"menuitem",className:(0,i.cn)("outline-none",h),style:m,onClick:l,"aria-current":r?"page":void 0,children:[n&&(0,s.jsx)("div",{className:"".concat(g.join(" ")," min-w-fit"),children:n}),(0,s.jsx)("span",{className:f.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:n,title:r}=e,i=(0,a.Z)("menu"),{type:o}=d();return(0,s.jsxs)("div",{className:[i.group.base,i.group.variants[o]].join(" "),children:[n&&(0,s.jsx)("span",{className:i.group.icon,children:n}),(0,s.jsx)("span",{className:i.group.content,children:r}),t]})},u.Misc=function(e){let{children:t}=e;return(0,s.jsx)("div",{children:(0,s.jsx)(o.Text,{children:(0,s.jsx)("span",{children:t})})})};var m=u},57782:function(e,t,n){"use strict";n.d(t,{Qd:function(){return c},UQ:function(){return l},o4:function(){return d},vF:function(){return u}});var s=n(97458),r=n(93761),a=n(15647),i=n(52983),o=n(43633);let l=r.fC,c=i.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.ck,{ref:t,className:(0,o.cn)("border-b",n),...a})});c.displayName="AccordionItem";let d=i.forwardRef((e,t)=>{let{className:n,children:i,hideIcon:l,...c}=e;return(0,s.jsx)(r.h4,{className:"flex",children:(0,s.jsxs)(r.xz,{ref:t,className:(0,o.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",n),...c,children:[i,!l&&(0,s.jsx)(a.Z,{className:"h-4 w-4 transition-transform duration-200"})]})})});d.displayName=r.xz.displayName;let u=i.forwardRef((e,t)=>{let{className:n,children:a,...i}=e;return(0,s.jsx)(r.VY,{ref:t,className:(0,o.cn)("overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",n),...i,children:(0,s.jsx)("div",{className:"pb-4 pt-0",children:a})})});u.displayName=r.VY.displayName},93761:function(e,t,n){"use strict";n.d(t,{VY:function(){return H},ck:function(){return Q},fC:function(){return W},h4:function(){return U},xz:function(){return D}});var s=n(83573),r=n(52983),a=n(95831),i=n(34981),o=n(61031),l=n(12527),c=n(29650),d=n(36986),u=n(99517),m=n(29028),p=n(72929);let x="Accordion",h=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[f,g,v]=(0,i.B)(x),[y,j]=(0,a.b)(x,[v,u.p_]),_=(0,u.p_)(),b=r.forwardRef((e,t)=>{let{type:n,...a}=e;return r.createElement(f.Provider,{scope:e.__scopeAccordion},"multiple"===n?r.createElement(C,(0,s.Z)({},a,{ref:t})):r.createElement(S,(0,s.Z)({},a,{ref:t})))});b.propTypes={type(e){let t=e.value||e.defaultValue;return e.type&&!["single","multiple"].includes(e.type)?Error("Invalid prop `type` supplied to `Accordion`. Expected one of `single | multiple`."):"multiple"===e.type&&"string"==typeof t?Error("Invalid prop `type` supplied to `Accordion`. Expected `single` when `defaultValue` or `value` is type `string`."):"single"===e.type&&Array.isArray(t)?Error("Invalid prop `type` supplied to `Accordion`. Expected `multiple` when `defaultValue` or `value` is type `string[]`."):null}};let[N,w]=y(x),[q,E]=y(x,{collapsible:!1}),S=r.forwardRef((e,t)=>{let{value:n,defaultValue:a,onValueChange:i=()=>{},collapsible:o=!1,...l}=e,[d,u]=(0,c.T)({prop:n,defaultProp:a,onChange:i});return r.createElement(N,{scope:e.__scopeAccordion,value:d?[d]:[],onItemOpen:u,onItemClose:r.useCallback(()=>o&&u(""),[o,u])},r.createElement(q,{scope:e.__scopeAccordion,collapsible:o},r.createElement(T,(0,s.Z)({},l,{ref:t}))))}),C=r.forwardRef((e,t)=>{let{value:n,defaultValue:a,onValueChange:i=()=>{},...o}=e,[l=[],d]=(0,c.T)({prop:n,defaultProp:a,onChange:i}),u=r.useCallback(e=>d((t=[])=>[...t,e]),[d]),m=r.useCallback(e=>d((t=[])=>t.filter(t=>t!==e)),[d]);return r.createElement(N,{scope:e.__scopeAccordion,value:l,onItemOpen:u,onItemClose:m},r.createElement(q,{scope:e.__scopeAccordion,collapsible:!0},r.createElement(T,(0,s.Z)({},o,{ref:t}))))}),[R,k]=y(x),T=r.forwardRef((e,t)=>{let{__scopeAccordion:n,disabled:a,dir:i,orientation:c="vertical",...u}=e,m=r.useRef(null),x=(0,o.e)(m,t),v=g(n),y="ltr"===(0,p.gm)(i),j=(0,l.M)(e.onKeyDown,e=>{var t;if(!h.includes(e.key))return;let n=e.target,s=v().filter(e=>{var t;return!(null!==(t=e.ref.current)&&void 0!==t&&t.disabled)}),r=s.findIndex(e=>e.ref.current===n),a=s.length;if(-1===r)return;e.preventDefault();let i=r,o=a-1,l=()=>{(i=r+1)>o&&(i=0)},d=()=>{(i=r-1)<0&&(i=o)};switch(e.key){case"Home":i=0;break;case"End":i=o;break;case"ArrowRight":"horizontal"===c&&(y?l():d());break;case"ArrowDown":"vertical"===c&&l();break;case"ArrowLeft":"horizontal"===c&&(y?d():l());break;case"ArrowUp":"vertical"===c&&d()}null===(t=s[i%a].ref.current)||void 0===t||t.focus()});return r.createElement(R,{scope:n,disabled:a,direction:i,orientation:c},r.createElement(f.Slot,{scope:n},r.createElement(d.WV.div,(0,s.Z)({},u,{"data-orientation":c,ref:x,onKeyDown:a?void 0:j}))))}),A="AccordionItem",[O,I]=y(A),F=r.forwardRef((e,t)=>{let{__scopeAccordion:n,value:a,...i}=e,o=k(A,n),l=w(A,n),c=_(n),d=(0,m.M)(),p=a&&l.value.includes(a)||!1,x=o.disabled||e.disabled;return r.createElement(O,{scope:n,open:p,disabled:x,triggerId:d},r.createElement(u.fC,(0,s.Z)({"data-orientation":o.orientation,"data-state":P(p)},c,i,{ref:t,disabled:x,open:p,onOpenChange:e=>{e?l.onItemOpen(a):l.onItemClose(a)}})))}),M=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,i=k(x,n),o=I("AccordionHeader",n);return r.createElement(d.WV.h3,(0,s.Z)({"data-orientation":i.orientation,"data-state":P(o.open),"data-disabled":o.disabled?"":void 0},a,{ref:t}))}),z="AccordionTrigger",Z=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,i=k(x,n),o=I(z,n),l=E(z,n),c=_(n);return r.createElement(f.ItemSlot,{scope:n},r.createElement(u.xz,(0,s.Z)({"aria-disabled":o.open&&!l.collapsible||void 0,"data-orientation":i.orientation,id:o.triggerId},c,a,{ref:t})))}),L=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,i=k(x,n),o=I("AccordionContent",n),l=_(n);return r.createElement(u.VY,(0,s.Z)({role:"region","aria-labelledby":o.triggerId,"data-orientation":i.orientation},l,a,{ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}}))});function P(e){return e?"open":"closed"}let W=b,Q=F,U=M,D=Z,H=L}},function(e){e.O(0,[6665,7623,588,7037,8e3,6402,4418,8703,2303,6823,6499,4837,3297,441,1577,5605,1503,7702,5834,7198,3535,8232,3048,9497,8005,2578,1446,9198,4554,5631,8803,3664,9774,2888,179],function(){return e(e.s=76)}),_N_E=e.O()}]);