(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6377],{12832:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(97335),i=n.n(r),a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s={key:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},onlyResolvesLast:!0},l=function(){function e(e){this.config=e,this.debounceSingleton=null,this.debounceCache={}}return e.prototype._createDebouncedFunction=function(){var e,t,n=i()(this.config.func,this.config.wait,this.config.options);return this.config.options.onlyResolvesLast&&(e=n,t=null,n=function(){for(var n,r,i,a,s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];t&&t();var o=(n=e.apply(void 0,s),r=null,i=null,a=new Promise(function(e,t){r=e,i=t}),n&&n.then(function(e){r&&r(e)},function(e){i&&i(e)}),{promise:a,resolve:function(e){r&&r(e)},reject:function(e){i&&i(e)},cancel:function(){r=null,i=null}}),c=o.promise;return t=o.cancel,c}),{func:n}},e.prototype.getDebouncedFunction=function(e){var t,n=(t=this.config.options).key.apply(t,e);return null==n?(this.debounceSingleton||(this.debounceSingleton=this._createDebouncedFunction()),this.debounceSingleton):(this.debounceCache[n]||(this.debounceCache[n]=this._createDebouncedFunction()),this.debounceCache[n])},e}(),o=function(e,t,n){var r=new l({func:e,wait:t,options:a({},s,n)});return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.getDebouncedFunction(e).func.apply(void 0,e)}}},97335:function(e){"use strict";e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=void 0,i=void 0,a=void 0,s=[];return function(){var o,c="function"==typeof t?t():t,u=new Date().getTime(),d=!r||u-r>c;r=u;for(var h=arguments.length,f=Array(h),m=0;m<h;m++)f[m]=arguments[m];if(d&&n.leading)return n.accumulate?Promise.resolve(e.call(this,[f])).then(function(e){return e[0]}):Promise.resolve(e.call.apply(e,[this].concat(f)));if(i?clearTimeout(a):((o={}).promise=new Promise(function(e,t){o.resolve=e,o.reject=t}),i=o),s.push(f),a=setTimeout(l.bind(this),c),n.accumulate){var p=s.length-1;return i.promise.then(function(e){return e[p]})}return i.promise};function l(){var t=i;clearTimeout(a),Promise.resolve(n.accumulate?e.call(this,s):e.apply(this,s[s.length-1])).then(t.resolve,t.reject),s=[],i=null}}},93906:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/sql/[id]",function(){return n(95697)}])},88473:function(e,t,n){"use strict";var r=n(97458),i=n(52983),a=n(28977),s=n.n(a),l=n(42599),o=n(62708),c=n(40195),u=n(83895),d=n(38733),h=n(41258),f=n(73954),m=n(70352),p=n(23848),g=n(95226),v=n(78548),x=n(69371);t.Z=e=>{var t,n,a;let{data:y,yAxisKey:b,xAxisKey:j,format:w,customDateFormat:N=p.EE.FULL,title:_,highlightedValue:k,highlightedLabel:E,displayDateInUtc:S,minimalHeader:C,valuePrecision:L,className:R="",size:A="normal",emptyStateMessage:O,onBarClick:I,showLegend:T=!1,xAxisIsDate:D=!0,XAxisProps:F,YAxisProps:M,showGrid:q=!1}=e,{Container:Z}=(0,v.D3)(A),[P,z]=(0,i.useState)(null),K=F||{interval:y.length-2,angle:0,tick:!1},U=M||{tickFormatter:e=>(0,v.V2)(e,L),tick:!1,width:0},Q=e=>S?s()(e).utc():s()(e),V=function(){if(!D){var e;return P?null===(e=y[P])||void 0===e?void 0:e[j]:E}return null!==P&&y&&void 0!==y[P]&&Q(y[P][j]).format(N)||E}(),G=null!==P?null===(t=y[P])||void 0===t?void 0:t[b]:k;return 0===y.length?(0,r.jsx)(x.Z,{message:O,description:"It may take up to 24 hours for data to refresh",size:A,className:R,attribute:_,format:w}):(0,r.jsxs)("div",{className:["flex flex-col gap-y-3",R].join(" "),children:[(0,r.jsx)(g.Z,{title:_,format:w,customDateFormat:N,highlightedValue:"number"==typeof G?(0,v.V2)(G,L):G,highlightedLabel:V,minimalHeader:C}),(0,r.jsx)(Z,{children:(0,r.jsxs)(l.v,{data:y,className:"overflow-visible",onMouseMove:e=>{e.activeTooltipIndex!==P&&z(e.activeTooltipIndex)},onMouseLeave:()=>z(null),onClick:e=>{var t,n;let r=null==e?void 0:null===(n=e.activePayload)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.payload;I&&I(r,e)},children:[T&&(0,r.jsx)(o.D,{}),q&&(0,r.jsx)(c.q,{stroke:p.ZE.AXIS}),(0,i.createElement)(u.B,{...U,axisLine:{stroke:p.ZE.AXIS},tickLine:{stroke:p.ZE.AXIS},key:b}),(0,i.createElement)(d.K,{...K,axisLine:{stroke:p.ZE.AXIS},tickLine:{stroke:p.ZE.AXIS},key:j}),(0,r.jsx)(h.u,{content:()=>null}),(0,r.jsx)(f.$,{dataKey:b,fill:p.ZE.GREEN_1,animationDuration:300,maxBarSize:48,children:null==y?void 0:y.map((e,t)=>(0,r.jsx)(m.b,{className:"transition-all duration-300 ".concat(I?"cursor-pointer":""),fill:P===t||null===P?p.ZE.GREEN_1:p.ZE.GREEN_2,enableBackground:12},"cell-".concat(t)))})]})}),y&&(0,r.jsxs)("div",{className:"text-foreground-lighter -mt-9 flex items-center justify-between text-xs",children:[(0,r.jsx)("span",{children:D?Q(y[0][j]).format(N):y[0][j]}),(0,r.jsx)("span",{children:D?Q(null===(n=y[(null==y?void 0:y.length)-1])||void 0===n?void 0:n[j]).format(N):null===(a=y[(null==y?void 0:y.length)-1])||void 0===a?void 0:a[j]})]})]})}},95226:function(e,t,n){"use strict";var r=n(97458);t.Z=e=>{let{format:t,highlightedValue:n,highlightedLabel:i,title:a,minimalHeader:s=!1}=e,l=(0,r.jsx)("h3",{className:"text-foreground-lighter "+(s?"text-xs":"text-sm"),children:a}),o=(0,r.jsxs)("h5",{className:"text-foreground text-xl font-normal ".concat(s?"text-base":"text-2xl"),children:[void 0!==n&&String(n),"seconds"===t?" ":"",(0,r.jsx)("span",{className:"text-lg",children:"function"==typeof t?t(n):t})]}),c=(0,r.jsx)("h5",{className:"text-foreground-lighter text-xs",children:i});return s?(0,r.jsxs)("div",{className:"flex flex-row items-center gap-x-4",style:{minHeight:"1.8rem"},children:[a&&l,(0,r.jsxs)("div",{className:"flex flex-row items-baseline gap-x-2",children:[void 0!==n&&o,c]})]}):(0,r.jsxs)("div",{className:"h-16",children:[a&&l,void 0!==n&&o,c]})}},23848:function(e,t,n){"use strict";var r,i;n.d(t,{EE:function(){return r},FK:function(){return s},Ki:function(){return l},ZE:function(){return a}});let a={TICK:"hsl(var(--background-overlay-hover))",AXIS:"hsl(var(--background-overlay-hover))",GREEN_1:"hsl(var(--brand-default))",GREEN_2:"hsl(var(--brand-500))",RED_1:"hsl(var(--destructive-default))",RED_2:"hsl(var(--destructive-500))"},s=e=>e.map(e=>{var t;let n=null!==(t=({slate:11})[e])&&void 0!==t?t:9;return{lighter:"var(--colors-".concat(e).concat(n-1,")"),base:"var(--colors-".concat(e).concat(n,")"),darker:"var(--colors-".concat(e).concat(n+1,")")}}),l=["brand","slate","blue","yellow","indigo"];(i=r||(r={})).FULL="MMM D, YYYY, hh:mma",i.DATE_ONLY="MMM D, YYYY"},78548:function(e,t,n){"use strict";n.d(t,{Bh:function(){return f},D3:function(){return p},Hx:function(){return m},V2:function(){return d},ww:function(){return g}});var r=n(97458),i=n(28977),a=n.n(i),s=n(13516),l=n.n(s),o=n(52983),c=n(12381),u=n(23848);a().extend(l());let d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return h(e)?f(e,t):e.toLocaleString()},h=e=>String(e).includes("."),f=(e,t)=>{if(!h(e))return e.toLocaleString()+"."+"0".repeat(t);{let[n,r]=String(e).split(".");return Number(n).toLocaleString()+"."+r.slice(0,t)}},m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.EE.FULL,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?a().utc(e).format(t):a()(e).format(t)},p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tiny:76,small:96,normal:160,large:280},n=t[e];return{Container:(0,o.useMemo)(()=>e=>{let{children:t}=e;return(0,r.jsx)(c.h,{height:n,minHeight:n,width:"100%",children:t})},[e]),minHeight:n}},g=e=>{let{data:t,xAxisKey:n,yAxisKey:r,stackKey:i,variant:a="values"}=e,s=(0,o.useMemo)(()=>t?Object.entries(t.reduce((e,t)=>{let a=t[n],s=t[r],l=t[i];return e[a]||(e[a]={}),e[a][l]=s,e},{})).map(e=>{let[t,r]=e;return{...r,[n]:Number.isNaN(Number(t))?t:Number(t)}}):[],[JSON.stringify(t)]),l=(0,o.useMemo)(()=>Object.keys(s[0]||{}).filter(e=>e!==n&&e!==r).sort(),[JSON.stringify(s[0]||{})]),c=(0,o.useMemo)(()=>{if("percentages"===a)return s.map(e=>{let t=Object.entries(e),n=t.filter(e=>{let[t,n]=e;return l.includes(t)}).reduce((e,t)=>{let[n,r]=t;return e+r},0);return t.reduce((e,t)=>{let[r,i]=t;return l.includes(r)?{...e,[r]:0!==i?i/n:0}:{...e,[r]:i}},{})})},[JSON.stringify(s)]);return{dataKeys:l,stackedData:s,percentagesStackedData:c}}},69371:function(e,t,n){"use strict";var r=n(97458),i=n(26419),a=n(43633),s=n(95226),l=n(78548);t.Z=e=>{let{attribute:t,message:n="No data to show",description:o,format:c,className:u="",size:d}=e,{minHeight:h}=(0,l.D3)(d);return(0,r.jsxs)("div",{children:[void 0!==t&&(0,r.jsx)(s.Z,{title:t,format:c,highlightedValue:0}),(0,r.jsxs)("div",{className:(0,a.cn)("border-control flex flex-grow w-full flex-col items-center justify-center space-y-2 border border-dashed text-center",u),style:{minHeight:h+20},children:[(0,r.jsx)(i.Z,{size:20,className:"text-border-stronger"}),(0,r.jsxs)("div",{className:"px-1",children:[(0,r.jsx)("p",{className:"text-foreground-light text-xs",children:n}),o&&(0,r.jsx)("p",{className:"text-foreground-lighter text-xs",children:o})]})]})]})}},94398:function(e,t,n){"use strict";var r=n(97458),i=n(9738),a=n(32024),s=n(52983),l=n(6433),o=n(53486),c=n(43633);t.Z=e=>{var t;let{text:n,asyncText:u,iconOnly:d=!1,children:h,onClick:f,copyLabel:m="Copy",copiedLabel:p="Copied",...g}=e,[v,x]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{if(!v)return;let e=setTimeout(()=>x(!1),2e3);return()=>clearTimeout(e)},[v]),(0,r.jsx)(o.z,{onClick:async e=>{let t=u?await u():n;x(!0),await (0,l.vQ)(t),null==f||f(e)},...g,className:(0,c.cn)({"px-1":d},g.className),icon:v?(0,r.jsx)(i.Z,{strokeWidth:2,className:"text-brand"}):null!==(t=g.icon)&&void 0!==t?t:(0,r.jsx)(a.Z,{}),children:!d&&(0,r.jsx)(r.Fragment,{children:null!=h?h:v?p:m})})}},1511:function(e,t,n){"use strict";n.d(t,{z:function(){return m}});var r=n(97458),i=n(15647),a=n(11968),s=n(32024),l=n(81307),o=n(52983),c=n(84012),u=n(34549),d=n(6433),h=n(15011),f=n(53486);let m=e=>{let{type:t="default",align:n="start",results:m,fileName:p,onDownloadAsCSV:g,onCopyAsMarkdown:v,onCopyAsJSON:x}=e,y=(0,o.useRef)(null),b=m.map(e=>{let t={...e};return Object.keys(e).forEach(n=>{"object"==typeof e[n]&&(t[n]=JSON.stringify(e[n]))}),t}),j=(0,o.useMemo)(()=>{if(m){let e=Array.from(m)[0];if(e)return Object.keys(e)}},[m]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(h.h_,{children:[(0,r.jsx)(h.$F,{asChild:!0,children:(0,r.jsx)(f.z,{type:t,iconRight:(0,r.jsx)(i.Z,{}),disabled:0===m.length,children:"Export"})}),(0,r.jsxs)(h.AW,{align:n,className:"w-44",children:[(0,r.jsxs)(h.Xi,{className:"gap-x-2",onClick:()=>{var e;null===(e=y.current)||void 0===e||e.link.click(),u.Am.success("Downloading results as CSV"),null==g||g()},children:[(0,r.jsx)(a.Z,{size:14}),(0,r.jsx)("p",{children:"Download CSV"})]}),(0,r.jsxs)(h.Xi,{onClick:()=>{if(navigator){0==b.length&&(0,u.Am)("Results are empty");let e=Object.keys(b[0]),t=b.map(t=>{let n=[];return e.forEach(e=>n.push(t[e])),n}),n=[e].concat(t),r=(0,l.x)(n);(0,d.vQ)(r,()=>{u.Am.success("Copied results to clipboard"),null==v||v()})}},className:"gap-x-2",children:[(0,r.jsx)(s.Z,{size:14}),(0,r.jsx)("p",{children:"Copy as markdown"})]}),(0,r.jsxs)(h.Xi,{onClick:()=>{if(navigator){if(0===m.length)return(0,u.Am)("Results are empty");(0,d.vQ)(JSON.stringify(m,null,2),()=>{u.Am.success("Copied results to clipboard"),null==x||x()})}},className:"gap-x-2",children:[(0,r.jsx)(s.Z,{size:14}),(0,r.jsx)("p",{children:"Copy as JSON"})]})]})]}),(0,r.jsx)(c.CSVLink,{ref:y,className:"hidden",headers:j,data:b,filename:"".concat(p,".csv")})]})}},77546:function(e,t,n){"use strict";n.d(t,{R:function(){return c}});var r=n(4330),i=n(28894),a=n(63609),s=n(70864);let l=r.Z.functions.list();async function o(e,t,n){let{projectRef:r,connectionString:i}=e,a=new Headers(n),{result:o}=await (0,s.R)({projectRef:r,connectionString:i,sql:l.sql,queryKey:["database-functions"]},t,a);return o}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:r=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.a)(a.A.databaseFunctions(t),e=>{let{signal:r}=e;return o({projectRef:t,connectionString:n},r)},{enabled:r&&void 0!==t,...s})}},51905:function(e,t,n){"use strict";n.d(t,{u$:function(){return c}});var r=n(28894),i=n(70864),a=n(55614),s=n(63609);let l=e=>{let{schemas:t,limit:n=100}=e;return"\n".concat(a.k,"\n\nwith records as (\n  select\n    c.oid::int8 as \"id\",\n    case c.relkind\n      when 'r' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n      when 'v' then concat(\n        'create view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'm' then concat(\n        'create materialized view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'f' then concat('create foreign table ', nc.nspname, '.', c.relname, ' ( ... )')\n      when 'p' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n    end as \"sql\"\n  from\n    pg_namespace nc\n    join pg_class c on nc.oid = c.relnamespace\n  where\n    c.relkind in ('r', 'v', 'm', 'f', 'p')\n    and not pg_is_other_temp_schema(nc.oid)\n    and (\n      pg_has_role(c.relowner, 'USAGE')\n      or has_table_privilege(\n        c.oid,\n        'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n      )\n      or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n    and nc.nspname IN (").concat(t.map(e=>"'".concat(e,"'")).join(", "),")\n  order by c.relname asc\n  limit ").concat(n,"\n  offset 0\n)\nselect\n  jsonb_build_object(\n    'definitions', coalesce(jsonb_agg(\n      jsonb_build_object(\n        'id', r.id,\n        'sql', r.sql\n      )\n    ), '[]'::jsonb)\n  ) \"data\"\nfrom records r;\n  ").trim()};async function o(e,t){let{projectRef:n,connectionString:r,schemas:a,limit:s}=e,o=l({schemas:a,limit:s}),{result:c}=await (0,i.R)({projectRef:n,connectionString:r,sql:o,queryKey:["entity-definitions",a]},t);return c[0].data.definitions}let c=function(e){let{projectRef:t,connectionString:n,schemas:i,limit:a}=e,{enabled:l=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.a)(s.A.entityDefinitions(t,i),e=>{let{signal:r}=e;return o({projectRef:t,connectionString:n,schemas:i,limit:a},r)},{enabled:l&&void 0!==t&&i.length>0,...c})}},29952:function(e,t,n){"use strict";n.d(t,{Kz:function(){return o}});var r=n(28894),i=n(70864),a=n(63609);let s=e=>{let{table:t,schema:n}=e,r=[];t&&r.push("tablename = '".concat(t,"'")),n&&r.push("schemaname = '".concat(n,"'"));let i=r.length>0?"WHERE ".concat(r.join(" AND ")):"";return"\n  \n  SELECT\n    tbl.schemaname,\n    tbl.tablename,\n    tbl.quoted_name,\n    tbl.is_table,\n    json_agg(a) as columns\n  FROM\n    (\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        true as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind = 'r'\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n      union all\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        false as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind in ('v', 'm')\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n    ) as tbl\n    LEFT JOIN (\n      SELECT\n        attrelid,\n        attname,\n        format_type(atttypid, atttypmod) as data_type,\n        attnum,\n        attisdropped\n      FROM\n        pg_attribute\n    ) as a ON (\n      a.attrelid = tbl.quoted_name::regclass\n      AND a.attnum > 0\n      AND NOT a.attisdropped\n      AND has_column_privilege(tbl.quoted_name, a.attname, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n  ".concat(i,"\n  GROUP BY schemaname, tablename, quoted_name, is_table;\n").trim()};async function l(e,t){let{projectRef:n,connectionString:r,table:a,schema:l}=e,o=s({table:a,schema:l}),{result:c}=await (0,i.R)({projectRef:n,connectionString:r,sql:o,queryKey:["table-columns",l,a]},t);return c}let o=function(e){let{projectRef:t,connectionString:n,schema:i,table:s}=e,{enabled:o=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.a)(a.A.tableColumns(t,i,s),e=>{let{signal:r}=e;return l({projectRef:t,connectionString:n,schema:i,table:s},r)},{enabled:o&&void 0!==t,...c})}},30740:function(e,t,n){"use strict";n.d(t,{k:function(){return l}});var r=n(62213);let i={search:"",timestampStart:"",timestampEnd:"",filters:{}},a=e=>(0,r.jo)({parse:t=>null!=t?t:e,serialize:e=>e||""}),s=e=>(0,r.jo)({parse:t=>{if(!t)return e;try{return JSON.parse(t)}catch(t){return e}},serialize:e=>{if(!e)return"";try{return JSON.stringify(e)}catch(e){return""}}});function l(){let[e,t]=(0,r.v1)("s",a(i.search)),[n,l]=(0,r.v1)("its",a(i.timestampStart)),[o,c]=(0,r.v1)("ite",a(i.timestampEnd)),[u,d]=(0,r.v1)("log",a("")),[h,f]=(0,r.v1)("f",s(i.filters)),m=e||i.search,p=n||i.timestampStart,g=o||i.timestampEnd,v=h||i.filters,x=e=>{t(e||i.search)},y=e=>{f(e||i.filters)};return{search:m,timestampStart:p,timestampEnd:g,selectedLogId:u||null,filters:v,setSearch:x,setTimeRange:(e,t)=>{l(e||i.timestampStart),c(t||i.timestampEnd)},setSelectedLogId:e=>{d(e||"")},setFilters:y,updateFilter:(e,t)=>{y({...v,[e]:t})},reset:()=>{x(i.search),l(i.timestampStart),c(i.timestampEnd),d(""),f(i.filters)}}}},95697:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return e6}});var r=n(97458),i=n(32691),a=n(52983),s=n(38001),l=n(36457),o=n(42019),c=n(59171),u=n(16402),d=n(85847),h=n(39390),f=n(9090),m=n(34583),p=n.n(m),g=n(34549),v=n(73512),x=n(67688),y=n(14723),b=n(51905),j=n(129),w=n(69658),N=n(18505),_=n(49736),k=n(5359),E=n(59884),S=n(91955),C=n(19521),L=n(9881),R=n(289),A=n(56535),O=n(34069),I=n(6433),T=n(27610),D=n(16333),F=n(41212),M=n(80342),q=n(25135),Z=n(22332),P=n(38336),z=n(43633),K=n(50322),U=n(15011),Q=n(53486),V=n(16303),G=n(96019),W=n(75307),B=n(47889),H=n(15518);let X=e=>{let{visible:t,hasDestructiveOperations:n,hasUpdateWithoutWhere:i,onCancel:a,onConfirm:s}=e;return(0,r.jsxs)(H.Z,{visible:t,size:"large",title:"Potential issue".concat(n&&i?"s":""," detected with your query"),confirmLabel:"Run this query",variant:"warning",alert:{base:{variant:"warning"},title:n&&i?"The following potential issues have been detected:":"The following potential issue has been detected:",description:"Ensure that these are intentional before executing this query"},onCancel:a,onConfirm:s,children:[(0,r.jsx)("div",{className:"text-sm",children:(0,r.jsxs)("ul",{className:"border rounded-md grid bg-surface-200",children:[n&&(0,r.jsxs)("li",{className:"grid pt-3 pb-2 px-4",children:[(0,r.jsx)("span",{className:"font-bold",children:"Query has destructive operation"}),(0,r.jsx)("span",{className:"text-foreground-lighter",children:"Make sure you are not accidentally removing something important."})]}),n&&i&&(0,r.jsx)(B.Z,{}),i&&(0,r.jsxs)("li",{className:"grid pt-2 pb-3 px-4 gap-1",children:[(0,r.jsx)("span",{className:"font-bold",children:"Query uses update without a where clause"}),(0,r.jsxs)("span",{className:"text-foreground-lighter",children:["Without a ",(0,r.jsx)("code",{className:"text-xs",children:"where"})," clause, this could update all rows in the table."]})]})]})}),(0,r.jsx)("p",{className:"mt-4 text-sm text-foreground-light",children:"Please confirm that you would like to execute this query."})]})};var Y=n(3075),J=n(90777),$=n(71926),ee=n(32672),et=n(84004);function en(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function er(e){return e!=e.toLowerCase()?'"'.concat(e,'"'):e}var ei=n(77546),ea=n(28894),es=n(70864),el=n(63609);let eo=()=>"\nSELECT word FROM pg_get_keywords();\n".trim();async function ec(e,t){let{projectRef:n,connectionString:r}=e,i=eo(),{result:a}=await (0,es.R)({projectRef:n,connectionString:r,sql:i,queryKey:["keywords"]},t);return a.map(e=>e.word.toLocaleLowerCase())}let eu=function(e){let{projectRef:t,connectionString:n}=e,{enabled:r=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ea.a)(el.A.keywords(t),e=>{let{signal:r}=e;return ec({projectRef:t,connectionString:n},r)},{enabled:r&&void 0!==t,...i})};var ed=n(1447),eh=n(29952),ef=n(35721);let em=(e,t)=>{let{project:n}=(0,ee.d2)(),r=(0,Z.B0)(),[i]=(0,ef.l)(A.dA.SQL_EDITOR_INTELLISENSE,!0),{data:s,isSuccess:l}=eu({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:i}),{data:o,isSuccess:c}=(0,ei.R)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:i}),{data:u,isSuccess:d}=(0,ed.Q1)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:i}),{data:h,isSuccess:f}=(0,eh.Kz)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:i}),m=(0,a.useRef)(null),p=i&&f&&d&&l&&c;p&&(null===m.current&&(m.current={}),m.current.tableColumns=h,m.current.schemas=u,m.current.keywords=s,m.current.functions=o),(0,a.useEffect)(()=>{if(t){let n=t.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(t){let n=t.getValue(),i=(0,O._)(n);return e&&r.setSql(e,i),[{range:t.getFullModelRange(),text:i}]}});return()=>n.dispose()}},[t]),(0,a.useEffect)(()=>{let e=null,n=null;return p&&t&&p&&(e=t.languages.registerCompletionItemProvider("pgsql",{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(e,n,r){try{let i=new et.Z(e,n.column-2,n.lineNumber-1);if('"'===r.triggerCharacter)return function(e,t,n){let r=[];if(!n.isFowardDQuote())return{suggestions:r};if(n.next(),n.isNextPeriod()){let i=n.readIdent(),a=!1;i.match(/^\".*?\"$/)&&(a=!0,i=en(i));let s=t.current.tableColumns.find(e=>a&&e.tablename===i||!a&&e.tablename.toLocaleLowerCase()==i.toLocaleLowerCase());if(!s)return{suggestions:r};s.columns.forEach(t=>{r.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:t.attname})})}else t.current.tableColumns.forEach(t=>{r.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,insertText:t.tablename})});return{suggestions:r}}(t,m,i);if("."===r.triggerCharacter)return function(e,t,n){let r=[],i=n.readIdents(3).map(e=>{let t=!1;return e.match(/^\".*?\"$/)&&(t=!0,e=en(e)),{isQuoted:t,name:e}}),a=0,s=t.current.schemas.find(e=>{var t,n;let r=i&&i.length>a?i[a]:{};return r.isQuoted&&e.name===r.name||!r.isQuoted&&(null===(t=e.name)||void 0===t?void 0:t.toLocaleLowerCase())==(null===(n=r.name)||void 0===n?void 0:n.toLocaleLowerCase())});if(s?a++:s=t.current.schemas.find(e=>"public"==e.name),i.length==a)return t.current.tableColumns.forEach(t=>{t.schemaname==s.name&&r.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==t.schemaname?t.schemaname:null,insertText:er(t.tablename)})}),{suggestions:r};let l=t.current.tableColumns.find(e=>{var t,n;let r=i&&i.length>a?i[a]:{};return e.schemaname==s.name&&r.isQuoted&&e.tablename===r.name||!r.isQuoted&&(null===(t=e.tablename)||void 0===t?void 0:t.toLocaleLowerCase())==(null===(n=r.name)||void 0===n?void 0:n.toLocaleLowerCase())});return l&&l.columns.forEach(t=>{r.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:er(t.attname)})}),{suggestions:r}}(t,m,i);return function(e,t){var n,r,i,a;let s=[];return(null===(n=t.current.keywords)||void 0===n?void 0:n.length)>0&&t.current.keywords.forEach(t=>{s.push({label:t,kind:e.languages.CompletionItemKind.Keyword,insertText:t})}),(null===(r=t.current.schemas)||void 0===r?void 0:r.length)>0&&t.current.schemas.forEach(t=>{s.push({label:t.name,kind:e.languages.CompletionItemKind.Keyword,insertText:t.name})}),(null===(i=t.current.tableColumns)||void 0===i?void 0:i.length)>0&&t.current.tableColumns.forEach(t=>{let n="public"==t.schemaname?t.tablename:t.schemaname+"."+t.tablename;s.push({label:t.tablename,detail:"public"!==t.schemaname?t.schemaname:null,kind:t.is_table?e.languages.CompletionItemKind.Class:e.languages.CompletionItemKind.Interface,insertText:er(n)}),t.columns.forEach(n=>{if(!n)return;let r=s.find(t=>t.label===(null==n?void 0:n.attname)&&t.kind===e.languages.CompletionItemKind.Field&&t.detail===(null==n?void 0:n.data_type));r?(r.tables.push(t.tablename),r.tables.sort(),r.documentation=r.tables.join(", ")):s.push({label:n.attname,kind:e.languages.CompletionItemKind.Field,detail:n.data_type,documentation:t.tablename,tables:[t.tablename],insertText:er(n.attname)})})}),(null===(a=t.current.functions)||void 0===a?void 0:a.length)>0&&t.current.functions.forEach(t=>{s.push({label:t.name,kind:e.languages.CompletionItemKind.Function,detail:t.return_type,insertText:t.name})}),{suggestions:s}}(t,m)}catch(e){return{suggestions:[]}}}}),n=t.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,t){let n=new et.Z(e,t.column-2,t.lineNumber-1),r=n.readArguments();if(r<0)return null;let i=n.readIdent();if(!i||i.match(/^\".*?\"$/))return null;let a=m.current.functions.find(e=>e.name.toLocaleLowerCase()===i.toLocaleLowerCase());if(!a||!a.args||a.args.length<r)return null;let s=Math.min(r,a.args.length-1),l=[];return l.push({label:"".concat(a.name,"(").concat(a.argument_types,")"),parameters:a.args.map(e=>({label:e.name}))}),{value:{signatures:l,activeSignature:0,activeParameter:s},dispose:()=>{}}}})),()=>{null==e||e.dispose(),null==n||n.dispose()}},[p,t])};var ep=n(1511),eg=n(42667),ev=n(19337),ex=n(28977),ey=n.n(ex),eb=n(42723),ej=n(11321),ew=n(2861),eN=n(88473),e_=n(69371),ek=n(30114),eE=n(83145),eS=n.n(eE),eC=n(33971),eL=n(7257),eR=n(68981),eA=n(5562),eO=n(27429);let eI=(e,t)=>{var n;return(null==e?void 0:null===(n=e.rows)||void 0===n?void 0:n.length)?e.rows.reduce((e,n)=>{let r=e[e.length-1]||{};return[...e,{...n,[t.yKey]:(r[t.yKey]||0)+n[t.yKey]}]},[]):[]},eT=["number","string","date"],eD=e=>{let{results:t={rows:[]},config:n,onConfigChange:i}=e,{ref:s}=(0,v.UO)(),l=(0,ek.P)("reportsV2"),[o,c]=(0,ef.l)(A.dA.SQL_EDITOR_SQL_BLOCK_ACKNOWLEDGED(s),!1),u=(0,a.useMemo)(()=>Object.keys(t.rows[0]||{}).filter(e=>{let n=typeof t.rows[0][e];return eT.includes(n)}),[t]),d=(0,a.useMemo)(()=>t.rows[0]?Object.keys(t.rows[0]).filter(e=>{let n=t.rows[0][e];return"number"==typeof n||!isNaN(Number(n))}):[],[t]),h=n.xKey&&n.yKey,f=(0,a.useMemo)(()=>{var e,r;if(!h)return!1;let i=typeof(null===(e=t.rows[0])||void 0===e?void 0:e[n.xKey]),a=typeof(null===(r=t.rows[0])||void 0===r?void 0:r[n.yKey]);return"number"===i&&"number"===a},[h,t.rows,n.xKey,n.yKey]),m=(0,a.useMemo)(()=>eI(t,n),[t,n]),p=n.cumulative?m:t.rows,g=(e=>{var t;let n=(null==p?void 0:null===(t=p[0])||void 0===t?void 0:t[e])||"";return"number"==typeof n?"number":ey()(n).isValid()?"date":"string"})(n.xKey);return u.length?(0,r.jsxs)(P.pO,{direction:"horizontal",className:"flex-grow h-full",children:[(0,r.jsx)(P.ee,{className:"p-4 h-full",defaultSize:75,children:h?"bar"===n.type?(0,r.jsx)(eN.Z,{showLegend:!0,size:"normal",xAxisIsDate:"date"===g,data:p,xAxisKey:n.xKey,yAxisKey:n.yKey,showGrid:n.showGrid,XAxisProps:{angle:0,interval:"preserveStart",hide:!n.showLabels,tickFormatter:e=>{let t=p[+e][n.xKey];return"date"===g?ey()(t).format("MMM D YYYY HH:mm"):t}},YAxisProps:{tickFormatter:e=>e.toLocaleString(),hide:!n.showLabels,domain:[0,"dataMax"]}}):null:(0,r.jsx)(P.ee,{className:"p-4 h-full",defaultSize:75,children:(0,r.jsx)(e_.Z,{size:"normal",title:"Configure your chart",description:"Select your X and Y axis in the chart options panel"})})}),(0,r.jsx)(P.Dp,{withHandle:!0}),(0,r.jsxs)(P.ee,{defaultSize:25,minSize:15,className:"px-3 py-3 space-y-4 !overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center h-5",children:[(0,r.jsx)("h2",{className:"text-sm text-foreground-lighter",children:"Chart options"}),n.xKey&&n.yKey&&(0,r.jsx)(ew.u,{type:"text",size:"tiny",onClick:()=>{let e=n.xKey,t=n.yKey;i({...n,xKey:t,yKey:e})},disabled:!f,icon:(0,r.jsx)(eb.Z,{size:"15",className:"text-foreground-lighter"}),tooltip:{content:{side:"bottom",className:"w-64 text-center",text:f?"Swap X and Y axis":"Unable to swap X and Y axis - both axes need to numerical values"}},children:"Flip"})]}),l&&!o&&(0,r.jsxs)(eO.J,{showIcon:!1,type:"tip",className:"p-2 relative group",children:[(0,r.jsxs)(K.u,{children:[(0,r.jsx)(K.aJ,{onClick:()=>c(!0),className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,r.jsx)(ej.Z,{size:14,className:"text-foreground-light"})}),(0,r.jsx)(K._v,{side:"bottom",children:"Dismiss"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,r.jsx)(eC.C,{variant:"success",className:"text-xs rounded px-1",children:"NEW"}),(0,r.jsx)("p",{className:"text-xs",children:"Add this chart to custom reports"})]}),(0,r.jsx)("p",{className:"text-xs text-foreground-light mt-1",children:"SQL snippets can now be added and saved to your custom reports. Try it out now!"}),(0,r.jsx)(Q.z,{asChild:!0,size:"tiny",type:"default",className:"mt-2",children:(0,r.jsx)(eS(),{href:"/project/".concat(s,"/reports"),children:"Head to Reports"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(eL._,{className:"text-xs text-foreground-light",children:"X Axis"}),(0,r.jsxs)(eR.Ph,{value:n.xKey,onValueChange:e=>{i({...n,xKey:e})},children:[(0,r.jsx)(eR.i4,{children:n.xKey||"Select X Axis"}),(0,r.jsx)(eR.Bw,{children:(0,r.jsx)(eR.DI,{children:u.map(e=>(0,r.jsx)(eR.Ql,{value:e,children:e},e))})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(eL._,{className:"text-xs text-foreground-light",children:"Y Axis"}),(0,r.jsxs)(eR.Ph,{value:n.yKey,onValueChange:e=>{i({...n,yKey:e})},children:[(0,r.jsx)(eR.i4,{children:n.yKey||"Select Y Axis"}),(0,r.jsx)(eR.Bw,{children:(0,r.jsx)(eR.DI,{children:d.map(e=>(0,r.jsx)(eR.Ql,{value:e,children:e},e))})})]})]}),(0,r.jsxs)("div",{className:"*:flex *:gap-2 *:items-center grid gap-2 *:text-foreground-light *:p-1.5 *:pl-0",children:[(0,r.jsxs)(eL._,{className:"",htmlFor:"cumulative",children:[(0,r.jsx)(eA.X,{id:"cumulative",name:"cumulative",checked:n.cumulative,onClick:()=>i({...n,cumulative:!n.cumulative})}),"Cumulative"]}),(0,r.jsxs)(eL._,{htmlFor:"showLabels",children:[(0,r.jsx)(eA.X,{id:"showLabels",name:"showLabels",checked:n.showLabels,onClick:()=>i({...n,showLabels:!n.showLabels})}),"Show labels"]}),(0,r.jsxs)(eL._,{htmlFor:"showGrid",children:[(0,r.jsx)(eA.X,{id:"showGrid",name:"showGrid",checked:n.showGrid,onClick:()=>i({...n,showGrid:!n.showGrid})}),"Show grid"]})]})]})]}):(0,r.jsx)("div",{className:"p-2",children:(0,r.jsx)(e_.Z,{size:"normal",description:"Execute a query and configure the chart options."})})};var eF=n(84053);let eM=(0,n(74234).Z)("Keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);var eq=n(9738),eZ=n(78616),eP=n(29468),ez=n(26487),eK=n(64269),eU=n(88683),eQ=n(79896),eV=n(19369),eG=n(89898),eW=e=>{let{id:t}=e,{profile:n}=(0,T.Un)(),i=(0,Z.B0)().snippets[t],a=(null==n?void 0:n.id)===(null==i?void 0:i.snippet.owner_id);return(0,r.jsx)(r.Fragment,{children:a?null:(0,r.jsx)(eC.C,{children:"Read-only"})})},eB=e=>{let{id:t}=e,{profile:n}=(0,T.Un)(),i=(0,Z.B0)(),s=i.savingStates[t],l=(0,eG.D9)(s),[o,c]=(0,a.useState)(!1),u=i.snippets[t],h=(null==n?void 0:n.id)===(null==u?void 0:u.snippet.owner_id);return(0,a.useEffect)(()=>{let e=!1;return"UPDATING"===l&&"IDLE"===s&&(c(!0),setTimeout(()=>{e||c(!1)},5e3)),()=>{e=!0}},[s]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:[h&&"UPDATING_FAILED"===s&&(0,r.jsx)(Q.z,{type:"text",size:"tiny",icon:(0,r.jsx)(eQ.Z,{className:"text-gray-1100",strokeWidth:2}),onClick:()=>i.addNeedsSaving(t),children:"Retry"}),o?(0,r.jsxs)(K.u,{children:[(0,r.jsx)(K.aJ,{children:(0,r.jsx)(eq.Z,{className:"text-brand",size:14,strokeWidth:3})}),(0,r.jsx)(K._v,{side:"bottom",children:"All changes saved"})]}):"UPDATING"===s?(0,r.jsxs)(K.u,{children:[(0,r.jsx)(K.aJ,{children:(0,r.jsx)(d.Z,{className:"animate-spin",size:14,strokeWidth:2})}),(0,r.jsx)(K._v,{children:"Saving changes..."})]}):"UPDATING_FAILED"===s?h?(0,r.jsxs)(K.u,{children:[(0,r.jsx)(K.aJ,{children:(0,r.jsx)(eV.Z,{className:"text-red-900",size:14,strokeWidth:2})}),(0,r.jsx)(K._v,{children:"Failed to save changes"})]}):(0,r.jsx)(eW,{id:t}):null]})})},eH=e=>{let{id:t,isExecuting:n=!1,isDisabled:i=!1,hasSelection:a,prettifyQuery:s,executeQuery:l}=e;(0,I.fV)();let{ref:o}=(0,v.UO)(),c=(0,Z.B0)(),[u]=(0,ef.l)(A.dA.SQL_EDITOR_AI_OPEN,!0),[d,h]=(0,ef.l)(A.dA.SQL_EDITOR_INTELLISENSE,!0),[f,m]=(0,ef.l)(A.dA.SQL_EDITOR_LAST_SELECTED_DB(o),""),p=c.snippets[t],x=void 0!==p&&p.snippet.favorite,y=()=>{h(!d),g.Am.success("Successfully ".concat(d?"disabled":"enabled"," intellisense. ").concat(d?"Please refresh your browser for changes to take place.":""))},b=()=>c.addFavorite(t),j=()=>c.removeFavorite(t);return(0,r.jsxs)("div",{className:"inline-flex items-center justify-end gap-x-2",children:[A.Qy&&(0,r.jsx)(eB,{id:t}),(0,r.jsxs)(U.h_,{children:[(0,r.jsx)(U.$F,{asChild:!0,children:(0,r.jsx)(Q.z,{type:"default",className:(0,z.cn)("px-1",u?"block 2xl:hidden":"hidden"),icon:(0,r.jsx)(eF.Z,{className:"text-foreground-light"})})}),(0,r.jsxs)(U.AW,{className:"w-48",children:[(0,r.jsxs)(U.Xi,{className:"justify-between",onClick:y,children:[(0,r.jsxs)("span",{className:"flex items-center gap-x-2",children:[(0,r.jsx)(eM,{size:14,className:"text-foreground-light"}),"Intellisense enabled"]}),d&&(0,r.jsx)(eq.Z,{className:"text-brand",size:16})]}),(0,r.jsx)(U.VD,{}),(0,r.jsxs)(U.Xi,{className:"gap-x-2",onClick:()=>{x?j():b()},children:[(0,r.jsx)(eZ.Z,{size:14,strokeWidth:2,className:x?"fill-brand stroke-none":"fill-none stroke-foreground-light"}),x?"Remove from":"Add to"," favorites"]}),(0,r.jsxs)(U.Xi,{className:"gap-x-2",onClick:s,children:[(0,r.jsx)(eP.Z,{size:14,strokeWidth:2,className:"text-foreground-light"}),"Prettify SQL"]})]})]}),(0,r.jsxs)("div",{className:(0,z.cn)("items-center gap-x-2",u?"hidden 2xl:flex":"flex"),children:[(0,r.jsxs)(U.h_,{children:[(0,r.jsx)(U.$F,{asChild:!0,children:(0,r.jsx)(Q.z,{type:"text",className:"px-1",icon:(0,r.jsx)(eM,{className:"text-foreground-light"})})}),(0,r.jsx)(U.AW,{className:"w-48",children:(0,r.jsxs)(U.Xi,{className:"justify-between",onClick:y,children:["Intellisense enabled",d&&(0,r.jsx)(eq.Z,{className:"text-brand",size:16})]})})]}),A.Qy&&(0,r.jsxs)(K.u,{children:[(0,r.jsx)(K.aJ,{asChild:!0,children:x?(0,r.jsx)(Q.z,{type:"text",size:"tiny",onClick:j,className:"px-1",icon:(0,r.jsx)(eZ.Z,{className:"fill-brand stroke-none"})}):(0,r.jsx)(Q.z,{type:"text",size:"tiny",onClick:b,className:"px-1",icon:(0,r.jsx)(eZ.Z,{className:"fill-none stroke-foreground-light"})})}),(0,r.jsxs)(K._v,{side:"bottom",children:[x?"Remove from":"Add to"," favorites"]})]}),(0,r.jsxs)(K.u,{children:[(0,r.jsx)(K.aJ,{asChild:!0,children:(0,r.jsx)(Q.z,{type:"text",onClick:s,className:"px-1",icon:(0,r.jsx)(eP.Z,{strokeWidth:2,className:"text-foreground-light"})})}),(0,r.jsx)(K._v,{side:"bottom",children:"Prettify SQL"})]})]}),(0,r.jsx)("div",{className:"flex items-center justify-between gap-x-2",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(eK.Z,{selectedDatabaseId:0===f.length?void 0:f,variant:"connected-on-right",onSelectId:e=>{c.resetResult(t),m(e)}}),(0,r.jsx)(ez.Q,{serviceRoleLabel:"postgres",variant:"connected-on-both"}),(0,r.jsx)(eU.F,{isDisabled:i||n,isExecuting:n,className:"rounded-l-none min-w-[82px]",onClick:l})]})})]})},eX=n(99033),eY=n(8294),eJ=n(54669),e$=e=>{var t,n,i,a,s,l,o,c,u;let{id:h,isExecuting:f,isDisabled:m,isDebugging:p,onDebug:g}=e,{ref:x}=(0,v.UO)(),y=(0,M.TF)(),b=(0,L.l)(),j=(0,Z.B0)(),w=null===(t=j.results[h])||void 0===t?void 0:t[0],{data:N}=(0,k.Gl)({orgSlug:null==b?void 0:b.slug}),_=(0,V.$w)(N),E=(null==w?void 0:null===(i=w.error)||void 0===i?void 0:null===(n=i.message)||void 0===n?void 0:n.includes("canceling statement due to statement timeout"))||(null==w?void 0:null===(s=w.error)||void 0===s?void 0:null===(a=s.message)||void 0===a?void 0:a.includes("upstream request timeout"));if(f)return(0,r.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,r.jsx)(d.Z,{size:14,className:"animate-spin"}),(0,r.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running..."})]});if(null==w?void 0:w.error){let e=(null!==(u=null===(o=w.error)||void 0===o?void 0:null===(l=o.formattedError)||void 0===l?void 0:l.split("\n"))&&void 0!==u?u:[]).filter(e=>e.length>0),t=y.selectedDatabaseId!==x&&w.error.message.includes("in a read-only transaction"),n=w.error.message.includes("Query is too large to be run via the SQL Editor");return(0,r.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,r.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[E?(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsx)("p",{className:"font-mono text-sm",children:"SQL query ran into an upstream timeout"}),(0,r.jsxs)("p",{className:"font-mono text-sm text-foreground-light",children:["You can either"," ",(0,r.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline transition hover:text-foreground",href:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",children:"optimize your query"}),", or"," ",(0,r.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline transition hover:text-foreground",href:"https://supabase.com/docs/guides/database/timeouts",children:"increase the statement timeout"}),"."]})]}):(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[e.length>0?e.map((e,t)=>(0,r.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},"error-".concat(t))):(0,r.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",null===(c=w.error)||void 0===c?void 0:c.message]}),!E&&w.autoLimit&&(0,r.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: A limit of ",w.autoLimit,' was applied to your query. If this was the cause of a syntax error, try selecting "No limit" instead and re-run the query.']}),t&&(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"Note: Read replicas are for read only queries. Run write queries on the primary database instead."}),n&&(0,r.jsxs)("p",{className:"text-sm text-foreground-light flex items-center gap-x-1",children:["Run this query by"," ",(0,r.jsxs)(eS(),{target:"_blank",rel:"noreferrer",href:"/project/".concat(x,"/settings/database"),className:"underline transition hover:text-foreground flex items-center gap-x-1",children:["connecting to your database directly",(0,r.jsx)(eX.Z,{size:12})]}),"."]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[t&&(0,r.jsx)(Q.z,{className:"py-2",type:"default",onClick:()=>{y.setSelectedDatabaseId(x),j.resetResult(h)},children:"Switch to primary database"}),!_&&(0,r.jsx)(Q.z,{icon:(0,r.jsx)(eY.c,{className:"scale-75 w-3 h-3",loading:p}),disabled:!!m||p,onClick:g,children:"Debug with Supabase AI"})]})]})})}return w?w.rows.length<=0?(0,r.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,r.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,r.jsx)(eJ.Z,{rows:w.rows}):(0,r.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,r.jsxs)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:["Click ",(0,r.jsx)("code",{children:"Run"})," to execute your query."]})})};let e0={type:"bar",cumulative:!1,xKey:"",yKey:"",showLabels:!1,showGrid:!1};var e1=e=>{var t,n,i;let{id:a,isExecuting:s,isDebugging:l,isDisabled:o,hasSelection:c,prettifyQuery:u,executeQuery:d,onDebug:h}=e,{ref:f}=(0,v.UO)(),m=(0,L.l)(),p=(0,Z.B0)(),x=null===(t=p.snippets[a])||void 0===t?void 0:t.snippet,y=null===(n=p.results[a])||void 0===n?void 0:n[0],{mutate:b}=(0,E.a)(),{mutate:j}=(0,eg.R)({invalidateQueriesOnSuccess:!1,onMutate:async e=>{let{payload:t}=e;if("sql"!==t.type||!("chart"in t.content))return;let n={...x,content:{...x.content,chart:t.content.chart}};p.updateSnippet({id:a,snippet:n})},onError:async(e,t,n)=>{g.Am.error("Failed to update chart. Please try again.")}}),w=x&&"sql"===x.type&&(null===(i=x.content)||void 0===i?void 0:i.chart)?x.content.chart:e0;return(0,r.jsxs)(ev.mQ,{defaultValue:"results",className:"w-full h-full flex flex-col",children:[(0,r.jsxs)(ev.dr,{className:"flex justify-between gap-2 px-4 overflow-x-auto min-h-[42px]",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(ev.SP,{className:"py-3 text-xs",value:"results",children:(0,r.jsx)("span",{className:"translate-y-[1px]",children:"Results"})}),(0,r.jsx)(ev.SP,{className:"py-3 text-xs",value:"chart",children:(0,r.jsx)("span",{className:"translate-y-[1px]",children:"Chart"})}),(null==y?void 0:y.rows)&&(0,r.jsx)(ep.z,{type:"text",results:y.rows,fileName:"Supabase Snippet ".concat(x.name),onDownloadAsCSV:()=>{var e;return b({action:"sql_editor_result_download_csv_clicked",groups:{project:null!=f?f:"",organization:null!==(e=null==m?void 0:m.slug)&&void 0!==e?e:""}})},onCopyAsMarkdown:()=>{var e;b({action:"sql_editor_result_copy_markdown_clicked",groups:{project:null!=f?f:"",organization:null!==(e=null==m?void 0:m.slug)&&void 0!==e?e:""}})},onCopyAsJSON:()=>{var e;b({action:"sql_editor_result_copy_json_clicked",groups:{project:null!=f?f:"",organization:null!==(e=null==m?void 0:m.slug)&&void 0!==e?e:""}})}})]}),(0,r.jsx)(eH,{id:a,isExecuting:s,isDisabled:o,hasSelection:c,prettifyQuery:u,executeQuery:d})]}),(0,r.jsx)(ev.nU,{asChild:!0,value:"results",className:"mt-0 flex-grow",children:(0,r.jsx)(e$,{id:a,isExecuting:s,isDisabled:o,onDebug:h,isDebugging:l})}),(0,r.jsx)(ev.nU,{asChild:!0,value:"chart",className:"mt-0 flex-grow",children:(0,r.jsx)(eD,{results:y,config:w,onConfigChange:function(e){f&&(null==x?void 0:x.id)&&j({projectRef:f,payload:{...x,id:x.id,description:x.description||"",project_id:x.project_id||0,content:{...x.content,content_id:a,chart:e}}})}})})]})};let e2=p()(()=>n.e(6417).then(n.bind(n,76417)),{loadableGenerated:{webpack:()=>[76417]},ssr:!1}),e4=p()(()=>Promise.resolve().then(n.bind(n,85229)).then(e=>{let{DiffEditor:t}=e;return t}),{loadableGenerated:{webpack:()=>[85229]},ssr:!1}),e3=()=>{var e,t,n;let s=(0,I.fV)(),m=(0,i.useRouter)(),{ref:p,id:B}=(0,v.UO)(),H=(0,L.l)(),{profile:ee}=(0,T.Un)(),et=(0,l.NL)(),en=(0,R.Vm)(),er=(0,L.l)(),ei=(0,F.WZ)(),ea=(0,Z.B0)(),es=(0,q.z6)(),el=(0,M.TF)(),eo=(0,S.C)(),[ec]=(0,C.l)(null==en?void 0:en.ref),eu=eo||!A.Qy,{sourceSqlDiff:ed,setSourceSqlDiff:eh,selectedDiffType:ef,setSelectedDiffType:ep,pendingTitle:eg,setIsAcceptDiffLoading:ev,isDiffOpen:ex,defaultSqlDiff:ey,closeDiff:eb}=(0,W.Yx)(),{promptState:ej,setPromptState:ew,promptInput:eN,setPromptInput:e_,resetPrompt:ek}=(0,W.iM)(),eE=(0,a.useRef)(null),eS=(0,a.useRef)(null),eC=(0,a.useRef)(null),[eL,eR]=(0,a.useState)(!1),[eA,eO]=(0,a.useState)([]),[eI,eT]=(0,a.useState)(!1),[eD,eF]=(0,a.useState)(!1),[eM,eq]=(0,a.useState)(!1),[eZ,eP]=(0,a.useState)(!1),[ez,eK]=(0,a.useState)(!1),eU=(0,a.useMemo)(()=>(0,I.k$)(),[B]),eQ=B&&"new"!==B?B:eU,eV=ea.limit,eG=null===(e=ea.results[eQ])||void 0===e?void 0:e[0],eW=!(eQ in ea.snippets&&void 0!==ea.snippets[eQ].snippet.content),eB="new"!==B&&eW;em(eQ,eS.current);let{data:eH}=(0,k.Gl)({orgSlug:null==er?void 0:er.slug}),eX=(0,V.$w)(eH),{data:eY,isSuccess:eJ}=(0,N.bN)({projectRef:p}),{data:e$,refetch:e0}=(0,b.u$)({schemas:ec,projectRef:null==en?void 0:en.ref,connectionString:null==en?void 0:en.connectionString},{enabled:eu}),e3=eu?null==e$?void 0:e$.map(e=>e.sql.trim()):void 0,{mutateAsync:e8}=(0,y.g)(),{mutate:e7}=(0,E.a)(),{mutate:e9,isLoading:e5}=(0,_.r)({onSuccess(e,t){eQ&&ea.addResult(eQ,e.result,t.autoLimit),e0(),et.invalidateQueries(w.X.lint(p))},onError(e,t){if(eQ){if(e.position&&eS.current){var n,r,i;let t=eE.current,a=eS.current,s=eL&&null!==(r=null==t?void 0:null===(n=t.getSelection())||void 0===n?void 0:n.startLineNumber)&&void 0!==r?r:0,l=null!==(i=e.formattedError)&&void 0!==i?i:"",o=l.slice(l.indexOf("LINE")),c=s+Number(o.slice(0,o.indexOf(":")).split(" ")[1]);if(!isNaN(c)){let e=null==t?void 0:t.deltaDecorations([],[{range:new a.Range(c,1,c,20),options:{isWholeLine:!0,inlineClassName:"bg-warning-400"}}]);e&&(null==t||t.revealLineInCenter(c),eO(e))}}ea.addResultError(eQ,e,t.autoLimit)}}}),e6=(0,a.useCallback)(async(e,t)=>{try{let{title:n}=await e8({sql:t});ea.renameSnippet({id:e,name:n})}catch(e){}},[e8,ea]),te=(0,a.useCallback)(async()=>{if(ex)return;let e=(0,Z.pB)().snippets[eQ];if(eE.current&&en){var t,n,r,i,a,s;let l=eE.current,o=l.getSelection(),c=o?null===(t=l.getModel())||void 0===t?void 0:t.getValueInRange(o):void 0,u=e?null!==(s=c||(null===(n=eE.current)||void 0===n?void 0:n.getValue()))&&void 0!==s?s:null===(r=e.snippet.content)||void 0===r?void 0:r.sql:c||(null===(i=eE.current)||void 0===i?void 0:i.getValue()),d=(0,O._)(u),h=null==eE?void 0:null===(a=eE.current)||void 0===a?void 0:a.getModel();eE.current&&h&&(eE.current.executeEdits("apply-prettify-edit",[{text:d,range:h.getFullModelRange()}]),ea.setSql(eQ,d))}},[eQ,ex,en,ea]),tt=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(ex)return;let t=(0,Z.pB)().snippets[eQ];if(null!==eE.current&&!e5&&void 0!==en){var n,r,i,a,s,l,o;let c=eE.current,u=c.getSelection(),d=u?null===(n=c.getModel())||void 0===n?void 0:n.getValueInRange(u):void 0,h=t?null!==(l=d||(null===(r=eE.current)||void 0===r?void 0:r.getValue()))&&void 0!==l?l:null===(i=t.snippet.content)||void 0===i?void 0:i.sql:d||(null===(a=eE.current)||void 0===a?void 0:a.getValue()),f=!1,m=(0,$.mw)(h);!e&&m&&(eF(!0),eq(!0),f=!0);let v=(0,$.tA)(h);if(!e&&v&&(eF(!0),eP(!0),f=!0),f)return;eX||(null==t?void 0:t.snippet.name)!==Y.$C||e6(eQ,h),eA.length>0&&(null==c||c.deltaDecorations(eA,[]),eO([]));let x=es(),y=null==eY?void 0:null===(s=eY.find(e=>e.identifier===el.selectedDatabaseId))||void 0===s?void 0:s.connectionString;if(A.Qy&&!y)return g.Am.error("Unable to run query: Connection string is missing");let{appendAutoLimit:b}=(0,$.c6)(h,eV),j=(0,$.se)(h,eV);e9({projectRef:en.ref,connectionString:y,sql:(0,D.Jh)(j,{projectRef:en.ref,role:x}),autoLimit:b?eV:void 0,isRoleImpersonationEnabled:(0,q.Gm)(x),contextualInvalidation:!0,handleError:e=>{throw e}}),e7({action:"sql_editor_query_run_button_clicked",groups:{project:null!=p?p:"Unknown",organization:null!==(o=null==H?void 0:H.slug)&&void 0!==o?o:"Unknown"}})}},[ex,eQ,e5,en,eX,e9,es,e6,el.selectedDatabaseId,eY,eV]),tn=(0,a.useCallback)(async(e,t)=>{if(!p)return console.error("Project ref is required");if(!ee)return console.error("Profile is required");if(!en)return console.error("Project is required");try{let n=(0,$.wI)({id:(0,I.k$)(),name:t,sql:e,owner_id:ee.id,project_id:en.id});ea.addSnippet({projectRef:p,snippet:n}),ea.addNeedsSaving(n.id),m.push("/project/".concat(p,"/sql/").concat(n.id))}catch(e){g.Am.error("Failed to create new query: ".concat(e.message))}},[null==ee?void 0:ee.id,null==en?void 0:en.id,p,m,ea]),tr=(0,a.useCallback)(async()=>{var e,t,n;try{let r=ea.snippets[eQ],i=null===(e=ea.results[eQ])||void 0===e?void 0:e[0];ei.setAiAssistantPanel({open:!0,sqlSnippets:[(null!==(n=null===(t=r.snippet.content)||void 0===t?void 0:t.sql)&&void 0!==n?n:"").replace(Y.eg,"").trim()],initialInput:"Help me to debug the attached sql snippet which gives the following error: \n\n".concat(i.error.message)})}catch(e){e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message&&g.Am.error("Sorry, the assistant failed to debug your query! Please try again with a different one.")}},[e3,eQ,ea.results,ea.snippets]),ti=(0,a.useCallback)(async()=>{try{var e;if(ev(!0),!ed||!eE.current||!eC.current)return;let t=eE.current.getModel(),n=eC.current.getModel();if(!t||!n)return;let r=n.modified.getValue();if(ef===J.U.NewSnippet){let{title:e}=await e8({sql:r});await tn(r,e)}else eE.current.executeEdits("apply-ai-edit",[{text:r,range:t.getFullModelRange()}]),eg&&ea.renameSnippet({id:eQ,name:eg});e7({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!0},groups:{project:null!=p?p:"Unknown",organization:null!==(e=null==H?void 0:H.slug)&&void 0!==e?e:"Unknown"}}),ep(J.U.Modification),ek(),eb()}finally{ev(!1)}},[ed,ef,tn,e8,m,eQ,eg,ea]),ta=(0,a.useCallback)(()=>{var e;e7({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!1},groups:{project:null!=p?p:"Unknown",organization:null!==(e=null==H?void 0:H.slug)&&void 0!==e?e:"Unknown"}}),ek(),eb()},[eb,ek,e7]),{complete:ts,completion:tl,isLoading:to}=(0,o.GO)({api:"".concat(A.GW,"/api/ai/sql/complete"),body:{projectRef:null==en?void 0:en.ref,connectionString:null==en?void 0:en.connectionString,includeSchemaMetadata:eu},onResponse:e=>{if(!e.ok)throw Error("Failed to generate completion")},onError:e=>{g.Am.error("Failed to generate SQL: ".concat(e.message))}}),tc=async(e,t)=>{try{var n;ew(e=>({...e,selection:t.selection,beforeSelection:t.beforeSelection,afterSelection:t.afterSelection}));let r=await (0,j.oT)();await ts(e,{headers:{Authorization:null!==(n=r.get("Authorization"))&&void 0!==n?n:""},body:{completionMetadata:{textBeforeCursor:t.beforeSelection,textAfterCursor:t.afterSelection,language:"pgsql",prompt:e,selection:t.selection}}})}catch(e){ew(e=>({...e,isLoading:!1}))}};return(0,a.useEffect)(()=>{eQ&&(eb(),ew(e=>({...e,isOpen:!1})))},[eb,eQ]),(0,a.useEffect)(()=>{let e=e=>{if(ex||ej.isOpen)switch(e.key){case"Enter":("macos"===s?e.metaKey:e.ctrlKey)&&ex&&(ti(),ek());return;case"Escape":var t;ex&&ta(),ek(),null===(t=eE.current)||void 0===t||t.focus();return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s,ex,ej.isOpen,ti,ta,ek]),(0,a.useEffect)(()=>{if(ex){let e=eC.current,t=null==e?void 0:e.getModel();if(t&&t.original&&t.modified){t.original.setValue(ey.original),t.modified.setValue(ey.modified);let n=e.getModifiedEditor(),r=ej.startLineNumber;n.revealLineInCenter(r)}}},[ef,ed]),(0,a.useEffect)(()=>{if(eJ){let e=eY.find(e=>e.identifier===p);el.setSelectedDatabaseId(null==e?void 0:e.identifier)}},[eJ,eY,p]),(0,a.useEffect)(()=>{if(void 0!==ea.diffContent){var e,t,n,r,i;let{diffType:a,sql:s}=ea.diffContent,l=null===(e=eE.current)||void 0===e?void 0:e.getModel();l&&(0===(null!==(n=null===(t=eE.current)||void 0===t?void 0:t.getValue())&&void 0!==n?n:"").length?null===(r=eE.current)||void 0===r||r.executeEdits("apply-ai-message",[{text:"".concat(s),range:l.getFullModelRange()}]):(eh({original:(null===(i=eE.current)||void 0===i?void 0:i.getValue())||"",modified:s}),ep(a)))}},[ea.diffContent]),(0,a.useEffect)(()=>{if(!tl)return;let e=ej.beforeSelection+ej.selection+ej.afterSelection,t=ej.beforeSelection+tl+ej.afterSelection;to&&(eh({original:e,modified:(0,O._)(t)}),ep(J.U.Modification),ew(e=>({...e,isLoading:!1})))},[tl,ej.beforeSelection,ej.selection,ej.afterSelection,to]),(0,a.useEffect)(()=>{if(ex){if(eC.current&&eI)return eK(!0),()=>eK(!1)}else eT(!1),eK(!1)},[ex,eI]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(X,{visible:eD,hasDestructiveOperations:eM,hasUpdateWithoutWhere:eZ,onCancel:()=>{eF(!1),eq(!1),eP(!1),setTimeout(()=>{var e;return null===(e=eE.current)||void 0===e?void 0:e.focus()},100)},onConfirm:()=>{eF(!1),tt(!0)}}),(0,r.jsx)(P.pO,{className:"flex h-full",direction:"horizontal",autoSaveId:A.dA.SQL_EDITOR_AI_PANEL_SPLIT_SIZE,children:(0,r.jsx)(P.ee,{minSize:30,children:(0,r.jsxs)(P.pO,{className:"relative",direction:"vertical",autoSaveId:A.dA.SQL_EDITOR_SPLIT_SIZE,children:[(0,r.jsx)(P.ee,{maxSize:70,children:(0,r.jsx)("div",{className:"flex-grow overflow-y-auto border-b h-full",children:eB?(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,r.jsx)(d.Z,{className:"animate-spin text-brand"})}):(0,r.jsxs)(r.Fragment,{children:[ex&&(0,r.jsxs)("div",{className:"w-full h-full",children:[(0,r.jsx)(e4,{theme:"supabase",language:"pgsql",original:ey.original,modified:ey.modified,onMount:e=>{eC.current=e,eT(!0)},options:{fontSize:13,renderSideBySide:!1,minimap:{enabled:!1},wordWrap:"on",lineNumbers:"on",folding:!1,padding:{top:4},lineNumbersMinChars:3}}),ez&&(0,r.jsx)(G.Z,{editor:eC.current,id:"ask-ai-diff",value:eN,onChange:e_,onSubmit:e=>{tc(e,{beforeSelection:ej.beforeSelection,selection:ej.selection||ey.modified,afterSelection:ej.afterSelection})},onAccept:ti,onReject:ta,onCancel:ek,isDiffVisible:!0,isLoading:to,startLineNumber:Math.max(0,ej.startLineNumber),endLineNumber:ej.endLineNumber})]}),(0,r.jsxs)("div",{className:"w-full h-full relative",children:[(0,r.jsx)(e2,{autoFocus:!0,id:eQ,className:(0,z.cn)(ex&&"hidden"),editorRef:eE,monacoRef:eS,executeQuery:tt,onHasSelection:eR,onPrompt:e=>{let{selection:t,beforeSelection:n,afterSelection:r,startLineNumber:i,endLineNumber:a}=e;ew(e=>({...e,isOpen:!0,selection:t,beforeSelection:n,afterSelection:r,startLineNumber:i,endLineNumber:a}))}}),eE.current&&ej.isOpen&&!ex&&(0,r.jsx)(G.Z,{editor:eE.current,id:"ask-ai",value:eN,onChange:e_,onSubmit:e=>{tc(e,{beforeSelection:ej.beforeSelection,selection:ej.selection,afterSelection:ej.afterSelection})},onCancel:ek,isDiffVisible:!1,isLoading:to,startLineNumber:Math.max(0,ej.startLineNumber),endLineNumber:ej.endLineNumber}),(0,r.jsx)(c.M,{children:!ej.isOpen&&!(null===(t=eE.current)||void 0===t?void 0:t.getValue())&&(0,r.jsxs)(u.E.p,{initial:{y:5,opacity:0},animate:{y:0,opacity:1},exit:{y:5,opacity:0},className:"text-foreground-lighter absolute bottom-4 left-4 z-10 font-mono text-xs flex items-center gap-1",children:["Hit ","macos"===s?(0,r.jsx)(h.Z,{size:12}):"CTRL+","K to edit with the Assistant"]})})]},eQ)]})})}),(0,r.jsx)(P.Dp,{withHandle:!0}),(0,r.jsx)(P.ee,{maxSize:70,children:eB?(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,r.jsx)(d.Z,{className:"animate-spin text-brand"})}):(0,r.jsx)(e1,{id:eQ,isExecuting:e5,isDisabled:ex,hasSelection:eL,prettifyQuery:te,executeQuery:tt,onDebug:tr})}),(0,r.jsx)(P.ee,{maxSize:10,minSize:10,className:"max-h-9",children:(null==eG?void 0:eG.rows)!==void 0&&!e5&&(0,r.jsxs)(x.x,{className:"flex items-center justify-between gap-2",children:[(0,r.jsxs)(K.u,{children:[(0,r.jsx)(K.aJ,{children:(0,r.jsxs)("p",{className:"text-xs",children:[(0,r.jsxs)("span",{className:"text-foreground",children:[eG.rows.length," row",eG.rows.length>1?"s":""]}),(0,r.jsx)("span",{className:"text-foreground-lighter ml-1",children:void 0!==eG.autoLimit&&" (Limited to only ".concat(eG.autoLimit," rows)")})]})}),(0,r.jsx)(K._v,{className:"max-w-xs",children:(0,r.jsxs)("p",{className:"flex flex-col gap-y-1",children:[(0,r.jsx)("span",{children:"Results are automatically limited to preserve browser performance, in particular if your query returns an exceptionally large number of rows."}),(0,r.jsx)("span",{className:"text-foreground-light",children:"You may change or remove this limit from the dropdown on the right"})]})})]}),void 0!==eG.autoLimit&&(0,r.jsxs)(U.h_,{children:[(0,r.jsx)(U.$F,{asChild:!0,children:(0,r.jsxs)(Q.z,{type:"default",iconRight:(0,r.jsx)(f.Z,{size:14}),children:["Limit results to:"," ",null===(n=Y.Tu.find(e=>e.value===ea.limit))||void 0===n?void 0:n.label]})}),(0,r.jsx)(U.AW,{className:"w-40",align:"end",children:(0,r.jsx)(U._x,{value:ea.limit.toString(),onValueChange:e=>ea.setLimit(Number(e)),children:Y.Tu.map(e=>(0,r.jsx)(U.qB,{value:e.value.toString(),children:e.label},e.label))})})]})]})})]})})})]})};var e8=n(42619),e7=n(1042),e9=n(38057);let e5=()=>{let e=(0,i.useRouter)(),{id:t,ref:n,content:l,skip:o}=(0,s.U)(),c=(0,F.WZ)(),u=(0,Z.B0)(),d=(0,Z.Fy)(n),{data:h}=(0,e7.N)({projectRef:n,id:t},{retry:!1,enabled:!!("new"!==t&&"function"==typeof u.addSnippet)});return(0,a.useEffect)(()=>{n&&h&&u.setSnippet(n,h)},[n,h]),(0,a.useEffect)(()=>{"new"===t&&"true"!==o&&void 0!==c.dashboardHistory.sql&&void 0===l&&void 0!==d.find(e=>e.id===c.dashboardHistory.sql)&&e.push("/project/".concat(n,"/sql/").concat(c.dashboardHistory.sql))},[t,d,l]),(0,r.jsx)("div",{className:"flex-1 overflow-auto",children:(0,r.jsx)(e3,{})})};e5.getLayout=e=>(0,r.jsx)(e9.Z,{children:(0,r.jsx)(e8.Z,{title:"SQL",children:e})});var e6=e5},29468:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]])},1546:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]])},90408:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]])},15676:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},60204:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]])},23125:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},79896:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])},43945:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]])},334:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},16163:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(74234).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},84012:function(e,t,n){e.exports=n(84736)},26914:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=(r=n(52983))&&r.__esModule?r:{default:r},s=n(47413),l=n(58984),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={},n}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"buildURI",value:function(){return s.buildURI.apply(void 0,arguments)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.data,n=e.headers,r=e.separator,i=e.enclosingCharacter,a=e.uFEFF,s=e.target,l=e.specs,o=e.replace;this.state.page=window.open(this.buildURI(t,a,n,r,i),s,l,o)}},{key:"getWindow",value:function(){return this.state.page}},{key:"render",value:function(){return null}}]),t}(a.default.Component);o.defaultProps=Object.assign(l.defaultProps,{target:"_blank"}),o.propTypes=l.propTypes,t.default=o},37989:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(r=n(52983))&&r.__esModule?r:{default:r},l=n(47413),o=n(58984),c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.buildURI=n.buildURI.bind(n),n}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"buildURI",value:function(){return l.buildURI.apply(void 0,arguments)}},{key:"handleLegacy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(window.navigator.msSaveOrOpenBlob){e.preventDefault();var n=this.props,r=n.data,i=n.headers,a=n.separator,s=n.filename,o=n.enclosingCharacter,c=n.uFEFF,u=t&&"function"==typeof r?r():r,d=new Blob([c?"\uFEFF":"",(0,l.toCSV)(u,i,a,o)]);return window.navigator.msSaveBlob(d,s),!1}}},{key:"handleAsyncClick",value:function(e){var t=this;this.props.onClick(e,function(n){if(!1===n){e.preventDefault();return}t.handleLegacy(e,!0)})}},{key:"handleSyncClick",value:function(e){if(!1===this.props.onClick(e)){e.preventDefault();return}this.handleLegacy(e)}},{key:"handleClick",value:function(){var e=this;return function(t){if("function"==typeof e.props.onClick)return e.props.asyncOnClick?e.handleAsyncClick(t):e.handleSyncClick(t);e.handleLegacy(t)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.headers,a=t.separator,l=t.filename,o=t.uFEFF,c=t.children,u=(t.onClick,t.asyncOnClick,t.enclosingCharacter),d=function(e,t){var n={};for(var r in e)!(t.indexOf(r)>=0)&&Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(t,["data","headers","separator","filename","uFEFF","children","onClick","asyncOnClick","enclosingCharacter"]),h="undefined"==typeof window?"":this.buildURI(n,o,r,a,u);return s.default.createElement("a",i({download:l},d,{ref:function(t){return e.link=t},target:"_self",href:h,onClick:this.handleClick()}),c)}}]),t}(s.default.Component);c.defaultProps=o.defaultProps,c.propTypes=o.propTypes,t.default=c},47413:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e){if(!Array.isArray(e))return Array.from(e);for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}var i=t.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},a=t.isJsons=function(e){return Array.isArray(e)&&e.every(function(e){return(void 0===e?"undefined":n(e))==="object"&&!(e instanceof Array)})},s=t.isArrays=function(e){return Array.isArray(e)&&e.every(function(e){return Array.isArray(e)})},l=t.jsonsHeaders=function(e){return Array.from(e.map(function(e){return Object.keys(e)}).reduce(function(e,t){return new Set([].concat(r(e),r(t)))},[]))},o=t.jsons2arrays=function(e,t){var n=t=t||l(e),i=t;return a(t)&&(n=t.map(function(e){return e.label}),i=t.map(function(e){return e.key})),[n].concat(r(e.map(function(e){return i.map(function(t){return c(t,e)})})))},c=t.getHeaderValue=function(e,t){var n=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(e,t,n,r){var i=e[t];if(null!=i)return i;r.splice(1)},t);return void 0===n?e in t?t[e]:"":n},u=t.elementOrEmpty=function(e){return null==e?"":e},d=t.joiner=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:'"';return e.filter(function(e){return e}).map(function(e){return e.map(function(e){return u(e)}).map(function(e){return""+n+e+n}).join(t)}).join("\n")},h=t.arrays2csv=function(e,t,n,i){return d(t?[t].concat(r(e)):e,n,i)},f=t.jsons2csv=function(e,t,n,r){return d(o(e,t),n,r)},m=t.string2csv=function(e,t,n,r){return t?t.join(n)+"\n"+e:e.replace(/"/g,'""')},p=t.toCSV=function(e,t,n,r){if(a(e))return f(e,t,n,r);if(s(e))return h(e,t,n,r);if("string"==typeof e)return m(e,t,n);throw TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')};t.buildURI=function(e,t,n,r,a){var s=p(e,n,r,a),l=i()?"application/csv":"text/csv",o=new Blob([t?"\uFEFF":"",s],{type:l}),c="data:"+l+";charset=utf-8,"+(t?"\uFEFF":"")+s,u=window.URL||window.webkitURL;return void 0===u.createObjectURL?c:u.createObjectURL(o)}},84736:function(e,t,n){"use strict";t.CSVLink=void 0;var r=a(n(26914)),i=a(n(37989));function a(e){return e&&e.__esModule?e:{default:e}}r.default,t.CSVLink=i.default},58984:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PropsNotForwarded=t.defaultProps=t.propTypes=void 0,(r=n(52983))&&r.__esModule;var r,i=n(7862);t.propTypes={data:(0,i.oneOfType)([i.string,i.array,i.func]).isRequired,headers:i.array,target:i.string,separator:i.string,filename:i.string,uFEFF:i.bool,onClick:i.func,asyncOnClick:i.bool,enclosingCharacter:i.string},t.defaultProps={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},t.PropsNotForwarded=["data","headers"]},56384:function(e,t,n){"use strict";n.d(t,{bU:function(){return w},fC:function(){return j}});var r=n(83573),i=n(52983),a=n(12527),s=n(61031),l=n(95831),o=n(29650),c=n(87178),u=n(56807),d=n(36986);let h="Switch",[f,m]=(0,l.b)(h),[p,g]=f(h),v=(0,i.forwardRef)((e,t)=>{let{__scopeSwitch:n,name:l,checked:c,defaultChecked:u,required:h,disabled:f,value:m="on",onCheckedChange:g,...v}=e,[x,j]=(0,i.useState)(null),w=(0,s.e)(t,e=>j(e)),N=(0,i.useRef)(!1),_=!x||!!x.closest("form"),[k=!1,E]=(0,o.T)({prop:c,defaultProp:u,onChange:g});return(0,i.createElement)(p,{scope:n,checked:k,disabled:f},(0,i.createElement)(d.WV.button,(0,r.Z)({type:"button",role:"switch","aria-checked":k,"aria-required":h,"data-state":b(k),"data-disabled":f?"":void 0,disabled:f,value:m},v,{ref:w,onClick:(0,a.M)(e.onClick,e=>{E(e=>!e),_&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())})})),_&&(0,i.createElement)(y,{control:x,bubbles:!N.current,name:l,value:m,checked:k,required:h,disabled:f,style:{transform:"translateX(-100%)"}}))}),x=(0,i.forwardRef)((e,t)=>{let{__scopeSwitch:n,...a}=e,s=g("SwitchThumb",n);return(0,i.createElement)(d.WV.span,(0,r.Z)({"data-state":b(s.checked),"data-disabled":s.disabled?"":void 0},a,{ref:t}))}),y=e=>{let{control:t,checked:n,bubbles:a=!0,...s}=e,l=(0,i.useRef)(null),o=(0,c.D)(n),d=(0,u.t)(t);return(0,i.useEffect)(()=>{let e=l.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(o!==n&&t){let r=new Event("click",{bubbles:a});t.call(e,n),e.dispatchEvent(r)}},[o,n,a]),(0,i.createElement)("input",(0,r.Z)({type:"checkbox","aria-hidden":!0,defaultChecked:n},s,{tabIndex:-1,ref:l,style:{...e.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function b(e){return e?"checked":"unchecked"}let j=v,w=x}},function(e){e.O(0,[6665,7623,588,7037,8e3,6402,4418,8703,2303,6823,6499,4837,3297,441,1577,5605,1503,7702,5834,7198,3535,8232,3048,7199,5518,5538,6984,8005,2578,1446,9198,4554,5631,8803,3664,7161,8482,4094,6487,2619,9774,2888,179],function(){return e(e.s=93906)}),_N_E=e.O()}]);