(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3881,8374],{64038:function(e,t,n){var s=n(87500),a=n(17325)(function(e,t,n){s(e,n,t)});e.exports=a},27767:function(e,t,n){var s=n(22825),a=n(29735),r=n(80135),i=n(18268),l=a(function(e){return r(s(e,1,i,!0))});e.exports=l},70699:function(e,t,n){"use strict";var s=n(97458),a=n(21116);t.Z=()=>(0,s.jsx)("div",{className:"block w-full rounded border border-muted border-opacity-50 bg-gray-300 p-3",children:(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)(a.Z,{size:20,strokeWidth:1.5}),(0,s.jsx)("p",{className:"text-sm",children:"No backups created yet - check again tomorrow."})]})})},10858:function(e,t,n){"use strict";var s=n(97458),a=n(19405),r=n(3696);t.Z=()=>(0,s.jsxs)(a.bZ,{variant:"default",children:[(0,s.jsx)(r.aN,{}),(0,s.jsx)(a.X,{children:"Database backups do not include objects stored via the Storage API, as the database only includes metadata about these objects. Restoring an old backup does not restore objects that have been deleted since then."})]})},58374:function(e,t,n){"use strict";var s=n(97458),a=n(4534),r=n(13826),i=n(99033),l=n(52983),o=n(34549),c=n(32672),d=n(27477),u=n(61115),m=n(24605),h=n(1447),x=n(70864),p=n(289),f=n(37914),j=n(28289),g=n(60661),v=n(59599),b=n(19405),y=n(3696),N=n(53486),w=n(27429);let S=["vector","postgis"];t.Z=e=>{let{visible:t,extension:n,onCancel:Z}=e,{project:C}=(0,c.d2)(),_=(0,p.Qv)(),[k,E]=(0,l.useState)(),[z,R]=(0,l.useState)(!1),{data:T,isLoading:A}=(0,h.Q1)({projectRef:null==C?void 0:C.ref,connectionString:null==C?void 0:C.connectionString}),{mutate:I,isLoading:F}=(0,m.k)({onSuccess:()=>{o.Am.success('Extension "'.concat(n.name,'" is now enabled')),Z()},onError:e=>{o.Am.error("Failed to enable ".concat(n.name,": ").concat(e.message))}});(0,l.useEffect)(()=>{let e=!1;return t&&(async()=>{e||(R(!0),E(void 0));try{let t=await (0,x.R)({projectRef:null==C?void 0:C.ref,connectionString:null==C?void 0:C.connectionString,sql:"select * from pg_available_extension_versions where name = '".concat(n.name,"'")});e||E(t.result[0].schema)}catch(e){}R(!1)})(),()=>{e=!0}},[t,n.name]);let L=async e=>{if(void 0===C)return console.error("Project is required");let t=null!=k?k:"custom"===e.schema?e.name:e.schema;I({projectRef:C.ref,connectionString:null==C?void 0:C.connectionString,schema:t,name:n.name,version:n.default_version,cascade:!0,createSchema:!t.startsWith("pg_")})};return(0,s.jsx)(f.Z,{hideFooter:!0,visible:t,onCancel:Z,size:"small",header:(0,s.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,s.jsx)("h5",{className:"text-sm text-foreground",children:"Confirm to enable"}),(0,s.jsx)("code",{className:"text-xs",children:n.name})]}),children:(0,s.jsx)(j.Z,{initialValues:{name:n.name,schema:"extensions"},validate:e=>{let t={};return"custom"!==e.schema||e.name||(t.name="Required field"),t},onSubmit:L,children:e=>{let{values:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(f.Z.Content,{className:"flex flex-col gap-y-2",children:[_&&S.includes(n.name)&&(0,s.jsxs)(w.J,{type:"default",title:"Extension is limited by OrioleDB",children:[(0,s.jsxs)("span",{className:"block",children:[n.name," cannot be accelerated by indexes on tables that are using the OrioleDB access method"]}),(0,s.jsx)(d.G,{abbrev:!1,className:"mt-2",href:"https://supabase.com/docs"})]}),z||A?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u.Z,{}),(0,s.jsx)("div",{className:"w-3/4",children:(0,s.jsx)(u.Z,{})})]}):k?(0,s.jsx)(g.Z,{disabled:!0,id:"schema",name:"schema",value:k,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(k,".")}):(0,s.jsxs)(v.Z,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,s.jsxs)(v.Z.Option,{id:"custom",label:'Create a new schema "'.concat(n.name,'"'),value:"custom",addOnBefore:()=>(0,s.jsx)(a.Z,{size:16,strokeWidth:1.5}),children:['Create a new schema "',n.name,'"']},"custom"),(0,s.jsx)(f.Z.Separator,{}),null==T?void 0:T.map(e=>(0,s.jsx)(v.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,s.jsx)(r.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]})]}),"custom"===t.schema&&(0,s.jsx)(f.Z.Content,{children:(0,s.jsx)(g.Z,{id:"name",name:"name",label:"Schema name"})}),"pg_cron"===n.name&&(null==C?void 0:C.cloud_provider)==="FLY"&&(0,s.jsx)(f.Z.Content,{children:(0,s.jsxs)(b.bZ,{variant:"warning",children:[(0,s.jsx)(y.aN,{}),(0,s.jsx)(b.Cd,{children:"The pg_cron extension is not fully supported for Fly projects"}),(0,s.jsx)(b.X,{children:"You can still enable the extension, but pg_cron jobs may not run due to the behavior of Fly projects."}),(0,s.jsx)(b.X,{className:"mt-3",children:(0,s.jsx)(N.z,{asChild:!0,type:"default",iconRight:(0,s.jsx)(i.Z,{width:12,height:12}),children:(0,s.jsx)("a",{href:"/docs/guides/platform/fly-postgres#limitations",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("span",{children:"Learn more"})})})})]})}),(0,s.jsx)(f.Z.Separator,{}),(0,s.jsxs)(f.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,s.jsx)(N.z,{type:"default",disabled:F,onClick:()=>Z(),children:"Cancel"}),(0,s.jsx)(N.z,{htmlType:"submit",disabled:F,loading:F,children:"Enable extension"})]})]})}})})}},30445:function(e,t,n){"use strict";n.d(t,{Z:function(){return R}});var s=n(97458),a=n(40540),r=n(85847),i=n(71656),l=n(29427),o=n(43947),c=n(83145),d=n.n(c),u=n(52983),m=n(34549),h=n(32672),x=n(36457),p=n(64618),f=n(129),j=n(39310);async function g(e){let{projectRef:t,connectionString:n,id:s}=e,a=new Headers;n&&a.set("x-connection-encrypted",n);let{data:r,error:i}=await (0,f.IV)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:s}},headers:a});return i&&(0,f.S3)(i),r}let v=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,x.NL)();return(0,p.D)(e=>g(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(j.o.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?m.Am.error("Failed to disable database extension: ".concat(e.message)):t(e,n,s)},...n})};var b=n(94281),y=n(289),N=n(620),w=n(43633),S=n(50322),Z=n(104),C=n(53486),_=n(27429),k=n(15518),E=n(58374),z=n(15093),R=e=>{var t,n,c;let{extension:x}=e,{project:p}=(0,h.d2)(),f=null!==x.installed_version,j=(0,y.Qv)(),[g,R]=(0,u.useState)(!1),[T,A]=(0,u.useState)(!1),I=(0,b.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),F=j&&"orioledb"===x.name,L=!I||F,D="px-5",P=N.Rw.find(e=>e.name===x.name),W=(null==P?void 0:P.link.startsWith("/guides"))?"https://supabase.com/docs".concat(null==P?void 0:P.link):null!==(t=null==P?void 0:P.link)&&void 0!==t?t:void 0,{mutate:O,isLoading:q}=v({onSuccess:()=>{m.Am.success("".concat(x.name," is off.")),R(!1)}}),B=()=>{if(void 0===p)return console.error("Project is required");O({projectRef:p.ref,connectionString:p.connectionString,id:x.name})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-surface-100 border border-overlay flex flex-col overflow-hidden rounded shadow-sm",children:[(0,s.jsxs)("div",{className:(0,w.cn)("border-b border-overlay flex justify-between w-full py-3",D),children:[(0,s.jsxs)("div",{className:"max-w-[85%] flex items-center space-x-3 truncate",children:[(0,s.jsx)("h3",{title:x.name,className:"h-5 m-0 text-sm truncate cursor-pointer text-foreground",children:x.name}),(0,s.jsx)("p",{className:"text-sm text-foreground-light font-mono tracking-tighter",children:null!==(n=null==x?void 0:x.installed_version)&&void 0!==n?n:x.default_version})]}),q?(0,s.jsx)(r.Z,{className:"animate-spin",size:16}):(0,s.jsxs)(S.u,{children:[(0,s.jsx)(S.aJ,{children:(0,s.jsx)(Z.r,{disabled:L,checked:f,onCheckedChange:()=>f?R(!0):A(!0)})}),L&&(0,s.jsx)(S._v,{side:"bottom",children:I?F?"Project is using OrioleDB and cannot be disabled":null:"You need additional permissions to toggle extensions"})]})]}),f&&(0,s.jsx)("div",{className:(0,w.cn)("border-b border-overlay py-2",D),children:(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["Installed in ",(0,s.jsx)("span",{className:"text-foreground",children:x.schema})," schema"]})}),(0,s.jsxs)("div",{className:(0,w.cn)("flex h-full flex-col gap-y-3 py-3",D),children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light capitalize-sentence",children:x.comment}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(null==P?void 0:P.github_url)&&(0,s.jsx)(C.z,{asChild:!0,type:"default",icon:(0,s.jsx)(i.Z,{}),className:"rounded-full",children:(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",href:P.github_url,className:"font-mono tracking-tighter",children:P.github_url.split("/").slice(-2).join("/")})}),void 0!==W&&(0,s.jsx)(C.z,{asChild:!0,type:"default",icon:(0,s.jsx)(l.Z,{}),className:"rounded-full",children:(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",className:"font-mono tracking-tighter",href:W,children:"Docs"})})]})]}),(null==P?void 0:P.product)&&(0,s.jsxs)("div",{className:(0,w.cn)("border-t border-overlay py-3 flex items-center gap-x-3",D),children:[(0,s.jsx)("div",{className:"min-w-5 w-5 h-5 border border-brand/50 rounded flex items-center justify-center",children:(0,s.jsx)(o.Z,{className:"text-brand",size:12})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-foreground-light text-xs",children:[(0,s.jsx)("span",{className:"text-foreground",children:x.name})," is used by"," ",P.product_url?(0,s.jsx)(d(),{href:P.product_url.replace("{ref}",null!==(c=null==p?void 0:p.ref)&&void 0!==c?c:""),className:"transition hover:text-foreground",children:P.product}):P.product]}),!f&&(0,s.jsxs)("p",{className:"text-foreground-lighter text-xs",children:["Install extension to use ",P.product]})]})]})]}),(0,s.jsx)(E.Z,{visible:T,extension:x,onCancel:()=>A(!1)}),(0,s.jsx)(k.Z,{visible:g,title:"Confirm to disable extension",confirmLabel:"Disable",variant:"destructive",confirmLabelLoading:"Disabling",onCancel:()=>R(!1),onConfirm:()=>B(),children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Are you sure you want to turn OFF the "',x.name,'" extension?']}),z.FL[x.name]&&(0,s.jsx)(_.J,{type:"warning",className:"m-0",children:z.FL[x.name]})]})})]})}},15093:function(e,t,n){"use strict";n.d(t,{FL:function(){return r},Ht:function(){return s},Xq:function(){return a}});let s=["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_surgery","pg_visibility","supabase_vault","supautils","intagg","xml2","pg_tle"],a={vector:["pgvector","pg_vector"]},r={pg_cron:"Disabling this extension will delete all scheduled jobs. This cannot be undone."}},39190:function(e,t,n){"use strict";n.d(t,{QI:function(){return i},cK:function(){return r}});var s=n(29787),a=n.n(s);function r(e){let t=null==e?void 0:e.split(",").map(e=>e.trim());return a()(e)||!t||0===t.length?{value:[]}:{value:t.map(e=>{let t=e.match(/(\w+)\s+([\w\[\]]+)(?:\s+DEFAULT\s+(.*))?/i);if(!t)return console.error("Error while trying to parse function arguments",e),null;{let[,e,n,s]=t,a=s?s.trim():void 0;return["timestamp","time","timetz","timestamptz"].includes(n.toLowerCase())&&a&&(a="'".concat(a,"'")),{name:e,type:n,defaultValue:a}}}).filter(Boolean)}}function i(e){let t=[];if(e)for(var n in e)t.push({name:n,value:e[n]});return{value:t}}},23555:function(e,t,n){"use strict";n.d(t,{Bv:function(){return a},IC:function(){return r},NM:function(){return s}});let s=["anon","service_role","authenticated","authenticator","dashboard_user","supabase_admin","supabase_auth_admin","supabase_functions_admin","supabase_read_only_user","supabase_realtime_admin","supabase_replication_admin","supabase_storage_admin","pgbouncer","pgsodium_keyholder","pgsodium_keyiduser","pgsodium_keymaker","pgtle_admin"],a=["postgres","pgbouncer","supabase_admin","supabase_auth_admin","supabase_storage_admin","dashboard_user","authenticator","pg_database_owner","pg_read_all_data","pg_write_all_data"],r={canLogin:{disabled:!1,description:"User can login",grant_by_dashboard:!0},canCreateRole:{disabled:!1,description:"User can create roles",grant_by_dashboard:!0},canCreateDb:{disabled:!1,description:"User can create databases",grant_by_dashboard:!0},canBypassRls:{disabled:!1,description:"User bypasses every row level security policy",grant_by_dashboard:!0},isSuperuser:{disabled:!0,description:"User is a Superuser",grant_by_dashboard:!1},isReplicationRole:{disabled:!1,description:"User can initiate streaming replication and put the system in and out of backup mode",grant_by_dashboard:!0}}},21823:function(e,t,n){"use strict";n.d(t,{M4:function(){return tN},TH:function(){return T},B8:function(){return nD},RA:function(){return nn},ZR:function(){return nM},eX:function(){return np},Ms:function(){return se},IP:function(){return e6},Vj:function(){return tt},_y:function(){return ta},yT:function(){return eJ},bw:function(){return ec}});var s=n(97458),a=n(40540),r=n(71607),i=n.n(r),l=n(38498),o=n(16696),c=n(4534),d=n(84053),u=n(48631),m=n(26597),h=n(83145),x=n.n(h),p=n(52983),f=n(73512),j=n(32672),g=n(71358),v=n(2052),b=n(84261),y=n(2861),N=n(61115),w=n(6570),S=n(67305),Z=n(94281),C=n(61958),_=n(53486),k=n(60661),E=n(15011),z=n(50322),R=n(73692),T=e=>{var t,n,r,h,T;let{onAddColumn:A=i(),onEditColumn:I=i(),onDeleteColumn:F=i()}=e,{id:L,ref:D}=(0,f.UO)(),P=L?Number(L):void 0,{project:W}=(0,j.d2)(),{data:O,error:q,isError:B,isLoading:V,isSuccess:M}=(0,w.iB)({projectRef:null==W?void 0:W.ref,connectionString:null==W?void 0:W.connectionString,id:P}),[Y,U]=(0,p.useState)(""),X=(0,S.N3)(O),Q=null!==(r=0===Y.length?null!==(n=null==O?void 0:O.columns)&&void 0!==n?n:[]:null==O?void 0:null===(t=O.columns)||void 0===t?void 0:t.filter(e=>e.name.includes(Y)))&&void 0!==r?r:[],G=C.s.includes(null!==(h=null==O?void 0:O.schema)&&void 0!==h?h:""),H=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(_.z,{asChild:!0,type:"outline",icon:(0,s.jsx)(l.Z,{}),style:{padding:"5px"},children:(0,s.jsx)(x(),{href:"/project/".concat(D,"/database/tables")})}),(0,s.jsx)(k.Z,{size:"small",placeholder:"Filter columns",value:Y,onChange:e=>U(e.target.value),icon:(0,s.jsx)(o.Z,{size:12})})]}),!G&&X&&(0,s.jsx)(y.u,{icon:(0,s.jsx)(c.Z,{}),disabled:!H,onClick:()=>A(),tooltip:{content:{side:"bottom",text:H?void 0:"You need additional permissions to create columns"}},children:"New column"})]}),G&&(0,s.jsx)(R.Z,{schema:null!==(T=null==O?void 0:O.schema)&&void 0!==T?T:"",entity:"columns"}),V&&(0,s.jsx)(N.A,{}),B&&(0,s.jsx)(b.Z,{error:q,subject:'Failed to retrieve columns for table "'.concat(null==O?void 0:O.schema,".").concat(null==O?void 0:O.name,'"')}),M&&(0,s.jsx)(s.Fragment,{children:0===Q.length?(0,s.jsx)(g.Z,{}):(0,s.jsx)("div",{children:(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{children:"Name"},"name"),(0,s.jsx)(v.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,s.jsx)(v.Z.th,{children:"Data Type"},"type"),(0,s.jsx)(v.Z.th,{children:"Format"},"format"),(0,s.jsx)(v.Z.th,{},"buttons")],body:Q.map((e,t)=>(0,s.jsxs)(v.Z.tr,{className:"border-t",children:[(0,s.jsx)(v.Z.td,{children:(0,s.jsx)("p",{children:e.name})}),(0,s.jsx)(v.Z.td,{className:"break-all whitespace-normal hidden xl:table-cell",children:null!==e.comment?(0,s.jsx)("p",{title:e.comment,children:e.comment}):(0,s.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,s.jsx)(v.Z.td,{children:(0,s.jsx)("code",{className:"text-xs",children:e.data_type})}),(0,s.jsx)(v.Z.td,{className:"font-mono text-xs",children:(0,s.jsx)("code",{className:"text-xs",children:e.format})}),(0,s.jsx)(v.Z.td,{className:"text-right",children:!G&&X&&(0,s.jsxs)(E.h_,{children:[(0,s.jsx)(E.$F,{asChild:!0,children:(0,s.jsx)(_.z,{type:"default",className:"px-1",icon:(0,s.jsx)(d.Z,{})})}),(0,s.jsxs)(E.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{children:(0,s.jsxs)(E.Xi,{disabled:!H,onClick:()=>I(e),className:"space-x-2",children:[(0,s.jsx)(u.Z,{size:12}),(0,s.jsx)("p",{children:"Edit column"})]})}),!H&&(0,s.jsx)(z._v,{side:"bottom",children:"Additional permissions required to edit column"})]}),(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{children:(0,s.jsxs)(E.Xi,{disabled:!H||G,onClick:()=>F(e),className:"space-x-2",children:[(0,s.jsx)(m.Z,{stroke:"red",size:12}),(0,s.jsx)("p",{children:"Delete column"})]})}),!H&&(0,s.jsx)(z._v,{side:"bottom",children:"Additional permissions required to delete column"})]})]})]})})]},e.name))})})})]})},A=n(41639),I=n(71534),F=n(5364),L=n(9738),D=n(11321),P=n(38254),W=n(74459),O=n(32691),q=n(58427),B=n(72356),V=n(7272),M=n(28894),Y=n(129),U=n(29633);async function X(e,t){let{projectRef:n,connectionString:s,schema:a}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:i,error:l}=await (0,Y.U2)("/platform/pg-meta/{ref}/foreign-tables",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{included_schemas:a||"",include_columns:!0}},headers:r,signal:t});return l&&(0,Y.S3)(l),i}let Q=function(e){let{projectRef:t,connectionString:n,schema:s}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,M.a)(s?U.T.listBySchema(t,s):U.T.list(t),e=>{let{signal:a}=e;return X({projectRef:t,connectionString:n,schema:s},a)},{enabled:a&&void 0!==t,...r})},G={list:e=>["projects",e,"materializedViews"],listBySchema:(e,t)=>[...G.list(e),t]};async function H(e,t){let{projectRef:n,connectionString:s,schema:a}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:i,error:l}=await (0,Y.U2)("/platform/pg-meta/{ref}/materialized-views",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{included_schemas:a||"",include_columns:!0}},headers:r,signal:t});return l&&(0,Y.S3)(l),i}let J=function(e){let{projectRef:t,connectionString:n,schema:s}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,M.a)(s?G.listBySchema(t,s):G.list(t),e=>{let{signal:a}=e;return H({projectRef:t,connectionString:n,schema:s},a)},{enabled:a&&void 0!==t,staleTime:0,...r})};var K=n(12724),$=n(21925),ee=n(40288);async function et(e,t){let{projectRef:n,connectionString:s,schema:a}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:i,error:l}=await (0,Y.U2)("/platform/pg-meta/{ref}/views",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{included_schemas:a||""}},headers:r,signal:t});return l&&(0,Y.S3)(l),i}let en=function(e){let{projectRef:t,connectionString:n,schema:s}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,M.a)(s?ee.N.listBySchema(t,s):ee.N.list(t),e=>{let{signal:a}=e;return et({projectRef:t,connectionString:n,schema:s},a)},{enabled:a&&void 0!==t,staleTime:0,...r})};var es=n(50998),ea=n(12753),er=n(5562),ei=n(7257),el=n(43633);let eo=e=>{let{tables:t=[],views:n=[],materializedViews:s=[],foreignTables:a=[]}=e,r=t.map(e=>{var t;return{...e,type:V.l.TABLE,rows:e.live_rows_estimate,columns:null!==(t=e.columns)&&void 0!==t?t:[]}});return[...r,...n.map(e=>{var t;return{type:V.l.VIEW,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}}),...s.map(e=>{var t;return{type:V.l.MATERIALIZED_VIEW,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}}),...a.map(e=>{var t;return{type:V.l.FOREIGN_TABLE,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}})].sort((e,t)=>e.name.localeCompare(t.name))};var ec=e=>{let{onDuplicateTable:t,onAddTable:n=i(),onEditTable:r=i(),onDeleteTable:l=i()}=e,h=(0,O.useRouter)(),{ref:g}=(0,f.UO)(),{project:w}=(0,j.d2)(),S=(0,K.yF)(),{selectedSchema:T,setSelectedSchema:M}=(0,es.B)(),[Y,U]=(0,p.useState)(""),[X,G]=(0,p.useState)(Object.values(V.l)),H=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables"),{data:ee,error:et,isError:ec,isLoading:ed,isSuccess:eu}=(0,$.Bj)({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString,schema:T,sortByProperty:"name",includeColumns:!0},{select:e=>0===Y.length?e:e.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase()))}),{data:em,error:eh,isError:ex,isLoading:ep,isSuccess:ef}=en({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString,schema:T},{select:e=>0===Y.length?e:e.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase()))}),{data:ej,error:eg,isError:ev,isLoading:eb,isSuccess:ey}=J({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString,schema:T},{select:e=>0===Y.length?e:e.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase()))}),{data:eN,error:ew,isError:eS,isLoading:eZ,isSuccess:eC}=Q({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString,schema:T},{select:e=>0===Y.length?e:e.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase()))}),{data:e_}=(0,B.z)({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString}),ek=(null!=e_?e_:[]).find(e=>"supabase_realtime"===e.name),eE=eo({tables:ee,views:em,materializedViews:ej,foreignTables:eN}).filter(e=>X.includes(e.type)),ez=C.s.includes(T),eR=e=>{var t,n,s,a;return null===(a=Object.entries(V.l).find(t=>{let[,n]=t;return n===e}))||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:null===(n=s.toLowerCase())||void 0===n?void 0:null===(t=n.split("_"))||void 0===t?void 0:t.join(" ")};return(0,s.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(q.Z,{className:"flex-grow lg:flex-grow-0 w-[180px]",size:"tiny",showError:!1,selectedSchemaName:T,onSelectSchema:M}),(0,s.jsxs)(ea.J2,{children:[(0,s.jsx)(ea.xo,{asChild:!0,children:(0,s.jsx)(_.z,{size:"tiny",type:5!==X.length?"default":"dashed",className:"px-1",icon:(0,s.jsx)(A.Z,{})})}),(0,s.jsx)(ea.yk,{className:"p-0 w-56",side:"bottom",align:"center",children:(0,s.jsxs)("div",{className:"px-3 pt-3 pb-2 flex flex-col gap-y-2",children:[(0,s.jsx)("p",{className:"text-xs",children:"Show entity types"}),(0,s.jsx)("div",{className:"flex flex-col",children:Object.entries(V.l).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{className:"group flex items-center justify-between py-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(er.X,{id:t,name:t,checked:X.includes(n),onCheckedChange:()=>{X.includes(n)?G(X.filter(e=>e!==n)):G(X.concat([n]))}}),(0,s.jsx)(ei._,{htmlFor:t,className:"capitalize text-xs",children:t.toLowerCase().replace("_"," ")})]}),(0,s.jsx)(_.z,{size:"tiny",type:"default",onClick:()=>G([n]),className:"transition opacity-0 group-hover:opacity-100 h-auto px-1 py-0.5",children:"Select only"})]},t)})})]})})]})]}),(0,s.jsxs)("div",{className:"flex flex-grow justify-between gap-2 items-center",children:[(0,s.jsx)(k.Z,{size:"tiny",className:"flex-grow lg:flex-grow-0 w-52",placeholder:"Search for a table",value:Y,onChange:e=>U(e.target.value),icon:(0,s.jsx)(o.Z,{size:12})}),!ez&&(0,s.jsx)(y.u,{className:"w-auto ml-auto",icon:(0,s.jsx)(c.Z,{}),disabled:!H,onClick:()=>n(),tooltip:{content:{side:"bottom",text:H?void 0:"You need additional permissions to create tables"}},children:"New table"})]})]}),ez&&(0,s.jsx)(R.Z,{schema:T,entity:"tables"}),(ed||ep||eb||eZ)&&(0,s.jsx)(N.A,{}),(ec||ex||ev||eS)&&(0,s.jsx)(b.Z,{error:et||eh||eg||ew,subject:"Failed to retrieve tables"}),eu&&ef&&ey&&eC&&(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{className:"!px-0"},"icon"),(0,s.jsx)(v.Z.th,{children:"Name"},"name"),(0,s.jsx)(v.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,s.jsx)(v.Z.th,{className:"hidden text-right xl:table-cell",children:"Rows (Estimated)"},"rows"),(0,s.jsx)(v.Z.th,{className:"hidden text-right xl:table-cell",children:"Size (Estimated)"},"size"),(0,s.jsx)(v.Z.th,{className:"hidden xl:table-cell text-center",children:"Realtime Enabled"},"realtime"),(0,s.jsx)(v.Z.th,{},"buttons")],body:(0,s.jsxs)(s.Fragment,{children:[0===eE.length&&0===Y.length&&(0,s.jsx)(v.Z.tr,{children:(0,s.jsx)(v.Z.td,{colSpan:7,children:0===X.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"Please select at least one entity type to filter with"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"There are currently no results based on the filter that you have applied"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No tables created yet"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["There are no"," ",5===X.length?"tables":1===X.length?"".concat(eR(X[0]),"s"):"".concat(X.slice(0,-1).map(e=>"".concat(eR(e),"s")).join(", "),", and ").concat(eR(X[X.length-1]),"s")," ",'found in the schema "',T,'"']})]})})},T),0===eE.length&&Y.length>0&&(0,s.jsx)(v.Z.tr,{children:(0,s.jsxs)(v.Z.td,{colSpan:7,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',Y,'" did not return any results']})]})},T),eE.length>0&&eE.map(e=>{var n,a,i,o;return(0,s.jsxs)(v.Z.tr,{children:[(0,s.jsx)(v.Z.td,{className:"!pl-5 !pr-1",children:(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{asChild:!0,children:e.type===V.l.TABLE?(0,s.jsx)(I.Z,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"}):e.type===V.l.VIEW?(0,s.jsx)(F.Z,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"}):(0,s.jsx)("div",{className:(0,el.cn)("flex items-center justify-center text-xs h-4 w-4 rounded-[2px] font-bold",e.type===V.l.FOREIGN_TABLE&&"text-yellow-900 bg-yellow-500",e.type===V.l.MATERIALIZED_VIEW&&"text-purple-1000 bg-purple-500"),children:null===(i=Object.entries(V.l).find(t=>{let[,n]=t;return n===e.type}))||void 0===i?void 0:null===(a=i[0])||void 0===a?void 0:null===(n=a[0])||void 0===n?void 0:n.toUpperCase()})}),(0,s.jsx)(z._v,{side:"bottom",className:"capitalize",children:eR(e.type)})]})}),(0,s.jsx)(v.Z.td,{children:e.name.length>20?(0,s.jsxs)(z.u,{disableHoverableContent:!0,children:[(0,s.jsx)(z.aJ,{asChild:!0,className:"max-w-[95%] overflow-hidden text-ellipsis whitespace-nowrap",children:(0,s.jsx)("p",{children:e.name})}),(0,s.jsx)(z._v,{side:"bottom",children:e.name})]}):(0,s.jsx)("p",{children:e.name})}),(0,s.jsx)(v.Z.td,{className:"hidden lg:table-cell ",children:null!==e.comment?(0,s.jsx)("span",{className:"lg:max-w-48 truncate inline-block",title:e.comment,children:e.comment}):(0,s.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,s.jsx)(v.Z.td,{className:"hidden text-right xl:table-cell",children:void 0!==e.rows?e.rows.toLocaleString():"-"}),(0,s.jsx)(v.Z.td,{className:"hidden text-right xl:table-cell",children:void 0!==e.size?(0,s.jsx)("code",{className:"text-xs",children:e.size}):"-"}),(0,s.jsx)(v.Z.td,{className:"hidden xl:table-cell text-center",children:(null!==(o=null==ek?void 0:ek.tables)&&void 0!==o?o:[]).find(t=>t.id===e.id)?(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(L.Z,{size:18,strokeWidth:2,className:"text-brand"})}):(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(D.Z,{size:18,strokeWidth:2,className:"text-foreground-lighter"})})}),(0,s.jsx)(v.Z.td,{children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(_.z,{asChild:!0,type:"default",iconRight:(0,s.jsx)(P.Z,{size:14,className:"text-foreground-light"}),className:"whitespace-nowrap hover:border-muted",style:{paddingTop:3,paddingBottom:3},children:(0,s.jsxs)(x(),{href:"/project/".concat(g,"/database/tables/").concat(e.id),children:[e.columns.length," columns"]})}),!ez&&(0,s.jsxs)(E.h_,{children:[(0,s.jsx)(E.$F,{asChild:!0,children:(0,s.jsx)(_.z,{type:"default",className:"px-1",icon:(0,s.jsx)(d.Z,{})})}),(0,s.jsxs)(E.AW,{side:"bottom",align:"end",className:"w-40",children:[(0,s.jsxs)(E.Xi,{className:"flex items-center space-x-2",onClick:()=>h.push("/project/".concat(null==w?void 0:w.ref,"/editor/").concat(e.id)),onMouseEnter:()=>S({id:e.id?String(e.id):void 0}),children:[(0,s.jsx)(F.Z,{size:12}),(0,s.jsx)("p",{children:"View in Table Editor"})]}),e.type===V.l.TABLE&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.VD,{}),(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{asChild:!0,children:(0,s.jsxs)(E.Xi,{className:"!pointer-events-auto gap-x-2",disabled:!H,onClick:()=>{H&&r(e)},children:[(0,s.jsx)(u.Z,{size:12}),(0,s.jsx)("p",{children:"Edit table"})]})}),!H&&(0,s.jsx)(z._v,{side:"left",children:"You need additional permissions to edit this table"})]}),(0,s.jsxs)(E.Xi,{className:"space-x-2",onClick:n=>{n.stopPropagation(),H&&t(e)},children:[(0,s.jsx)(W.Z,{size:12}),(0,s.jsx)("span",{children:"Duplicate Table"})]},"duplicate-table"),(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{asChild:!0,children:(0,s.jsxs)(E.Xi,{disabled:!H||ez,className:"!pointer-events-auto gap-x-2",onClick:()=>{H&&!ez&&l({...e,schema:T})},children:[(0,s.jsx)(m.Z,{stroke:"red",size:12}),(0,s.jsx)("p",{children:"Delete table"})]})}),!H&&(0,s.jsx)(z._v,{side:"left",children:"You need additional permissions to delete tables"})]})]})]})]})]})})]},e.id)})]})})})]})},ed=n(50663),eu=n.n(ed),em=n(71635),eh=n.n(em),ex=n(54542),ep=n(65039),ef=n(80070),ej=n(65024),eg=n(33971),ev=n(90330),eb=n(86848),ey=n(34549),eN=n(5394),ew=n(81219),eS=n(4330),eZ=n(36457),eC=n(64618),e_=n(70864);async function ek(e){let{projectRef:t,connectionString:n,payload:s}=e,a=eS.Z.roles.create(s).sql,{result:r}=await (0,e_.R)({projectRef:t,connectionString:n,sql:a,queryKey:["roles","create"]});return r}let eE=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>ek(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await (0,ef.fA)(s,r),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to create database role: ".concat(e.message)):t(e,n,s)},...n})};var ez=n(26944),eR=n(76707),eT=n(93840),eA=n(104),eI=n(23555);let eF=eN.ZP.object({name:eN.ZP.string().trim().min(1,"You must provide a name").default(""),isSuperuser:eN.ZP.boolean().default(!1),canLogin:eN.ZP.boolean().default(!1),canCreateRole:eN.ZP.boolean().default(!1),canCreateDb:eN.ZP.boolean().default(!1),isReplicationRole:eN.ZP.boolean().default(!1),canBypassRls:eN.ZP.boolean().default(!1)}),eL={name:"",isSuperuser:!1,canLogin:!1,canCreateRole:!1,canCreateDb:!1,isReplicationRole:!1,canBypassRls:!1};var eD=e=>{let{visible:t,onClose:n}=e,a="create-new-role",{project:r}=(0,j.d2)(),i=(0,eb.cI)({resolver:(0,ev.F)(eF)}),{mutate:l,isLoading:o}=eE({onSuccess:(e,t)=>{ey.Am.success("Successfully created new role: ".concat(t.payload.name)),d()}}),c=async e=>{if(!r)return console.error("Project is required");l({projectRef:r.ref,connectionString:r.connectionString,payload:e})},d=()=>{n(),i.reset(eL)};return(0,s.jsx)(ez.ZP,{size:"large",visible:t,header:"Create a new role",className:"mr-0 transform transition-all duration-300 ease-in-out",loading:!1,onCancel:d,customFooter:(0,s.jsx)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:(0,s.jsx)(ew.i,{form:a,isSubmitting:o,hasChanges:i.formState.isDirty,handleReset:d})}),children:(0,s.jsx)(eR.l0,{...i,children:(0,s.jsxs)("form",{id:a,className:"grid gap-6 w-full px-8 py-8",onSubmit:i.handleSubmit(c),children:[(0,s.jsx)(eR.Wi,{control:i.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,s.jsx)(eR.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Name"}),(0,s.jsx)(eR.NI,{className:"col-span-8",children:(0,s.jsx)(eT.I,{...t,className:"w-full"})}),(0,s.jsx)(eR.zG,{className:"col-start-5 col-span-8"})]})}}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 md:grid md:grid-cols-12",children:[(0,s.jsx)("div",{className:"col-span-4",children:(0,s.jsx)(eR.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Role privileges"})}),(0,s.jsxs)("div",{className:"col-span-8 grid gap-4",children:[Object.keys(eI.IC).filter(e=>eI.IC[e].grant_by_dashboard).map(e=>{let t=eI.IC[e];return(0,s.jsx)(eR.Wi,{control:i.control,name:e,render:e=>{let{field:n}=e;return(0,s.jsxs)(eR.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,s.jsx)(eR.NI,{className:"col-span-8 flex items-center gap-4",children:(0,s.jsxs)("div",{className:"w-full text-sm",children:[(0,s.jsx)(eA.r,{checked:n.value,onCheckedChange:n.onChange}),(0,s.jsx)(eR.lX,{children:t.description})]})}),(0,s.jsx)(eR.zG,{className:"col-start-5 col-span-8"})]})}},e)}),(0,s.jsx)(ez.ZP.Separator,{}),(0,s.jsxs)("div",{className:"grid gap-4",children:[(0,s.jsx)("p",{className:"text-sm",children:"These privileges cannot be granted via the Dashboard:"}),Object.keys(eI.IC).filter(e=>!eI.IC[e].grant_by_dashboard).map(e=>{let t=eI.IC[e];return(0,s.jsx)(eR.Wi,{control:i.control,name:e,render:e=>{let{field:n}=e;return(0,s.jsxs)(eR.xJ,{className:"space-y-0 opacity-70",children:[(0,s.jsx)(eR.NI,{className:"flex items-center gap-4",children:(0,s.jsxs)("div",{className:"w-full text-sm",children:[(0,s.jsx)(eA.r,{checked:n.value,onCheckedChange:n.onChange,disabled:!0,"aria-readonly":!0}),(0,s.jsx)(eR.lX,{children:t.description})]})}),(0,s.jsx)(eR.zG,{className:"col-start-5 col-span-8"})]})}},e)})]})]})]})]})})})},eP=n(37914);async function eW(e){let{projectRef:t,connectionString:n,id:s,payload:a}=e,r=eS.Z.roles.remove({id:s},a).sql,{result:i}=await (0,e_.R)({projectRef:t,connectionString:n,sql:r,queryKey:["roles","delete"]});return i}let eO=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>eW(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await (0,ef.fA)(s,r),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to delete database role: ".concat(e.message)):t(e,n,s)},...n})};var eq=e=>{let{role:t,visible:n,onClose:a}=e,{project:r}=(0,j.d2)(),{mutate:i,isLoading:l}=eO({onSuccess:()=>{ey.Am.success("Successfully deleted role: ".concat(t.name)),a()}}),o=async()=>r?t?void i({projectRef:r.ref,connectionString:r.connectionString,id:t.id}):console.error("Failed to delete role: role is missing"):console.error("Project is required");return(0,s.jsx)(eP.Z,{size:"small",alignFooter:"right",visible:n,onCancel:a,onConfirm:o,header:(0,s.jsxs)("h3",{children:['Confirm to delete role "',null==t?void 0:t.name,'"']}),loading:l,children:(0,s.jsx)(eP.Z.Content,{children:(0,s.jsx)("p",{className:"text-sm",children:"This will automatically revoke any membership of this role in other roles, and this action cannot be undone."})})})},eB=n(28289),eV=n(75856),eM=n(77127);async function eY(e){let{projectRef:t,connectionString:n,id:s,payload:a}=e,r=eS.Z.roles.update({id:s},a).sql,{result:i}=await (0,e_.R)({projectRef:t,connectionString:n,sql:r,queryKey:["roles","update"]});return i}let eU=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>eY(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await (0,ef.fA)(s,r),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to update database role: ".concat(e.message)):t(e,n,s)},...n})};var eX=n(9090),eQ=n(29274),eG=e=>{let{role:t,disabled:n=!1,onSelectDelete:a}=e,{project:r}=(0,j.d2)(),[i,l]=(0,p.useState)(!1),{mutate:o,isLoading:c}=eU(),{isSuperuser:u,canLogin:h,canCreateRole:x,canCreateDb:f,isReplicationRole:g,canBypassRls:v}=t,b=async(e,n)=>{let{resetForm:s}=n;if(!r)return console.error("Project is required");let a=Object.fromEntries(Object.entries(e).filter(e=>{let[n,s]=e;return s!==t[n]}));o({projectRef:r.ref,connectionString:r.connectionString,id:t.id,payload:a},{onSuccess:()=>{ey.Am.success('Successfully updated role "'.concat(t.name,'"')),s({values:{...e},initialValues:{...e}})}})};return(0,s.jsx)(eB.Z,{name:"role-update-form",initialValues:{isSuperuser:u,canLogin:h,canCreateRole:x,canCreateDb:f,isReplicationRole:g,canBypassRls:v},onSubmit:b,className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong data-open:pb-px col-span-12 mx-auto -space-y-px overflow-hidden border border-t-0 first:border-t first:!mt-0 hover:border-t hover:-mt-[1px] shadow transition hover:z-50 first:rounded-tl first:rounded-tr last:rounded-bl last:rounded-br",children:e=>{let{values:r,initialValues:o,handleReset:u}=e,h=JSON.stringify(r)!==JSON.stringify(o);return(0,s.jsxs)(eV.ZP,{open:i,children:[(0,s.jsx)(eV.ZP.Trigger,{asChild:!0,children:(0,s.jsxs)("button",{id:"collapsible-trigger",type:"button",className:"group flex w-full items-center justify-between rounded py-3 px-4 md:px-6 text-foreground",onClick:e=>{"collapsible-trigger"===e.target.id&&l(!i)},children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(eX.Z,{id:"collapsible-trigger",className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,s.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,s.jsx)("p",{className:"text-left text-sm",id:"collapsible-trigger",children:t.name}),(0,s.jsxs)("p",{className:"text-left text-sm text-foreground-light",id:"collapsible-trigger",children:["(ID: ",t.id,")"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[t.activeConnections>0&&(0,s.jsx)("div",{className:"relative h-2 w-2",children:(0,s.jsxs)("span",{className:"flex h-2 w-2",children:[(0,s.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-brand opacity-75"}),(0,s.jsx)("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-brand opacity-75"})]})}),(0,s.jsxs)("p",{id:"collapsible-trigger",className:"text-sm ".concat(t.activeConnections>0?"text-foreground":"text-foreground-light"),children:[t.activeConnections," connections"]}),!n&&(0,s.jsxs)(E.h_,{children:[(0,s.jsx)(E.$F,{asChild:!0,children:(0,s.jsx)(_.z,{type:"default",className:"px-1",children:(0,s.jsx)(d.Z,{})})}),(0,s.jsx)(E.AW,{side:"bottom",className:"w-[120px]",children:(0,s.jsxs)(E.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),a(t)},children:[(0,s.jsx)(m.Z,{className:"text-red-800",size:"14",strokeWidth:2}),(0,s.jsx)("p",{children:"Delete"})]})})]})]})]})}),(0,s.jsx)(eV.ZP.Content,{children:(0,s.jsxs)("div",{className:"group border-t border-default bg-surface-100 py-6 px-5 md:px-20 text-foreground",children:[(0,s.jsx)("div",{className:"py-4 space-y-[9px]",children:Object.keys(eI.IC).map(e=>(0,s.jsx)(eM.Z,{size:"small",id:e,name:e,label:eI.IC[e].description,disabled:n||eI.IC[e].disabled,className:["roles-toggle",n||eI.IC[e].disabled?"[&>div>button]:opacity-30 [&>div>label]:text-foreground-lighter":""].join(" "),afterLabel:!n&&eI.IC[e].disabled&&(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{children:(0,s.jsx)(eQ.Z,{size:"14",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,s.jsx)(z._v,{side:"bottom",children:"This privilege cannot be updated via the dashboard"})]})},e))}),!n&&(0,s.jsxs)("div",{className:"py-4 flex items-center space-x-2 justify-end",children:[(0,s.jsx)(_.z,{type:"default",disabled:!h||c,onClick:()=>u(),children:"Cancel"}),(0,s.jsx)(_.z,{type:"primary",htmlType:"submit",disabled:!h||c,loading:c,children:"Save"})]})]})})]})}})},eH=e=>{let{index:t}=e;return(0,s.jsx)("div",{className:(0,el.cn)(["bg-surface-100","data-open:bg-selection","border-default","data-open:border-strong","data-open:pb-px col-span-12 mx-auto","-space-y-px overflow-hidden","border border-t-0 first:border-t first:!mt-0 shadow transition","first:rounded-tl first:rounded-tr","last:rounded-bl last:rounded-br"]),children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between rounded py-3 px-6 text-foreground",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(eX.Z,{id:"collapsible-trigger",className:"text-border-stronger rotate-180",strokeWidth:2,width:14}),(0,s.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,s.jsx)(N.Z,{className:"h-4 w-20 py-0 my-0.5",delayIndex:t}),(0,s.jsx)(N.Z,{className:"h-4 w-16 py-0 my-0.5",delayIndex:t})]})]}),(0,s.jsx)(N.Z,{className:"h-4 w-[90px] py-0 my-0.5",delayIndex:t})]})})},eJ=()=>{let{project:e}=(0,j.d2)(),[t,n]=(0,p.useState)(""),[r,i]=(0,p.useState)("all"),[l,d]=(0,p.useState)(!1),[u,m]=(0,p.useState)(),h=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"roles"),{data:x}=(0,ej.E3)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),f=null==x?void 0:x.maxConnections,{data:g,isLoading:v}=(0,ef.x4)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),b=eh()(null!=g?g:[],e=>e.name.toLocaleLowerCase()),N=("active"===r?b.filter(e=>e.activeConnections>0):b).filter(e=>e.name.includes(t)),[w,S]=eu()(N,e=>eI.NM.includes(e.name)),C=b.map(e=>e.activeConnections).reduce((e,t)=>e+t,0),E=eh()(b.filter(e=>e.activeConnections>0),e=>-e.activeConnections);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mb-4 flex items-center justify-between gap-2 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(k.Z,{size:"tiny",className:"w-52",placeholder:"Search for a role",icon:(0,s.jsx)(o.Z,{size:12}),value:t,onChange:e=>n(e.target.value),actions:t&&(0,s.jsx)(_.z,{size:"tiny",type:"text",onClick:()=>n(""),className:"px-1 mr-1",children:(0,s.jsx)(D.Z,{size:12,strokeWidth:2})})}),(0,s.jsxs)("div",{className:"flex items-center border border-strong rounded-full w-min h-[26px]",children:[(0,s.jsx)("button",{className:["text-xs w-[80px] h-full text-center rounded-l-full flex items-center justify-center transition","all"===r?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>i("all"),children:"All roles"}),(0,s.jsx)("div",{className:"h-full w-[1px] border-r border-strong"}),(0,s.jsx)("button",{className:["text-xs w-[80px] h-full text-center rounded-r-full flex items-center justify-center transition","active"===r?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>i("active"),children:"Active roles"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{children:(0,s.jsx)("div",{className:"w-42",children:(0,s.jsx)(ep.Z,{type:"horizontal",max:f||C,value:C,barClass:0===f||void 0===f?"bg-foreground":C>.9*f?"bg-destructive":C>.75*f?"bg-warning":void 0,labelTop:Number.isInteger(f)?"".concat(C,"/").concat(f):"".concat(C),labelTopClass:"text-xs",labelBottom:"Active connections",labelBottomClass:"text-xs"})})}),(0,s.jsxs)(z._v,{align:"start",side:"bottom",className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-foreground-light pr-2",children:"Connections by roles:"}),E.map(e=>(0,s.jsxs)("div",{children:[e.name,": ",e.activeConnections]},e.id))]})]}),(0,s.jsx)(y.u,{type:"primary",disabled:!h,icon:(0,s.jsx)(c.Z,{size:12}),onClick:()=>d(!0),tooltip:{content:{side:"bottom",text:h?void 0:"You need additional permissions to add a new role"}},children:"Add role"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"bg-surface-100 border border-default px-4 md:px-6 py-3 rounded-t flex items-center space-x-4",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Roles managed by Supabase"}),(0,s.jsx)(eg.C,{variant:"brand",children:"Protected"})]}),v?Array.from({length:5}).map((e,t)=>(0,s.jsx)(eH,{index:t},t)):w.map(e=>(0,s.jsx)(eG,{disabled:!0,role:e,onSelectDelete:m},e.id))]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"bg-surface-100 border border-default px-4 md:px-6 py-3 rounded-t",children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Other database roles"})}),v?Array.from({length:3}).map((e,t)=>(0,s.jsx)(eH,{index:t},t)):S.map(e=>(0,s.jsx)(eG,{disabled:!h,role:e,onSelectDelete:m},e.id))]})]}),t.length>0&&0===N.length&&(0,s.jsx)(ex.Z,{searchString:t,onResetFilter:()=>n("")}),(0,s.jsx)(eD,{visible:l,onClose:()=>d(!1)}),(0,s.jsx)(eq,{role:u,visible:void 0!==u,onClose:()=>m(void 0)})]})},eK=n(7534),e$=n.n(eK),e0=n(19369),e1=n(27477),e2=n(62445),e4=n(31723),e3=n(30445),e5=e=>{let{index:t=0}=e;return(0,s.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,s.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,s.jsx)("div",{className:"flex items-center gap-1 max-w-[85%]",children:(0,s.jsx)("div",{className:"flex items-center space-x-2 truncate",children:(0,s.jsx)(N.Z,{className:"h-5 w-32 m-0 text-foreground",delayIndex:t})})}),(0,s.jsx)(eM.Z,{size:"tiny",checked:!1,disabled:!0})]}),(0,s.jsx)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:(0,s.jsx)("div",{className:"py-3 px-4",children:(0,s.jsx)(N.Z,{className:"h-4 w-48",delayIndex:t})})})]})},e8=n(15093),e6=()=>{let{filter:e}=(0,f.UO)(),{project:t}=(0,j.d2)(),[n,r]=(0,p.useState)(""),{data:i,isLoading:l}=(0,e4.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),c=0===n.length?null!=i?i:[]:(null!=i?i:[]).filter(e=>{let t=e.name.toLowerCase().includes(n.toLowerCase()),s=(e8.Xq[e.name]||[]).some(e=>e.includes(n.toLowerCase()));return t||s}),d=c.filter(e=>!e8.Ht.includes(e.name)),[u,m]=eu()(d,e=>!e$()(e.installed_version)),h=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),x=(0,Z.N4)();return(0,p.useEffect)(()=>{void 0!==e&&r(e)},[e]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(k.Z,{size:"tiny",placeholder:"Search for an extension",value:n,onChange:e=>r(e.target.value),className:"w-52",icon:(0,s.jsx)(o.Z,{size:14})}),(0,s.jsx)(e1.G,{href:"https://supabase.com/docs/guides/database/extensions"})]})}),x&&!h&&(0,s.jsx)(e2.Z,{icon:(0,s.jsx)(e0.Z,{className:"text-foreground-light",size:18,strokeWidth:2}),title:"You need additional permissions to update database extensions"}),l?(0,s.jsx)("div",{className:"my-8 w-full space-y-12",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(N.Z,{className:"h-[28px] w-40"}),(0,s.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((e,t)=>(0,s.jsx)(e5,{index:t},t))})]})}):(0,s.jsxs)(s.Fragment,{children:[0===c.length&&(0,s.jsx)(ex.Z,{searchString:n,onResetFilter:()=>r("")}),(0,s.jsxs)("div",{className:"my-8 w-full space-y-12",children:[u.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-lg",children:"Enabled extensions"}),(0,s.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:u.map(e=>(0,s.jsx)(e3.Z,{extension:e},e.name))})]}),m.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-lg",children:"Available extensions"}),(0,s.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:m.map(e=>(0,s.jsx)(e3.Z,{extension:e},e.name))})]})]})]})]})},e9=n(15518),e7=n(58901),te=e=>{let{index:t}=e;return(0,s.jsxs)(v.Z.tr,{className:"border-t",children:[(0,s.jsx)(v.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:(0,s.jsx)(N.Z,{className:"h-4 w-24 my-0.5 p-0",delayIndex:t})}),(0,s.jsx)(v.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:(0,s.jsx)(N.Z,{className:"h-4 w-14 my-0.5 p-0",delayIndex:t})}),Array.from({length:4}).map((e,t)=>(0,s.jsx)(v.Z.td,{children:(0,s.jsx)(eM.Z,{size:"tiny",checked:!1,disabled:!0})},t)),(0,s.jsx)(v.Z.td,{className:"px-4 py-3 pr-2",children:(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(N.Z,{className:"h-6 w-12 p-0",delayIndex:t})})})]})},tt=e=>{let{onSelectPublication:t=i()}=e,{project:n}=(0,j.d2)(),[r,l]=(0,p.useState)(""),{data:c,isLoading:d}=(0,B.z)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),{mutate:u}=(0,e7.u)({onSuccess:()=>{ey.Am.success("Successfully updated event"),b(null)}}),m=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"publications"),h=(0,Z.N4)(),x=[{event:"Insert",key:"publish_insert"},{event:"Update",key:"publish_update"},{event:"Delete",key:"publish_delete"},{event:"Truncate",key:"publish_truncate"}],f=0===r.length?null!=c?c:[]:(null!=c?c:[]).filter(e=>e.name.includes(r)),[g,b]=(0,p.useState)(null),y=async()=>{if(!g||!n)return;let{publication:e,event:t,currentStatus:s}=g,a={projectRef:n.ref,connectionString:n.connectionString,id:e.id};a["publish_".concat(t.event.toLowerCase())]=!s,u(a)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)(k.Z,{size:"tiny",icon:(0,s.jsx)(o.Z,{size:"14"}),placeholder:"Filter",value:r,onChange:e=>l(e.target.value)})}),h&&!m&&(0,s.jsx)("div",{className:"w-[500px]",children:(0,s.jsx)(e2.Z,{icon:(0,s.jsx)(e0.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database publications"})})]})}),(0,s.jsx)("div",{className:"w-full overflow-hidden overflow-x-auto",children:(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{children:"Name"},"header.name"),(0,s.jsx)(v.Z.th,{children:"System ID"},"header.id"),(0,s.jsx)(v.Z.th,{children:"Insert"},"header.insert"),(0,s.jsx)(v.Z.th,{children:"Update"},"header.update"),(0,s.jsx)(v.Z.th,{children:"Delete"},"header.delete"),(0,s.jsx)(v.Z.th,{children:"Truncate"},"header.truncate"),(0,s.jsx)(v.Z.th,{className:"text-right",children:"Source"},"header.source")],body:d?Array.from({length:5}).map((e,t)=>(0,s.jsx)(te,{index:t},t)):f.map(e=>(0,s.jsxs)(v.Z.tr,{className:"border-t",children:[(0,s.jsx)(v.Z.td,{className:"px-4 py-3",children:e.name}),(0,s.jsx)(v.Z.td,{children:e.id}),x.map(t=>(0,s.jsx)(v.Z.td,{children:(0,s.jsx)(eM.Z,{size:"tiny",checked:e[t.key],disabled:!m,onChange:()=>{b({publication:e,event:t,currentStatus:e[t.key]})}})},t.key)),(0,s.jsx)(v.Z.td,{className:"px-4 py-3 pr-2",children:(0,s.jsx)("div",{className:"flex justify-end gap-2",children:(0,s.jsx)(_.z,{type:"default",style:{paddingTop:3,paddingBottom:3},onClick:()=>t(e.id),children:null==e.tables?"All tables":"".concat(e.tables.length," ").concat(e.tables.length>1||0==e.tables.length?"tables":"table")})})})]},e.name))})}),!d&&0===f.length&&(0,s.jsx)(ex.Z,{searchString:r,onResetFilter:()=>l(""),className:"rounded-t-none border-t-0"}),(0,s.jsx)(e9.Z,{visible:null!==g,title:"Confirm to toggle sending ".concat(null==g?void 0:g.event.event.toLowerCase()," events"),confirmLabel:"Confirm",confirmLabelLoading:"Updating",onCancel:()=>b(null),onConfirm:()=>{y()},children:(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to ",(null==g?void 0:g.currentStatus)?"stop":"start"," ","sending ",null==g?void 0:g.event.event.toLowerCase()," events for"," ",null==g?void 0:g.publication.name,"?"]})})]})},tn=n(94583),ts=e=>{var t;let{table:n,selectedPublication:r}=e,{project:i}=(0,j.d2)(),l=null==r.tables,[o,c]=(0,p.useState)((null===(t=r.tables)||void 0===t?void 0:t.find(e=>e.id==n.id))!=void 0),d=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{mutate:u,isLoading:m}=(0,e7.u)(),h=async(e,t)=>{var n;if(void 0===i)return console.error("Project is required");c(!o);let s=null!==(n=null==t?void 0:t.tables)&&void 0!==n?n:[],a=s.some(t=>t.id==e.id)?s.filter(t=>t.id!=e.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(e.schema,".").concat(e.name)].concat(s.map(e=>"".concat(e.schema,".").concat(e.name)));u({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:t.id,tables:a},{onSuccess:()=>{ey.Am.success("Successfully ".concat(o?"disabled":"enabled"," replication for ").concat(e.name))},onError:t=>{ey.Am.error("Failed to toggle replication for ".concat(e.name,": ").concat(t.message)),c(o)}})};return(0,s.jsxs)(v.Z.tr,{children:[(0,s.jsx)(v.Z.td,{className:"whitespace-nowrap",children:n.name}),(0,s.jsx)(v.Z.td,{className:"whitespace-nowrap",children:n.schema}),(0,s.jsx)(v.Z.td,{className:"hidden max-w-sm truncate whitespace-nowrap lg:table-cell",children:n.comment}),(0,s.jsx)(v.Z.td,{className:"px-4 py-3 pr-2",children:(0,s.jsx)("div",{className:"flex justify-end gap-2",children:l?(0,s.jsxs)(eg.C,{children:[(0,s.jsx)("span",{children:"Enabled"}),(0,s.jsx)("span",{className:"hidden lg:inline-block",children:"\xa0for all tables"})]}):(0,s.jsx)(eM.Z,{size:"tiny",align:"right",disabled:!d||m,className:"m-0 ml-2 mt-1 -mb-1 p-0",checked:o,onChange:()=>h(n,r)})})})]},n.id)},ta=e=>{let{selectedPublication:t,onSelectBack:n}=e,{project:r}=(0,j.d2)(),[i,c]=(0,p.useState)(""),d=(0,Z.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{data:u,isLoading:m,isSuccess:h,isError:x,error:f}=(0,$.Bj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{select:e=>e.filter(e=>0===i.length?!C.s.includes(e.schema):!C.s.includes(e.schema)&&e.name.includes(i))});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(_.z,{type:"outline",onClick:()=>n(),icon:(0,s.jsx)(l.Z,{}),style:{padding:"5px"}}),(0,s.jsx)("div",{children:(0,s.jsx)(k.Z,{size:"small",placeholder:"Filter",value:i,onChange:e=>c(e.target.value),icon:(0,s.jsx)(o.Z,{size:"14"})})})]}),!d&&(0,s.jsx)("div",{className:"w-[500px]",children:(0,s.jsx)(e2.Z,{icon:(0,s.jsx)(e0.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),m&&(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)(tn.Z,{})}),x&&(0,s.jsx)(b.Z,{error:f,subject:"Failed to retrieve tables"}),h&&(0===u.length?(0,s.jsx)(g.Z,{}):(0,s.jsx)("div",{children:(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{children:"Name"},"header-name"),(0,s.jsx)(v.Z.th,{children:"Schema"},"header-schema"),(0,s.jsx)(v.Z.th,{className:"hidden text-left lg:table-cell",children:"Description"},"header-desc"),(0,s.jsx)(v.Z.th,{},"header-all")],body:u.map(e=>(0,s.jsx)(ts,{table:e,selectedPublication:t},e.id))})}))]})},tr=n(28977),ti=n.n(tr),tl=n(55077),to=n(49510),tc=n(88256);async function td(e){let{ref:t,backup:n}=e;if(n.isPhysicalBackup){let{data:e,error:s}=await (0,Y.v_)("/platform/database/{ref}/backups/restore-physical",{params:{path:{ref:t}},body:{id:n.id,recovery_time_target:n.inserted_at}});if(s)throw s;return e}let{data:s,error:a}=await (0,Y.v_)("/platform/database/{ref}/backups/restore",{params:{path:{ref:t}},body:{id:n.id}});return a&&(0,Y.S3)(a),s}let tu=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,eC.D)(e=>td(e),{async onSuccess(t,n,s){await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to restore from backup: ".concat(e.message)):t(e,n,s)},...n})};var tm=n(46825),th=n(19890),tx=n(56535),tp=n(11968),tf=n(94744),tj=n(20156),tg=n(18858),tv=e=>{let{index:t,isHealthy:n,backup:r,onSelectBackup:i}=e,{ref:l}=(0,f.UO)(),o=(0,Z.Xo)(a.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{mutate:c,isLoading:d}=(0,tj.s)({onSuccess:e=>{let{fileUrl:t}=e,n=document.createElement("a");n.href=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}});return(0,s.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(t?"border-t border-default":""),children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(tg.c,{displayAs:"utc",utcTimestamp:r.inserted_at,labelFormat:"DD MMM YYYY HH:mm:ss (ZZ)",className:"text-left !text-sm font-mono tracking-tight"}),(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{children:(0,s.jsx)(eg.C,{variant:"default",children:r.isPhysicalBackup?"Physical":"Logical"})}),(0,s.jsxs)(z._v,{side:"bottom",children:["Learn more about backup types"," ",(0,s.jsx)(tf.U,{href:"https://supabase.com/blog/postgresql-physical-logical-backups",children:"here"})]})]})]}),(0,s.jsx)("div",{children:"COMPLETED"===r.status?(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(y.u,{type:"default",disabled:!n||!o,onClick:i,tooltip:{content:{side:"bottom",text:n?o?void 0:"You need additional permissions to trigger a restore":"Cannot be restored as project is not active"}},children:"Restore"}),(0,s.jsx)(y.u,{type:"default",icon:(0,s.jsx)(tp.Z,{}),loading:d,disabled:!o||d||r.isPhysicalBackup,onClick:()=>{if(!l)return console.error("Project ref is required");c({ref:l,backup:r})},tooltip:{content:{side:"bottom",className:r.isPhysicalBackup?"w-64":"",text:r.isPhysicalBackup?(0,s.jsxs)(s.Fragment,{children:["Physical backups cannot be downloaded through the dashboard. You can still download it via pgdump by following our guide"," ",(0,s.jsx)(tf.U,{href:"https://supabase.com/docs/guides/troubleshooting/download-logical-backups",children:"here"}),"."]}):o?void 0:"You need additional permissions to download backups"}},children:"Download"})]}):(0,s.jsx)(eg.C,{variant:"warning",children:"Backup In Progress..."})})]})},tb=n(70699),ty=n(10858),tN=()=>{var e,t;let n=(0,O.useRouter)(),a=(0,eZ.NL)(),{ref:r}=(0,f.UO)(),{project:i}=(0,j.d2)(),l=(null==i?void 0:i.status)===tx.S.ACTIVE_HEALTHY,[o,c]=(0,p.useState)(),{data:d}=(0,tm.T)({projectRef:r}),{mutate:u,isLoading:m,isSuccess:h}=tu({onSuccess:()=>{r&&setTimeout(()=>{(0,th.k7)(a,r,tx.S.RESTORING),ey.Am.success("Restoring database back to ".concat(ti()(null==o?void 0:o.inserted_at).format("DD MMM YYYY HH:mm:ss"))),n.push("/project/".concat(r))},3e3)}}),x=null!==(e=null==d?void 0:d.tierKey)&&void 0!==e?e:"",g=(null!==(t=null==d?void 0:d.backups)&&void 0!==t?t:[]).sort((e,t)=>new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()),v=null==d?void 0:d.pitr_enabled;return"FREE"===x?(0,s.jsx)(tc.Z,{addon:"pitr",icon:(0,s.jsx)(tl.Z,{size:20}),primaryText:"Free Plan does not include project backups.",secondaryText:"Upgrade to the Pro Plan for up to 7 days of scheduled backups.",source:"backups"}):v?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"space-y-6",children:0===g.length&&"FREE"!==x?(0,s.jsx)(tb.Z,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ty.Z,{}),(0,s.jsx)(to.Z,{children:null==g?void 0:g.map((e,t)=>(0,s.jsx)(tv,{backup:e,index:t,isHealthy:l,onSelectBackup:()=>c(e)},e.id))})]})}),(0,s.jsx)(e9.Z,{size:"small",confirmLabel:"Confirm restore",confirmLabelLoading:"Restoring",visible:void 0!==o,title:"Confirm to restore from backup",loading:m||h,onCancel:()=>c(void 0),onConfirm:()=>void 0===r?console.error("Project ref required"):void 0===o?console.error("Backup required"):void u({ref:r,backup:o}),children:(0,s.jsxs)("p",{className:"text-sm",children:["Are you sure you want to restore from"," ",ti()(null==o?void 0:o.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."]})})]})},tw=n(98219),tS=n(45346),tZ=n.n(tS),tC=n(29787),t_=n.n(tC),tk=n(61230),tE=n.n(tk),tz=n(27767),tR=n.n(tz),tT=n(92238),tA=n.n(tT),tI=n(23470),tF=n(26288),tL=n(50588),tD=n(59599),tP=n(24958),tW=n(81932),tO=e=>{let{icon:t,text:n}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2",children:[(0,s.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,s.jsx)("p",{className:"text-foreground-light",children:n})]})},tq=n(17470),tB=n(77546),tV=n(97065),tM=n(86710);async function tY(e){let{id:t,projectRef:n,connectionString:s,payload:a}=e,r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:i,error:l}=await (0,Y.r$)("/platform/pg-meta/{ref}/triggers",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{id:t}},body:a,headers:r});return l&&(0,Y.S3)(l),i}let tU=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>tY(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(tM.D.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to update database trigger: ".concat(e.message)):t(e,n,s)},...n})};var tX=n(13099),tQ=n(57711),tG=n(25289),tH=n(2099),tJ=n(69107),tK=n.n(tJ),t$=n(3010),t0=n.n(t$),t1=n(47594),t2=n(48560),t4=n(15647),t3=e=>{let{triggerFunctions:t,visible:n,onChange:a,setVisible:r}=e,i=t.length>=1,l=tK()(t0()(t,"schema"),"schema");function o(e){a(e),r(!n)}return(0,s.jsx)(ez.ZP,{size:"large",header:"Pick a function",visible:n,onCancel:()=>r(!n),className:"hooks-sidepanel",children:(0,s.jsx)("div",{className:"py-6",children:i?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(t5,{}),l.map(e=>(0,s.jsx)(t6,{schema:e,functions:t.filter(t=>t.schema==e),selectFunction:o},e))]}):(0,s.jsx)(t8,{})})})};let t5=()=>{let{ref:e}=(0,f.UO)();return(0,s.jsx)("div",{className:"px-6",children:(0,s.jsx)(e2.Z,{icon:(0,s.jsx)(eQ.Z,{size:"20",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,s.jsx)(_.z,{asChild:!0,type:"default",children:(0,s.jsx)(x(),{href:"/project/".concat(e,"/database/functions"),children:"Go to Functions"})})})})},t8=()=>{let e=(0,O.useRouter)(),{ref:t}=e.query;return(0,s.jsx)(t1.Z,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:()=>{e.push("/project/".concat(t,"/database/functions"))},children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},t6=e=>{let{schema:t,functions:n,selectFunction:a}=e;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,s.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,s.jsx)("h5",{children:t})]}),(0,s.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:n.map(e=>(0,s.jsx)(t9,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:a},e.id))})]})},t9=e=>{let{id:t,completeStatement:n,name:a,onClick:r}=e,[i,l]=(0,p.useState)(!1);return(0,s.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-studio",onClick:()=>r(t),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,s.jsx)(tG.Z,{strokeWidth:2,size:14})}),(0,s.jsx)("p",{className:"mb-0 text-sm",children:a})]}),(0,s.jsx)(_.z,{type:"text",onClick:e=>{e.stopPropagation(),l(!i)},icon:(0,s.jsx)(t4.Z,{className:i?"rotate-180 transform":"rotate-0 transform"}),children:i?"Hide definition":"View definition"})]}),(0,s.jsx)(tH.u,{show:i,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,s.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,s.jsx)(t2.Z,{defaultValue:n,readOnly:!0,contextmenu:!1})})})]})};class t7{get requestBody(){return{id:this.id,activation:this.activation.value,enabled_mode:this.enabledMode.value,events:this.events.value,function_name:this.functionName.value,function_schema:this.functionSchema.value,orientation:this.orientation.value,name:this.name.value,schema:this.schema.value,table:this.table.value}}reset(e){var t,n,s,a,r,i,l,o,c,d,u;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.activation={value:null!==(t=null==e?void 0:e.activation)&&void 0!==t?t:"BEFORE"},this.enabledMode={value:null!==(n=null==e?void 0:e.enabled_mode)&&void 0!==n?n:"ORIGIN"},this.events={value:null!==(s=null==e?void 0:e.events)&&void 0!==s?s:[]},this.functionName={value:null!==(a=null==e?void 0:e.function_name)&&void 0!==a?a:""},this.functionSchema={value:null!==(r=null==e?void 0:e.function_schema)&&void 0!==r?r:""},this.orientation={value:null!==(i=null==e?void 0:e.orientation)&&void 0!==i?i:"STATEMENT"},this.name={value:null!==(l=null==e?void 0:e.name)&&void 0!==l?l:""},this.schema={value:null!==(o=null==e?void 0:e.schema)&&void 0!==o?o:""},this.table={value:null!==(c=null==e?void 0:e.table)&&void 0!==c?c:""},this.tableId={value:null!==(d=null==e?void 0:e.table_id)&&void 0!==d?d:""},this.condition={value:null!==(u=null==e?void 0:e.condition)&&void 0!==u?u:""}}update(e){this.activation=e.activation,this.enabledMode=e.enabledMode,this.events=e.events,this.functionName=e.functionName,this.functionSchema=e.functionSchema,this.orientation=e.orientation,this.name=e.name,this.schema=e.schema,this.table=e.table,this.tableId=e.tableId}constructor(){(0,tw._)(this,"id",void 0),(0,tw._)(this,"originalName",void 0),(0,tw._)(this,"activation",void 0),(0,tw._)(this,"enabledMode",void 0),(0,tw._)(this,"events",void 0),(0,tw._)(this,"functionName",void 0),(0,tw._)(this,"functionSchema",void 0),(0,tw._)(this,"orientation",void 0),(0,tw._)(this,"name",void 0),(0,tw._)(this,"schema",void 0),(0,tw._)(this,"table",void 0),(0,tw._)(this,"tableId",void 0),(0,tw._)(this,"condition",void 0),(0,tI.ky)(this),this.reset()}}class ne{get isEditing(){return void 0!=this.formState.id}constructor(){(0,tw._)(this,"chooseFunctionFormVisible",!1),(0,tw._)(this,"formState",new t7),(0,tw._)(this,"meta",null),(0,tw._)(this,"tables",[]),(0,tw._)(this,"isDirty",!1),(0,tw._)(this,"setChooseFunctionFormVisible",e=>{this.chooseFunctionFormVisible=e}),(0,tw._)(this,"setDefaultSelectedTable",()=>{var e;(null===(e=this.tables)||void 0===e?void 0:e.length)!=0&&(this.formState.table.value=this.tables[0].name,this.formState.schema.value=this.tables[0].schema,this.formState.tableId.value=this.tables[0].id)}),(0,tw._)(this,"setisDirty",e=>{this.isDirty=e}),(0,tw._)(this,"setTables",e=>{this.tables=e.sort((e,t)=>e.schema.localeCompare(t.schema)).filter(e=>!C.s.includes(e.schema)),this.setDefaultSelectedTable()}),(0,tw._)(this,"onFormChange",e=>{let{key:t,value:n}=e;if(this.isDirty=!0,tZ()(this.formState,t)){let e=this.formState[t];this.formState[t]={...e,value:n,error:void 0}}else this.formState[t]={value:n}}),(0,tw._)(this,"onSelectFunction",e=>{this.formState.functionName.value=e.name,this.formState.functionSchema.value=e.schema}),(0,tw._)(this,"validateForm",()=>{let e=!0,t=tE()(this.formState,(t,n)=>{switch(n){case"name":var s;if(t_()(t.value)||(s=t.value,/\s/.test(s)))return e=!1,{...t,error:"Invalid trigger name"};return t;case"activation":if(t_()(t.value))return e=!1,{...t,error:"you have an error"};return t;case"events":if(t_()(t.value))return e=!1,{...t,error:"Select at least 1 event"};return t;case"tableId":if(t_()("".concat(t.value)))return e=!1,{...t,error:"You must choose a table"};return t;default:return t}});return e||this.formState.update(t),e}),(0,tI.ky)(this)}}let nt=(0,p.createContext)(null);var nn=(0,tF.Pi)(e=>{let{trigger:t,visible:n,setVisible:a}=e,{project:r}=(0,j.d2)(),[i,l]=(0,p.useState)(!1),o=(0,tF.fv)(()=>new ne);(0,$.Bj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{onSuccess(e){o.tables.length<=0&&o.setTables(e)}});let{data:c}=(0,tB.R)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),d=(null!=c?c:[]).filter(e=>"trigger"===e.return_type),{mutate:u,isLoading:m}=(0,tV.x)(),{mutate:h,isLoading:x}=tU();async function f(){if(!r)return console.error("Project is required");if(o.validateForm()){let e=o.formState.requestBody;o.isEditing&&e.id?h({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:e.id,payload:e},{onSuccess:()=>{ey.Am.success("Successfully updated trigger ".concat(e.name)),a(!n)},onError:e=>{ey.Am.error("Failed to update trigger: ".concat(e.message))}}):u({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,payload:e},{onSuccess:()=>{ey.Am.success("Successfully created trigger ".concat(e.name)),a(!n)},onError:e=>{ey.Am.error("Failed to create trigger: ".concat(e.message))}})}}(0,p.useEffect)(()=>{o.setisDirty(!1),t?o.formState.reset(t):(o.formState.reset(),o.setDefaultSelectedTable())},[n,t]);let g=o.tables.length>=1;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ez.ZP,{size:"large",visible:n,onCancel:()=>{o.isDirty?l(!0):a(!n)},header:o.formState.id?"Edit '".concat(o.formState.originalName,"' trigger"):"Add a new Trigger",hideFooter:!g,className:o.chooseFunctionFormVisible?"hooks-sidepanel mr-16 transform transition-all duration-300 ease-in-out":"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:m||x,onConfirm:f,children:g?(0,s.jsxs)("div",{children:[(0,s.jsxs)(nt.Provider,{value:o,children:[(0,s.jsx)("div",{className:"my-6 space-y-10",children:o.isEditing?(0,s.jsxs)("div",{className:"space-y-6 px-6",children:[(0,s.jsx)(ns,{}),(0,s.jsx)(na,{}),o.formState.condition.value&&(0,s.jsx)(nr,{})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"px-6",children:(0,s.jsx)(ns,{})}),(0,s.jsx)(ez.ZP.Separator,{}),(0,s.jsxs)("div",{className:"space-y-12 px-6",children:[(0,s.jsx)("h5",{children:"Conditions to fire trigger"}),(0,s.jsx)(nl,{}),(0,s.jsx)(no,{}),(0,s.jsx)(nc,{}),(0,s.jsx)(ni,{})]}),(0,s.jsx)(ez.ZP.Separator,{}),(0,s.jsx)(nd,{})]})}),(0,s.jsx)(t3,{triggerFunctions:d,visible:o.chooseFunctionFormVisible,setVisible:o.setChooseFunctionFormVisible,onChange:e=>{let t=(null!=c?c:[]).find(t=>t.id===e);t&&o.onSelectFunction(t)}})]}),(0,s.jsx)(e9.Z,{visible:i,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>l(!1),onConfirm:()=>{l(!1),a(!n)},children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]}):(0,s.jsx)(tq.Z,{message:"You will need to create a table first before you can make a trigger"})})})});let ns=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsx)(k.Z,{id:"name",label:"Name of trigger",layout:"horizontal",placeholder:"Name of trigger",value:t.formState.name.value,onChange:e=>t.onFormChange({key:"name",value:e.target.value}),size:"small",error:t.formState.name.error,descriptionText:"The name is also stored as the actual postgres name of the trigger. Do not use spaces/whitespace."})}),na=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)(tD.Z,{id:"enabled-mode",label:"Enabled mode",layout:"horizontal",value:t.formState.enabledMode.value,onChange:e=>t.onFormChange({key:"enabledMode",value:e}),size:"small",descriptionText:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:[(0,s.jsxs)(tD.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,s.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ORIGIN",label:"Origin",children:["Origin",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"This is a default behavior"})]}),(0,s.jsxs)(tD.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,s.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"REPLICA",label:"Replica",children:["Replica",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Will only fire if the session is in replica mode"})]}),(0,s.jsxs)(tD.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,s.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ALWAYS",label:"Always",children:["Always",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Will fire regardless of the current replication role"})]}),(0,s.jsxs)(tD.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,s.jsx)("div",{className:"h-3 w-3 rounded-full border border-red-700 bg-red-900 shadow-sm"})},value:"DISABLED",label:"Disabled",children:["Disabled",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Will not fire"})]})]})}),nr=(0,tF.Pi)(()=>{let e=(0,p.useContext)(nt);return(0,s.jsxs)("div",{className:"text-sm leading-4 grid gap-2 md:grid md:grid-cols-12",children:[(0,s.jsx)("div",{className:"flex flex-col space-y-2 col-span-4",children:(0,s.jsx)("label",{className:"block text-foreground-light text-sm leading-4 break-all",children:"Condition"})}),(0,s.jsxs)("div",{className:"col-span-8 h-[100px]",children:[(0,s.jsx)(tW.Z,{isReadOnly:!0,autofocus:!1,id:"trigger-condition-".concat(e.formState.id),language:"pgsql",defaultValue:e.formState.condition.value}),(0,s.jsxs)("div",{className:"mt-2 text-foreground-lighter leading-normal text-sm",children:["This condition must be met for the trigger to fire.",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-foreground",children:"To update the condition, you must drop and recreate this trigger."})]})]})]})}),ni=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)(tD.Z,{id:"orientation",label:"Orientation",layout:"horizontal",value:t.formState.orientation.value,onChange:e=>t.onFormChange({key:"orientation",value:e}),size:"small",descriptionText:"Identifies whether the trigger fires once for each processed row or once for each statement",children:[(0,s.jsxs)(tD.Z.Option,{value:"ROW",label:"Row",children:["Row",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each processed row"})]}),(0,s.jsxs)(tD.Z.Option,{value:"STATEMENT",label:"Statement",children:["Statement",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each statement"})]})]})}),nl=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsx)(tD.Z,{id:"table",label:"Table",layout:"horizontal",value:t.formState.tableId.value,onChange:e=>{let n=t.tables.find(t=>t.id===e);n&&(t.onFormChange({key:"table",value:n.name}),t.onFormChange({key:"schema",value:n.schema}),t.onFormChange({key:"tableId",value:e}))},size:"small",error:t.formState.tableId.error,descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:t.tables.map(e=>(0,s.jsx)(tD.Z.Option,{id:e.id,value:e.id,label:e.name,addOnBefore:()=>(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,s.jsx)(tL.Z,{src:"".concat(tx.GW,"/img/table-editor.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"')})}),children:(0,s.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:e.schema}),(0,s.jsx)("p",{className:"text-foreground",children:e.name})]})},e.id))})}),no=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)(tP.Z.Group,{name:"events",label:"Events",id:"events",labelOptional:"The type of events that will trigger your trigger",layout:"horizontal",descriptionText:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",size:"small",onChange:e=>{let n=t.formState.events.value,s=e.target.checked?tR()(n,[e.target.value]):tA()(n,e.target.value);t.onFormChange({key:"events",value:s})},error:t.formState.events.error,children:[(0,s.jsx)(tP.Z,{value:"INSERT",label:"Insert",description:"Any insert operation on the table",checked:t.formState.events.value.includes("INSERT")}),(0,s.jsx)(tP.Z,{value:"UPDATE",label:"Update",description:"Any update operation, of any column in the table",checked:t.formState.events.value.includes("UPDATE")}),(0,s.jsx)(tP.Z,{value:"DELETE",label:"Delete",description:"Any deletion of a record",checked:t.formState.events.value.includes("DELETE")})]})}),nc=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)(tD.Z,{id:"activation",label:"Trigger type",descriptionText:"This determines when your Hook fires",onChange:e=>{t.onFormChange({key:"activation",value:e})},value:t.formState.activation.value,layout:"horizontal",size:"small",error:t.formState.activation.error,children:[(0,s.jsx)(tD.Z.Option,{id:"before",value:"BEFORE",label:"Before the event",addOnBefore:()=>(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,s.jsx)(tX.Z,{strokeWidth:2,size:"18"})}),children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:"before"}),(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires before the operation is attempted"})]})}),(0,s.jsx)(tD.Z.Option,{id:"after",value:"AFTER",label:"After the event",addOnBefore:()=>(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-green-1200 p-1 text-background",children:(0,s.jsx)(tQ.Z,{strokeWidth:2,size:"18"})}),children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:"after"}),(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires after the operation has completed"})]})})]})}),nd=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"space-y-6 px-6",children:(0,s.jsx)("h5",{children:"Function to trigger"})}),(0,s.jsx)("div",{className:"px-6",children:t_()(t.formState.functionName.value)?(0,s.jsx)(nu,{}):(0,s.jsx)(nm,{})})]})}),nu=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsx)("button",{type:"button",onClick:()=>t.setChooseFunctionFormVisible(!0),className:"relative w-full rounded border border-default bg-surface-200 px-5 py-1 shadow-sm transition-all hover:border-strong hover:bg-overlay-hover",children:(0,s.jsx)(tO,{icon:(0,s.jsx)(tG.Z,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})})}),nm=(0,tF.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"relative w-full flex items-center justify-between space-x-3 px-5 py-4 border border-default rounded shadow-sm transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,s.jsx)(tG.Z,{size:"18",strokeWidth:2,width:14})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("p",{className:"text-foreground-light",children:t.formState.functionName.value}),(0,s.jsx)("div",{children:(0,s.jsx)(eg.C,{children:t.formState.functionSchema.value})})]})]}),(0,s.jsx)(_.z,{type:"default",onClick:()=>t.setChooseFunctionFormVisible(!0),children:"Change function"})]})})});var nh=n(16556),nx=n(2183),np=e=>{let{trigger:t,visible:n,setVisible:a}=e,{project:r}=(0,j.d2)(),{id:i,name:l,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=(0,nh.m)();async function u(){return r?i?void c({projectRef:r.ref,connectionString:r.connectionString,id:i},{onSuccess:()=>{ey.Am.success("Successfully removed ".concat(l)),a(!1)}}):console.error("Trigger ID is required"):console.error("Project is required")}return(0,s.jsx)(nx.Z,{variant:"warning",visible:n,onCancel:()=>a(!n),onConfirm:u,title:"Delete this trigger",loading:d,confirmLabel:"Delete trigger ".concat(l),confirmPlaceholder:"Type in name of trigger",confirmString:l,text:(0,s.jsxs)(s.Fragment,{children:["This will delete your trigger called"," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:l})," of schema"," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:o})]}),alert:{title:"You cannot recover this trigger once deleted."}})},nf=n(64038),nj=n.n(nf),ng=n(35508),nv=n(63609);async function nb(e){let{projectRef:t,connectionString:n,payload:s}=e,{sql:a,zod:r}=eS.Z.functions.create(s),{result:i}=await (0,e_.R)({projectRef:t,connectionString:n,sql:a,queryKey:["functions","create"]});return i}let ny=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>nb(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nv.A.databaseFunctions(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to create database function: ".concat(e.message)):t(e,n,s)},...n})};async function nN(e){let{projectRef:t,connectionString:n,func:s,payload:a}=e,{sql:r,zod:i}=eS.Z.functions.update(s,a),{result:l}=await (0,e_.R)({projectRef:t,connectionString:n,sql:r,queryKey:["functions","update",s.id.toString()]});return l}let nw=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>nN(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nv.A.databaseFunctions(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to update database function: ".concat(e.message)):t(e,n,s)},...n})};var nS=n(33968),nZ=n(47889),nC=n(68981),n_=n(12361),nk=n(3597),nE=n(59225),nz=n(39190);let nR=e=>{let{selectedFunction:t,assistantVisible:n,setAssistantVisible:a}=e;return(0,s.jsx)(nS.Tu,{className:"py-3 flex flex-row justify-between items-center border-b-0",children:(0,s.jsxs)("div",{className:"flex flex-row gap-3 items-center max-w-[75%]",children:[(0,s.jsxs)(nS.sw,{className:(0,el.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","disabled:pointer-events-none data-[state=open]:bg-secondary","transition"),children:[(0,s.jsx)(D.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,s.jsx)(nS.bC,{className:"truncate",children:void 0!==t?"Edit '".concat(t,"' function"):"Add a new function"})]})})};var nT=n(56757),nA=n(95962);let nI=e=>{let{field:t,language:n,focused:a,setFocused:r}=e;return(0,s.jsxs)("div",{className:(0,el.cn)("rounded-md relative group flex-grow"),children:[(0,s.jsx)(eR.NI,{children:void 0!==n&&(0,s.jsx)(tW.Z,{id:"database-functions-editor",language:"pgsql",placeholder:"plpgsql"===n?"BEGIN\n\nEND;":void 0,value:t.value,onInputChange:t.onChange})}),(0,s.jsx)("div",{className:(0,el.cn)("absolute top-0 right-2 bg-surface-300 border border-strong rounded h-[28px]","opacity-0 group-hover:opacity-100 group-hover:top-2 transition-all"),children:(0,s.jsxs)(z.u,{children:[(0,s.jsx)(z.aJ,{asChild:!0,children:(0,s.jsx)(_.z,{type:"text",size:"tiny",className:(0,el.cn)("px-1.5 text-foreground-lighter hover:text-foreground","transition z-50"),onClick:()=>r(!a),icon:a?(0,s.jsx)(nT.Z,{}):(0,s.jsx)(nA.Z,{})})}),(0,s.jsx)(z._v,{side:"bottom",children:a?"Minimize editor":"Maximize editor"})]})})]})},nF="create-function-sidepanel",nL=eN.ZP.object({name:eN.ZP.string().trim().min(1),schema:eN.ZP.string().trim().min(1),args:eN.ZP.array(eN.ZP.object({name:eN.ZP.string().trim().min(1),type:eN.ZP.string().trim()})),behavior:eN.ZP.enum(["IMMUTABLE","STABLE","VOLATILE"]),definition:eN.ZP.string().trim().min(1),language:eN.ZP.string().trim(),return_type:eN.ZP.string().trim(),security_definer:eN.ZP.boolean(),config_params:eN.ZP.array(eN.ZP.object({name:eN.ZP.string().trim().min(1),value:eN.ZP.string().trim().min(1)})).optional()});var nD=e=>{let{func:t,visible:n,setVisible:a}=e,{project:r}=(0,j.d2)(),[i,l]=(0,p.useState)(!1),[o,c]=(0,p.useState)(!1),[d,u]=(0,p.useState)(!1),[m,h]=(0,p.useState)(!1),x=!!(null==t?void 0:t.id),f=(0,eb.cI)({resolver:(0,ev.F)(nL)}),g=f.watch("language"),{mutate:v,isLoading:b}=ny(),{mutate:y,isLoading:N}=nw();function w(){f.formState.isDirty?l(!0):a(!n)}let S=async e=>{if(!r)return console.error("Project is required");let s={...e,args:e.args.map(e=>"".concat(e.name," ").concat(e.type)),config_params:tE()(nj()(e.config_params,"name"),"value")};x?y({func:t,projectRef:r.ref,connectionString:r.connectionString,payload:s},{onSuccess:()=>{ey.Am.success("Successfully updated function ".concat(e.name)),a(!n)}}):v({projectRef:r.ref,connectionString:r.connectionString,payload:s},{onSuccess:()=>{ey.Am.success("Successfully created function ".concat(e.name)),a(!n)}})};return(0,p.useEffect)(()=>{if(n){var e,s,a,r,i,l,o;f.reset({name:null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"",schema:null!==(s=null==t?void 0:t.schema)&&void 0!==s?s:"public",args:(0,nz.cK)((null==t?void 0:t.argument_types)||"").value,behavior:null!==(a=null==t?void 0:t.behavior)&&void 0!==a?a:"VOLATILE",definition:null!==(r=null==t?void 0:t.definition)&&void 0!==r?r:"",language:null!==(i=null==t?void 0:t.language)&&void 0!==i?i:"plpgsql",return_type:null!==(l=null==t?void 0:t.return_type)&&void 0!==l?l:"void",security_definer:null!==(o=null==t?void 0:t.security_definer)&&void 0!==o&&o,config_params:(0,nz.QI)(null==t?void 0:t.config_params).value})}},[n,t]),(0,s.jsx)(nS.yo,{open:n,onOpenChange:()=>w(),children:(0,s.jsxs)(nS.ue,{showClose:!1,size:d?"lg":"default",className:(0,el.cn)("p-0 flex flex-row gap-0",d?"!min-w-screen lg:!min-w-[1200px]":"!min-w-screen lg:!min-w-[600px]"),children:[(0,s.jsxs)("div",{className:(0,el.cn)("flex flex-col grow w-full",d&&"w-[60%]"),children:[(0,s.jsx)(nR,{selectedFunction:null==t?void 0:t.name,assistantVisible:d,setAssistantVisible:u}),(0,s.jsx)(nZ.Z,{}),(0,s.jsx)(eR.l0,{...f,children:(0,s.jsxs)("form",{id:nF,className:"flex-grow overflow-auto",onSubmit:f.handleSubmit(S),children:[(0,s.jsx)(nS.DN,{className:m?"hidden":"",children:(0,s.jsx)(eR.Wi,{control:f.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsx)(nE.E,{label:"Name of function",description:"Name will also be used for the function name in postgres",layout:"horizontal",children:(0,s.jsx)(eR.NI,{children:(0,s.jsx)(eT.I,{...t})})})}})}),(0,s.jsx)(nZ.Z,{className:m?"hidden":""}),(0,s.jsxs)(nS.DN,{className:m?"hidden":"space-y-4",children:[(0,s.jsx)(eR.Wi,{control:f.control,name:"schema",render:e=>{let{field:t}=e;return(0,s.jsx)(nE.E,{label:"Schema",description:"Tables made in the table editor will be in 'public'",layout:"horizontal",children:(0,s.jsx)(eR.NI,{children:(0,s.jsx)(q.Z,{selectedSchemaName:t.value,excludedSchemas:C.s,size:"small",onSelectSchema:e=>t.onChange(e)})})})}}),!x&&(0,s.jsx)(eR.Wi,{control:f.control,name:"return_type",render:e=>{let{field:t}=e;return(0,s.jsx)(nE.E,{label:"Return type",layout:"horizontal",children:(0,s.jsxs)(nC.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(nC.i4,{className:"col-span-8",children:(0,s.jsx)(nC.ki,{})}),(0,s.jsx)(nC.Bw,{children:(0,s.jsx)(n_.xr,{className:"h-52",children:["void","record","trigger","integer",...ng.DL].map(e=>(0,s.jsx)(nC.Ql,{value:e,children:e},e))})})]})})}})]}),(0,s.jsx)(nZ.Z,{className:m?"hidden":""}),(0,s.jsx)(nS.DN,{className:m?"hidden":"",children:(0,s.jsx)(nP,{readonly:x})}),(0,s.jsx)(nZ.Z,{className:m?"hidden":""}),(0,s.jsx)(nS.DN,{className:"".concat(m?"h-full":""," !px-0"),children:(0,s.jsx)(eR.Wi,{control:f.control,name:"definition",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{className:"space-y-4 flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"px-content",children:[(0,s.jsx)(eR.lX,{className:"text-base text-foreground",children:"Definition"}),(0,s.jsxs)(eR.pf,{className:"text-sm text-foreground-light",children:[(0,s.jsxs)("p",{children:["The language below should be written in ",(0,s.jsx)("code",{children:g}),"."]}),!x&&(0,s.jsx)("p",{children:"Change the language in the Advanced Settings below."})]})]}),(0,s.jsx)("div",{className:(0,el.cn)("border border-default flex",m?"flex-grow ":"h-72"),children:(0,s.jsx)(nI,{field:t,language:g,focused:m,setFocused:h})}),(0,s.jsx)(eR.zG,{className:"px-content"})]})}})}),(0,s.jsx)(nZ.Z,{className:m?"hidden":""}),x?(0,s.jsx)(s.Fragment,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(nS.DN,{className:m?"hidden":"",children:(0,s.jsx)("div",{className:"space-y-8 rounded bg-studio py-4 px-6 border border-overlay",children:(0,s.jsx)(eM.Z,{onChange:()=>c(!o),label:"Show advanced settings",checked:o,labelOptional:"These are settings that might be familiar for Postgres developers"})})}),o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(nS.DN,{className:m?"hidden":"space-y-2 pt-0",children:[(0,s.jsx)(nq,{}),(0,s.jsx)(eR.Wi,{control:f.control,name:"behavior",render:e=>{let{field:t}=e;return(0,s.jsx)(nE.E,{label:"Behavior",layout:"horizontal",children:(0,s.jsxs)(nC.Ph,{defaultValue:t.value,onValueChange:t.onChange,children:[(0,s.jsx)(nC.i4,{className:"col-span-8",children:(0,s.jsx)(nC.ki,{})}),(0,s.jsxs)(nC.Bw,{children:[(0,s.jsx)(nC.Ql,{value:"IMMUTABLE",children:"immutable"},"IMMUTABLE"),(0,s.jsx)(nC.Ql,{value:"STABLE",children:"stable"},"STABLE"),(0,s.jsx)(nC.Ql,{value:"VOLATILE",children:"volatile"},"VOLATILE")]})]})})}})]}),(0,s.jsx)(nZ.Z,{className:m?"hidden":""}),(0,s.jsx)(nS.DN,{className:m?"hidden":"",children:(0,s.jsx)(nW,{readonly:x})}),(0,s.jsx)(nZ.Z,{className:m?"hidden":""}),(0,s.jsxs)(nS.DN,{className:m?"hidden":"",children:[(0,s.jsx)("h5",{className:"text-base text-foreground mb-4",children:"Type of Security"}),(0,s.jsx)(eR.Wi,{control:f.control,name:"security_definer",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.NI,{className:"col-span-8",children:(0,s.jsxs)(nk.Z.Group,{type:"cards",layout:"vertical",onChange:e=>t.onChange("SECURITY_DEFINER"==e.target.value),value:t.value?"SECURITY_DEFINER":"SECURITY_INVOKER",children:[(0,s.jsx)(nk.Z,{id:"SECURITY_INVOKER",label:"SECURITY INVOKER",value:"SECURITY_INVOKER",checked:!t.value,description:(0,s.jsxs)(s.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,s.jsx)("span",{className:"text-foreground",children:"calls it"}),"."]})}),(0,s.jsx)(nk.Z,{id:"SECURITY_DEFINER",label:"SECURITY DEFINER",value:"SECURITY_DEFINER",checked:t.value,description:(0,s.jsxs)(s.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,s.jsx)("span",{className:"text-foreground",children:"created it"}),"."]})})]})}),(0,s.jsx)(eR.zG,{})]})}})]})]})]})]})}),(0,s.jsxs)(nS.FF,{children:[(0,s.jsx)(_.z,{disabled:b||N,type:"default",onClick:w,children:"Cancel"}),(0,s.jsx)(_.z,{form:nF,htmlType:"submit",disabled:b||N,loading:b||N,children:"Confirm"})]})]}),d?(0,s.jsx)("div",{className:"border-l shadow-[rgba(0,0,0,0.13)_-4px_0px_6px_0px] z-10 w-[50%] bg-studio"}):null,(0,s.jsx)(e9.Z,{visible:i,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>l(!1),onConfirm:()=>{l(!1),a(!n)},children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]})})};let nP=e=>{let{readonly:t}=e,{fields:n,append:a,remove:r}=(0,eb.Dq)({name:"args"});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h5",{className:"text-base text-foreground",children:"Arguments"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Arguments can be referenced in the function body using either names or numbers."})]}),(0,s.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&t_()(n)&&(0,s.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),n.map((e,n)=>(0,s.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,s.jsx)(eR.Wi,{name:"args.".concat(n,".name"),render:e=>{let{field:n}=e;return(0,s.jsxs)(eR.xJ,{className:"flex-1",children:[(0,s.jsx)(eR.NI,{children:(0,s.jsx)(eT.I,{...n,disabled:t,placeholder:"argument_name"})}),(0,s.jsx)(eR.zG,{})]})}}),(0,s.jsx)(eR.Wi,{name:"args.".concat(n,".type"),render:e=>{let{field:n}=e;return(0,s.jsxs)(eR.xJ,{className:"flex-1",children:[(0,s.jsx)(eR.NI,{children:t?(0,s.jsx)(eT.I,{value:n.value,disabled:!0,readOnly:!0,className:"h-auto"}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(nC.Ph,{disabled:t,onValueChange:n.onChange,defaultValue:n.value,children:[(0,s.jsx)(nC.i4,{className:"h-[38px]",children:(0,s.jsx)(nC.ki,{})}),(0,s.jsx)(nC.Bw,{children:(0,s.jsx)(n_.xr,{className:"h-52",children:["integer",...ng.DL].map(e=>(0,s.jsx)(nC.Ql,{value:e,children:e},e))})})]})})}),(0,s.jsx)(eR.zG,{})]})}}),!t&&(0,s.jsx)(_.z,{type:"danger",icon:(0,s.jsx)(m.Z,{size:12}),onClick:()=>r(n),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,s.jsx)(_.z,{type:"default",icon:(0,s.jsx)(c.Z,{size:12}),onClick:()=>a({name:"",type:"integer"}),disabled:t,children:"Add a new argument"})]})]})},nW=e=>{let{readonly:t}=e,{fields:n,append:a,remove:r}=(0,eb.Dq)({name:"config_params"});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h5",{className:"text-base text-foreground",children:"Configuration Parameters"}),(0,s.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&t_()(n)&&(0,s.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),n.map((e,n)=>(0,s.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,s.jsx)(eR.Wi,{name:"config_params.".concat(n,".name"),render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{className:"flex-1",children:[(0,s.jsx)(eR.NI,{children:(0,s.jsx)(eT.I,{...t,placeholder:"parameter_name"})}),(0,s.jsx)(eR.zG,{})]})}}),(0,s.jsx)(eR.Wi,{name:"config_params.".concat(n,".value"),render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{className:"flex-1",children:[(0,s.jsx)(eR.NI,{children:(0,s.jsx)(eT.I,{...t,placeholder:"parameter_value"})}),(0,s.jsx)(eR.zG,{})]})}}),!t&&(0,s.jsx)(_.z,{type:"danger",icon:(0,s.jsx)(m.Z,{size:12}),onClick:()=>r(n),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,s.jsx)(_.z,{type:"default",icon:(0,s.jsx)(c.Z,{size:12}),onClick:()=>a({name:"",type:""}),disabled:t,children:"Add a new config"})]})]})},nO=["plpgsql","sql","plcoffee","plv8","plls"],nq=()=>{let{project:e}=(0,j.d2)(),{data:t}=(0,e4.H)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString},{select:e=>eu()(e,e=>!e$()(e.installed_version))[0]}),n=(0,p.useMemo)(()=>nO.filter(e=>!e.startsWith("pl")||(null==t?void 0:t.find(t=>t.name===e))!==void 0),[t]);return(0,s.jsx)(eR.Wi,{name:"language",render:e=>{let{field:t}=e;return(0,s.jsx)(nE.E,{label:"Language",layout:"horizontal",children:(0,s.jsxs)(nC.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(nC.i4,{className:"col-span-8",children:(0,s.jsx)(nC.ki,{})}),(0,s.jsx)(nC.Bw,{children:n.map(e=>(0,s.jsx)(nC.Ql,{value:e,children:e},e))})]})})}})};async function nB(e){let{projectRef:t,connectionString:n,func:s}=e,{sql:a,zod:r}=eS.Z.functions.remove(s),{result:i}=await (0,e_.R)({projectRef:t,connectionString:n,sql:a,queryKey:["functions","delete",s.id.toString()]});return i}let nV=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>nB(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nv.A.databaseFunctions(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to delete database function: ".concat(e.message)):t(e,n,s)},...n})};var nM=e=>{let{func:t,visible:n,setVisible:a}=e,{project:r}=(0,j.d2)(),{name:i,schema:l}=null!=t?t:{},{mutate:o,isLoading:c}=nV({onSuccess:()=>{ey.Am.success("Successfully removed function ".concat(i)),a(!1)}});async function d(){return t?r?void o({func:t,projectRef:r.ref,connectionString:r.connectionString}):console.error("Project is required"):console.error("Function is required")}return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(nx.Z,{variant:"warning",visible:n,onCancel:()=>a(!n),onConfirm:d,title:"Delete this function",loading:c,confirmLabel:"Delete function ".concat(i),confirmPlaceholder:"Type in name of function",confirmString:null!=i?i:"Unknown",text:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"This will delete the function"})," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:i})," ",(0,s.jsx)("span",{children:"from the schema"})," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:l})]}),alert:{title:"You cannot recover this function once deleted."}})})},nY=n(1447),nU=n(41111),nX=n(91539),nQ=n(19405),nG=n(92131),nH=n(50259);async function nJ(e){let{projectRef:t,connectionString:n,schema:s,name:a,description:r,values:i}=e,l='create type "'.concat(s,'"."').concat(a,'" as enum (').concat(i.map(e=>"'".concat(e,"'")).join(", "),");"),o=void 0!==r?'comment on type "'.concat(s,'"."').concat(a,"\" is '").concat(r,"';"):"",c=(0,nG.J)("".concat(l," ").concat(o)),{result:d}=await (0,e_.R)({projectRef:t,connectionString:n,sql:c});return d}let nK=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>nJ(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nH.P.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to create enumerated type: ".concat(e.message)):t(e,n,s)},...n})};var n$=n(23845),n0=e=>{let{index:t,id:n,field:a,isDisabled:r=!1,onRemoveValue:i}=e;return(0,s.jsx)(nX._l,{draggableId:n,index:t,isDragDisabled:r,children:e=>(0,s.jsxs)("div",{ref:e.innerRef,...e.draggableProps,className:"flex items-center space-x-2 space-y-2",children:[(0,s.jsx)("div",{...e.dragHandleProps,className:"opacity-50 hover:opacity-100 transition ".concat(r?"text-foreground-lighter !cursor-default":"text-foreground"),children:(0,s.jsx)(n$.Z,{size:16,strokeWidth:1.5})}),(0,s.jsx)(eT.I,{...a,className:"w-full"}),(0,s.jsx)(_.z,{type:"default",size:"small",disabled:r,icon:(0,s.jsx)(m.Z,{strokeWidth:1.5,size:16}),className:"px-2",onClick:()=>i()})]})})};let n1=[...ng.ji,...ng.BB,...ng.YF,...ng.Ks,...ng.XO,...ng.lb,...ng.vH,"bigint","bigserial","bit","bit varying","boolean","box","bytea","char","character","character varying","cidr","circle","date","double precision","inet","int","integer","interval","line","lseg","macaddr","macaddr8","money","numeric","decimal","path","pg_lsn","pg_snapshot","point","polygon","real","smallint","smallserial","serial","time with timezone","timestamp with timezone","tsquery","tsvector","txid_snapshot","xml"];var n2=n(99033),n4=e=>{let{visible:t,onClose:n,schema:a}=e,r={name:"",description:"",values:[{value:""}]},i=(0,p.useRef)(null),{project:l}=(0,j.d2)(),{mutate:o,isLoading:d}=nK({onSuccess:(e,t)=>{ey.Am.success('Successfully created type "'.concat(t.name,'"')),y()}});(0,p.useEffect)(()=>{m.reset(r)},[t]);let u=eN.Ry({name:eN.Z_().min(1,"Please provide a name for your enumerated type").refine(e=>!n1.includes(e),{message:"Name cannot be a native Postgres data type"}).default(""),description:eN.Z_().default("").optional(),values:eN.Ry({value:eN.Z_().min(1,"Please provide a value")}).array().default([])}),m=(0,eb.cI)({resolver:(0,ev.F)(u),defaultValues:r}),{fields:h,append:f,remove:g,move:v}=(0,eb.Dq)({name:"values",control:m.control}),b=e=>{e.destination&&v(e.source.index,e.destination.index)},y=()=>{m.reset(r),n()};return(0,s.jsx)(ez.ZP,{loading:d,visible:t,onCancel:y,header:"Create a new enumerated type",confirmText:"Create type",onConfirm:()=>{i.current&&i.current.click()},children:(0,s.jsx)(ez.ZP.Content,{className:"py-4",children:(0,s.jsx)(eR.l0,{...m,children:(0,s.jsxs)("form",{className:"space-y-4",onSubmit:m.handleSubmit(e=>{var t;return(null==l?void 0:l.ref)===void 0?console.error("Project ref required"):(null==l?void 0:l.connectionString)===void 0?console.error("Project connectionString required"):void o({projectRef:l.ref,connectionString:l.connectionString,schema:a,name:e.name,description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''"),values:e.values.filter(e=>e.value.length>0).map(e=>e.value.trim())})}),children:[(0,s.jsx)(eR.Wi,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{children:"Name"}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(eT.I,{...t})}),(0,s.jsx)(eR.zG,{})]})}}),(0,s.jsx)(eR.Wi,{control:m.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{children:"Description"}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(eT.I,{...t})}),(0,s.jsx)(eR.pf,{children:"Optional"})]})}}),(0,s.jsx)(nX.Z5,{onDragEnd:e=>b(e),children:(0,s.jsx)(nX.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,s.jsxs)("div",{ref:e.innerRef,children:[h.map((e,t)=>(0,s.jsx)(eR.Wi,{control:m.control,name:"values.".concat(t,".value"),render:n=>{let{field:a}=n;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{className:(0,el.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,s.jsxs)(nQ.bZ,{children:[(0,s.jsx)(e0.Z,{strokeWidth:1.5}),(0,s.jsx)(nQ.Cd,{children:"After creation, values cannot be deleted or sorted"}),(0,s.jsxs)(nQ.X,{children:[(0,s.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,s.jsx)(_.z,{asChild:!0,type:"default",icon:(0,s.jsx)(n2.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,s.jsx)(x(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(n0,{index:t,id:e.id,field:a,isDisabled:h.length<2,onRemoveValue:()=>g(t)})}),(0,s.jsx)(eR.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,s.jsx)(_.z,{type:"default",icon:(0,s.jsx)(c.Z,{strokeWidth:1.5}),onClick:()=>f({value:""}),children:"Add value"}),(0,s.jsx)(_.z,{ref:i,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})};async function n3(e){let{projectRef:t,connectionString:n,name:s,schema:a}=e,r="drop type if exists ".concat(a,'."').concat(s,'"'),{result:i}=await (0,e_.R)({projectRef:t,connectionString:n,sql:r});return i}let n5=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>n3(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nH.P.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to create enumerated type: ".concat(e.message)):t(e,n,s)},...n})};var n8=e=>{let{visible:t,selectedEnumeratedType:n,onClose:a}=e,{project:r}=(0,j.d2)(),{mutate:i,isLoading:l}=n5({onSuccess:()=>{ey.Am.success('Successfully deleted "'.concat(n.name,'"')),a()}}),o=()=>void 0===n?console.error("No enumerated type selected"):(null==r?void 0:r.ref)===void 0?console.error("Project ref required"):(null==r?void 0:r.connectionString)===void 0?console.error("Project connectionString required"):void i({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,name:n.name,schema:n.schema});return(0,s.jsxs)(e9.Z,{variant:"destructive",size:"medium",loading:l,visible:t,title:(0,s.jsxs)(s.Fragment,{children:["Confirm to delete enumerated type"," ",(0,s.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}),confirmLabel:"Confirm delete",confirmLabelLoading:"Deleting...",onCancel:a,onConfirm:()=>o(),alert:{title:"This action cannot be undone",description:"You will need to re-create the enumerated type if you want to revert the deletion."},children:[(0,s.jsx)("p",{className:"text-sm",children:"Before deleting this enumerated type, consider:"}),(0,s.jsx)("ul",{className:"space-y-2 mt-2 text-sm text-foreground-light",children:(0,s.jsx)("li",{className:"list-disc ml-6",children:"This enumerated type is no longer in use in any tables or functions"})})]})};async function n6(e){let{projectRef:t,connectionString:n,schema:s,name:a,description:r,values:i=[]}=e,l=[];a.original!==a.updated&&l.push('alter type "'.concat(s,'"."').concat(a.original,'" rename to "').concat(a.updated,'";')),i.length>0&&i.forEach((e,t)=>{if(e.isNew){if(0===t){let t=i.find(e=>!e.isNew);l.push('alter type "'.concat(s,'"."').concat(a.updated,"\" add value '").concat(e.updated,"' before '").concat(null==t?void 0:t.original,"';"))}else l.push('alter type "'.concat(s,'"."').concat(a.updated,"\" add value '").concat(e.updated,"' after '").concat(i[t-1].updated,"';"))}else e.original!==e.updated&&l.push('alter type "'.concat(s,'"."').concat(a.updated,"\" rename value '").concat(e.original,"' to '").concat(e.updated,"';"))}),void 0!==r&&l.push('comment on type "'.concat(s,'"."').concat(a.updated,"\" is '").concat(r,"';"));let o=(0,nG.J)(l.join(" ")),{result:c}=await (0,e_.R)({projectRef:t,connectionString:n,sql:o});return c}let n9=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,eC.D)(e=>n6(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nH.P.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?ey.Am.error("Failed to add value to enumerated type: ".concat(e.message)):t(e,n,s)},...n})};var n7=e=>{var t;let{visible:n,selectedEnumeratedType:a,onClose:r}=e,i=(0,p.useRef)(null),{project:l}=(0,j.d2)(),{mutate:o,isLoading:d}=n9({onSuccess:(e,t)=>{ey.Am.success('Successfully updated type "'.concat(t.name.updated,'"')),r()}}),u=eN.Ry({name:eN.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:eN.Z_().default("").optional(),values:eN.Ry({isNew:eN.O7(),originalValue:eN.Z_(),updatedValue:eN.Z_().min(1,"Please provide a value")}).array().default([])}),m=(0,eb.cI)({resolver:(0,ev.F)(u),defaultValues:{name:"",description:"",values:[{isNew:!0,originalValue:"",updatedValue:""}]}}),{fields:h,append:f,remove:g,move:v}=(0,eb.Dq)({name:"values",control:m.control}),b=e=>{e.destination&&v(e.source.index,e.destination.index)},y=(null!==(t=null==a?void 0:a.enums)&&void 0!==t?t:[]).map(e=>({isNew:!1,originalValue:e,updatedValue:e}));return(0,p.useEffect)(()=>{if(void 0!==a){var e;m.reset({name:a.name,description:null!==(e=a.comment)&&void 0!==e?e:"",values:y})}void 0==a&&m.reset({values:y})},[a]),(0,s.jsx)(ez.ZP,{loading:d,visible:n,onCancel:r,header:'Update type "'.concat(null==a?void 0:a.name,'"'),confirmText:"Update type",onConfirm:()=>{i.current&&i.current.click()},children:(0,s.jsx)(ez.ZP.Content,{className:"py-4",children:(0,s.jsx)(eR.l0,{...m,children:(0,s.jsxs)("form",{className:"space-y-4",onSubmit:m.handleSubmit(e=>{var t;if((null==l?void 0:l.ref)===void 0)return console.error("Project ref required");if((null==l?void 0:l.connectionString)===void 0)return console.error("Project connectionString required");if(void 0===a)return console.error("selectedEnumeratedType required");let n={schema:a.schema,name:{original:a.name,updated:e.name},values:e.values.filter(e=>0!==e.updatedValue.length).map(e=>({original:e.originalValue,updated:e.updatedValue.trim(),isNew:e.isNew})),...e.description!==a.comment?{description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''")}:{}};o({projectRef:l.ref,connectionString:l.connectionString,...n})}),children:[(0,s.jsx)(eR.Wi,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{children:"Name"}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(eT.I,{...t})}),(0,s.jsx)(eR.zG,{})]})}}),(0,s.jsx)(eR.Wi,{control:m.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{children:"Description"}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(eT.I,{...t})}),(0,s.jsx)(eR.pf,{children:"Optional"})]})}}),(0,s.jsx)(nX.Z5,{onDragEnd:e=>b(e),children:(0,s.jsx)(nX.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,s.jsxs)("div",{ref:e.innerRef,children:[h.map((e,t)=>(0,s.jsx)(eR.Wi,{control:m.control,name:"values.".concat(t,".updatedValue"),render:n=>{let{field:a}=n;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{className:(0,el.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,s.jsxs)(nQ.bZ,{children:[(0,s.jsx)(e0.Z,{strokeWidth:1.5}),(0,s.jsx)(nQ.Cd,{children:"Existing values cannot be deleted or sorted"}),(0,s.jsxs)(nQ.X,{children:[(0,s.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,s.jsx)(_.z,{asChild:!0,type:"default",icon:(0,s.jsx)(n2.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,s.jsx)(x(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(n0,{index:t,id:e.id,field:a,isDisabled:!e.isNew,onRemoveValue:()=>g(t)})}),(0,s.jsx)(eR.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,s.jsx)(_.z,{type:"default",icon:(0,s.jsx)(c.Z,{strokeWidth:1.5}),onClick:()=>f({isNew:!0,originalValue:"",updatedValue:""}),children:"Add value"}),(0,s.jsx)(_.z,{ref:i,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})},se=()=>{let{project:e}=(0,j.d2)(),[t,n]=(0,p.useState)(""),{selectedSchema:a,setSelectedSchema:r}=(0,es.B)(),[i,l]=(0,p.useState)(!1),[c,h]=(0,p.useState)(),[x,f]=(0,p.useState)(),{data:g}=(0,nY.Q1)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:y,error:w,isLoading:S,isError:Z,isSuccess:z}=(0,nU.k)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),T=(null!=y?y:[]).filter(e=>e.enums.length>0),A=t.length>0?T.filter(e=>e.schema===a&&e.name.toLowerCase().includes(t.toLowerCase())):T.filter(e=>e.schema===a),I=(null!=g?g:[]).filter(e=>{var t;return C.s.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),F=null==g?void 0:g.find(e=>e.name===a),L=I.some(e=>e.id===(null==F?void 0:F.id));return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[(0,s.jsx)(q.Z,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:a,onSelectSchema:r}),(0,s.jsx)(k.Z,{size:"tiny",value:t,className:"w-full lg:w-52",onChange:e=>n(e.target.value),placeholder:"Search for a type",icon:(0,s.jsx)(o.Z,{size:14})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(e1.G,{href:"https://www.postgresql.org/docs/current/datatype-enum.html"}),!L&&(0,s.jsx)(_.z,{className:"ml-auto flex-1",type:"primary",onClick:()=>l(!0),children:"Create type"})]})]}),L&&(0,s.jsx)(R.Z,{schema:a,entity:"enumerated types"}),S&&(0,s.jsx)(N.A,{}),Z&&(0,s.jsx)(b.Z,{error:w,subject:"Failed to retrieve database enumerated types"}),z&&(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{children:"Schema"},"schema"),(0,s.jsx)(v.Z.th,{children:"Name"},"name"),(0,s.jsx)(v.Z.th,{children:"Values"},"values"),(0,s.jsx)(v.Z.th,{},"actions")],body:(0,s.jsxs)(s.Fragment,{children:[0===A.length&&0===t.length&&(0,s.jsx)(v.Z.tr,{children:(0,s.jsxs)(v.Z.td,{colSpan:4,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No enumerated types created yet"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no enumerated types found in the schema "',a,'"']})]})}),0===A.length&&t.length>0&&(0,s.jsx)(v.Z.tr,{children:(0,s.jsxs)(v.Z.td,{colSpan:4,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]})}),A.length>0&&A.map(e=>(0,s.jsxs)(v.Z.tr,{children:[(0,s.jsx)(v.Z.td,{className:"w-20",children:(0,s.jsx)("p",{className:"w-20 truncate",children:e.schema})}),(0,s.jsx)(v.Z.td,{children:e.name}),(0,s.jsx)(v.Z.td,{children:e.enums.join(", ")}),(0,s.jsx)(v.Z.td,{children:!L&&(0,s.jsx)("div",{className:"flex justify-end items-center space-x-2",children:(0,s.jsxs)(E.h_,{children:[(0,s.jsx)(E.$F,{asChild:!0,children:(0,s.jsx)(_.z,{type:"default",className:"px-1",icon:(0,s.jsx)(d.Z,{})})}),(0,s.jsxs)(E.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,s.jsxs)(E.Xi,{className:"space-x-2",onClick:()=>h(e),children:[(0,s.jsx)(u.Z,{size:14}),(0,s.jsx)("p",{children:"Update type"})]}),(0,s.jsxs)(E.Xi,{className:"space-x-2",onClick:()=>f(e),children:[(0,s.jsx)(m.Z,{size:14}),(0,s.jsx)("p",{children:"Delete type"})]})]})]})})})]},e.id))]})}),(0,s.jsx)(n4,{visible:i,onClose:()=>l(!1),schema:a}),(0,s.jsx)(n7,{visible:void 0!==c,selectedEnumeratedType:c,onClose:()=>h(void 0)}),(0,s.jsx)(n8,{visible:void 0!==x,selectedEnumeratedType:x,onClose:()=>f(void 0)})]})}},405:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var s=n(97458),a=n(32691),r=n(63640),i=n(4879),l=n(31723),o=n(17164),c=n(289),d=n(76026),u=n(15631),m=n(56535),h=n(11794);let x=(e,t)=>{var n;let a=null!==(n=null==e?void 0:e.ref)&&void 0!==n?n:"default",{pgNetExtensionExists:r,pitrEnabled:i,columnLevelPrivileges:l}=t||{};return[{title:"Database Management",items:[{name:"Schema Visualizer",key:"schemas",url:"/project/".concat(a,"/database/schemas"),items:[]},{name:"Tables",key:"tables",url:"/project/".concat(a,"/database/tables"),items:[]},{name:"Functions",key:"functions",url:"/project/".concat(a,"/database/functions"),items:[]},{name:"Triggers",key:"triggers",url:"/project/".concat(a,"/database/triggers"),items:[]},{name:"Enumerated Types",key:"types",url:"/project/".concat(a,"/database/types"),items:[]},{name:"Extensions",key:"extensions",url:"/project/".concat(a,"/database/extensions"),items:[]},{name:"Indexes",key:"indexes",url:"/project/".concat(a,"/database/indexes"),items:[]},{name:"Publications",key:"publications",url:"/project/".concat(a,"/database/publications"),items:[]}]},{title:"Access Control",items:[{name:"Roles",key:"roles",url:"/project/".concat(a,"/database/roles"),items:[]},...l?[{name:"Column Privileges",key:"column-privileges",url:"/project/".concat(a,"/database/column-privileges"),items:[],label:"ALPHA"}]:[],{name:"Policies",key:"policies",url:"/project/".concat(a,"/auth/policies"),rightIcon:(0,s.jsx)(h.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]}]},{title:"Platform",items:[...m.Qy?[{name:"Backups",key:"backups",url:i?"/project/".concat(a,"/database/backups/pitr"):"/project/".concat(a,"/database/backups/scheduled"),items:[]}]:[],{name:"Migrations",key:"migrations",url:"/project/".concat(a,"/database/migrations"),items:[]},{name:"Wrappers",key:"wrappers",url:"/project/".concat(a,"/integrations?category=wrapper"),rightIcon:(0,s.jsx)(h.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]},...r?[{name:"Webhooks",key:"hooks",url:"/project/".concat(a,"/integrations/webhooks/overview"),rightIcon:(0,s.jsx)(h.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]}]:[]]},{title:"Tools",items:[{name:"Security Advisor",key:"security-advisor",url:"/project/".concat(a,"/advisors/security"),rightIcon:(0,s.jsx)(h.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]},{name:"Performance Advisor",key:"performance-advisor",url:"/project/".concat(a,"/advisors/performance"),rightIcon:(0,s.jsx)(h.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]},{name:"Query Performance",key:"query-performance",url:"/project/".concat(a,"/advisors/query-performance"),rightIcon:(0,s.jsx)(h.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]}]}]},p=()=>{let e=(0,c.Vm)(),t=(0,a.useRouter)().pathname.split("/")[4],{data:n}=(0,l.H)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:d}=(0,o.F)({projectRef:null==e?void 0:e.ref}),u=void 0!==(null!=n?n:[]).find(e=>"pg_net"===e.name),m=(null==d?void 0:d.selected_addons.find(e=>"pitr"===e.type))!==void 0,h=(0,r.ar)();return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(i.Q,{page:t,menu:x(e,{pgNetExtensionExists:u,pitrEnabled:m,columnLevelPrivileges:h})})})};var f=(0,d.Q)(e=>{let{children:t}=e;return(0,s.jsx)(u.Z,{product:"Database",productMenu:(0,s.jsx)(p,{}),isBlocking:!1,children:t})})},33838:function(e,t,n){"use strict";n.d(t,{CG:function(){return N},FW:function(){return m},I7:function(){return x},Lc:function(){return g},RN:function(){return f},Wv:function(){return b},_S:function(){return c},g$:function(){return j},gW:function(){return w},jX:function(){return h},q7:function(){return u},qw:function(){return p},s_:function(){return o},tM:function(){return v},tU:function(){return d},ur:function(){return y},y:function(){return l}});var s=n(97458),a=n(52983),r=n(41212),i=n(43633);let l="mx-auto w-full max-w-[1200px]",o="px-4 md:px-6 lg:px-14 xl:px-24 2xl:px-28",c=(0,a.forwardRef)((e,t)=>{let{className:n,bottomPadding:a,size:l="default",...c}=e,{aiAssistantPanel:d}=(0,r.WZ)(),{open:u}=d;return(0,s.jsx)("div",{ref:t,...c,className:(0,i.cn)("mx-auto w-full",{small:"max-w-[768px]",default:"max-w-[1200px]",large:"max-w-[1600px]",full:"max-w-none"}[l],o,a&&"pb-16",u?"xl:px-6":"",n)})}),d=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("header",{...a,ref:t,className:(0,i.cn)("w-full","flex-col gap-3 py-6",n)})}),u=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("h1",{ref:t,...a,className:(0,i.cn)("text-2xl",n)})}),m=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("p",{ref:t,...a,className:(0,i.cn)("text-sm text-foreground-light",n)})}),h=(0,a.forwardRef)((e,t)=>{let{className:n,isFullWidth:a,topPadding:r,...l}=e;return(0,s.jsx)("div",{ref:t,...l,className:(0,i.cn)("flex flex-col first:pt-12 py-6",a?"w-full":"gap-3 lg:grid md:grid-cols-12",n)})}),x=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,i.cn)("w-full h-px bg-border",n)})}),p=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("h3",{ref:t,...a,className:(0,i.cn)("text-foreground text-xl",n)})}),f=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("p",{ref:t,...a,className:(0,i.cn)("text-sm text-foreground-light",n)})}),j=(0,a.forwardRef)((e,t)=>{let{className:n,children:a,title:r,...l}=e;return(0,s.jsxs)("div",{ref:t,...l,className:(0,i.cn)("col-span-4 xl:col-span-5 prose text-sm",n),children:[r&&(0,s.jsx)("h2",{children:r}),a]})}),g=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,i.cn)("col-span-8 xl:col-span-7","flex flex-col gap-6",n)})}),v=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,i.cn)("flex flex-col gap-3 items-center",n)})}),b=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,i.cn)("flex w-full items-center",n)})}),y=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,i.cn)("flex flex-row gap-3",n)})}),N=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,i.cn)("flex flex-col gap-3","min-w-[420px]",n)})}),w=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,i.cn)(l,o,"my-8 flex flex-col gap-8",n)})});d.displayName="ScaffoldHeader",u.displayName="ScaffoldTitle",m.displayName="ScaffoldDescription",c.displayName="ScaffoldContainer",x.displayName="ScaffoldDivider",h.displayName="ScaffoldSection",N.displayName="ScaffoldColumn",j.displayName="ScaffoldSectionDetail",g.displayName="ScaffoldSectionContent",v.displayName="ScaffoldFilterAndContent",b.displayName="ScaffoldActionsContainer",y.displayName="ScaffoldActionsGroup",w.displayName="ScaffoldContainerLegacy",p.displayName="ScaffoldSectionTitle",f.displayName="ScaffoldSectionDescription"},71358:function(e,t,n){"use strict";var s=n(97458),a=n(50588),r=n(56535);t.Z=()=>(0,s.jsxs)("div",{className:"flex h-64 flex-col items-center justify-center",children:[(0,s.jsx)(a.Z,{src:"".concat(r.GW,"/img/no-search-results.svg"),preProcessor:e=>e.replace(/svg/,'svg className="mb-2 w-16 h-16 text-color-inherit"')}),(0,s.jsx)("p",{className:"w-64 text-center text-sm opacity-50",children:"Hmm, we couldn't find any results that match your query."})]})},81219:function(e,t,n){"use strict";n.d(t,{i:function(){return r}});var s=n(97458),a=n(53486);let r=e=>{let{form:t,hasChanges:n,handleReset:r,helper:i,disabled:l=!1,isSubmitting:o,submitText:c="Save"}=e,d=o||l||!n&&void 0!==n;return(0,s.jsxs)("div",{className:["flex w-full items-center gap-2",i?"justify-between":"justify-end"].join(" "),children:[i&&(0,s.jsx)("span",{className:"text-sm text-foreground-lighter",children:i}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.z,{disabled:d,type:"default",htmlType:"reset",onClick:()=>r(),children:"Cancel"}),(0,s.jsx)(a.z,{form:t,type:"primary",htmlType:"submit",disabled:d,loading:o,children:c})]})]})}},54542:function(e,t,n){"use strict";var s=n(97458),a=n(43633),r=n(53486);t.Z=e=>{let{searchString:t,onResetFilter:n,className:i}=e;return(0,s.jsxs)("div",{className:(0,a.cn)("bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",i),children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==n&&(0,s.jsx)(r.z,{type:"default",onClick:()=>n(),children:"Reset filter"})]})}},74172:function(e,t,n){"use strict";var s=n(97458),a=n(83145),r=n.n(a),i=n(33880),l=n(33971),o=n(53486);t.Z=e=>{let{name:t="",isActive:n,isExternal:a,icon:c,rightIcon:d,url:u="",target:m="_self",onClick:h,textClassName:x="",hoverText:p="",label:f}=e,j=(0,s.jsx)(i.ZP.Item,{icon:c,rounded:!0,active:n,onClick:h,children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,s.jsxs)("div",{title:p||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+x,children:[(0,s.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==f&&(0,s.jsx)(l.C,{variant:"warning",className:"py-0 px-1.5 capitalize",children:f})]}),d&&(0,s.jsx)("div",{children:d})]})});return u?a?(0,s.jsx)(o.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,s.jsx)(r(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,s.jsx)(r(),{href:u,className:"block",target:m,children:j}):j}},4879:function(e,t,n){"use strict";n.d(t,{Q:function(){return l}});var s=n(97458),a=n(33880),r=n(33971),i=n(74172),l=e=>{let{page:t,menu:n}=e;return(0,s.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto",children:(0,s.jsx)(a.ZP,{type:"pills",children:n.map((e,l)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"my-6 space-y-8",children:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(a.ZP.Group,{title:e.title?(0,s.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,s.jsx)("span",{children:e.title}),e.isPreview&&(0,s.jsx)(r.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,s.jsx)("div",{children:e.items.map(e=>{let n=e.pages?e.pages.includes(t):t===e.key;return(0,s.jsx)(i.Z,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:n,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key)})})]})}),l!==n.length-1&&(0,s.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},58427:function(e,t,n){"use strict";var s=n(97458),a=n(40540),r=n(26833),i=n(9738),l=n(4534),o=n(52983),c=n(32672),d=n(1447),u=n(94281),m=n(53486),h=n(95293),x=n(19405),p=n(12753),f=n(22921),j=n(12361);t.Z=e=>{let{className:t,disabled:n=!1,size:g="tiny",showError:v=!0,selectedSchemaName:b,supportSelectAll:y=!1,excludedSchemas:N=[],onSelectSchema:w,onSelectCreateSchema:S}=e,[Z,C]=(0,o.useState)(!1),_=(0,u.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"schemas"),{project:k}=(0,c.d2)(),{data:E,isLoading:z,isSuccess:R,isError:T,error:A,refetch:I}=(0,d.Q1)({projectRef:null==k?void 0:k.ref,connectionString:null==k?void 0:k.connectionString}),F=(E||[]).filter(e=>!N.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,s.jsxs)("div",{className:t,children:[z&&(0,s.jsx)(m.z,{type:"default",className:"w-full [&>span]:w-full",size:g,disabled:!0,children:(0,s.jsx)(h.O,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),v&&T&&(0,s.jsxs)(x.bZ,{variant:"warning",className:"!px-3 !py-3",children:[(0,s.jsx)(x.Cd,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,s.jsxs)(x.X,{className:"text-xs mb-2 break-words",children:["Error: ",null==A?void 0:A.message]}),(0,s.jsx)(m.z,{type:"default",size:"tiny",onClick:()=>I(),children:"Reload schemas"})]}),R&&(0,s.jsxs)(p.J2,{open:Z,onOpenChange:C,modal:!1,children:[(0,s.jsx)(p.xo,{asChild:!0,children:(0,s.jsx)(m.z,{size:g,disabled:n,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,s.jsx)(r.Z,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:b?(0,s.jsxs)("div",{className:"w-full flex gap-1",children:[(0,s.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,s.jsx)("p",{className:"text-foreground",children:"*"===b?"All schemas":b})]}):(0,s.jsx)("div",{className:"w-full flex gap-1",children:(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schema"})})})}),(0,s.jsx)(p.yk,{className:"p-0 min-w-[200px]",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,s.jsxs)(f.mY,{children:[(0,s.jsx)(f.sZ,{placeholder:"Find schema..."}),(0,s.jsxs)(f.e8,{children:[(0,s.jsx)(f.rb,{children:"No schemas found"}),(0,s.jsx)(f.fu,{children:(0,s.jsxs)(j.xr,{className:(F||[]).length>7?"h-[210px]":"",children:[y&&(0,s.jsxs)(f.di,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{w("*"),C(!1)},onClick:()=>{w("*"),C(!1)},children:[(0,s.jsx)("span",{children:"All schemas"}),"*"===b&&(0,s.jsx)(i.Z,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==F?void 0:F.map(e=>(0,s.jsxs)(f.di,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{w(e.name),C(!1)},onClick:()=>{w(e.name),C(!1)},children:[(0,s.jsx)("span",{children:e.name}),b===e.name&&(0,s.jsx)(i.Z,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==S&&_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.zz,{}),(0,s.jsx)(f.fu,{children:(0,s.jsxs)(f.di,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{S(),C(!1)},onClick:()=>{S(),C(!1)},children:[(0,s.jsx)(l.Z,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},65039:function(e,t,n){"use strict";var s=n(97458),a=n(43633);t.Z=e=>{let{max:t=100,value:n=0,barClass:r="bg-foreground",bgClass:i="",type:l="vertical",borderClass:o="",labelBottom:c="",labelBottomClass:d="tabular-nums",labelTop:u="",labelTopClass:m=""}=e;if("horizontal"===l){let e=Number(n/t*100),l=c||u;return(0,s.jsxs)("div",{className:"flex flex-col w-full",children:[l&&(0,s.jsxs)("div",{className:"flex align-baseline justify-between pb-1 space-x-8",children:[(0,s.jsx)("p",{className:(0,a.cn)("text-foreground text-sm truncate capitalize-sentence",u.length>0&&"max-w-[75%]",d),children:c}),(0,s.jsx)("p",{className:(0,a.cn)("text-foreground-light text-sm",m),children:u})]}),(0,s.jsx)("div",{className:"relative rounded h-1 overflow-hidden w-full border p-0 ".concat(i||"bg-surface-400"," ").concat(o||"border-none"),children:(0,s.jsx)("div",{className:"absolute rounded inset-x-0 bottom-0 h-1 ".concat(r," transition-all"),style:{width:"".concat(e,"%")}})})]})}{let e=Number(n/t*35);return e<2&&(e=2),(0,s.jsx)("div",{className:"relative rounded w-5 overflow-hidden border p-1 ".concat(i||"bg-gray-400"," ").concat(o||"border-none"),style:{height:35},children:(0,s.jsx)("div",{className:"absolute inset-x-0 bottom-0 w-5 ".concat(r),style:{height:e}})})}}},48560:function(e,t,n){"use strict";var s=n(97458),a=n(85229),r=n(71607),i=n.n(r),l=n(52983),o=n(32672),c=n(34069);t.Z=e=>{let{queryId:t,language:n="pgsql",defaultValue:r="",readOnly:d=!1,contextmenu:u=!0,onInputChange:m=i()}=e,h=(0,a.useMonaco)(),{project:x}=(0,o.d2)(),p=(0,l.useRef)();return(0,l.useEffect)(()=>{if(h){let e=h.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(e){let t=e.getValue(),n=(0,c._)(t);return[{range:e.getFullModelRange(),text:n}]}});return()=>{e.dispose()}}},[h]),(0,l.useEffect)(()=>{if(p.current){var e;null===(e=p.current)||void 0===e||e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})}},[t]),(0,s.jsx)(a.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:n,defaultValue:r,path:t,loading:(0,s.jsx)(()=>(0,s.jsx)("h4",{className:"text-lg",children:"Loading"}),{}),options:{readOnly:d,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,contextmenu:u},onMount:(e,t)=>{p.current=e,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})},onChange:m})}},17470:function(e,t,n){"use strict";var s=n(97458),a=n(32691),r=n(47594);t.Z=e=>{let{message:t}=e,n=(0,a.useRouter)(),{ref:i}=n.query;return(0,s.jsx)(r.Z,{title:"No public tables found",ctaButtonLabel:"Create a new table",onClickCta:()=>{n.push("/project/".concat(i,"/editor"))},children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:t})})}},88256:function(e,t,n){"use strict";var s=n(97458),a=n(40540),r=n(83145),i=n.n(r),l=n(5359),o=n(94281),c=n(9881),d=n(289),u=n(30114),m=n(43633),h=n(53486),x=n(2861);t.Z=e=>{var t,n,r;let{icon:p,primaryText:f,secondaryText:j,addon:g,buttonText:v,source:b="upgrade",disabled:y=!1}=e,N=(0,d.Vm)(),w=(0,c.l)(),{data:S}=(0,l.Gl)({orgSlug:null==w?void 0:w.slug}),Z=null==S?void 0:null===(t=S.plan)||void 0===t?void 0:t.id,C=(0,o.Xo)(a.KA.BILLING_WRITE,"stripe.subscriptions"),_=(0,u.P)("disableProjectCreationAndUpdate");return(0,s.jsx)("div",{className:(0,m.cn)("block w-full rounded border border-opacity-20 py-4 px-6","border-overlay bg-surface-200"),children:(0,s.jsxs)("div",{className:"flex gap-x-3",children:[p&&(0,s.jsx)("div",{className:"mt-1",children:p}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row w-full md:items-center justify-between gap-4 md:gap-x-8 xl:gap-x-32",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm",children:f}),(0,s.jsx)("div",{children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:j})})]}),!C||_?(0,s.jsx)(x.u,{disabled:!0,type:"primary",tooltip:{content:{side:"bottom",text:_?"Subscription changes are currently disabled, our engineers are working on a fix":C?void 0:"You need additional permissions to amend subscriptions"}},children:"Reset database password"}):(0,s.jsx)(h.z,{asChild:!0,type:"primary",disabled:!C||_||y,children:(0,s.jsx)(i(),{href:"free"===Z?"/org/".concat(null!==(n=null==w?void 0:w.slug)&&void 0!==n?n:"_","/billing?panel=subscriptionPlan&source=").concat(b):"/project/".concat(null!==(r=null==N?void 0:N.ref)&&void 0!==r?r:"_","/settings/addons?panel=").concat(g,"&source=").concat(b),children:v||("free"===Z?"Upgrade to Pro":"Enable add on")})})]})]})})}},24605:function(e,t,n){"use strict";n.d(t,{k:function(){return d}});var s=n(36457),a=n(64618),r=n(34549),i=n(129),l=n(70864),o=n(39310);async function c(e){let{projectRef:t,connectionString:n,schema:s,name:a,version:r,cascade:o=!1,createSchema:c=!1}=e,d=new Headers;if(n&&d.set("x-connection-encrypted",n),c)try{await (0,l.R)({projectRef:t,connectionString:n,sql:"create schema if not exists ".concat(s)})}catch(e){throw e}let{data:u,error:m}=await (0,i.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{schema:s,name:a,version:r,cascade:o},headers:d});return m&&(0,i.S3)(m),u}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,s.NL)();return(0,a.D)(e=>c(e),{async onSuccess(t,n,s){let{projectRef:a}=n;await i.invalidateQueries(o.o.list(a)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,n,s)},...n})}},31723:function(e,t,n){"use strict";n.d(t,{H:function(){return c}});var s=n(28894),a=n(129),r=n(39310),i=n(289),l=n(56535);async function o(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:i,error:l}=await (0,a.U2)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:r,signal:t});return l&&(0,a.S3)(l),i}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=(0,i.Vm)(),u=(null==d?void 0:d.status)===l.S.ACTIVE_HEALTHY;return(0,s.a)(r.o.list(t),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t&&u,...c})}},77546:function(e,t,n){"use strict";n.d(t,{R:function(){return c}});var s=n(4330),a=n(28894),r=n(63609),i=n(70864);let l=s.Z.functions.list();async function o(e,t,n){let{projectRef:s,connectionString:a}=e,r=new Headers(n),{result:o}=await (0,i.R)({projectRef:s,connectionString:a,sql:l.sql,queryKey:["database-functions"]},t,r);return o}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(r.A.databaseFunctions(t),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n},s)},{enabled:s&&void 0!==t,...i})}},72356:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var s=n(28894),a=n(129),r=n(69080);async function i(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:i,error:l}=await (0,a.U2)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:r,signal:t});return l&&(0,a.S3)(l),i}let l=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.z.list(t),e=>{let{signal:s}=e;return i({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t,...l})}},58901:function(e,t,n){"use strict";n.d(t,{u:function(){return c}});var s=n(36457),a=n(64618),r=n(34549),i=n(129),l=n(69080);async function o(e){let{projectRef:t,connectionString:n,id:s,tables:a,publish_insert:r,publish_update:l,publish_delete:o,publish_truncate:c}=e,d=new Headers;n&&d.set("x-connection-encrypted",n);let u={id:s};void 0!==a&&(u.tables=a),void 0!==r&&(u.publish_insert=r),void 0!==l&&(u.publish_update=l),void 0!==o&&(u.publish_delete=o),void 0!==c&&(u.publish_truncate=c);let{data:m,error:h}=await (0,i.r$)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:s}},body:u,headers:d});return h&&(0,i.S3)(h),m}let c=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,s.NL)();return(0,a.D)(e=>o(e),{async onSuccess(t,n,s){let{projectRef:a}=n;await i.invalidateQueries(l.z.list(a)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to update database publication: ".concat(e.message)):t(e,n,s)},...n})}},69080:function(e,t,n){"use strict";n.d(t,{z:function(){return s}});let s={list:e=>["projects",e,"database-publications"]}},80070:function(e,t,n){"use strict";n.d(t,{fA:function(){return d},x4:function(){return c}});var s=n(4330),a=n(28894),r=n(70864),i=n(99345);let l=s.Z.roles.list();async function o(e,t){let{projectRef:n,connectionString:s}=e,{result:a}=await (0,r.R)({projectRef:n,connectionString:s,sql:l.sql,queryKey:["database-roles"]},t);return a}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(i.E.databaseRoles(t),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n},s)},{enabled:s&&void 0!==t,...r})};function d(e,t){return e.invalidateQueries(i.E.databaseRoles(t))}},97065:function(e,t,n){"use strict";n.d(t,{x:function(){return c}});var s=n(36457),a=n(64618),r=n(34549),i=n(129),l=n(86710);async function o(e){let{projectRef:t,connectionString:n,payload:s}=e,a=new Headers;n&&a.set("x-connection-encrypted",n);let{data:r,error:l}=await (0,i.v_)("/platform/pg-meta/{ref}/triggers",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:s,headers:a});return l&&(0,i.S3)(l),r}let c=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,s.NL)();return(0,a.D)(e=>o(e),{async onSuccess(t,n,s){let{projectRef:a}=n;await i.invalidateQueries(l.D.list(a)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to create database trigger: ".concat(e.message)):t(e,n,s)},...n})}},16556:function(e,t,n){"use strict";n.d(t,{m:function(){return c}});var s=n(36457),a=n(64618),r=n(34549),i=n(129),l=n(86710);async function o(e){let{id:t,projectRef:n,connectionString:s}=e,a=new Headers;s&&a.set("x-connection-encrypted",s);let{data:r,error:l}=await (0,i.IV)("/platform/pg-meta/{ref}/triggers",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{id:t}},headers:a});return l&&(0,i.S3)(l),r}let c=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,s.NL)();return(0,a.D)(e=>o(e),{async onSuccess(t,n,s){let{projectRef:a}=n;await i.invalidateQueries(l.D.list(a)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to delete database trigger: ".concat(e.message)):t(e,n,s)},...n})}},46825:function(e,t,n){"use strict";n.d(t,{T:function(){return o}});var s=n(28894),a=n(129),r=n(289),i=n(63609);async function l(e,t){let{projectRef:n}=e;if(!n)throw Error("Project ref is required");let{data:s,error:r}=await (0,a.U2)("/platform/database/{ref}/backups",{params:{path:{ref:n}},signal:t});return r&&(0,a.S3)(r),s}let o=function(e){let{projectRef:t}=e,{enabled:n=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(0,r.Qv)();return(0,s.a)(i.A.backups(t),e=>{let{signal:n}=e;return l({projectRef:t},n)},{enabled:n&&!1===o&&void 0!==t,...a})}},65024:function(e,t,n){"use strict";n.d(t,{E3:function(){return o}});var s=n(28894),a=n(70864),r=n(63609);let i=()=>"show max_connections";async function l(e,t){let{projectRef:n,connectionString:s}=e,r=i(),{result:l}=await (0,a.R)({projectRef:n,connectionString:s,sql:r,queryKey:["max-connections"]},t);return{maxConnections:parseInt(l[0].max_connections)}}let o=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.A.maxConnections(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t,...i})}},41111:function(e,t,n){"use strict";n.d(t,{k:function(){return l}});var s=n(28894),a=n(129),r=n(50259);async function i(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:i,error:l}=await (0,a.U2)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:Object.fromEntries(r),signal:t});return l&&(0,a.S3)(l),i}let l=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.P.list(t),e=>{let{signal:s}=e;return i({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t,...l})}},29633:function(e,t,n){"use strict";n.d(t,{T:function(){return s}});let s={list:e=>["projects",e,"foreignTables"],listBySchema:(e,t)=>[...s.list(e),t]}},92131:function(e,t,n){"use strict";function s(e){return"\n    begin;\n\n    ".concat(e,"\n    \n    commit;\n  ")}n.d(t,{J:function(){return s}})},40288:function(e,t,n){"use strict";n.d(t,{N:function(){return s}});let s={list:e=>["projects",e,"views"],listBySchema:(e,t)=>[...s.list(e),t]}},50998:function(e,t,n){"use strict";n.d(t,{B:function(){return o}});var s=n(62213),a=n(52983),r=n(73512),i=n(56535);let l=e=>(0,s.v1)("schema",s.Oi.withDefault(e)),o=()=>{let{ref:e}=(0,r.UO)(),t=e&&e.length>0&&window.localStorage.getItem(i.dA.LAST_SELECTED_SCHEMA(e))||"public",[n,s]=l((0,a.useMemo)(()=>t,[e]));return(0,a.useEffect)(()=>{e&&e.length>0&&window.localStorage.setItem(i.dA.LAST_SELECTED_SCHEMA(e),n)},[n,e]),{selectedSchema:n,setSelectedSchema:s}}},57711:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(74234).Z)("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]])},24958:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var s=n(97458),a=n(52983),r=n(40392),i=n(92334),l=n(75675);let o=(0,a.createContext)({parentCallback:e=>{},parentSize:""});function c(e){let{className:t,id:n="",name:a="",label:r,afterLabel:c,beforeLabel:d,description:u,checked:m,value:h,onChange:x,onBlur:p,size:f="medium",disabled:j=!1,...g}=e,{formContextOnChange:v,values:b,handleBlur:y}=(0,l.G)(),N=(0,i.Z)("checkbox");return(0,s.jsx)(o.Consumer,{children:e=>{let{parentCallback:i,parentSize:l}=e,o=n||a||(r?r.toLowerCase().replace(/^[^A-Z0-9]+/gi,"").replace(/ /g,"-"):void 0);f=l||f;let w=a||o,S=null!=m?m:void 0,Z=[N.container];return t&&Z.push(t),b&&void 0===m&&(S=b[n||a]),(0,s.jsxs)("div",{className:Z.join(" "),children:[(0,s.jsx)("input",{id:o,name:w,type:"checkbox",className:[N.base,N.size[f]].join(" "),onChange:function(e){i&&i(e),x&&x(e),v&&v(e)},onBlur:function(e){y&&setTimeout(()=>{y(e)},100),p&&p(e)},checked:S,value:h||o,disabled:j,...g}),(0,s.jsxs)("label",{className:[N.label.base,N.label[f]].join(" "),htmlFor:o,children:[(0,s.jsxs)("span",{children:[d&&(0,s.jsx)("span",{className:[N.label_before.base,N.label_before[f]].join(" "),children:d}),r,c&&(0,s.jsx)("span",{className:[N.label_after.base,N.label_after[f]].join(" "),children:c})]}),u&&(0,s.jsx)("p",{className:[N.description.base,N.description[f]].join(" "),children:u})]})]})}})}c.Group=function(e){let{id:t,layout:n="vertical",error:a,descriptionText:l,label:d,afterLabel:u,beforeLabel:m,labelOptional:h,children:x,className:p,options:f,onChange:j,size:g="medium"}=e,v=(0,i.Z)("checkbox");return(0,s.jsx)(r.l,{label:d,afterLabel:u,beforeLabel:m,labelOptional:h,layout:n,id:t,error:a,descriptionText:l,className:p,size:g,children:(0,s.jsx)(o.Provider,{value:{parentCallback:e=>{j&&j(e)},parentSize:g},children:(0,s.jsx)("div",{className:v.group,children:f?f.map(e=>(0,s.jsx)(c,{id:e.id,value:e.value,label:e.label,beforeLabel:e.beforeLabel,afterLabel:e.afterLabel,checked:e.checked,name:e.name,description:e.description,defaultChecked:e.defaultChecked},e.id)):x})})})};var d=c},75856:function(e,t,n){"use strict";var s=n(97458),a=n(99517);n(52983);var r=n(92334);let i=e=>{let{open:t,children:n,className:r,...i}=e;return(0,s.jsx)(a.fC,{asChild:i.asChild,defaultOpen:i.defaultOpen,open:t,onOpenChange:i.onOpenChange,disabled:i.disabled,className:r,children:n})};i.Trigger=function(e){let{children:t,asChild:n}=e;return(0,s.jsx)(a.xz,{asChild:n,children:t})},i.Content=function(e){let{asChild:t,children:n,className:i}=e,l=(0,r.Z)("collapsible");return(0,s.jsx)(a.VY,{asChild:t,className:[l.content,i].join(" "),children:n})},t.ZP=i},59599:function(e,t,n){"use strict";n.d(t,{Z:function(){return j}});var s=n(97458),a=n(44809),r=n(62923),i=n.n(r),l=n(52983),o=n(40392),c=n(5625),d=n(47196),u=n(92334),m=n(43633),h=n(75675);let x=(0,l.createContext)({onChange:e=>{},selected:void 0});var p=n(9738);function f(e){let{children:t,className:n,buttonClassName:r,descriptionText:p,error:f,icon:j,id:g="",name:v="",label:b,labelOptional:y,layout:N,value:w,onChange:S,onFocus:Z,onBlur:C,style:_,size:k="medium",defaultValue:E,validation:z,disabled:R,optionsWidth:T}=e,[A,I]=(0,l.useState)(void 0),[F,L]=(0,l.useState)({}),D=(0,u.Z)("listbox"),P=(0,l.useRef)(null),{formContextOnChange:W,values:O,errors:q,handleBlur:B,touched:V,fieldLevelValidation:M}=(0,h.G)();O&&!w&&(w=O[g||v],E=O[g||v]),f||(q&&!f&&(f=q[g||v]),f=V&&V[g||v]?f:void 0),(0,l.useEffect)(()=>{void 0!==w&&I(w)},[w]),(0,l.useEffect)(()=>{function e(){var e;document.documentElement.style.setProperty("--width-listbox","".concat(T||(null===(e=P.current)||void 0===e?void 0:e.offsetWidth),"px"))}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,l.useEffect)(()=>{var e;let n=i()(t);function s(e){return n.find(t=>t.props.value===e)}if(w){I(w);let e=s(w);L((null==e?void 0:e.props)?e.props:void 0);return}if(A){let e=s(A);L((null==e?void 0:e.props)?e.props:void 0);return}if(E){I(E);let e=s(A);L((null==e?void 0:e.props)?e.props:void 0);return}L(null===(e=n[0])||void 0===e?void 0:e.props)},[A]);let Y=[D.container,D.base,r],U=[D.addOnBefore];return f&&Y.push(D.variants.error),f||Y.push(D.variants.standard),j&&U.push(D.with_icon),k&&Y.push(D.size[k]),R&&Y.push(D.disabled),(0,s.jsx)(o.l,{label:b,labelOptional:y,layout:N,id:g,error:f,descriptionText:p,className:n,style:_,size:k,children:(0,s.jsxs)(a.fC,{children:[(0,s.jsx)(a.xz,{asChild:!0,disabled:R,children:(0,s.jsxs)("button",{"data-size":k,ref:P,className:(0,m.cn)(Y),onBlur:function(e){B&&B(e),C&&C(e)},onFocus:Z,name:v,id:g,children:[(0,s.jsxs)("span",{className:(0,m.cn)(U),children:[j&&(0,s.jsx)(d.Z,{size:k,icon:j}),(null==F?void 0:F.addOnBefore)&&(0,s.jsx)(F.addOnBefore,{}),(0,s.jsx)("span",{className:D.label,children:null==F?void 0:F.label})]}),(0,s.jsx)("span",{className:D.chevron_container,children:(0,s.jsx)("svg",{className:D.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})}),f&&(0,s.jsx)("div",{className:D.actions_container,children:f&&(0,s.jsx)(c.Z,{size:k})})]})}),(0,s.jsx)(a.VY,{sideOffset:6,loop:!0,side:"bottom",align:"center",className:D.options_container,children:(0,s.jsx)("div",{children:(0,s.jsx)(x.Provider,{value:{onChange:function(e){S&&S(e),I(e);let t={};t.target={type:"select",name:v,id:g,value:e,checked:void 0},W&&W(t),z&&M(g,z(e))},selected:A},children:t})})})]})})}f.Option=function(e){let{id:t,value:n,label:r,disabled:i=!1,children:l,className:o="",addOnBefore:c}=e,d=(0,u.Z)("listbox");return(0,s.jsx)(x.Consumer,{children:e=>{let{onChange:r,selected:u}=e,h=u===n;return(0,s.jsxs)(a.ck,{className:(0,m.cn)(d.option,h?d.option_active:" ",i?d.option_disabled:" ",o),onSelect:()=>i?{}:r(n),children:[(0,s.jsxs)("div",{className:d.option_inner,children:[c&&c({active:h,selected:u}),(0,s.jsx)("span",{children:"function"==typeof l?l({active:h,selected:u}):l})]}),h?(0,s.jsx)("span",{className:(0,m.cn)(d.option_check,h?d.option_check_active:""),children:(0,s.jsx)(p.Z,{className:d.option_check_icon,"aria-hidden":"true"})}):null]},t)}})};var j=f},33880:function(e,t,n){"use strict";n.d(t,{ZP:function(){return m}});var s=n(97458),a=n(52983),r=n(92334),i=n(43633);function l(e){let{children:t,className:n,tag:a="div",style:r}=e;return(0,s.jsx)("".concat(a),{style:r,children:t})}l.Title=function(e){let{className:t,level:n=1,children:a,style:r}=e;return(0,s.jsx)("h".concat(n),{style:r,children:a})},l.Text=function(e){let{className:t,children:n,style:a,type:r,disabled:i,mark:l,code:o,keyboard:c,underline:d,strikethrough:u,strong:m,small:h}=e;return o?(0,s.jsx)("code",{style:a,children:n}):l?(0,s.jsx)("mark",{style:a,children:n}):c?(0,s.jsx)("kbd",{style:a,children:n}):m?(0,s.jsx)("strong",{style:a,children:n}):(0,s.jsx)("span",{style:a,children:n})},l.Link=function(e){let{children:t,target:n="_blank",href:a,className:r,onClick:i,style:l}=e;return(0,s.jsx)("a",{onClick:i,href:a,target:n,rel:"noopener noreferrer",style:l,children:t})};let o=(0,a.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,s.jsx)(o.Provider,{value:{type:t},children:e.children})},d=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:n,ulClassName:a,style:r,type:i="text"}=e;return(0,s.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:n,style:r,children:(0,s.jsx)(c,{type:i,children:(0,s.jsx)("ul",{className:a,children:t})})})}u.Item=function(e){let{children:t,icon:n,active:a,rounded:l,onClick:o,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:m}=e,h=(0,r.Z)("menu"),{type:x}=d(),p=[h.item.base];p.push(h.item.variants[x].base),a?p.push(h.item.variants[x].active):p.push(h.item.variants[x].normal);let f=[h.item.content.base];a?f.push(h.item.content.active):f.push(h.item.content.normal);let j=[h.item.icon.base];return a?j.push(h.item.icon.active):j.push(h.item.icon.normal),(0,s.jsxs)("li",{role:"menuitem",className:(0,i.cn)("outline-none",p),style:m,onClick:o,"aria-current":a?"page":void 0,children:[n&&(0,s.jsx)("div",{className:"".concat(j.join(" ")," min-w-fit"),children:n}),(0,s.jsx)("span",{className:f.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:n,title:a}=e,i=(0,r.Z)("menu"),{type:l}=d();return(0,s.jsxs)("div",{className:[i.group.base,i.group.variants[l]].join(" "),children:[n&&(0,s.jsx)("span",{className:i.group.icon,children:n}),(0,s.jsx)("span",{className:i.group.content,children:a}),t]})},u.Misc=function(e){let{children:t}=e;return(0,s.jsx)("div",{children:(0,s.jsx)(l.Text,{children:(0,s.jsx)("span",{children:t})})})};var m=u},3597:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var s=n(97458),a=n(52983),r=n(40392),i=n(92334),l=n(75675);let o=(0,a.createContext)({parentCallback:e=>{},type:"",name:"",activeId:"",parentSize:""});function c(e){let{id:t=("00000"+(46656*Math.random()|0).toString(36)).slice(-3)+("00000"+(46656*Math.random()|0).toString(36)).slice(-3),disabled:n,value:a,label:r,afterLabel:c,beforeLabel:d,description:u,name:m,checked:h,className:x,onChange:p,onBlur:f,hidden:j=!1,size:g="medium",align:v="vertical",optionalLabel:b,addOnBefore:y,children:N}=e,w=(0,i.Z)("radio"),{handleBlur:S}=(0,l.G)();function Z(e){S&&S(e),f&&f(e)}return(0,s.jsx)(o.Consumer,{children:e=>{let{parentCallback:i,type:l,name:o,activeId:f,parentSize:S}=e;g=S||g;let C=f===t||!!h||!1!==h&&void 0,_=[x,w.variants[l].container.base,"list"===l&&!j&&w.variants[l].container.size[g]];return _.push(w.variants[l].base),_.push(w.variants[l].size[g]),C?_.push(w.variants[l].active):_.push(w.variants[l].inactive),n&&_.push(w.disabled),"list"!==l&&(j=!0),(0,s.jsxs)("label",{htmlFor:t,className:_.join(" "),children:[(0,s.jsx)("input",{id:t,name:o||m,type:"radio",className:[w.base,w.size[g],j&&w.hidden,w.variants[l].radio_offset,""].join(" "),checked:C,disabled:n,value:a||t,onChange:e=>{i&&i(e),p&&p(e)},onBlur:Z}),y,N||(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:[w.label.base,w.label[g],w.variants[l].container.align[v]].join(" "),children:[d&&(0,s.jsx)("div",{className:[w.label_before.base,w.label_before[g]].join(" "),children:d}),(0,s.jsx)("div",{children:r}),c&&(0,s.jsx)("div",{className:[w.label_after.base,w.label_after[g]].join(" "),children:c}),u&&(0,s.jsx)("div",{className:[w.description.base,w.description[g]].join(" "),children:u})]}),b&&(0,s.jsx)("div",{className:[w.optionalLabel.base,w.optionalLabel[g]].join(" "),children:b})]})]})}})}c.Group=function(e){let{id:t,layout:n,error:d,descriptionText:u,label:m,afterLabel:h,beforeLabel:x,labelOptional:p,children:f,className:j,type:g="list",options:v,value:b,name:y,onChange:N,size:w="medium",validation:S,groupClassName:Z,labelsLayout:C="vertical"}=e,[_,k]=(0,a.useState)(""),E=(0,i.Z)("radio"),{formContextOnChange:z,values:R,errors:T,touched:A,fieldLevelValidation:I}=(0,l.G)();return R&&!b&&(b=R[t||y]),d||(T&&!d&&(d=T[t||y]),d=A&&A[t||y]?d:void 0),(0,a.useEffect)(()=>{S&&I(t,S(b))},[]),(0,a.useEffect)(()=>{k(b)},[b]),(0,s.jsx)("fieldset",{name:y,className:j,children:(0,s.jsx)(r.l,{nonBoxInput:!0,label:m,afterLabel:h,beforeLabel:x,labelOptional:p,layout:n,id:t,error:d,descriptionText:u,size:w,labelLayout:C,children:(0,s.jsx)("div",{className:Z||E.variants[g].group,children:(0,s.jsx)(o.Provider,{value:{parentCallback:function(e){N&&N(e),z&&z(e),S&&I(t,S(e.target.value)),k(e.target.id)},type:g,name:y,activeId:_,parentSize:w},children:v?v.map(e=>(0,s.jsx)(c,{id:e.id,label:e.label,beforeLabel:e.beforeLabel,afterLabel:e.afterLabel,value:e.value,description:e.description})):f})})})})};var d=c}}]);