(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9395],{80384:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/triggers",function(){return s(95045)}])},55527:function(e,t,s){"use strict";s.d(t,{p:function(){return r}});var a=s(97458),n=s(43633),i=s(27477);let r=e=>{let{title:t,description:s,docsUrl:r,actions:l,className:c}=e;return(0,a.jsxs)("div",{className:(0,n.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(c)),children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),s&&(0,a.jsx)("div",{className:"prose text-sm max-w-full",children:s})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==r&&(0,a.jsx)(i.G,{href:r}),l]})]})}},37315:function(e,t,s){"use strict";var a=s(97458),n=s(19369);t.Z=e=>{let{resourceText:t,isFullPage:s=!1}=e,i=()=>(0,a.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(n.Z,{size:20})}),(0,a.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)("div",{className:"w-[550px]",children:(0,a.jsx)(i,{})})}):(0,a.jsx)(i,{})}},2991:function(e,t,s){"use strict";s.d(t,{R_:function(){return l},rD:function(){return c}});var a=s(28894),n=s(129),i=s(86710);async function r(e,t){let{projectRef:s,connectionString:a}=e;if(!s)throw Error("projectRef is required");let i=new Headers;a&&i.set("x-connection-encrypted",a);let{data:r,error:l}=await (0,n.U2)("/platform/pg-meta/{ref}/triggers",{params:{header:{"x-connection-encrypted":a},path:{ref:s},query:void 0},headers:i,signal:t});return l&&(0,n.S3)(l),r}let l=function(e){let{projectRef:t,connectionString:s}=e,{enabled:n=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(i.D.list(t),e=>{let{signal:a}=e;return r({projectRef:t,connectionString:s},a)},{select:e=>e.filter(e=>"supabase_functions"===e.function_schema&&("net"!==e.schema||0===e.function_args.length)),enabled:n&&void 0!==t,...l})},c=function(e){let{projectRef:t,connectionString:s}=e,{enabled:n=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(i.D.list(t),e=>{let{signal:a}=e;return r({projectRef:t,connectionString:s},a)},{enabled:n&&void 0!==t,...l})}},95045:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ee}});var a=s(97458),n=s(40540),i=s(52983),r=s(21823),l=s(71607),c=s.n(l),o=s(50663),d=s.n(o),u=s(16696),h=s(32672),x=s(11108),g=()=>(0,a.jsx)(x.b,{title:"Alpha preview",withIcon:!0,variant:"warning",children:"This is not suitable for production"}),m=s(47594),f=s(2052),p=s(84261),j=s(2861),v=s(58427),b=s(61115),N=s(2991),w=s(1447),Z=s(94281),y=s(50998),k=s(61958),C=s(41212),S=s(60661),_=s(8294),E=s(73692),T=s(42876),A=s.n(T),R=s(71635),z=s.n(R),L=s(9738),D=s(11321),F=s(84053),I=s(35323),V=s(48631),W=s(26597),O=s(50322),X=s(53486),P=s(33971),U=s(15011);let M=e=>{let t=e.events.join(" OR "),s=e.function_args.length>0?"(".concat(e.function_args.join(", "),")"):"()",a='\nDROP TRIGGER IF EXISTS "'.concat(e.name,'" ON "').concat(e.schema,'"."').concat(e.table,'";\n\nCREATE TRIGGER "').concat(e.name,'"\n').concat(e.activation," ").concat(t,'\nON "').concat(e.schema,'"."').concat(e.table,'"\nFOR EACH ').concat(e.orientation,"\n");return e.condition&&(a+="WHEN (".concat(e.condition,")\n")),(a+='EXECUTE FUNCTION "'.concat(e.function_schema,'"."').concat(e.function_name,'"').concat(s,";")).trim()};var B=e=>{let{schema:t,filterString:s,isLocked:i,editTrigger:r,deleteTrigger:l}=e,{project:c}=(0,h.d2)(),{setAiAssistantPanel:o}=(0,C.WZ)(),{data:d}=(0,N.rD)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),u=(null!=d?d:[]).filter(e=>A()(e.name.toLowerCase(),s.toLowerCase())),x=z()(u.filter(e=>e.schema==t),e=>e.name.toLocaleLowerCase()),g=(0,Z.Xo)(n.KA.TENANT_SQL_ADMIN_WRITE,"triggers");return 0===x.length&&0===s.length?(0,a.jsx)(f.Z.tr,{children:(0,a.jsxs)(f.Z.td,{colSpan:7,children:[(0,a.jsx)("p",{className:"text-sm text-foreground",children:"No triggers created yet"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no triggers found in the schema "',t,'"']})]})},t):0===x.length&&s.length>0?(0,a.jsx)(f.Z.tr,{children:(0,a.jsxs)(f.Z.td,{colSpan:7,children:[(0,a.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',s,'" did not return any results']})]})},t):(0,a.jsx)(a.Fragment,{children:x.map(e=>(0,a.jsxs)(f.Z.tr,{children:[(0,a.jsx)(f.Z.td,{className:"space-x-2",children:(0,a.jsxs)(O.u,{children:[(0,a.jsx)(O.aJ,{className:"cursor-default truncate max-w-48 inline-block",children:(0,a.jsx)(X.z,{type:"text",className:"text-foreground p-0 hover:bg-transparent",onClick:()=>r(e),children:e.name})}),(0,a.jsx)(O._v,{side:"bottom",align:"center",children:e.name})]})}),(0,a.jsx)(f.Z.td,{className:"break-all",children:(0,a.jsx)("p",{title:e.table,className:"truncate",children:e.table})}),(0,a.jsx)(f.Z.td,{className:"space-x-2",children:(0,a.jsx)("p",{title:e.function_name,className:"truncate",children:e.function_name})}),(0,a.jsx)(f.Z.td,{children:(0,a.jsx)("div",{className:"flex gap-2 flex-wrap",children:e.events.map(t=>(0,a.jsx)(P.C,{children:"".concat(e.activation," ").concat(t)},t))})}),(0,a.jsx)(f.Z.td,{className:"space-x-2",children:(0,a.jsx)("p",{title:e.orientation,className:"truncate",children:e.orientation})}),(0,a.jsx)(f.Z.td,{children:(0,a.jsx)("div",{className:"flex items-center justify-center",children:"DISABLED"!==e.enabled_mode?(0,a.jsx)(L.Z,{strokeWidth:2,className:"text-brand"}):(0,a.jsx)(D.Z,{strokeWidth:2})})}),(0,a.jsx)(f.Z.td,{className:"text-right",children:!i&&(0,a.jsx)("div",{className:"flex items-center justify-end",children:g?(0,a.jsxs)(U.h_,{children:[(0,a.jsx)(U.$F,{asChild:!0,children:(0,a.jsx)(X.z,{type:"default",className:"px-1",icon:(0,a.jsx)(F.Z,{})})}),(0,a.jsxs)(U.AW,{side:"bottom",align:"end",className:"w-52",children:[(0,a.jsxs)(U.Xi,{className:"space-x-2",onClick:()=>{M(e),r(e)},children:[(0,a.jsx)(I.Z,{size:14}),(0,a.jsx)("p",{children:"Edit trigger"})]}),(0,a.jsxs)(U.Xi,{className:"space-x-2",onClick:()=>{let t=M(e);o({open:!0,initialInput:"Update this trigger which exists on the ".concat(e.schema,".").concat(e.table," table to..."),suggestions:{title:"I can help you make a change to this trigger, here are a few example prompts to get you started:",prompts:["Rename this trigger to ...","Change the events this trigger responds to ...","Modify this trigger to run after instead of before ..."]},sqlSnippets:[t]})},children:[(0,a.jsx)(V.Z,{size:14}),(0,a.jsx)("p",{children:"Edit with Assistant"})]}),(0,a.jsxs)(U.Xi,{className:"space-x-2",onClick:()=>l(e),children:[(0,a.jsx)(W.Z,{stroke:"red",size:14}),(0,a.jsx)("p",{children:"Delete trigger"})]})]})]}):(0,a.jsx)(j.u,{disabled:!0,type:"default",className:"px-1",icon:(0,a.jsx)(F.Z,{}),tooltip:{content:{side:"bottom",text:"You need additional permissions to update triggers"}}})})})]},e.id))})},G=e=>{let{createTrigger:t=c(),editTrigger:s=c(),deleteTrigger:r=c()}=e,{project:l}=(0,h.d2)(),{setAiAssistantPanel:o}=(0,C.WZ)(),{selectedSchema:x,setSelectedSchema:T}=(0,y.B)(),[A,R]=(0,i.useState)(""),{data:z}=(0,w.Q1)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),[L]=d()(null!=z?z:[],e=>{var t;return k.s.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),D=null==z?void 0:z.find(e=>e.name===x),F=L.some(e=>e.id===(null==D?void 0:D.id)),{data:I,error:V,isLoading:W,isError:O}=(0,N.rD)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),X=(0,Z.Xo)(n.KA.TENANT_SQL_ADMIN_WRITE,"triggers");return W?(0,a.jsx)(b.A,{}):O?(0,a.jsx)(p.Z,{error:V,subject:"Failed to retrieve database triggers"}):(0,a.jsx)(a.Fragment,{children:0===(null!=I?I:[]).length?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsxs)(m.Z,{title:"Triggers",ctaButtonLabel:"Create a new trigger",onClickCta:()=>t(),children:[(0,a.jsx)(g,{}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"A PostgreSQL trigger is a function invoked automatically whenever an event associated with a table occurs."}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"An event could be any of the following: INSERT, UPDATE, DELETE. A trigger is a special user-defined function associated with a table."})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[(0,a.jsx)(v.Z,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:x,onSelectSchema:T}),(0,a.jsx)(S.Z,{placeholder:"Search for a trigger",size:"tiny",icon:(0,a.jsx)(u.Z,{size:"14"}),value:A,className:"w-full lg:w-52",onChange:e=>R(e.target.value)})]}),!F&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(j.u,{disabled:!X,onClick:()=>t(),className:"flex-grow",tooltip:{content:{side:"bottom",text:X?void 0:"You need additional permissions to create triggers"}},children:"Create a new trigger"}),(0,a.jsx)(j.u,{type:"default",disabled:!X,className:"px-1 pointer-events-auto",icon:(0,a.jsx)(_.c,{size:16}),onClick:()=>o({open:!0,initialInput:"Create a new trigger for the schema ".concat(x," that does ..."),suggestions:{title:"I can help you create a new trigger, here are a few example prompts to get you started:",prompts:["Create a trigger that logs changes to the users table","Create a trigger that updates updated_at timestamp","Create a trigger that validates email format before insert"]}}),tooltip:{content:{side:"bottom",text:X?"Create with Supabase Assistant":"You need additional permissions to create triggers"}}})]})]}),F&&(0,a.jsx)(E.Z,{schema:x,entity:"triggers"}),(0,a.jsx)("div",{className:"w-full overflow-hidden overflow-x-auto",children:(0,a.jsx)(f.Z,{head:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Z.th,{children:"Name"},"name"),(0,a.jsx)(f.Z.th,{children:"Table"},"table"),(0,a.jsx)(f.Z.th,{children:"Function"},"function"),(0,a.jsx)(f.Z.th,{children:"Events"},"events"),(0,a.jsx)(f.Z.th,{children:"Orientation"},"orientation"),(0,a.jsx)(f.Z.th,{className:"w-20",children:"Enabled"},"enabled"),(0,a.jsx)(f.Z.th,{className:"w-1/12"},"buttons")]}),body:(0,a.jsx)(B,{schema:x,filterString:A,isLocked:F,editTrigger:s,deleteTrigger:r})})})]})})},Q=s(405),Y=s(33838),H=s(55527),q=s(37315),K=s(38057),J=s(63640);let $=()=>{let[e,t]=(0,i.useState)(),[s,l]=(0,i.useState)(!1),[c,o]=(0,i.useState)(!1),{setEditorPanel:d}=(0,C.WZ)(),u=(0,J.uL)(),h=(0,Z.Xo)(n.KA.TENANT_SQL_ADMIN_READ,"triggers");return(0,Z.N4)()&&!h?(0,a.jsx)(q.Z,{isFullPage:!0,resourceText:"view database triggers"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y._S,{children:(0,a.jsx)(Y.jX,{children:(0,a.jsxs)("div",{className:"col-span-12",children:[(0,a.jsx)(H.p,{title:"Database Triggers",description:"Execute a set of actions automatically on specified table events",docsUrl:"https://supabase.com/docs/guides/database/postgres/triggers"}),(0,a.jsx)(G,{createTrigger:()=>{u?d({open:!0,initialValue:"create trigger trigger_name\nafter insert or update or delete on table_name\nfor each row\nexecute function function_name();",label:"Create new database trigger",saveLabel:"Create trigger",initialPrompt:"Create a new database trigger that..."}):(t(void 0),l(!0))},editTrigger:e=>{u?d({open:!0,initialValue:M(e),label:'Edit trigger "'.concat(e.name,'"'),saveLabel:"Update trigger",initialPrompt:'Update the database trigger "'.concat(e.name,'" to...')}):(t(e),l(!0))},deleteTrigger:e=>{t(e),o(!0)}})]})})}),(0,a.jsx)(r.RA,{trigger:e,visible:s,setVisible:l}),(0,a.jsx)(r.eX,{trigger:e,visible:c,setVisible:o})]})};$.getLayout=e=>(0,a.jsx)(K.Z,{children:(0,a.jsx)(Q.Z,{title:"Database",children:e})});var ee=$},80063:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(74234).Z)("OctagonAlert",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]])},35323:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(74234).Z)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},11108:function(e,t,s){"use strict";s.d(t,{b:function(){return h}});var a=s(97458),n=s(52983),i=s(92334),r=s(80063),l=s(84687),c=s(28570),o=s(21116),d=s(11321);let u={danger:(0,a.jsx)(r.Z,{strokeWidth:1.5,size:18}),success:(0,a.jsx)(l.Z,{strokeWidth:1.5,size:18}),warning:(0,a.jsx)(c.Z,{strokeWidth:1.5,size:18}),info:(0,a.jsx)(o.Z,{strokeWidth:1.5,size:18}),neutral:(0,a.jsx)(a.Fragment,{})};function h(e){let{variant:t="neutral",className:s,title:r,withIcon:l,closable:c,children:o,icon:h,actions:x}=e,g=(0,i.Z)("alert"),[m,f]=(0,n.useState)(!0),p=[g.base];p.push(g.variant[t].base),s&&p.push(s);let j=[g.description,g.variant[t].description],v=[g.close];return(0,a.jsx)(a.Fragment,{children:m&&(0,a.jsxs)("div",{className:p.join(" "),children:[l?(0,a.jsx)("div",{className:g.variant[t].icon,children:l&&u[t]}):null,h&&h,(0,a.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:[g.variant[t].header,g.header].join(" "),children:r}),(0,a.jsx)("div",{className:j.join(" "),children:o})]}),x]}),c&&(0,a.jsx)("button",{"aria-label":"Close alert",onClick:()=>f(!1),className:v.join(" "),children:(0,a.jsx)(d.Z,{strokeWidth:2,size:16})})]})})}},28289:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var a=s(97458),n=s(52983),i=s(17199),r=s(75675);function l(e,t){if(!t.error)return delete e[t.key],e;if(t)return{...e,[t.key]:t.error};throw Error()}function c(e){let{validate:t,...s}=e,[c,o]=(0,n.useReducer)(l,null),d=(0,i.TA)({validateOnBlur:!0,...s,validationSchema:s.validationSchema,initialValues:s.initialValues,onSubmit:s.onSubmit,validate:t||function(){return c}});return(0,a.jsx)("form",{id:s.id,name:s.name,onSubmit:d.handleSubmit,className:s.className,style:s.style,method:"POST",children:(0,a.jsx)(r.o,{values:d.values,errors:d.errors,formContextOnChange:d.handleChange,handleBlur:d.handleBlur,touched:d.touched,fieldLevelValidation:function(e,t){o({key:e,error:t})},children:s.children({errors:d.errors,touched:d.touched,isSubmitting:d.isSubmitting,isValidating:d.isValidating,submitCount:d.submitCount,initialValues:d.initialValues,values:d.values,handleReset:d.handleReset,resetForm:d.resetForm,setFieldValue:d.setFieldValue})})})}},104:function(e,t,s){"use strict";s.d(t,{r:function(){return d}});var a=s(97458),n=s(56384),i=s(31706),r=s(52983),l=s(43633);let c=(0,i.j)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),o=(0,i.j)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),d=r.forwardRef((e,t)=>{let{className:s,size:i,...r}=e;return(0,a.jsx)(n.fC,{className:(0,l.cn)(c({size:i}),s),...r,ref:t,children:(0,a.jsx)(n.bU,{className:(0,l.cn)(o({size:i}))})})});d.displayName=n.fC.displayName}},function(e){e.O(0,[6665,3659,7186,7623,588,7037,8e3,6402,4418,8703,2303,6823,6499,4837,3297,441,1577,5605,1503,7702,5834,7198,3535,8232,3048,7199,5538,3767,2347,8777,8005,2578,1446,9198,4554,5631,8803,8482,5618,3881,9774,2888,179],function(){return e(e.s=80384)}),_N_E=e.O()}]);