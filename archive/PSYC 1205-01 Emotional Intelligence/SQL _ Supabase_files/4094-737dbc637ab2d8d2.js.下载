"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4094],{46156:function(e,s,t){t.d(s,{T:function(){return c}});var n=t(97458),i=t(73512),r=t(34549),a=t(45155),l=t(6433),o=t(15518);let c=e=>{var s,t;let{visible:c,selectedUser:d,onClose:u,onDeleteSuccess:m}=e,{ref:x}=(0,i.UO)(),{mutate:h,isLoading:p}=(0,a.T)({onSuccess:()=>{r.Am.success("Successfully deleted ".concat(null==d?void 0:d.email)),null==m||m()}}),f=async()=>(await (0,l.Vs)(200),x)?(null==d?void 0:d.id)===void 0?r.Am.error("Failed to delete user: User ID not found"):void h({projectRef:x,userId:d.id}):console.error("Project ref is required");return(0,n.jsx)(o.Z,{visible:c,variant:"destructive",title:"Confirm to delete user",loading:p,confirmLabel:"Delete",onCancel:()=>u(),onConfirm:()=>f(),alert:{title:"Deleting a user is irreversible",description:"This will remove the selected the user from the project and all associated data."},children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["This is permanent! Are you sure you want to delete the user"," ",null!==(t=null!==(s=null==d?void 0:d.email)&&void 0!==s?s:null==d?void 0:d.phone)&&void 0!==t?t:"this user","?"]})})}},25136:function(e,s,t){t.d(s,{w:function(){return c}});var n=t(97458),i=t(74459),r=t(94398),a=t(43633),l=t(31241),o=t(78096);let c=e=>{var s,t,c;let{user:d}=e,u=(0,o.Gf)(d),m="-"!==u,x=null!==d.phone,h=d.is_anonymous;return(0,n.jsx)("div",{className:(0,a.cn)(l.l),children:x?(0,n.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,n.jsx)("p",{children:d.phone}),(0,n.jsx)(r.Z,{iconOnly:!0,type:"text",icon:(0,n.jsx)(i.Z,{}),className:"px-1",text:null!==(s=null==d?void 0:d.phone)&&void 0!==s?s:""})]}):h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"Anonymous user"}),(0,n.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:d.id}),(0,n.jsx)(r.Z,{iconOnly:!0,type:"text",icon:(0,n.jsx)(i.Z,{}),className:"px-1",text:null!==(t=null==d?void 0:d.id)&&void 0!==t?t:""})]})]}):(0,n.jsxs)(n.Fragment,{children:[m&&(0,n.jsx)("p",{children:u}),(0,n.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,n.jsx)("p",{className:(0,a.cn)(m?"text-foreground-light text-sm":"text-foreground"),children:d.email}),(0,n.jsx)(r.Z,{iconOnly:!0,type:"text",icon:(0,n.jsx)(i.Z,{}),className:"px-1",text:null!==(c=null==d?void 0:d.email)&&void 0!==c?c:""})]})]})})}},79819:function(e,s,t){t.d(s,{KU:function(){return eo},ah:function(){return el},wC:function(){return ea}});var n=t(97458),i=t(40540),r=t(28977),a=t.n(r),l=t(9738),o=t(69636),c=t(43945),d=t(60204),u=t(26597),m=t(11321),x=t(74459),h=t(83145),p=t.n(h),f=t(52983),v=t(34549),g=t(73512),j=t(2861),y=t(94398),b=t(66437),w=t(64618),N=t(129);async function _(e){let{projectRef:s,userId:t}=e,{data:n,error:i}=await (0,N.IV)("/platform/auth/{ref}/users/{id}/factors",{params:{path:{ref:s,id:t}}});return i&&(0,N.S3)(i),n}let S=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.D)(e=>_(e),{async onSuccess(s,t,n){await (null==e?void 0:e(s,t,n))},async onError(e,t,n){void 0===s?v.Am.error("Failed to delete the user's MFA factors: ".concat(e.message)):s(e,t,n)},...t})};async function C(e){let{projectRef:s,user:t}=e,{data:n,error:i}=await (0,N.v_)("/platform/auth/{ref}/recover",{params:{path:{ref:s}},body:{email:t.email}});return i&&(0,N.S3)(i),n}let k=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.D)(e=>C(e),{async onSuccess(s,t,n){await (null==e?void 0:e(s,t,n))},async onError(e,t,n){void 0===s?v.Am.error("Failed to reset user password: ".concat(e.message)):s(e,t,n)},...t})};async function A(e){let{projectRef:s,user:t}=e,{data:n,error:i}=await (0,N.v_)("/platform/auth/{ref}/magiclink",{params:{path:{ref:s}},body:{email:t.email}});return i&&(0,N.S3)(i),n}let z=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.D)(e=>A(e),{async onSuccess(s,t,n){await (null==e?void 0:e(s,t,n))},async onError(e,t,n){void 0===s?v.Am.error("Failed to send magic link: ".concat(e.message)):s(e,t,n)},...t})};async function Z(e){let{projectRef:s,user:t}=e,{data:n,error:i}=await (0,N.v_)("/platform/auth/{ref}/otp",{params:{path:{ref:s}},body:{phone:t.phone}});return i&&(0,N.S3)(i),n}let E=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.D)(e=>Z(e),{async onSuccess(s,t,n){await (null==e?void 0:e(s,t,n))},async onError(e,t,n){void 0===s?v.Am.error("Failed to send magic link: ".concat(e.message)):s(e,t,n)},...t})};var L=t(36457),T=t(44309);async function U(e){let{projectRef:s,userId:t,banDuration:n}=e,{data:i,error:r}=await (0,N.r$)("/platform/auth/{ref}/users/{id}",{params:{path:{ref:s,id:t}},body:{ban_duration:"number"==typeof n?"".concat(n,"h"):n}});return r&&(0,N.S3)(r),i}let O=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,L.NL)();return(0,w.D)(e=>U(e),{async onSuccess(s,t,i){let{projectRef:r}=t;await n.invalidateQueries(T.o.usersInfinite(r)),await (null==e?void 0:e(s,t,i))},async onError(e,t,n){void 0===s?v.Am.error("Failed to update user: ".concat(e.message)):s(e,t,n)},...t})};var I=t(94281),D=t(56535),P=t(6433),F=t(43633),W=t(47889),M=t(53486),R=t(27429),q=t(15518),X=t(48254),H=t(90330),K=t(86848),B=t(5394),G=t(37914),V=t(76707),Y=t(93840),Q=t(68981),J=t(59225);let $=e=>{let{visible:s,user:t,onClose:i}=e,{ref:r}=(0,g.UO)(),{mutate:l,isLoading:o}=O({onSuccess:(e,s)=>{let t=a()().add(Number(s.banDuration),"hours").format("DD MMM YYYY HH:mm (ZZ)");v.Am.success("User banned successfully until ".concat(t)),i()}}),c=B.Ry({value:B.Z_().min(1,{message:"Please provide a duration"}),unit:B.Km(["hours","days"])}),d={value:"24",unit:"hours"},u=(0,K.cI)({mode:"onBlur",reValidateMode:"onChange",resolver:(0,H.F)(c),defaultValues:d}),{value:m,unit:x}=u.watch(),h=a()().add(Number(m),x).format("DD MMM YYYY HH:mm (ZZ)");return(0,f.useEffect)(()=>{s&&u.reset(d)},[s]),(0,n.jsx)(G.Z,{hideFooter:!0,visible:s,size:"small",header:"Confirm to ban user",onCancel:()=>i(),children:(0,n.jsx)(V.l0,{...u,children:(0,n.jsxs)("form",{onSubmit:u.handleSubmit(e=>{if(void 0===r)return console.error("Project ref is required");if(void 0===t.id)return v.Am.error("Failed to ban user: User ID not found");let s="hours"===e.unit?Number(e.value):24*Number(e.value);l({projectRef:r,userId:t.id,banDuration:s})}),children:[(0,n.jsxs)(G.Z.Content,{className:"flex flex-col gap-y-3",children:[(0,n.jsx)("p",{className:"text-sm",children:"This will revoke the user's access to your project and prevent them from logging in for a specified duration."}),(0,n.jsxs)("div",{className:"flex items-start gap-x-2 [&>div:first-child]:flex-grow",children:[(0,n.jsx)(V.Wi,{control:u.control,name:"value",render:e=>{let{field:s}=e;return(0,n.jsx)(J.E,{className:"[&>div>div]:mt-0",label:"Set a ban duration",children:(0,n.jsx)(V.NI,{children:(0,n.jsx)(Y.I,{...s})})})}}),(0,n.jsx)(V.Wi,{control:u.control,name:"unit",render:e=>{let{field:s}=e;return(0,n.jsx)(J.E,{className:"[&>div>div]:mt-0 mt-[33px]",children:(0,n.jsx)(V.NI,{children:(0,n.jsxs)(Q.Ph,{...s,value:s.value,onValueChange:e=>u.setValue("unit",e),children:[(0,n.jsx)(Q.i4,{className:"capitalize w-24",children:s.value}),(0,n.jsxs)(Q.Bw,{children:[(0,n.jsx)(Q.Ql,{value:"hours",children:"Hours"}),(0,n.jsx)(Q.Ql,{value:"days",children:"Days"})]})]})})})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-foreground-lighter",children:"This user will not be able to log in until:"}),(0,n.jsx)("p",{className:(0,F.cn)("text-sm",!m&&"text-foreground-light"),children:m?h:"Invalid duration set"})]})]}),(0,n.jsx)(W.Z,{}),(0,n.jsxs)(G.Z.Content,{className:"flex justify-end gap-2",children:[(0,n.jsx)(M.z,{type:"default",disabled:o,onClick:()=>i(),children:"Cancel"}),(0,n.jsx)(M.z,{type:"warning",htmlType:"submit",loading:o,children:"Confirm ban"})]})]})})})};var ee=t(46156),es=t(25136),et=t(31241),en=t(78096);let ei="DD MMM, YYYY HH:mm",er=(0,F.cn)("bg-surface-100 border-default text-foreground flex items-center justify-between","gap-x-4 border px-5 py-4 text-sm first:rounded-tr first:rounded-tl last:rounded-br last:rounded-bl"),ea=e=>{var s,t,r,m,x;let{user:h,onDeleteSuccess:j}=e,{ref:y}=(0,g.UO)(),w=null!==h.email,N=null!==h.phone,_=null!==h.banned_until,C=(null!==(t=null===(s=h.raw_app_meta_data)||void 0===s?void 0:s.providers)&&void 0!==t?t:[]).map(e=>({name:e.startsWith("sso")?"SAML":e,icon:"email"===e?"".concat(D.GW,"/img/icons/email-icon2.svg"):en.Bn[e]?"".concat(D.GW,"/img/icons/").concat(en.Bn[e],".svg"):void 0})),A=(0,I.Xo)(i.KA.AUTH_EXECUTE,"*"),Z=(0,I.Xo)(i.KA.AUTH_EXECUTE,"send_magic_link"),L=(0,I.Xo)(i.KA.AUTH_EXECUTE,"send_recovery"),T=(0,I.Xo)(i.KA.AUTH_EXECUTE,"send_otp"),U=(0,I.Xo)(i.KA.TENANT_SQL_DELETE,"auth.users"),H=(0,I.Xo)(i.KA.TENANT_SQL_DELETE,"auth.mfa_factors"),[K,B]=(0,f.useState)(),[G,V]=(0,f.useState)(!1),[Y,Q]=(0,f.useState)(!1),[J,ea]=(0,f.useState)(!1),[ec,ed]=(0,f.useState)(!1),{data:eu}=(0,b.$E)({projectRef:y}),em=null!==(r=null==eu?void 0:eu.MAILER_OTP_EXP)&&void 0!==r?r:0,ex=Math.floor(em/60),eh=Math.floor(em%60),ep="".concat(em>60?"".concat(ex," minute").concat(ex>1?"s":""," ").concat(eh>0?"and":""," "):"").concat(eh>0?"".concat(eh," second").concat(eh>1?"s":""):""),{mutate:ef,isLoading:ev}=k({onSuccess:(e,s)=>{B("send_recovery"),v.Am.success("Sent password recovery to ".concat(s.user.email))},onError:e=>{v.Am.error("Failed to send password recovery: ".concat(e.message))}}),{mutate:eg,isLoading:ej}=z({onSuccess:(e,s)=>{B("send_magic_link"),v.Am.success("Sent magic link to ".concat(s.user.email))},onError:e=>{v.Am.error("Failed to send magic link: ".concat(e.message))}}),{mutate:ey,isLoading:eb}=E({onSuccess:(e,s)=>{B("send_otp"),v.Am.success("Sent OTP to ".concat(s.user.phone))},onError:e=>{v.Am.error("Failed to send OTP: ".concat(e.message))}}),{mutate:ew}=S({onSuccess:()=>{v.Am.success("Successfully deleted the user's factors"),ed(!1)}}),{mutate:eN,isLoading:e_}=O({onSuccess:()=>{v.Am.success("Successfully unbanned user"),Q(!1)}}),eS=async()=>{if(await (0,P.Vs)(200),!y)return console.error("Project ref is required");ew({projectRef:y,userId:h.id})},eC=()=>void 0===y?console.error("Project ref is required"):void 0===h.id?v.Am.error("Failed to ban user: User ID not found"):void eN({projectRef:y,userId:h.id,banDuration:"none"});return(0,f.useEffect)(()=>{if(void 0!==K){let e=setTimeout(()=>B(void 0),5e3);return()=>clearTimeout(e)}},[K]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(es.w,{user:h}),_?(0,n.jsx)(R.J,{type:"warning",label:"User banned until ".concat(a()(h.banned_until).format(ei)),className:"border-r-0 border-l-0 rounded-none -mt-px [&_svg]:ml-0.5 mb-0"}):(0,n.jsx)(W.Z,{}),(0,n.jsxs)("div",{className:(0,F.cn)("flex flex-col gap-y-1",et.l),children:[(0,n.jsx)(el,{property:"User UID",value:h.id}),(0,n.jsx)(el,{property:"Created at",value:h.created_at?a()(h.created_at).format(ei):void 0}),(0,n.jsx)(el,{property:"Updated at",value:h.updated_at?a()(h.updated_at).format(ei):void 0}),(0,n.jsx)(el,{property:"Invited at",value:h.invited_at}),(0,n.jsx)(el,{property:"Confirmation sent at",value:h.confirmation_sent_at}),(0,n.jsx)(el,{property:"Confirmed at",value:h.confirmed_at?a()(h.confirmed_at).format(ei):void 0}),(0,n.jsx)(el,{property:"Last signed in",value:h.last_sign_in_at?a()(h.last_sign_in_at).format(ei):void 0}),(0,n.jsx)(el,{property:"SSO",value:h.is_sso_user})]}),(0,n.jsxs)("div",{className:(0,F.cn)("flex flex-col !pt-0",et.l),children:[(0,n.jsx)("p",{children:"Provider Information"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"The user has the following providers"})]}),(0,n.jsx)("div",{className:(0,F.cn)("flex flex-col -space-y-1 !pt-0",et.l),children:C.map(e=>{var s,t,i;let r=X.Wm.find(s=>s.title.toLowerCase()===("linkedin"===e.name?"linkedin (oidc)":e.name)),a=Object.keys(null!==(s=null==r?void 0:r.properties)&&void 0!==s?s:{}).find(e=>e.toLowerCase().endsWith("_enabled")),o="email"===e.name?"email":"linkedin"===e.name?"LinkedIn":null!==(t=null==r?void 0:r.title)&&void 0!==t?t:e.name,c=null!==(i=null==eu?void 0:eu[a])&&void 0!==i&&i;return(0,n.jsxs)("div",{className:(0,F.cn)(er,"items-start justify-start"),children:[e.icon&&(0,n.jsx)("img",{width:16,src:e.icon,alt:"".concat(e.name," auth icon"),className:(0,F.cn)("mt-1.5","github"===e.name?"dark:invert":"")}),(0,n.jsxs)("div",{className:"flex-grow mt-0.5",children:[(0,n.jsx)("p",{className:"capitalize",children:o}),(0,n.jsxs)("p",{className:"text-xs text-foreground-light",children:["Signed in with a ",o," account via"," ","SAML"===o?"SSO":"OAuth"]}),(0,n.jsx)(M.z,{asChild:!0,type:"default",className:"mt-2",children:(0,n.jsxs)(p(),{href:"/project/".concat(y,"/auth/providers?provider=").concat("SAML"===e.name?"SAML 2.0":e.name),children:["Configure ",o," provider"]})})]}),c?(0,n.jsxs)("div",{className:"flex items-center gap-1 rounded-full border border-brand-400 bg-brand-200 py-1 px-1 text-xs text-brand",children:[(0,n.jsx)("span",{className:"rounded-full bg-brand p-0.5 text-xs text-brand-200",children:(0,n.jsx)(l.Z,{strokeWidth:2,size:12})}),(0,n.jsx)("span",{className:"px-1",children:"Enabled"})]}):(0,n.jsx)("div",{className:"rounded-md border border-strong bg-surface-100 py-1 px-3 text-xs text-foreground-lighter",children:"Disabled"})]},e.name)})}),(0,n.jsx)(W.Z,{}),(0,n.jsxs)("div",{className:(0,F.cn)("flex flex-col -space-y-1",et.l),children:[w&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eo,{title:"Reset password",description:"Send a password recovery email to the user",button:{icon:(0,n.jsx)(o.Z,{}),text:"Send password recovery",isLoading:ev,disabled:!L,onClick:()=>{y&&ef({projectRef:y,user:h})}},success:"send_recovery"===K?{title:"Password recovery sent",description:"The link in the email is valid for ".concat(ep)}:void 0}),(0,n.jsx)(eo,{title:"Send magic link",description:"Passwordless login via email for the user",button:{icon:(0,n.jsx)(o.Z,{}),text:"Send magic link",isLoading:ej,disabled:!Z,onClick:()=>{y&&eg({projectRef:y,user:h})}},success:"send_magic_link"===K?{title:"Magic link sent",description:"The link in the email is valid for ".concat(ep)}:void 0})]}),N&&(0,n.jsx)(eo,{title:"Send OTP",description:"Passwordless login via phone for the user",button:{icon:(0,n.jsx)(o.Z,{}),text:"Send OTP",isLoading:eb,disabled:!T,onClick:()=>{y&&ey({projectRef:y,user:h})}},success:"send_otp"===K?{title:"OTP sent",description:"The link in the OTP SMS is valid for ".concat(ep)}:void 0})]}),(0,n.jsx)(W.Z,{}),(0,n.jsxs)("div",{className:(0,F.cn)("flex flex-col",et.l),children:[(0,n.jsx)("p",{children:"Danger zone"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Be wary of the following features as they cannot be undone."})]}),(0,n.jsxs)("div",{className:(0,F.cn)("flex flex-col -space-y-1 !pt-0",et.l),children:[(0,n.jsx)(eo,{title:"Remove MFA factors",description:"This will log the user out of all active sessions",button:{icon:(0,n.jsx)(c.Z,{}),text:"Remove MFA factors",disabled:!H,onClick:()=>ed(!0)},className:"!bg border-destructive-400"}),(0,n.jsx)(eo,{title:_?"User is banned until ".concat(a()(h.banned_until).format(ei)):"Ban user",description:_?"User has no access to the project until after this date":"Revoke access to the project for a set duration",button:{icon:(0,n.jsx)(d.Z,{}),text:_?"Unban user":"Ban user",disabled:!A,onClick:()=>{_?Q(!0):V(!0)}},className:"!bg border-destructive-400"}),(0,n.jsx)(eo,{title:"Delete user",description:"User will no longer have access to the project",button:{icon:(0,n.jsx)(u.Z,{}),type:"danger",text:"Delete user",disabled:!U,onClick:()=>ea(!0)},className:"!bg border-destructive-400"})]})]}),(0,n.jsx)(ee.T,{visible:J,selectedUser:h,onClose:()=>ea(!1),onDeleteSuccess:()=>{ea(!1),j()}}),(0,n.jsx)(q.Z,{visible:ec,variant:"warning",title:"Confirm to remove MFA factors",confirmLabel:"Remove factors",confirmLabelLoading:"Removing",onCancel:()=>ed(!1),onConfirm:()=>eS(),alert:{base:{variant:"warning"},title:"Removing MFA factors is irreversible",description:"This will log the user out of all active sessions."},children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["This is permanent! Are you sure you want to remove the MFA factors for the user"," ",(0,n.jsx)("span",{className:"text-foreground",children:null!==(x=null!==(m=h.email)&&void 0!==m?m:h.phone)&&void 0!==x?x:"this user"}),"?"]})}),(0,n.jsx)($,{visible:G,user:h,onClose:()=>V(!1)}),(0,n.jsx)(q.Z,{variant:"warning",visible:Y,title:"Confirm to unban user",loading:e_,confirmLabel:"Unban user",confirmLabelLoading:"Unbanning",onCancel:()=>Q(!1),onConfirm:()=>eC(),children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"The user will have access to your project again once unbanned. Are you sure you want to unban this user?"})})]})},el=e=>{let{property:s,value:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-x-2 group justify-between",children:[(0,n.jsx)("p",{className:" text-foreground-lighter text-xs",children:s}),"boolean"==typeof t?(0,n.jsx)("div",{className:"h-[26px] flex items-center justify-center min-w-[70px]",children:t?(0,n.jsx)("div",{className:"rounded-full w-4 h-4 dark:bg-white bg-black flex items-center justify-center",children:(0,n.jsx)(l.Z,{size:10,className:"text-contrast",strokeWidth:4})}):(0,n.jsx)("div",{className:"rounded-full w-4 h-4 dark:bg-white bg-black flex items-center justify-center",children:(0,n.jsx)(m.Z,{size:10,className:"text-contrast",strokeWidth:4})})}):(0,n.jsxs)("div",{className:"flex items-center gap-x-2 h-[26px] font-mono min-w-[40px]",children:[(0,n.jsx)("p",{className:"text-xs",children:t||"-"}),!!t&&(0,n.jsx)(y.Z,{iconOnly:!0,type:"text",icon:(0,n.jsx)(x.Z,{}),className:"transition opacity-0 group-hover:opacity-100 px-1",text:t})]})]}),(0,n.jsx)(W.Z,{})]})},eo=e=>{var s,t,i;let{title:r,description:a,button:o,success:c,className:d}=e,u=null!==(s=null==o?void 0:o.disabled)&&void 0!==s&&s;return(0,n.jsxs)("div",{className:(0,F.cn)(er,d),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:c?c.title:r}),(0,n.jsx)("p",{className:"text-xs text-foreground-light",children:c?c.description:a})]}),(0,n.jsx)(j.u,{type:null!==(t=null==o?void 0:o.type)&&void 0!==t?t:"default",icon:c?(0,n.jsx)(l.Z,{className:"text-brand"}):o.icon,loading:null!==(i=o.isLoading)&&void 0!==i&&i,onClick:o.onClick,disabled:u,tooltip:{content:{side:"bottom",text:u?"You need additional permissions to ".concat(o.text.toLowerCase()):void 0}},children:o.text})]})}},31241:function(e,s,t){t.d(s,{l:function(){return z},i:function(){return Z}});var n=t(97458),i=t(44151),r=t(11321),a=t(52983),l=t(38336),o=t(53486),c=t(19337),d=t(43633),u=t(93840),m=t(79819),x=t(929),h=t(99033),p=t(83145),f=t.n(p),v=t(73512),g=t(61249),j=t(61115),y=t(77086),b=t(47889),w=t(3696),N=t(27429),_=t(18858),S=t(25136),C=t(2861),k=t(30740);let A=e=>{let{user:s}=e,{ref:t}=(0,v.UO)(),{filters:i,setFilters:r}=(0,k.k)(),{logData:l,isSuccess:c,isLoading:u,refresh:m}=(0,y.Z)({projectRef:t,table:g.ae.auth,filterOverride:{search_query:s.id},limit:5});return(0,a.useEffect)(()=>{s.id&&r({...i,search_query:s.id})},[s.id]),(0,n.jsxs)("div",{children:[(0,n.jsx)(S.w,{user:s}),(0,n.jsx)(b.Z,{}),(0,n.jsxs)("div",{className:(0,d.cn)("flex flex-col gap-y-3",z),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Authentication logs"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Latest logs from authentication for this user in the past hour"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(o.z,{type:"status_code"in i?"default":"secondary",className:"rounded-r-none border-r-0",disabled:u,onClick:()=>r({search_query:s.id}),children:"Show all"}),(0,n.jsx)("div",{className:"border-button border border-l-0 py-3"}),(0,n.jsx)(o.z,{type:"status_code"in i?"secondary":"default",className:"rounded-l-none border-l-0",disabled:u,onClick:()=>r({search_query:s.id,status_code:{client_error:!0,server_error:!0}}),children:"Error only"})]}),(0,n.jsx)(o.z,{type:"default",loading:u,disabled:u,icon:(0,n.jsx)(x.Z,{}),onClick:()=>m(),children:"Refresh"})]}),u&&!c?(0,n.jsx)(j.A,{}):0===l.length?(0,n.jsx)(N.J,{type:"note",title:"No authentication logs available for this user",description:"Auth events such as logging in will be shown here"}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"border border-b-0 rounded-t-md divide-y overflow-hidden",children:l.map(e=>{var s;let i=(null!==(s=e.status)&&void 0!==s?s:"-").toString(),r=i.startsWith("4"),a=i.startsWith("5");return(0,n.jsxs)("div",{className:"flex items-center transition font-mono px-2 py-1.5 bg-surface-100 divide-x",children:[(0,n.jsx)("p",{className:"text-xs text-foreground-light min-w-[125px] w-[125px] px-1",children:(0,n.jsx)(_.c,{utcTimestamp:e.timestamp/1e3})}),(0,n.jsx)("div",{className:"flex items-center text-xs text-foreground-light h-[22px] min-w-[70px] w-[70px] px-2",children:(0,n.jsxs)("div",{className:(0,d.cn)("flex items-center justify-center gap-x-1",!!e.status&&"border px-1 py-0.5 rounded",r?"text-warning border-warning bg-warning-300":a?"text-destructive border-destructive bg-destructive-300":""),children:[(r||a)&&(0,n.jsx)(w.ku,{hideBackground:!0,className:(0,d.cn)(r&&"text-warning-600")}),i]})}),(0,n.jsxs)("p",{className:"group relative flex items-center py-1.5 text-xs text-foreground-light px-2 truncate w-full",children:["".concat(e.path," | ").concat(e.msg),(0,n.jsx)(C.u,{type:"outline",asChild:!0,tooltip:{content:{text:"Open in logs"}},className:"px-1.5 absolute right-0 top-0 opacity-0 group-hover:opacity-100 transition bg-background focus-visible:opacity-100",children:(0,n.jsx)(f(),{href:"/project/".concat(t,"/logs/auth-logs?log=").concat(e.id),children:(0,n.jsx)(h.Z,{size:"12",className:"text-foreground-light"})})})]})]},e.id)})}),(0,n.jsx)(o.z,{block:!0,asChild:!0,type:"outline",className:"transition rounded-t-none text-foreground-light hover:text-foreground",children:(0,n.jsx)(f(),{href:"/project/".concat(t,"/logs/auth-logs?s=").concat(s.id),children:"See more logs"})})]})]})]})},z="px-5 py-5",Z=e=>{let{selectedUser:s,onClose:t}=e,[x,h]=(0,a.useState)("overview"),[p,f]=(0,a.useState)(""),v=s?Object.entries(s).filter(e=>{let[s,t]=e;return s.toLowerCase().includes(p.toLowerCase())||"string"==typeof t&&t.toLowerCase().includes(p.toLowerCase())}).reduce((e,s)=>{let[t,n]=s;return void 0!==n&&(e[t]=n),e},{}):{};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Dp,{withHandle:!0}),(0,n.jsxs)(l.ee,{defaultSize:30,maxSize:45,minSize:30,className:"bg-studio border-t",children:[(0,n.jsx)(o.z,{type:"text",className:"absolute top-3 right-3 px-1",icon:(0,n.jsx)(r.Z,{}),onClick:()=>t()}),(0,n.jsxs)(c.mQ,{value:x,className:"flex flex-col h-full",onValueChange:e=>h(e),children:[(0,n.jsxs)(c.dr,{className:"px-5 flex gap-x-4 min-h-[46px]",children:[(0,n.jsx)(c.SP,{value:"overview",className:"px-0 pb-0 h-full text-xs  data-[state=active]:bg-transparent !shadow-none",children:"Overview"}),(0,n.jsx)(c.SP,{value:"logs",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none",children:"Logs"}),(0,n.jsx)(c.SP,{value:"raw",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none",children:"Raw JSON"})]}),(0,n.jsx)(c.nU,{value:"overview",className:(0,d.cn)("mt-0 flex-grow min-h-0 overflow-y-auto"),children:s&&(0,n.jsx)(m.wC,{user:s,onDeleteSuccess:t})}),(0,n.jsx)(c.nU,{value:"logs",className:(0,d.cn)("mt-0 flex-grow min-h-0 overflow-y-auto"),children:s&&(0,n.jsx)(A,{user:s})}),(0,n.jsxs)(c.nU,{value:"raw",className:(0,d.cn)("mt-0 flex-grow min-h-0 overflow-y-auto",z),children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)(u.I,{autoFocus:!0,type:"text",placeholder:"Filter...",value:p,onChange:e=>f(e.target.value),className:"mr-2"}),(0,n.jsx)(o.z,{type:"text",disabled:!p,onClick:()=>f(""),className:"text-xs",children:"Clear"})]}),(0,n.jsx)(i.c,{className:"javascript",children:JSON.stringify(v,null,2)})]})]})]})]})}},78096:function(e,s,t){t.d(s,{Rs:function(){return O},Bi:function(){return C},E$:function(){return U},Gf:function(){return T},KG:function(){return S},Bn:function(){return z}});var n=t(97458),i=t(28977),r=t.n(i),a=t(86392),l=t(32024),o=t(26597),c=t(44914),d=t(56535),u=t(6433),m=t(5562),x=t(43633),h=t(97079),p=t(15647),f=t(1546),v=t(90408),g=t(52983),j=t(15011),y=t(53486);let b=e=>{let{col:s,setSortByValue:t}=e,i=(0,g.useRef)(0),[r,a]=(0,g.useState)(!1);return(0,g.useEffect)(()=>{i.current=Number(new Date)},[r]),(0,n.jsxs)("div",{className:"flex items-center justify-between font-normal text-xs w-full",children:[(0,n.jsx)("div",{className:"flex items-center gap-x-2",children:(0,n.jsx)("p",{className:"!text-foreground",children:s.name})}),["created_at","email","phone"].includes(s.id)&&(0,n.jsxs)(j.h_,{open:r,onOpenChange:e=>{!1===e&&Number(new Date)-i.current>100&&a(e)},children:[(0,n.jsx)(j.$F,{asChild:!0,children:(0,n.jsx)(y.z,{type:"text",icon:(0,n.jsx)(p.Z,{}),className:"p-0 h-5 w-5",onClick:()=>a(!r)})}),(0,n.jsxs)(j.AW,{className:"w-36",children:[(0,n.jsxs)(j.Xi,{className:"flex items-center gap-x-2",onClick:()=>{a(!1),t("".concat(s.id,":desc"))},children:[(0,n.jsx)(f.Z,{size:14}),"Sort descending"]}),(0,n.jsxs)(j.Xi,{className:"flex items-center gap-x-2",onClick:()=>{a(!1),t("".concat(s.id,":asc"))},children:[(0,n.jsx)(v.Z,{size:14}),"Sort ascending"]})]})]})]})};var w=t(20238);let N="https://avatars.githubusercontent.com",_=[N,"https://lh3.googleusercontent.com"],S=e=>{let{currentTarget:s}=e;return s.scrollTop+10>=s.scrollHeight-s.clientHeight},C=e=>e.map(e=>{var s,t;let n=null!==(t=null===(s=e.raw_app_meta_data)||void 0===s?void 0:s.provider)&&void 0!==t?t:"",i=e.providers.map(e=>e.startsWith("sso")?"SAML":e);return{id:e.id,email:e.email,phone:e.phone,created_at:e.created_at,last_sign_in_at:e.last_sign_in_at,providers:e.is_anonymous?"-":i,provider_icons:i.map(e=>"email"===e?"".concat(d.GW,"/img/icons/email-icon2.svg"):"SAML"===e?"".concat(d.GW,"/img/icons/saml-icon.svg"):z[e]?"".concat(d.GW,"/img/icons/").concat(z[e],".svg"):void 0).filter(Boolean),provider_type:e.is_anonymous?"Anonymous":"email"===n?"-":Z.includes(n)?"Social":E.includes(n)?"Phone":"-",img:U(e),name:T(e)}}),k=[{email:"email-icon2"},{apple:"apple-icon"},{azure:"microsoft-icon"},{bitbucket:"bitbucket-icon"},{discord:"discord-icon"},{facebook:"facebook-icon"},{figma:"figma-icon"},{github:"github-icon"},{gitlab:"gitlab-icon"},{google:"google-icon"},{kakao:"kakao-icon"},{keycloak:"keycloak-icon"},{linkedin:"linkedin-icon"},{notion:"notion-icon"},{twitch:"twitch-icon"},{twitter:"twitter-icon"},{slack:"slack-icon"},{spotify:"spotify-icon"},{workos:"workos-icon"},{zoom:"zoom-icon"}],A=[{twilio:"twilio-icon"},{messagebird:"messagebird-icon"},{textlocal:"messagebird-icon"},{vonage:"messagebird-icon"},{twilioverify:"twilio-verify-icon"}],z=Object.values([...k,...A]).reduce((e,s)=>{let[[t,n]]=Object.entries(s);return{...e,[t]:n}},{}),Z=k.map(e=>{let[s]=Object.keys(e);return s}),E=A.map(e=>{let[s]=Object.keys(e);return s});function L(e){if(e){if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>L(e)).join(" ");try{return JSON.stringify(e)}catch(e){}}}function T(e){var s;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",{custom_claims:n,displayName:i,display_name:r,fullName:a,full_name:l,familyName:o,family_name:c,givenName:d,given_name:u,surname:m,lastName:x,last_name:h,firstName:p,first_name:f}=null!==(s=e.raw_user_meta_data)&&void 0!==s?s:{},{displayName:v,display_name:g,fullName:j,full_name:y,familyName:b,family_name:w,givenName:N,given_name:_,surname:S,lastName:C,last_name:k,firstName:A,first_name:z}=null!=n?n:{},Z=L(o||c||m||x||h||b||w||S||C||k),E=L(d||u||p||f||N||_||A||z);return L(i||r||v||g||a||l||j||y||E&&Z&&"".concat(E," ").concat(Z)||Z||E)||t}function U(e){var s;let{avatarUrl:t,avatarURL:n,avatar_url:i,profileUrl:r,profileURL:a,profile_url:l,profileImage:o,profile_image:c,profileImageUrl:d,profileImageURL:u,profile_image_url:m}=null!==(s=e.raw_user_meta_data)&&void 0!==s?s:{},x=t||n||i||o||c||r||a||l||d||u||m||"";if("string"!=typeof x)return;let h=_.some(e=>x.startsWith(e));try{let e=new URL(x);return e.searchParams.set("s","24"),h?x.startsWith(N)?e.href:x:void 0}catch(e){return h?x:void 0}}let O=e=>{var s;let{config:t,users:i,visibleColumns:d=[],setSortByValue:p,onSelectDeleteUser:f}=e,v=null!==(s=t.map(e=>e.id))&&void 0!==s?s:w.O.map(e=>e.id),g=w.O.map(e=>{var s,d,v;let g=t.find(s=>s.id===e.id);return{key:e.id,name:e.name,resizable:null===(s=e.resizable)||void 0===s||s,sortable:!1,draggable:!0,width:null!==(d=null==g?void 0:g.width)&&void 0!==d?d:e.width,minWidth:null!==(v=e.minWidth)&&void 0!==v?v:120,headerCellClass:"z-50 outline-none !shadow-none",renderHeaderCell:()=>{if("img"!==e.id)return(0,n.jsx)(b,{col:e,setSortByValue:p})},renderCell:s=>{let{row:t}=s,[d,p]=(0,c.Gt)(),v=null==t?void 0:t[e.id],g=null==i?void 0:i.find(e=>e.id===t.id),j=null!==v&&["created_at","last_sign_in_at"].includes(e.id)?r()(v).format("ddd DD MMM YYYY HH:mm:ss [GMT]ZZ"):Array.isArray(v)?v.join(", "):v,y=!!(null==g?void 0:g.confirmed_at);return"img"===e.id?(0,n.jsxs)("div",{className:"flex items-center justify-center gap-x-2",children:[(0,n.jsx)(m.X,{checked:d,onClick:e=>{e.stopPropagation(),p({row:t,type:"ROW",checked:!d,isShiftClick:e.shiftKey})}}),(0,n.jsx)("div",{className:(0,x.cn)("flex items-center justify-center w-6 h-6 rounded-full bg-center bg-cover bg-no-repeat",t.img?"border":"bg-selection"),style:{backgroundImage:t.img?"url('".concat(t.img,"')"):"none"},children:!t.img&&(0,n.jsx)(a.Z,{size:12})})]}):(0,n.jsxs)(h.xV,{children:[(0,n.jsx)(h.W4,{asChild:!0,children:(0,n.jsxs)("div",{className:(0,x.cn)("w-full flex items-center text-xs",e.id.includes("provider")?"capitalize":""),children:["providers"===e.id&&t.provider_icons.map((e,s)=>{let i=t.providers[s];return(0,n.jsx)("div",{className:"min-w-6 min-h-6 rounded-full border flex items-center justify-center bg-surface-75",style:{marginLeft:0===s?0:"-8px",zIndex:t.provider_icons.length-s},children:(0,n.jsx)("img",{width:16,src:e,alt:"".concat(i," auth icon"),className:(0,x.cn)("github"===i&&"dark:invert")},"".concat(null==g?void 0:g.id,"-").concat(i))})}),"last_sign_in_at"!==e.id||y?(0,n.jsx)("p",{className:(0,x.cn)("providers"===e.id&&"ml-1"),children:null===j?"-":j}):(0,n.jsx)("p",{className:"text-foreground-lighter",children:"Waiting for verification"})]})}),(0,n.jsxs)(h.h_,{onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)(h.Zo,{className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),onSelect:()=>{let s="providers"===e.id?t.providers.join(", "):j;(0,u.vQ)(s)},children:[(0,n.jsx)(l.Z,{size:12}),(0,n.jsxs)("span",{children:["Copy ","id"===e.id?e.name:e.name.toLowerCase()]})]}),(0,n.jsx)(h.uP,{}),(0,n.jsxs)(h.Zo,{className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),onSelect:()=>{g&&f(g)},children:[(0,n.jsx)(o.Z,{size:12}),(0,n.jsx)("span",{children:"Delete user"})]})]})]})}}}),j=g.find(e=>"img"===e.key);return v.length>0&&(g=g.filter(e=>v.includes(e.key)).sort((e,s)=>v.indexOf(e.key)-v.indexOf(s.key))),0===d.length?g:[j].concat(g.filter(e=>d.includes(e.key)))}},20238:function(e,s,t){t.d(s,{O:function(){return ew},r:function(){return eN}});var n=t(97458),i=t(36457),r=t(12832),a=t(26597),l=t(11321),o=t(16696),c=t(29360),d=t(15676),u=t(929),m=t(16163),x=t(85847),h=t(52983),p=t(44914),f=t(34549),v=t(73512),g=t(63640),j=t(32672),y=t(84261),b=t(62347),w=t(2861),N=t(17209),_=t(55527),S=t(44309),C=t(45155),k=t(28894),A=t(70864);let z=e=>{let{filter:s,keywords:t,providers:n}=e,i=[];if(t&&""!==t){let e=t.replaceAll("'","''");i.push("id::text ilike '%".concat(e,"%' or email ilike '%").concat(e,"%' or phone ilike '%").concat(e,"%'"))}"verified"===s?i.push("email_confirmed_at IS NOT NULL or phone_confirmed_at IS NOT NULL"):"anonymous"===s?i.push("is_anonymous is true"):"unverified"===s&&i.push("email_confirmed_at IS NULL AND phone_confirmed_at IS NULL"),n&&n.length>0&&(n.includes("saml 2.0")?i.push("(select jsonb_agg(case when value ~ '^sso' then 'sso' else value end) from jsonb_array_elements_text((raw_app_meta_data ->> 'providers')::jsonb)) ?| array[".concat(n.map(e=>"saml 2.0"===e?"'sso'":"'".concat(e,"'")).join(", "),"]").trim()):i.push("(raw_app_meta_data->>'providers')::jsonb ?| array[".concat(n.map(e=>"'".concat(e,"'")).join(", "),"]")));let r=i.map(e=>"(".concat(e,")")).join(" and ");return"".concat("select count(*) from auth.users").concat(i.length>0?" where ".concat(r):"",";")};async function Z(e,s){var t;let{projectRef:n,connectionString:i,keywords:r,filter:a,providers:l}=e,o=z({filter:a,keywords:r,providers:l}),{result:c}=await (0,A.R)({projectRef:n,connectionString:i,sql:o,queryKey:["users-count"]},s),d=null==c?void 0:null===(t=c[0])||void 0===t?void 0:t.count;if("number"!=typeof d)throw Error("Error fetching users count");return d}let E=function(e){let{projectRef:s,connectionString:t,keywords:n,filter:i,providers:r}=e,{enabled:a=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,k.a)(S.o.usersCount(s,{keywords:n,filter:i,providers:r}),e=>{let{signal:a}=e;return Z({projectRef:s,connectionString:t,keywords:n,filter:i,providers:r},a)},{enabled:a&&void 0!==s,...l})};var L=t(6232),T=t(35721),U=t(56535),O=t(53486),I=t(68981),D=t(43633),P=t(15011),F=t(42317),W=t(38336),M=t(60586),R=t(15518),q=t(28179),X=t(40540),H=t(15647),K=t(69636),B=t(334),G=t(94281),V=t(50322),Y=t(90330),Q=t(74286),J=t(86848),$=t(5394),ee=t(64618),es=t(129);async function et(e){let{projectRef:s,user:t}=e,{data:n,error:i}=await (0,es.v_)("/platform/auth/{ref}/users",{params:{path:{ref:s}},body:{email:t.email,password:t.password,email_confirm:t.autoConfirmUser}});return i&&(0,es.S3)(i),n}let en=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,i.NL)();return(0,ee.D)(e=>et(e),{async onSuccess(s,t,i){let{projectRef:r}=t;await Promise.all([n.invalidateQueries(S.o.usersInfinite(r)),n.invalidateQueries(S.o.usersCount(r))]),await (null==e?void 0:e(s,t,i))},async onError(e,t,n){void 0===s?f.Am.error("Failed to create user: ".concat(e.message)):s(e,t,n)},...t})};var ei=t(79180),er=t(76707),ea=t(93840),el=t(5562);let eo=$.Ry({email:$.Z_().min(1,"Email is required").email("Must be a valid email address"),password:$.Z_().min(1,"Password is required"),autoConfirmUser:$.O7()});var ec=e=>{let{visible:s,setVisible:t}=e,{ref:i}=(0,v.UO)(),r=(0,G.Xo)(X.KA.AUTH_EXECUTE,"create_user"),{mutate:a,isLoading:l}=en({onSuccess(e){f.Am.success("Successfully created user: ".concat(e.email)),c.reset({email:"",password:"",autoConfirmUser:!0}),t(!1)}}),o=async e=>{if(!i)return console.error("Project ref is required");a({projectRef:i,user:e})},c=(0,J.cI)({resolver:(0,Y.F)(eo),defaultValues:{email:"",password:"",autoConfirmUser:!0}});return(0,n.jsx)(ei.Vq,{open:s,onOpenChange:t,children:(0,n.jsxs)(ei.cZ,{size:"small",children:[(0,n.jsx)(ei.fK,{children:(0,n.jsx)(ei.$N,{children:"Create a new user"})}),(0,n.jsx)(ei.P3,{}),(0,n.jsx)(er.l0,{...c,children:(0,n.jsxs)("form",{id:"create-user",className:"flex flex-col gap-y-4 p-6",onSubmit:c.handleSubmit(o),children:[(0,n.jsx)(er.Wi,{name:"email",control:c.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(er.xJ,{className:"flex flex-col gap-1",children:[(0,n.jsx)(er.lX,{children:"Email address"}),(0,n.jsx)(er.NI,{children:(0,n.jsxs)("div",{className:"items-center relative",children:[(0,n.jsx)(K.Z,{size:18,className:"absolute left-2 top-1/2 transform -translate-y-1/2",strokeWidth:1.5}),(0,n.jsx)(ea.I,{autoFocus:!0,...s,autoComplete:"off",type:"email",name:"email",placeholder:"user@example.com",disabled:l,className:"pl-8"})]})}),(0,n.jsx)(er.zG,{})]})}}),(0,n.jsx)(er.Wi,{name:"password",control:c.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(er.xJ,{className:"flex flex-col gap-1",children:[(0,n.jsx)(er.lX,{children:"User Password"}),(0,n.jsx)(er.NI,{children:(0,n.jsxs)("div",{className:"items-center relative",children:[(0,n.jsx)(Q.Z,{size:18,className:"absolute left-2 top-1/2 transform -translate-y-1/2",strokeWidth:1.5}),(0,n.jsx)(ea.I,{...s,autoComplete:"new-password",type:"password",name:"password",placeholder:"••••••••",disabled:l,className:"pl-8"})]})}),(0,n.jsx)(er.zG,{})]})}}),(0,n.jsx)(er.Wi,{name:"autoConfirmUser",control:c.control,render:e=>{let{field:s}=e;return(0,n.jsxs)(er.xJ,{className:"flex items-center gap-x-2",children:[(0,n.jsx)(er.NI,{children:(0,n.jsx)(el.X,{checked:s.value,onCheckedChange:e=>s.onChange(e)})}),(0,n.jsx)(er.lX,{children:"Auto Confirm User?"})]})}}),(0,n.jsx)(er.lX,{children:(0,n.jsx)("p",{className:"text-sm text-foreground-lighter",children:"A confirmation email will not be sent when creating a user via this form."})}),(0,n.jsx)(O.z,{block:!0,size:"small",htmlType:"submit",loading:l,disabled:!r||l,children:"Create user"})]})})]})})};async function ed(e){let{projectRef:s,email:t}=e,{data:n,error:i}=await (0,es.v_)("/platform/auth/{ref}/invite",{params:{path:{ref:s}},body:{email:t}});return i&&(0,es.S3)(i),n}let eu=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,i.NL)();return(0,ee.D)(e=>ed(e),{async onSuccess(s,t,i){let{projectRef:r}=t;await Promise.all([n.invalidateQueries(S.o.usersInfinite(r)),n.invalidateQueries(S.o.usersCount(r))]),await (null==e?void 0:e(s,t,i))},async onError(e,t,n){void 0===s?f.Am.error("Failed to invite user: ".concat(e.message)):s(e,t,n)},...t})};var em=t(37914),ex=t(28289),eh=t(60661),ep=e=>{let{visible:s,setVisible:t}=e,{ref:i}=(0,v.UO)(),{mutate:r,isLoading:a}=eu({onSuccess:(e,s)=>{f.Am.success("Sent invite email to ".concat(s.email)),t(!1)}}),l=(0,G.Xo)(X.KA.AUTH_EXECUTE,"invite_user"),o=async e=>{if(!i)return console.error("Project ref is required");r({projectRef:i,email:e.email})};return(0,n.jsx)(em.Z,{hideFooter:!0,size:"small",visible:s,header:"Invite a new user",onCancel:()=>t(!s),children:(0,n.jsx)(ex.Z,{validateOnBlur:!1,initialValues:{email:""},validate:e=>{let s={};return 0===e.email.length?s.email="Please enter a valid email":/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(e.email)||(s.email="".concat(e.email," is an invalid email")),s},onSubmit:o,children:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(em.Z.Content,{children:(0,n.jsx)(eh.Z,{id:"email",className:"w-full",label:"User email",icon:(0,n.jsx)(K.Z,{}),type:"email",name:"email",placeholder:"User email"})}),(0,n.jsx)(em.Z.Content,{children:(0,n.jsx)(O.z,{block:!0,size:"small",htmlType:"submit",loading:a,disabled:!l||a,children:"Invite user"})})]})})},"invite-user-modal")},ef=()=>{let e=(0,G.Xo)(X.KA.AUTH_EXECUTE,"invite_user"),s=(0,G.Xo)(X.KA.AUTH_EXECUTE,"create_user"),[t,i]=(0,h.useState)(!1),[r,a]=(0,h.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(P.h_,{children:[(0,n.jsx)(P.$F,{asChild:!0,children:(0,n.jsx)(O.z,{type:"primary",iconRight:(0,n.jsx)(H.Z,{size:14,strokeWidth:1.5}),children:"Add user"})}),(0,n.jsxs)(P.AW,{side:"bottom",align:"end",className:"w-40",children:[(0,n.jsxs)(V.u,{children:[(0,n.jsx)(V.aJ,{asChild:!0,children:(0,n.jsxs)(P.Xi,{className:"space-x-2 !pointer-events-auto",disabled:!e,onClick:()=>{e&&i(!0)},children:[(0,n.jsx)(K.Z,{size:14}),(0,n.jsx)("p",{children:"Send invitation"})]})}),!e&&(0,n.jsx)(V._v,{side:"left",children:"You need additional permissions to invite users"})]}),(0,n.jsxs)(V.u,{children:[(0,n.jsx)(V.aJ,{asChild:!0,children:(0,n.jsxs)(P.Xi,{className:"space-x-2 !pointer-events-auto",disabled:!s,onClick:()=>{s&&a(!0)},children:[(0,n.jsx)(B.Z,{size:14}),(0,n.jsx)("p",{children:"Create new user"})]})}),!s&&(0,n.jsx)(V._v,{side:"left",children:"You need additional permissions to create users"})]})]})]}),(0,n.jsx)(ep,{visible:t,setVisible:i}),(0,n.jsx)(ec,{visible:r,setVisible:a})]})},ev=t(46156),eg=t(31241),ej=t(48254);let ey=ej.Wm.map(e=>({name:e.title,value:"Slack (OIDC)"===e.title?"slack_oidc":"LinkedIn (OIDC)"===e.title?"linkedin_oidc":e.title.toLowerCase(),icon:"".concat(U.GW,"/img/icons/").concat(e.misc.iconKey,".svg"),iconClass:"GitHub"===e.title?"dark:invert":""})).concat(ej.Px.properties.SMS_PROVIDER.enum.map(e=>({name:e.label,value:e.value,icon:"".concat(U.GW,"/img/icons/").concat(e.icon),iconClass:""})));var eb=t(78096);let ew=[{id:"img",name:"",minWidth:95,width:95,resizable:!1},{id:"id",name:"UID",width:280},{id:"name",name:"Display name",minWidth:0,width:150},{id:"email",name:"Email",width:300},{id:"phone",name:"Phone"},{id:"providers",name:"Providers",minWidth:150},{id:"provider_type",name:"Provider type",minWidth:150},{id:"created_at",name:"Created at",width:260},{id:"last_sign_in_at",name:"Last sign in at",width:260}],eN=()=>{var e,s;let t=(0,i.NL)(),{ref:k}=(0,v.UO)(),{project:A}=(0,j.d2)(),z=(0,h.useRef)(null),Z=(0,h.useRef)(0),X=(0,g.cg)(),[H,K]=(0,h.useState)([]),[B,G]=(0,h.useState)(""),[V,Y]=(0,h.useState)("all"),[Q,J]=(0,h.useState)(""),[$,ee]=(0,h.useState)([]),[es,et]=(0,h.useState)([]),[en,ei]=(0,h.useState)("created_at:desc"),[er,ea]=(0,h.useState)(),[el,eo]=(0,h.useState)(new Set([])),[ec,ed]=(0,h.useState)(),[eu,em]=(0,h.useState)(!1),[ex,eh]=(0,h.useState)(!1),[ep,ej,{isSuccess:eN,isError:e_,error:eS}]=(0,T.l)(U.dA.AUTH_USERS_COLUMNS_CONFIGURATION(null!=k?k:""),null),[eC,ek]=en.split(":"),{data:eA,error:ez,isSuccess:eZ,isLoading:eE,isRefetching:eL,isError:eT,isFetchingNextPage:eU,refetch:eO,hasNextPage:eI,fetchNextPage:eD}=(0,L.x7)({projectRef:k,connectionString:null==A?void 0:A.connectionString,keywords:Q,filter:"all"===V?void 0:V,providers:es,sort:eC,order:ek},{keepPreviousData:!!Q,staleTime:1/0}),{data:eP}=E({projectRef:k,connectionString:null==A?void 0:A.connectionString,keywords:Q,filter:"all"===V?void 0:V,providers:es}),{mutateAsync:eF}=(0,C.T)(),eW=(0,h.useMemo)(()=>{var e;return null!==(e=null==eA?void 0:eA.pages.flatMap(e=>e.result))&&void 0!==e?e:[]},[null==eA?void 0:eA.pages]),eM=eW.find(e=>e.id===[...el][0]),eR=()=>{G(""),J("")},eq=(e,s,t)=>{let n=e.slice(),[i]=n.splice(s,1);return n.splice(t,0,i),n},eX=(0,r.Z)((e,s)=>{"toggle"===e?ej(s.columns.map(e=>({id:e.key,width:e.width}))):"resize"===e?ej(H.map((e,t)=>({id:e.key,width:t===s.idx?s.width:e.width}))):"reorder"===e&&ej(s.columns.map(e=>({id:e.key,width:e.width})))},500),eH=async()=>{if(!k)return console.error("Project ref is required");let e=[...el];eh(!0);try{await Promise.all(e.map(e=>eF({projectRef:k,userId:e,skipInvalidation:!0}))),await Promise.all([t.invalidateQueries(S.o.usersInfinite(k)),t.invalidateQueries(S.o.usersCount(k))]),f.Am.success("Successfully deleted the selected ".concat(el.size," user").concat(el.size>1?"s":"")),em(!1),eo(new Set([])),e.includes(er)&&ea(void 0)}catch(e){f.Am.error("Failed to delete selected users: ".concat(e.message)),eh(!1)}};return(0,h.useEffect)(()=>{if(!eL&&(eN||e_&&eS.message.includes("data is undefined"))){let e=(0,eb.Rs)({config:null!=ep?ep:[],users:null!=eW?eW:[],visibleColumns:$,setSortByValue:ei,onSelectDeleteUser:ed});K(e),e.length<ew.length&&ee(e.filter(e=>"img"!==e.key).map(e=>e.key))}},[eZ,eL,eN,e_,eS,eW,el]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsx)(_.p,{className:"py-4 px-6 !mb-0",title:"Users"}),(0,n.jsx)("div",{className:"bg-surface-200 py-3 px-4 md:px-6 flex flex-col lg:flex-row lg:items-center justify-between gap-2 border-t",children:el.size>0?(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsxs)(O.z,{type:"default",icon:(0,n.jsx)(a.Z,{}),onClick:()=>em(!0),children:["Delete ",el.size," users"]}),(0,n.jsx)(w.u,{type:"default",icon:(0,n.jsx)(l.Z,{}),className:"px-1.5",onClick:()=>eo(new Set([])),tooltip:{content:{side:"bottom",text:"Cancel selection"}}})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,n.jsx)(M.I,{size:"tiny",className:"w-52 pl-7 bg-transparent",iconContainerClassName:"pl-2",icon:(0,n.jsx)(o.Z,{size:14,className:"text-foreground-lighter"}),placeholder:"Search email, phone or UID",value:B,onChange:e=>G(e.target.value),onKeyDown:e=>{"Enter"===e.code&&(G(B.trim()),J(B.trim().toLocaleLowerCase()))},actions:[B&&(0,n.jsx)(O.z,{size:"tiny",type:"text",icon:(0,n.jsx)(l.Z,{}),onClick:()=>eR(),className:"p-0 h-5 w-5"})]}),(0,n.jsxs)(I.Ph,{value:V,onValueChange:e=>Y(e),children:[(0,n.jsx)(I.i4,{size:"tiny",className:(0,D.cn)("w-[140px] !bg-transparent","all"===V&&"border-dashed"),children:(0,n.jsx)(I.ki,{})}),(0,n.jsx)(I.Bw,{children:(0,n.jsxs)(I.DI,{children:[(0,n.jsx)(I.Ql,{value:"all",className:"text-xs",children:"All users"}),(0,n.jsx)(I.Ql,{value:"verified",className:"text-xs",children:"Verified users"}),(0,n.jsx)(I.Ql,{value:"unverified",className:"text-xs",children:"Unverified users"}),(0,n.jsx)(I.Ql,{value:"anonymous",className:"text-xs",children:"Anonymous users"})]})})]}),(0,n.jsx)(N.E,{name:"Provider",options:ey,labelKey:"name",valueKey:"value",iconKey:"icon",activeOptions:es,labelClass:"text-xs",maxHeightClass:"h-[190px]",onSaveFilters:et}),(0,n.jsx)("div",{className:"border-r border-strong h-6"}),(0,n.jsx)(N.E,{name:0===$.length?"All columns":"Columns",title:"Select columns to show",buttonType:0===$.length?"dashed":"default",options:ew.slice(1),labelKey:"name",valueKey:"id",labelClass:"text-xs",maxHeightClass:"h-[190px]",clearButtonText:"Reset",activeOptions:$,onSaveFilters:e=>{let s=(null!=ep?ep:[]).slice();0===e.length?s=ew.map(e=>({id:e.id,width:e.width})):e.forEach(e=>{var t;s.find(s=>s.id===e)||s.push({id:e,width:null===(t=ew.find(s=>s.id===e))||void 0===t?void 0:t.width})});let t=(0,eb.Rs)({config:s,users:null!=eW?eW:[],visibleColumns:e,setSortByValue:ei,onSelectDeleteUser:ed});ee(e),K(t),eX("toggle",{columns:t})}}),(0,n.jsxs)(P.h_,{children:[(0,n.jsx)(P.$F,{asChild:!0,children:(0,n.jsxs)(O.z,{icon:"desc"===ek?(0,n.jsx)(c.Z,{}):(0,n.jsx)(d.Z,{}),children:["Sorted by ",eC.replaceAll("_"," ")]})}),(0,n.jsx)(P.AW,{className:"w-44",align:"start",children:(0,n.jsxs)(P._x,{value:en,onValueChange:ei,children:[(0,n.jsxs)(P.Ph,{children:[(0,n.jsx)(P.kt,{children:"Sort by created at"}),(0,n.jsxs)(P.TG,{children:[(0,n.jsx)(P.qB,{value:"created_at:asc",children:"Ascending"}),(0,n.jsx)(P.qB,{value:"created_at:desc",children:"Descending"})]})]}),(0,n.jsxs)(P.Ph,{children:[(0,n.jsx)(P.kt,{children:"Sort by last sign in at"}),(0,n.jsxs)(P.TG,{children:[(0,n.jsx)(P.qB,{value:"last_sign_in_at:asc",children:"Ascending"}),(0,n.jsx)(P.qB,{value:"last_sign_in_at:desc",children:"Descending"})]})]}),(0,n.jsxs)(P.Ph,{children:[(0,n.jsx)(P.kt,{children:"Sort by email"}),(0,n.jsxs)(P.TG,{children:[(0,n.jsx)(P.qB,{value:"email:asc",children:"Ascending"}),(0,n.jsx)(P.qB,{value:"email:desc",children:"Descending"})]})]}),(0,n.jsxs)(P.Ph,{children:[(0,n.jsx)(P.kt,{children:"Sort by phone"}),(0,n.jsxs)(P.TG,{children:[(0,n.jsx)(P.qB,{value:"phone:asc",children:"Ascending"}),(0,n.jsx)(P.qB,{value:"phone:desc",children:"Descending"})]})]})]})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[X&&(0,n.jsx)(b.Z,{section:["user-management"]}),(0,n.jsx)(O.z,{size:"tiny",icon:(0,n.jsx)(u.Z,{}),type:"default",loading:eL&&!eU,onClick:()=>eO(),children:"Refresh"}),(0,n.jsx)(ef,{})]})]})}),(0,n.jsx)(F.O,{loading:eE||eL||eU}),(0,n.jsxs)(W.pO,{direction:"horizontal",className:"relative flex flex-grow bg-alternative min-h-0",autoSaveId:"query-performance-layout-v1",children:[(0,n.jsx)(W.ee,{defaultSize:1,children:(0,n.jsx)("div",{className:"flex flex-col w-full h-full",children:(0,n.jsx)(p.ZP,{ref:z,className:"flex-grow border-t-0",rowHeight:44,headerRowHeight:36,columns:H,rows:(0,eb.Bi)(null!=eW?eW:[]),rowClass:e=>{let s=e.id===er;return["".concat(s?"bg-surface-300 dark:bg-surface-300":"bg-200"," cursor-pointer"),"[&>.rdg-cell]:border-box [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none","[&>.rdg-cell:first-child>div]:ml-4"].join(" ")},rowKeyGetter:e=>e.id,selectedRows:el,onScroll:e=>{let s=Z.current!==e.currentTarget.scrollLeft;Z.current=e.currentTarget.scrollLeft,!eE&&!eU&&!s&&(0,eb.KG)(e)&&eI&&eD()},onSelectedRowsChange:e=>{e.size>20?(0,f.Am)("Only up to ".concat(20," users can be selected at a time")):eo(e)},onColumnResize:(e,s)=>eX("resize",{idx:e,width:s}),onColumnsReorder:(e,s)=>{let t=H.findIndex(s=>s.key===e),n=H.findIndex(e=>e.key===s),i=eq(H,t,n);K(i),eX("reorder",{columns:i})},renderers:{renderRow:(e,s)=>(0,n.jsx)(p.X2,{...s,onClick:()=>{let t=eW.find(s=>s.id===e);if(t){let e=eW.indexOf(t);if(s.row.id){var n;ea(s.row.id),null===(n=z.current)||void 0===n||n.scrollToCell({idx:0,rowIdx:e})}}}}),noRowsFallback:eE?(0,n.jsx)("div",{className:"absolute top-14 px-6 w-full",children:(0,n.jsx)(q.A,{})}):eT?(0,n.jsx)("div",{className:"absolute top-14 px-6 flex flex-col items-center justify-center w-full",children:(0,n.jsx)(y.Z,{subject:"Failed to retrieve users",error:ez})}):(0,n.jsxs)("div",{className:"absolute top-20 px-6 flex flex-col items-center justify-center w-full gap-y-2",children:[(0,n.jsx)(m.Z,{className:"text-foreground-lighter",strokeWidth:1}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-foreground",children:"all"!==V||Q.length>0?"No users found":"No users in your project"}),(0,n.jsx)("p",{className:"text-foreground-light",children:"all"!==V||Q.length>0?"There are currently no users based on the filters applied":"There are currently no users who signed up to your project"})]})]})}})})}),void 0!==er&&(0,n.jsx)(eg.i,{selectedUser:eW.find(e=>e.id===er),onClose:()=>ea(void 0)})]}),(0,n.jsxs)("div",{className:"flex justify-between min-h-9 h-9 overflow-hidden items-center px-6 w-full border-t text-xs text-foreground-light",children:[eE||eL?"Loading users...":"Total: ".concat(null!=eP?eP:0," users"),(eE||eL||eU)&&(0,n.jsxs)("span",{className:"flex items-center gap-2",children:[(0,n.jsx)(x.Z,{size:14,className:"animate-spin"})," Loading..."]})]})]}),(0,n.jsx)(R.Z,{visible:eu,variant:"destructive",title:"Confirm to delete ".concat(el.size," user").concat(el.size>1?"s":""),loading:ex,confirmLabel:"Delete",onCancel:()=>em(!1),onConfirm:()=>eH(),alert:{title:"Deleting ".concat(1===el.size?"a user":"users"," is irreversible"),description:"This will remove the selected ".concat(1===el.size?"":"".concat(el.size," "),"user").concat(el.size>1?"s":""," from the project and all associated data.")},children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["This is permanent! Are you sure you want to delete the"," ",1===el.size?"":"selected ".concat(el.size," "),"user",el.size>1?"s":"",1===el.size?(0,n.jsxs)("span",{className:"text-foreground",children:[" ",null!==(s=null!==(e=null==eM?void 0:eM.email)&&void 0!==e?e:null==eM?void 0:eM.phone)&&void 0!==s?s:"this user"]}):null,"?"]})}),(0,n.jsx)(ev.T,{visible:!!ec,selectedUser:ec,onClose:()=>ed(void 0),onDeleteSuccess:()=>ed(void 0)})]})}},62347:function(e,s,t){var n=t(97458),i=t(64714),r=t(41212),a=t(53486);s.Z=e=>{let{section:s}=e,t=(0,r.WZ)();return(0,n.jsx)(a.z,{size:"tiny",type:"default",onClick:()=>{s&&t.setActiveDocsSection(s),t.setShowProjectApiDocs(!0)},icon:(0,n.jsx)(i.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),children:"API Docs"})}},17209:function(e,s,t){t.d(s,{E:function(){return u}});var n=t(97458),i=t(52983),r=t(12753),a=t(53486),l=t(43633),o=t(12361),c=t(5562),d=t(7257);let u=e=>{let{title:s,options:t=[],activeOptions:u=[],valueKey:m,labelKey:x,iconKey:h="icon",name:p="default",variant:f="rectangular",buttonType:v,disabled:g,labelClass:j,className:y,maxHeightClass:b="h-[205px]",clearButtonText:w="Clear",onSaveFilters:N}=e,[_,S]=(0,i.useState)(!1),[C,k]=(0,i.useState)([]),A=u.map(e=>{let s=t.find(s=>s[m]===e);return s&&s[x]?s[x]:""});return(0,i.useEffect)(()=>{!_&&u.length>0&&k(u)},[_,u]),(0,n.jsxs)(r.J2,{open:_,onOpenChange:S,children:[(0,n.jsx)(r.xo,{asChild:!0,children:(0,n.jsx)(a.z,{asChild:!0,disabled:g,type:null!=v?v:u.length>0?"default":"dashed",onClick:()=>S(!1),className:"rounded"===f?"rounded-full":"",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:p}),u.length>0&&(0,n.jsx)("span",{className:"mr-1",children:":"}),u.length>=3?(0,n.jsxs)("span",{children:[A[0]," and ",u.length-1," others"]}):u.length>0?(0,n.jsx)("span",{children:A.join(", ")}):null]})})}),(0,n.jsxs)(r.yk,{className:(0,l.cn)("p-0 w-44",y),align:"start",children:[(0,n.jsx)("div",{className:"border-b border-overlay bg-surface-200 rounded-t pb-1 px-3",children:(0,n.jsx)("span",{className:"text-xs text-foreground-light",children:null!=s?s:"Select ".concat(p.toLowerCase())})}),(0,n.jsx)(o.xr,{className:t.length>7?b:"",children:(0,n.jsx)("div",{className:"p-3 flex flex-col gap-y-2",children:t.map(e=>{let s=e[m],t=h?e[h]:void 0;return(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsx)(c.X,{id:s,checked:C.includes(s),onCheckedChange:()=>{C.includes(s)?k(C.filter(e=>e!==s)):k(C.concat(s))}}),(0,n.jsxs)(d._,{htmlFor:e[m],className:(0,l.cn)("flex items-center gap-x-2 text-xs",j),children:[t&&(0,n.jsx)("img",{src:t,alt:e[x],className:(0,l.cn)("w-4 h-4",e.iconClass)}),(0,n.jsx)("span",{children:e[x]})]})]},s)})})}),(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,n.jsx)(a.z,{size:"tiny",type:"default",onClick:()=>{N([]),k([]),S(!1)},children:w}),(0,n.jsx)(a.z,{type:"primary",onClick:()=>{let e=t.map(e=>e[m]);N(C.sort((s,t)=>e.indexOf(s)-e.indexOf(t))),S(!1)},children:"Save"})]})]})]})}},55527:function(e,s,t){t.d(s,{p:function(){return a}});var n=t(97458),i=t(43633),r=t(27477);let a=e=>{let{title:s,description:t,docsUrl:a,actions:l,className:o}=e;return(0,n.jsxs)("div",{className:(0,i.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(o)),children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("h3",{className:"text-foreground text-xl prose",children:s}),t&&(0,n.jsx)("div",{className:"prose text-sm max-w-full",children:t})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==a&&(0,n.jsx)(r.G,{href:a}),l]})]})}},45155:function(e,s,t){t.d(s,{T:function(){return c}});var n=t(36457),i=t(64618),r=t(34549),a=t(129),l=t(44309);async function o(e){let{projectRef:s,userId:t}=e,{data:n,error:i}=await (0,a.IV)("/platform/auth/{ref}/users/{id}",{params:{path:{ref:s,id:t}}});return i&&(0,a.S3)(i),n}let c=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,n.NL)();return(0,i.D)(e=>o(e),{async onSuccess(s,t,n){let{projectRef:i,skipInvalidation:r=!1}=t;r||await Promise.all([a.invalidateQueries(l.o.usersInfinite(i)),a.invalidateQueries(l.o.usersCount(i))]),await (null==e?void 0:e(s,t,n))},async onError(e,t,n){void 0===s?r.Am.error("Failed to delete user: ".concat(e.message)):s(e,t,n)},...t})}},6232:function(e,s,t){t.d(s,{x7:function(){return c}});var n=t(90688),i=t(70864),r=t(289),a=t(56535),l=t(44309);let o=e=>{let{page:s=0,verified:t,keywords:n,providers:i,sort:r,order:a}=e,l=[];if(n&&""!==n){let e=n.replaceAll("'","''");l.push("id::text like '%".concat(e,"%' or email like '%").concat(e,"%' or phone like '%").concat(e,"%'"))}"verified"===t?l.push("email_confirmed_at IS NOT NULL or phone_confirmed_at IS NOT NULL"):"anonymous"===t?l.push("is_anonymous is true"):"unverified"===t&&l.push("email_confirmed_at IS NULL AND phone_confirmed_at IS NULL"),i&&i.length>0&&(i.includes("saml 2.0")?l.push("(select jsonb_agg(case when value ~ '^sso' then 'sso' else value end) from jsonb_array_elements_text((raw_app_meta_data ->> 'providers')::jsonb)) ?| array[".concat(i.map(e=>"saml 2.0"===e?"'sso'":"'".concat(e,"'")).join(", "),"]").trim()):l.push("(raw_app_meta_data->>'providers')::jsonb ?| array[".concat(i.map(e=>"'".concat(e,"'")).join(", "),"]")));let o=l.map(e=>"(".concat(e,")")).join(" and ");return"".concat("\n  select *, coalesce((select array_agg(distinct i.provider) from auth.identities i where i.user_id = auth.users.id), '{}'::text[]) as providers from auth.users\n  ".trim()).concat(l.length>0?" where ".concat(o):"",' order by "').concat(null!=r?r:"created_at",'" ').concat(null!=a?a:"desc"," nulls last limit ").concat(50," offset ").concat(50*s,";")},c=function(e){let{projectRef:s,connectionString:t,keywords:c,filter:d,providers:u,sort:m,order:x}=e,{enabled:h=!0,...p}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=(0,r.Vm)(),v=(null==f?void 0:f.status)===a.S.ACTIVE_HEALTHY;return(0,n.N)(l.o.usersInfinite(s,{keywords:c,filter:d,providers:u,sort:m,order:x}),e=>{let{signal:n,pageParam:r}=e;return(0,i.R)({projectRef:s,connectionString:t,sql:o({page:r,verified:d,keywords:c,providers:u,sort:null!=m?m:"created_at",order:null!=x?x:"desc"}),queryKey:l.o.usersInfinite(s)},n)},{enabled:h&&void 0!==s&&v,getNextPageParam(e,s){let t=s.length;if(e.result.length>=50)return t},...p})}},83733:function(e,s,t){t.d(s,{Z:function(){return r}});var n=t(23664),i=t(52983);let r=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,i.useMemo)(()=>{var e;let[t,i]=s;if(!(null===(e=t[0])||void 0===e?void 0:e[i]))return{data:t,error:void 0,isError:!1};try{return{data:(0,n.h6)(...s).sort((e,t)=>new Date(e[s[1]])-new Date(t[s[1]])),error:void 0,isError:!1}}catch(e){return{data:[],error:e,isError:!0}}},[JSON.stringify(s[0]),...s])}},77086:function(e,s,t){t.d(s,{Z:function(){return h}});var n=t(90688),i=t(28894),r=t(28977),a=t.n(r),l=t(52983),o=t(61249),c=t(23664),d=t(129),u=t(30740),m=t(83733),x=(e,s)=>(0,l.useMemo)(()=>0!==e.length&&(0,c.Sj)(e[0][s])?null==e?void 0:e.map(e=>(e[s]=(0,c.tI)(e[s]),e)):e,[JSON.stringify(e)]),h=function(e){var s,t,r,h;let{projectRef:p,table:f,filterOverride:v,limit:g}=e,j=(0,o.PJ)(o.bj),[y,b]=(0,l.useState)(new Date().toISOString()),w=(0,l.useRef)(!0),{timestampStart:N=j.calcFrom(),timestampEnd:_=j.calcTo(),filters:S,search:C}=(0,u.k)(),k=N||j.calcFrom(),A=_||j.calcTo(),z=(0,l.useMemo)(()=>({...S,...v,...C?{search_query:C}:{}}),[S,v,C]),[Z,E]=(0,l.useState)((0,c.UR)(f,z,g)),L={project:p,iso_timestamp_start:k,iso_timestamp_end:A,sql:Z},{data:T,isSuccess:U,isLoading:O,isRefetching:I,error:D,fetchNextPage:P,isFetchingNextPage:F,refetch:W}=(0,n.N)(["projects",p,"logs",L],async e=>{let{signal:s,pageParam:t}=e,{data:n,error:i}=await (0,d.U2)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:p},query:{...L,iso_timestamp_end:t||L.iso_timestamp_end}},signal:s});if(i)throw i;return n},{refetchOnWindowFocus:!1,getNextPageParam(e){var s,t;if((null!==(t=null===(s=e.result)||void 0===s?void 0:s.length)&&void 0!==t?t:0)===0)return;let n=e.result.length,{timestamp:i}=e.result[n-1];return a().utc(Number(i/1e3)).toISOString()}});(0,l.useEffect)(()=>{if(w.current){w.current=!1;return}let e=(0,c.UR)(f,z,g);E(e),V(e)},[JSON.stringify(z)]);let{logData:M,error:R,oldestTimestamp:q}=(0,l.useMemo)(()=>{var e;let s=[],t=D?D.message:null;null==T||T.pages.forEach(e=>{e.result&&(s=[...s,...e.result]),!t&&e&&e.error&&(t=e.error)});let n=null===(e=s[s.length-1])||void 0===e?void 0:e.timestamp;return{logData:s,error:t,oldestTimestamp:n}},[null==T?void 0:T.pages]),{data:X}=(0,i.a)(["projects",p,"logs-count",{...L,sql:(0,c.My)(f,z),timestampStart:k,latestRefresh:y}],async e=>{let{signal:s}=e,{data:t,error:n}=await (0,d.U2)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:p},query:{...L,sql:(0,c.My)(f,z),iso_timestamp_start:y}},signal:s});if(n)throw n;return t},{refetchOnWindowFocus:!1,refetchInterval:6e4,enabled:!R&&!!T&&T.pages.length>0}),H=null!==(r=null==X?void 0:null===(t=X.result)||void 0===t?void 0:null===(s=t[0])||void 0===s?void 0:s.count)&&void 0!==r?r:0,K=(0,l.useMemo)(()=>(0,c.g8)(f,L,z),[f,L.iso_timestamp_end,L.project,z]),{data:B,refetch:G}=(0,i.a)(["projects",p,"logs-chart",{iso_timestamp_end:L.iso_timestamp_end,project:L.project,sql:K}],async e=>{var s,t,n;let{signal:i}=e,{data:r,error:a}=await (0,d.U2)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:p},query:{iso_timestamp_start:null!==(s=L.iso_timestamp_start)&&void 0!==s?s:"",iso_timestamp_end:null!==(t=L.iso_timestamp_end)&&void 0!==t?t:"",project:null!==(n=L.project)&&void 0!==n?n:"",sql:K}},signal:i});if(a)throw a;return r},{refetchOnWindowFocus:!1}),V=async e=>{E(e||(0,c.UR)(f,z,g)),G(),b(new Date().toISOString()),W()};(0,l.useEffect)(()=>{L.iso_timestamp_start=k,L.iso_timestamp_end=A},[k,A]);let Y=x(null!==(h=null==B?void 0:B.result)&&void 0!==h?h:[],"timestamp"),{data:Q,error:J}=(0,m.Z)(Y,"timestamp","count",0,L.iso_timestamp_start,L.iso_timestamp_end||new Date().toISOString());return{newCount:H,logData:M,isSuccess:U,isLoading:O||I,isLoadingOlder:F,error:R||J,filters:z,params:L,oldestTimestamp:q?String(q):void 0,eventChartData:Q,refresh:V,loadOlder:()=>P()}}},42317:function(e,s,t){t.d(s,{O:function(){return r}});var n=t(97458),i=t(43633);let r=e=>{let{loading:s}=e;return(0,n.jsx)("div",{className:"relative overflow-hidden w-full h-px bg-border m-auto",children:(0,n.jsx)("span",{className:(0,i.cn)("absolute w-[80px] h-px ml-auto mr-auto left-0 right-0 text-center block top-0","transition-all","line-loading-bg-light dark:line-loading-bg",s&&"animate-line-loading-slower opacity-100",s?"opacity-100":"opacity-0")})})}}}]);